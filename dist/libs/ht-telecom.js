!function(Q,P){"use strict";var G=ht.AlarmSeverity=function(u,O,f,i,g){this.value=u,this.name=O,this.nickName=f,this.color=i,this.displayName=g};ht.Default.def("ht.AlarmSeverity",P,{toString:function(){return this.displayName||this.name}}),function(){G.severities=new ht.List,G._vm={},G._nm={},G._cp=function(m,U){if(m&&U){var b=m.value-U.value;return b>0?1:0>b?-1:0}return m&&!U?1:!m&&U?-1:0},G.each=function(j,a){G.severities.each(j,a)},G.getSortFunction=function(){return G._cp},G.setSortFunction=function(N){G._cp=N,G.severities.sort(N)},G.add=function(k,J,q,d,x){var K=new G(k,J,q,d,x);return G._vm[k]=K,G._nm[J]=K,G.severities.add(K),G.severities.sort(G._cp),K},G.remove=function(B){var b=G._nm[B];return b&&(delete G._nm[B],delete G._vm[b.value],G.severities.remove(b)),b},G.CRITICAL=G.add(500,"Critical","C","#FF0000"),G.MAJOR=G.add(400,"Major","M","#FFA000"),G.MINOR=G.add(300,"Minor","m","#FFFF00"),G.WARNING=G.add(200,"Warning","W","#00FFFF"),G.INDETERMINATE=G.add(100,"Indeterminate","N","#C800FF"),G.CLEARED=G.add(0,"Cleared","R","#00FF00"),G.isClearedAlarmSeverity=function(b){return b?0===b.value:!1},G.getByName=function(b){return G._nm[b]},G.getByValue=function(O){return G._vm[O]},G.clear=function(){G.severities.clear(),G._vm={},G._nm={}},G.compare=function(t,_){return G._cp(t,_)}}();var x=ht.AlarmState=function(Q){this._d=Q,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",P,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var M=null;for(var A in this._am)A=G.getByName(A),G.isClearedAlarmSeverity(A)||0!==this.getAcknowledgedAlarmCount(A)&&(M=M?G.compare(M,A)>0?M:A:A);this._haa=M},_c2:function(){var _=null;for(var J in this._nm)J=G.getByName(J),G.isClearedAlarmSeverity(J)||0!==this.getNewAlarmCount(J)&&(_=_?G.compare(_,J)>0?_:J:J);this._hna=_},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var f in this._nm)if(f=G.getByName(f),!G.isClearedAlarmSeverity(f)&&0!==this.getNewAlarmCount(f)&&G.compare(this._hna,f)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var U=this._haa,Z=this._hna,C=this._ps;this._hoa=U,G.compare(Z,this._hoa)>0&&(this._hoa=Z),G.compare(C,this._hoa)>0&&(this._hoa=C)},_c5:function(){var Q=this._haa,T=this._hna;this._hta=Q,G.compare(T,this._hta)>0&&(this._hta=T)},increaseAcknowledgedAlarm:function(W,t){if(0!==t){t=t||1;var R=this._am[W.name]||0;R+=t,this._am[W.name]=R,this._f()}},increaseNewAlarm:function(F,G){if(0!==G){G=G||1;var c=this._nm[F.name]||0;c+=G,this._nm[F.name]=c,this._f()}},decreaseAcknowledgedAlarm:function(Q,F){if(0!==F){F||(F=1);var I=this._am[Q.name]||0;if(I-=F,0>I)throw"Alarm count can not be negative";this._am[Q.name]=I,this._f()}},decreaseNewAlarm:function(B,p){if(0!==p){p||(p=1);var m=this._nm[B.name]||0;if(m-=p,0>m)throw"Alarm count can not be negative";this._nm[B.name]=m,this._f()}},acknowledgeAlarm:function(c){this.decreaseNewAlarm(c,1),this.increaseAcknowledgedAlarm(c,1)},acknowledgeAllAlarms:function(X){if(X){var O=this.getNewAlarmCount(X);this.decreaseNewAlarm(X,O),this.increaseAcknowledgedAlarm(X,O)}else for(var v in this._nm)this.acknowledgeAllAlarms(G.getByName(v))},_c6:function(){this._aac=0;for(var _ in this._am)_=G.getByName(_),this._aac+=this.getAcknowledgedAlarmCount(_)},getAcknowledgedAlarmCount:function(J){return J?this._am[J.name]||0:this._aac},getAlarmCount:function(L){return this.getAcknowledgedAlarmCount(L)+this.getNewAlarmCount(L)},_c7:function(){this._nac=0;for(var $ in this._nm)this._nac+=this.getNewAlarmCount(G.getByName($))},getNewAlarmCount:function(r){return r?this._nm[r.name]||0:this._nac},setNewAlarmCount:function(V,s){this._nm[V.name]=s,this._f()},removeAllNewAlarms:function(H){H?delete this._nm[H]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(E,f){this._am[E.name]=f,this._f()},removeAllAcknowledgedAlarms:function(O){O?delete this._am[O.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(b){if(this._ep||(b=null),this._ps!==b){var s=this._ps;this._ps=b,this._f(),this._d.fp("propagateSeverity",s,b)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(Z){var B=this._ep;this._ep=Z,this._d.fp("enablePropagation",B,Z)&&(Z||this.setPropagateSeverity(null))}});var S=ht.AlarmStatePropagator=function(g){this._dataModel=g,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",P,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(m){this._enable!==m&&(this._enable=m,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function($){this.propagate($)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(H){H.data&&this.propagate(H.data)},handleDataPropertyChange:function(Y){if("alarmState"===Y.property||"enablePropagation"===Y.property)this.propagate(Y.data);else if("parent"===Y.property){var S=Y.oldValue;S&&this.propagate(S),this.propagate(Y.data)}},propagate:function(H){H&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(H),this._isPropagating=!1)},propagateToTop:function(H){for(this.propagateToParent(null,H);H&&H.getParent();)this.propagateToParent(H,H.getParent()),H=H.getParent()},propagateToParent:function(W,o){var g=null;o.getChildren().each(function(P){var Z=P.getAlarmState().getHighestOverallAlarmSeverity();G.compare(Z,g)>0&&(g=Z)}),o.getAlarmState().setPropagateSeverity(g)}}),ht.AlarmStateStatistics=function($){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel($)},ht.Default.def("ht.AlarmStateStatistics",P,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(y){var A=this._dataModel;A!==y&&(A&&(A.umd(this.handleDataPropertyChange,this),A.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=y,this.reset(),y.md(this.handleDataPropertyChange,this),y.mm(this.handleDataModelChange,this),this.fp("dataModel",A,y))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(J){"alarmState"===J.property&&(this.increase(J.data),this.fireAlarmStateChange())},handleDataModelChange:function(t){"add"===t.kind?(this.increase(t.data),this.fireAlarmStateChange()):"remove"===t.kind?(this.decrease(t.data),this.fireAlarmStateChange()):"clear"===t.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,G.each(function(L){var v=this.getSumInfo(L);this.sumAcked+=v.ackedCount,this.sumNew+=v.newCount,this.sumTotal+=v.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(M){if(!M)return this.sumNew;var L=this.getSumInfo(M);return L.newCount},getAcknowledgedAlarmCount:function(Q){if(!Q)return this.sumAcked;var m=this.getSumInfo(Q);return m.ackedCount},getTotalAlarmCount:function(d){if(!d)return this.sumTotal;var E=this.getSumInfo(d);return E.totalCount},getSumInfo:function(M){var g=this.severtiyMap[M.name];return g||(g={},g.newCount=0,g.ackedCount=0,g.totalCount=0,this.severtiyMap[M.name]=g),g},decrease:function(v){var Z=this.dataMap[v.getId()];Z&&(delete this.dataMap[v.getId()],G.each(function(k){var F=Z[k.name],E=this.getSumInfo(k);E.newCount=E.newCount-F.newCount,E.ackedCount=E.ackedCount-F.ackedCount,E.totalCount=E.totalCount-F.totalCount},this))},increase:function(U){if(this.decrease(U),!this._filterFunc||this._filterFunc(U)){var T={},M=U.getAlarmState();this.dataMap[U.getId()]=T,G.each(function(k){var j={};j.newCount=M.getNewAlarmCount(k),j.ackedCount=M.getAcknowledgedAlarmCount(k),j.totalCount=M.getAlarmCount(k),T[k.name]=j;var V=this.getSumInfo(k);V.newCount=V.newCount+j.newCount,V.ackedCount=V.ackedCount+j.ackedCount,V.totalCount=V.totalCount+j.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(m){var S=this._filterFunc;this._filterFunc=m,this.reset(),this.fp("filterFunc",S,m)},getFilterFunc:function(){return this._filterFunc}});var A=ht.Data.prototype;A.getAlarmState=function(){return this._alarmState||(this._alarmState=new x(this))},A=ht.DataModel.prototype,A.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},A.setEnableAlarmStatePropagator=function(D){D!=this.isEnableAlarmStatePropagator()&&(D?(this._alarmStatePropagator=new S(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},A=ht.graph.GraphView.prototype,A.getNote2=function(B){var k=B.getAlarmState().getHighestNewAlarmSeverity();if(k){var e=B.getAlarmState().getNewAlarmCount(k)+k.nickName;return B.getAlarmState().hasLessSevereNewAlarms()&&(e+="+"),e}return B.s("note2")},A.getNote2Background=function(c){var G=c.getAlarmState().getHighestNewAlarmSeverity();return G?G.color:c.s("note2.background")},A.getBodyColor=function(g){var u=g.getAlarmState().getHighestNativeAlarmSeverity();return u?u.color:g.s("body.color")},A.getBorderColor=function(Y){var Z=Y.getAlarmState().getPropagateSeverity();return Z?Z.color:Y.s("border.color")},A=ht.widget.TreeView.prototype,A.getBorderColor=function(D){var I=D.getAlarmState().getPropagateSeverity();return I?I.color:D.s("border.color")},A.getIcon=function(F){return F.getIcon()?"__alarmIcon__":null},A=ht.widget.TreeTableView.prototype,A.getBorderColor=function(q){var T=q.getAlarmState().getPropagateSeverity();return T?T.color:q.s("border.color")},A.getIcon=function(j){return j.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(w){return w.getIcon()}},color:{func:function(N){var $=N.getAlarmState().getHighestNativeAlarmSeverity();return $?$.color:N.s("body.color")}},rect:[0,0,16,16]}]});var _=ht.Style;_["note2.expanded"]=!0,_["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);