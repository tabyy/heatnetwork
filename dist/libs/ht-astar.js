!function(Q,Z,D){"use strict";var k=Q.ht;k.Astar={},function(H){var W=H();Q.AStar=W.astar,Q.AStar.Graph=W.Graph}(function(){function U(l){for(var L=l,C=[];L.parent;)C.unshift(L),L=L.parent;return C}function S(){return new k(function(_){return _.f})}function D($,C){C=C||{},this.nodes=[],this.diagonal=!!C.diagonal,this.grid=[];for(var D=0;D<$.length;D++){this.grid[D]=[];for(var u=0,U=$[D];u<U.length;u++){var F=new H(D,u,U[u]);this.grid[D][u]=F,this.nodes.push(F)}}this.$13x()}function H(P,E,u){this.x=P,this.y=E,this.weight=u}function k(H){this.content=[],this.scoreFunction=H}var d={search:function(l,j,C,a){l.$6x(),a=a||{};var i=a.heuristic;i||(i=l.diagonal?d.$4x.diagonal:d.$4x.manhattan);var y=a.closest||!1,m=a.punish,h=S(),n=j;for(j.h=i(j,C),l.$7x(j),h.push(j);h.size()>0;){var X=h.pop();if(X===C)return U(X);X.closed=!0;for(var V=l.neighbors(X),I=0,e=V.length;e>I;++I){var z=V[I];if(!z.closed&&!z.$9x()){var f=X.g+z.getCost(X,m),t=z.visited;(!t||f<z.g)&&(z.visited=!0,z.parent=X,z.h=z.h||i(z,C),z.g=f,z.f=z.g+z.h,l.$7x(z),y&&(z.h<n.h||z.h===n.h&&z.g<n.g)&&(n=z),t?h.$10x(z):h.push(z))}}}return y?U(n):[]},$4x:{manhattan:function(v,J){var u=Math.abs(J.x-v.x),o=Math.abs(J.y-v.y);return u+o},diagonal:function(c,d){var Z=1,n=Math.sqrt(2),N=Math.abs(d.x-c.x),U=Math.abs(d.y-c.y);return Z*(N+U)+(n-2*Z)*Math.min(N,U)}},$5x:function(y){y.f=0,y.g=0,y.h=0,y.visited=!1,y.closed=!1,y.parent=null}};return D.prototype.$13x=function(){this.dirtyNodes=[];for(var I=0;I<this.nodes.length;I++)d.$5x(this.nodes[I])},D.prototype.$6x=function(){for(var O=0;O<this.dirtyNodes.length;O++)d.$5x(this.dirtyNodes[O]);this.dirtyNodes=[]},D.prototype.$7x=function(H){this.dirtyNodes.push(H)},D.prototype.neighbors=function(J){var i=[],T=J.x,B=J.y,h=this.grid;return h[T-1]&&h[T-1][B]&&i.push(h[T-1][B]),h[T+1]&&h[T+1][B]&&i.push(h[T+1][B]),h[T]&&h[T][B-1]&&i.push(h[T][B-1]),h[T]&&h[T][B+1]&&i.push(h[T][B+1]),this.diagonal&&(h[T-1]&&h[T-1][B-1]&&i.push(h[T-1][B-1]),h[T+1]&&h[T+1][B-1]&&i.push(h[T+1][B-1]),h[T-1]&&h[T-1][B+1]&&i.push(h[T-1][B+1]),h[T+1]&&h[T+1][B+1]&&i.push(h[T+1][B+1])),i},D.prototype.toString=function(){for(var L=[],f=this.grid,G=0;G<f.length;G++){for(var e=[],U=f[G],v=0;v<U.length;v++)e.push(U[v].weight);L.push(e.join(" "))}return L.join("\n")},H.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},H.prototype.getCost=function(f,L){var H;if(H=f&&f.x!=this.x&&f.y!=this.y?1.41421*this.weight:this.weight,L){var j=f;if(!j)return H;var C=j.parent;return C?Math.abs(C.x+this.x-2*j.x)>1e-5?H+L:Math.abs(C.y+this.y-2*j.y)>1e-5?H+L:H:H}},H.prototype.$9x=function(){return 0===this.weight},k.prototype={push:function(i){this.content.push(i),this.$11x(this.content.length-1)},pop:function(){var B=this.content[0],r=this.content.pop();return this.content.length>0&&(this.content[0]=r,this.$12x(0)),B},remove:function(s){var l=this.content.indexOf(s),T=this.content.pop();l!==this.content.length-1&&(this.content[l]=T,this.scoreFunction(T)<this.scoreFunction(s)?this.$11x(l):this.$12x(l))},size:function(){return this.content.length},$10x:function(n){this.$11x(this.content.indexOf(n))},$11x:function(j){for(var d=this.content[j];j>0;){var X=(j+1>>1)-1,u=this.content[X];if(!(this.scoreFunction(d)<this.scoreFunction(u)))break;this.content[X]=d,this.content[j]=u,j=X}},$12x:function(z){for(var m=this.content.length,D=this.content[z],v=this.scoreFunction(D);;){var N,P=z+1<<1,n=P-1,Z=null;if(m>n){var Y=this.content[n];N=this.scoreFunction(Y),v>N&&(Z=n)}if(m>P){var G=this.content[P],u=this.scoreFunction(G);(null===Z?v:N)>u&&(Z=P)}if(null===Z)break;this.content[z]=this.content[Z],this.content[Z]=D,z=Z}}},{astar:d,Graph:D}});var L=k.Astar.Finder=function(j,h){var M=this;M.gv=j,M.$13x(h),M.refreshMap()};L.prototype={},L.prototype.constructor=L,Z.defineProperties(L.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(d){this.gv._astarDebugInfo=d}}}),L.prototype.$13x=function(N){var W=this,d=W.$14x={};N=N||{};var P=N.gridSize||10;d.gridSizeX=N.gridSizeX||P,d.gridSizeY=N.gridSizeY||P,d.rect=N.rect,d.filter=N.filter,d.extendBlocks=N.extendBlocks||3,d.fastOverlap=N.fastOverlap===D?!0:N.fastOverlap,d.nodeRectExtend=N.nodeRectExtend||0,d.diagonal=N.diagonal===D?!0:N.diagonal,d.turnPunish=N.turnPunish===D?.1:N.turnPunish,d.simplify=N.simplify===D?!0:N.simplify,d.toGridCenter=N.toGridCenter===D?!1:N.toGridCenter,d.closest=N.closest===D?!0:N.closest},L.prototype.refreshMap=function(){var C,I=this,r=I.$14x,o=r.gridSizeX,D=r.gridSizeY,A=r.extendBlocks;r.rect?C=r.rect:(C=I.$15x(),k.Default.grow(C,o*A,D*A)),k.Default.grow(C,o,D);var y=Math.floor(C.x/o)*o,e=Math.floor(C.y/D)*D,i=Math.ceil(C.width/o),$=Math.ceil(C.height/D),Y=i*o,N=$*D;I.$16x={x:y,y:e,w:Y,h:N,gridX:o,gridY:D,xLen:i,yLen:$},I.$17x(),I.$21x()},L.prototype.$15x=function(){var $=this.gv;if($ instanceof k.graph.GraphView)return $.getContentRect();var J,W=k.Default.unionRect;return $.dm().each(function(_){$.isVisible(_)&&_.getRect&&(J=W(J,_.getRect()))}),J},L.prototype.$17x=function(){var M,N,A,g,H=this,q=H.$16x,u=q.xLen,x=q.yLen;for(M=new Array(u),A=0;u>A;A++)for(M[A]=N=new Array(x),g=x;g--;)N[g]=1;var Q=H.$14x.filter;for(H.gv.dm().each(function(N){Q&&Q(N)===!1||(!H._debugInfo||N!==H._debugInfo.grid&&N!=H._debugInfo.path)&&H.$1cw(M,N)}),A=0;u>A;A++)M[A][0]=1,M[A][x-1]=1;for(g=0;x>g;g++)M[0][g]=1,M[u-1][g]=1;H.grid=M;var i=new AStar.Graph(M,{diagonal:H.$14x.diagonal});H.graph=i},L.prototype.$18x=function(c,Y,j,p,v,r,O,x){var W=this.$19x,F=W(j-c,v-O,p-Y,r-x);if(1e-6>=F&&F>=-1e-6)return!1;var I=W(v-c,v-O,r-Y,r-x)/F;if(0>I||I>1)return!1;var T=W(j-c,v-c,p-Y,r-Y)/F;return 0>T||T>1?!1:!0},L.prototype.$19x=function(V,a,v,e){return V*e-a*v},L.prototype.$1aw=function(C,m,h,V){for(var d=[-(m[1]-C[1]),m[0]-C[0]],x=d[0]*(h[0]-C[0])+d[1]*(h[1]-C[1])>=0,S=0,B=V.length;B>S;S+=2)if(d[0]*(V[S]-C[0])+d[1]*(V[S+1]-C[1])>=0===x)return!1;return!0},L.prototype.$1bw=function(I,O){for(var r,M,W=this,X=0,F=I.length;F>X;X+=2)if(r=X===F-2?0:X+2,M=r===F-2?0:r+2,W.$1aw([I[X],I[X+1]],[I[r],I[r+1]],[I[M],I[M+1]],O))return!1;for(var X=0,F=O.length;F>X;X+=2)if(r=X===F-2?0:X+2,M=r===F-2?0:r+2,W.$1aw([O[X],O[X+1]],[O[r],O[r+1]],[O[M],O[M+1]],I))return!1;return!0},L.prototype.$1cw=function(t,N){if(N.getRect){var C=this,z=N.getRect();k.Default.grow(z,C.$14x.nodeRectExtend);var T,H,b,D,y,$,e,h,E,f,u,K=C.$1dw({x:z.x,y:z.y}),r=C.$1dw({x:z.x+z.width,y:z.y+z.height}),n=C.$14x.fastOverlap;if(!n){var Q=N.getCorners();e=[],Q.forEach(function(u){e.push(u.x,u.y)}),f=C.$14x.gridSizeX/2,u=C.$14x.gridSizeY/2}for(H=Math.max(0,K.x),b=Math.min(r.x,t.length-1),y=Math.max(0,K.y),$=Math.min(r.y,t.length?t[0].length-1:-1),T=H;b>=T;T++)for(D=y;$>=D;D++)if(n)t[T][D]=0;else{E=C.$1ew({x:T,y:D});var U=E.x-f,j=E.x+f,x=E.y-u,p=E.y+u;h=[U,x,U,p,j,p,j,x],C.$1bw(e,h)&&(t[T][D]=0)}}},L.prototype.$1dw=function(C,L){var e=this,W=e.$16x,R=(C.x-W.x)/W.gridX,A=(C.y-W.y)/W.gridY;return L!==!1&&(R=Math.round(R),A=Math.round(A)),{x:R,y:A}},L.prototype.$1ew=function(t){var v=this,A=v.$16x;return{x:t.x*A.gridX+A.x,y:t.y*A.gridY+A.y}},L.prototype.$1fw=function(B){var o=this,T=o.$16x,q=T.xLen,y=T.yLen;if(B.x>=0&&B.x<q&&B.y>=0&&B.y<y)return B;var H={x:B.x,y:B.y};return H.x<0?H.x=0:H.x>=q&&(H.x=q-1),H.y<0?H.y=0:H.y>=y&&(H.y=y-1),H},L.prototype.findPath=function(i,T){var k,R,F,W,p=this,K=p.$1dw(i),t=p.$1dw(T);if(F=p.$1fw(K),W=p.$1fw(t),F!==K&&W!==t){var s=p.$16x,y=s.x-s.gridX/2,I=s.y-s.gridY/2,_=y+s.gridX*s.xLen,M=I+s.gridY*s.yLen;if(!(p.$18x(i.x,i.y,T.x,T.y,y,I,_,I)||p.$18x(i.x,i.y,T.x,T.y,_,I,_,M)||p.$18x(i.x,i.y,T.x,T.y,_,M,y,M)||p.$18x(i.x,i.y,T.x,T.y,y,M,y,I)))return[i,T]}F!==K&&(k=!0,K=F),W!==t&&(R=!0,t=W);var v=p.graph.grid[K.x][K.y],J=p.graph.grid[t.x][t.y],D=AStar.search(p.graph,v,J,{closest:p.$14x.closest,punish:p.$14x.turnPunish});if(!D||!D.length)return null;var Q=[];Q.push(i),k&&Q.push(p.$1ew(D[0]));for(var r=1,h=D.length;h-1>r;r++)Q.push(p.$1ew(D[r]));if(R)Q.push(p.$1ew(D[h-1])),Q.push(T);else{var C=D[h-1];t.x!==C.x||t.y!==C.y||p.$14x.toGridCenter?Q.push(p.$1ew(C)):Q.push(T)}return p.$14x.simplify&&(Q=p.simplifyPath(Q)),p.$20x=Q,p.$21x(),Q},L.prototype.debugOn=function(L){this.debugFlag=!0,this.debugSettings=L||{},this.$21x()},L.prototype.simplifyPath=function(R){var d=R.length;if(2>=d)return R;var q,k,W=[R[0],R[1]],l=W[0],E=W[1],C=1e-5;for(q=2;d>q;q++)k=R[q],Math.abs((E.x-l.x)*(k.y-l.y)-(E.y-l.y)*(k.x-l.x))<C?E=W[W.length-1]=k:(l=E,E=k,W.push(k));return W},L.prototype.$21x=function(){var f=this;if(f.$22x(),this.debugFlag){var V=f.grid;if(V){var d,T=f.gv;if(f.debugSettings.$16x!==!1){d=[];for(var O,y,v,U,P,G=[],F=f.$14x.gridSizeX/2,Z=f.$14x.gridSizeY/2,r=V.length,L=r?V[0].length:0,o=1;r-1>o;o++)for(var E=1;L-1>E;E++)V[o][E]||(O=f.$1ew({x:o,y:E}),y=O.x-F,v=O.x+F,U=O.y-Z,P=O.y+Z,d.push({x:y,y:U},{x:y,y:P},{x:v,y:P},{x:v,y:U}),G.push(1,2,2,2,5));var c=new k.Shape;c.s("shape.border.color","rgba(50, 50, 50, 0.2)"),c.s("shape.border.width",1),c.s("shape.background","rgba(200, 50, 100, 0.2)"),c.s("2d.editable",!1),c.s("2d.selectable",!1),c.setPoints(d),c.setSegments(G),f._debugInfo={grid:c},T.dm().add(c)}f.debugSettings.path!==!1&&(d=new k.Shape,f.$20x&&(d.setPoints(f.$20x),d.s("shape.border.color","red"),d.s("shape.border.width",1),d.s("2d.editable",!1),d.s("2d.selectable",!1),d.s("shape.background",null),f._debugInfo||(f._debugInfo={}),f._debugInfo.path=d,T.dm().add(d)))}}},L.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},L.prototype.$22x=function(){var D=this;if(D._debugInfo){var i=D._debugInfo.grid,P=D._debugInfo.path,W=D.gv;i&&W.dm().remove(i),P&&W.dm().remove(P),D._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);