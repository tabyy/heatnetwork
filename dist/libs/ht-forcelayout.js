!function(r,U){"use strict";var j="ht",x=j+".layout.",X=r[j]||module.parent.exports.ht,c=X.List,O=X.DataModel,M=X.Node,$=X.Edge,A=X.Group,D=Math,I=D.sqrt,S=D.random,q=D.max,f=D.min,E=function(Y){return Y*Y};X.Default.getInternal().addMSMap({ms_force:function(z){z._interval=50,z._stepCount=10,z._motionLimit=.01,z._edgeRepulsion=.65,z._nodeRepulsion=.65,z._damper=1,z._maxMotion=0,z._motionRatio=0,z.init=function(k){var F=this;k instanceof O?F.dm=k:F.gv=k,F._nodeMap={},F._nodes=new c,F._edges=new c},z.start=function(){var K=this,v=K.gv;if(!K._timer){var q=K.cdm=v?v.dm():K.dm;q.mm(K.handleDataModelChange,K),q.md(K.handleDataPropertyChange,K),v&&v.mp(K.handleGV,K),q.each(function(w){if(K.isVisible(w)&&K.isLayoutable(w)&&w instanceof M)if(K instanceof b){var f=w.p3();w.p3([f[0]+S(),f[1]+S(),f[2]+S()])}else f=w.p(),w.p(f.x+S(),f.y+S())}),K._timer=setInterval(function(){K.relax()},K._interval),K._damper=1}},z.stop=function(){var u=this;u._timer&&(u.cdm.umm(u.handleDataModelChange,u),u.cdm.umd(u.handleDataPropertyChange,u),u.gv&&u.gv.ump(u.handleGV,u),clearInterval(u._timer),delete u._timer,delete u.cdm)},z.handleGV=function(c){var Z=this;if("dataModel"===c.property){var t=c.oldValue,F=c.newValue;t&&(t.umm(Z.handleDataModelChange,Z),t.umd(Z.handleDataPropertyChange,Z)),this.cdm=F,F.mm(Z.handleDataModelChange,Z),F.md(Z.handleDataPropertyChange,Z)}},z.relax=function(){var y=this;if(!(y._damper<.1&&y._maxMotion<y._motionLimit)){this.cdm.each(function(t){y.isVisible(t)&&(t instanceof $?y.addEdge(t):t instanceof M&&y.addNode(t))});for(var W,J,m=0,I=y._edges,c=y._nodes,R=c.size();m<y._stepCount;m++){for(I.each(y.relaxEdge,y),W=0;R>W;W++)for(J=0;R>J;J++)y.relaxNode(c.get(W),c.get(J));y.moveNode()}y._isAdjusting=1,c.each(function(k){k.fix||(k.p?k.v.p3(k.p):k.v.p(k.x,k.y))}),delete y._isAdjusting,y._nodeMap={},c.clear(),I.clear(),y.onRelaxed()}},z.onRelaxed=function(){},z.isRunning=function(){return!!this._timer},z.isVisible=function(C){return C.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(C):!0},z.isLayoutable=function(o){if(o.s("layoutable")===!1)return!1;if(o instanceof A)return!1;var V=this;return V.gv?V.gv.isMovable(o)&&!V.gv.isSelected(o):!(V.cdm||V.dm).sm().co(o)},z.getNodeRepulsion=function(){return this._nodeRepulsion},z.setNodeRepulsion=function(G){this._nodeRepulsion=G,this._damper=1},z.getEdgeRepulsion=function(){return this._edgeRepulsion},z.setEdgeRepulsion=function(n){this._edgeRepulsion=n,this._damper=1},z.getStepCount=function(){return this._stepCount},z.setStepCount=function(s){this._stepCount=s,this._damper=1},z.getInterval=function(){return this._interval},z.setInterval=function(K){var V=this;V._interval!==K&&(V._interval=K,V._timer&&(clearInterval(V._timer),V._timer=setInterval(function(){V.relax()},K)))},z.handleDataPropertyChange=function(p){!this._isAdjusting&&this.isVisible(p.data)&&(this._damper=1)},z.handleDataModelChange=function(){this._damper=1},z.damp=function(){var z=this._maxMotion,G=this._damper;this._motionRatio<=.001&&((.2>z||z>1&&.9>G)&&G>.01?this._damper-=.01:.4>z&&G>.003?this._damper-=.003:G>1e-4&&(this._damper-=1e-4)),z<this._motionLimit&&(this._damper=0)}}}),X.layout.ForceLayout=function(S){this.init(S)},X.Default.def(x+"ForceLayout",U,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(N){this._limitBounds=N,this._damper=1},getNodeSize:function(b){var G=this.gv;return G&&G.getDataUIBounds?G.getDataUIBounds(b):b.getRect()},addNode:function(D){var W=this,X=W._nodeMap[D._id];if(X)return X;var a=D.p();X={v:D,x:a.x,y:a.y,dx:0,dy:0,fix:!W.isLayoutable(D),s:W.getNodeSize(D)};var e=X.s,H=I(E(e.width)+E(e.height))*W._nodeRepulsion;return X.r=1>H?100:H,W._nodeMap[D._id]=X,W._nodes.add(X),X},addEdge:function($){if($._40I&&$._41I){var G=this,h=G.addNode($._40I),N=G.addNode($._41I),w={s:h,t:N};N=N.s,h=h.s;var V=N.width+h.width,x=N.height+h.height;w.length=I(V*V+x*x)*G._edgeRepulsion,w.length<=0&&(w.length=100),G._edges.add(w)}},relaxEdge:function(S){var T=S.t,v=S.s,x=T.x-v.x,g=T.y-v.y,W=I(x*x+g*g),N=100*S.length,C=.25*x/N*W,d=.25*g/N*W;T.dx=T.dx-C,T.dy=T.dy-d,v.dx=v.dx+C,v.dy=v.dy+d},relaxNode:function(p,C){if(p!==C){var D=0,g=0,K=p.x-C.x,s=p.y-C.y,V=K*K+s*s;0===V?(D=S(),g=S()):36e4>V&&(D=K/V,g=s/V);var A=p.r*C.r/400;D*=A,g*=A,p.dx+=D,p.dy+=g,C.dx-=D,C.dy-=g}},moveNode:function(){var g=this,u=g._limitBounds,G=g._maxMotion,M=0,b=g._damper;g._nodes.each(function(C){if(!C.fix){var z=C.dx*b,p=C.dy*b;if(C.dx=z/2,C.dy=p/2,M=q(I(z*z+p*p),M),C.x+=q(-40,f(40,z)),C.y+=q(-40,f(40,p)),u){C.x<u.x&&(C.x=u.x,g.adjust(1,0)),C.y<u.y&&(C.y=u.y,g.adjust(0,1));var y=C.s;C.x+y.width>u.x+u.width&&(C.x=u.x+u.width-y.width,g.adjust(-1,0)),C.y+y.height>u.y+u.height&&(C.y=u.y+u.height-y.height,g.adjust(0,-1))}}}),g._maxMotion=M,g._motionRatio=M>0?G/M-1:0,g.damp()},adjust:function(j,P){var m=this._limitBounds;this._nodes.each(function(b){j>0?(!m||b.x+b.s.width+j<m.x+m.width)&&(b.x+=j):(!m||b.x+j>m.x)&&(b.x+=j),P>0?(!m||b.y+b.s.height+P<m.y+m.height)&&(b.y+=P):(!m||b.y+P>m.y)&&(b.y+=P)})}});var b=X.layout.Force3dLayout=function(i){this.init(i)};X.Default.def(x+"Force3dLayout",U,{ms_force:1,getNodeSize3d:function(v){return v.s3()},addNode:function(t){var w=this,N=w._nodeMap[t._id];if(N)return N;N={v:t,p:t.p3(),d:[0,0,0],fix:!w.isLayoutable(t),s:w.getNodeSize3d(t)};var D=N.s,r=X.Default.getDistance(D)*w._nodeRepulsion;return N.r=1>r?100:r,w._nodeMap[t._id]=N,w._nodes.add(N),N},addEdge:function(Z){if(Z._40I&&Z._41I){var n=this,G=n.addNode(Z._40I),B=n.addNode(Z._41I),g={s:G,t:B};B=B.s,G=G.s,g.length=I(E(B[0]+G[0])+E(B[1]+G[1])+E(B[2]+G[2]))*n._edgeRepulsion,g.length<=0&&(g.length=100),n._edges.add(g)}},relaxEdge:function(J){var X=J.t.p,L=J.s.p,$=J.t.d,z=J.s.d,E=X[0]-L[0],e=X[1]-L[1],t=X[2]-L[2],O=I(E*E+e*e+t*t),P=100*J.length,A=.25*E/P*O,K=.25*e/P*O,o=.25*t/P*O;$[0]-=A,$[1]-=K,$[2]-=o,z[0]+=A,z[1]+=K,z[2]+=o},relaxNode:function(L,h){if(L!==h){var V=L.p,u=h.p,y=0,Z=0,x=0,B=V[0]-u[0],z=V[1]-u[1],c=V[2]-u[2],D=B*B+z*z+c*c;0===D?(y=S(),Z=S(),x=S()):216e6>D&&(y=B/D,Z=z/D,x=c/D);var o=L.r*h.r/400,q=L.d,U=h.d;y*=o,Z*=o,x*=o,q[0]+=y,q[1]+=Z,q[2]+=x,U[0]-=y,U[1]-=Z,U[2]-=x}},moveNode:function(){var $=this,X=$._maxMotion,S=0,_=$._damper;$._nodes.each(function(p){if(!p.fix){var F=p.p,c=p.d,P=c[0]*_,r=c[1]*_,T=c[2]*_;c[0]=P/2,c[1]=r/2,c[2]=T/2,S=q(I(P*P+r*r+T*T),S),F[0]+=q(-40,f(40,P)),F[1]+=q(-40,f(40,r)),F[2]+=q(-40,f(40,T))}}),$._maxMotion=S,$._motionRatio=S>0?X/S-1:0,$.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);