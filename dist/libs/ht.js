!function(U,C,H){"use strict";var t="ht";if(!U[t]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),U.performance&&U.performance.now||function(){var x=Date.now();U.performance||(U.performance={}),U.performance.now=function(){return Date.now()-x}}();for(var B=Date.now(),V=16,g=["ms","moz","webkit","o"],T=0;T<g.length&&!U.requestAnimationFrame;++T)U.requestAnimationFrame=U[g[T]+"RequestAnimationFrame"],U.cancelAnimationFrame=U[g[T]+"CancelAnimationFrame"]||U[g[T]+"CancelRequestAnimationFrame"];U.requestAnimationFrame||(U.requestAnimationFrame=function(t){var d=Date.now(),$=V+B-d;return 0>$&&($=0),B=d,U.setTimeout(function(){B=Date.now(),t(performance.now())},$)}),U.cancelAnimationFrame||(U.cancelAnimationFrame=function(I){return U.clearTimeout(I)}),C.assign===H&&(C.assign=function(K){if(K===H||null===K)throw new TypeError("Cannot convert undefined or null to object");for(var a=C(K),t=1;t<arguments.length;t++){var k=arguments[t];if(k!==H&&null!==k)for(var P in k)C.prototype.hasOwnProperty.call(k,P)&&(a[P]=k[P])}return a})}();var i=U.document,I=null,j=U[t]={},z=U[t+"config"],h=j.Default=z&&z.Default||{},v=j.Style=z&&z.Style||{},M=j.Attr=z&&z.Attr||{},R=j.Color=z&&z.Color||{},Q=j.IsGetter=z&&z.IsGetter||{};!function(){var B=!1;try{var n=C.defineProperty({},"passive",{get:function(){B=!0}});U.addEventListener("test",n,n),U.removeEventListener("test",n,n)}catch(p){B=!1}h.passiveSupported=B}();var x,q,s,m,w=h.passiveSupported,P=h.eventListenerOptionsFalse=w?{passive:!1,capture:!1}:!1,y=h.eventListenerOptionsTrue=w?{passive:!1,capture:!0}:!0,L=Math,A=L.round,$=L.floor,c=L.ceil,p=L.sqrt,o=L.max,N=L.min,J=L.abs,O=L.cos,a=L.acos,f=L.sin,d=L.pow,u=L.asin,g=L.PI,W=2*g,S=g/2,V=L.tan,B=L.atan2,l=L.random,n=L.log,T=!1,F=!1,G=U.parseInt||global.parseInt,Y="2018-12-28",X=U.navigator?U.navigator.platform.indexOf("Win")>-1:!1,D=function(t){return t*t},e=U.setTimeout,r=U.clearTimeout,K=U.location,Z=U.navigator?U.navigator.userAgent.toLowerCase():"",_=function(F){return F.test(Z)},b=_(/msie/),E=_(/msie/)||_(/trident/),k=_(/msie 10/),Hm=_(/edge/),Sq=_(/firefox/),pf=_(/mac/),hd=h.isTouchable===H?X?!1:i?"ontouchend"in i:!1:h.isTouchable,Ci="default",Oc="single",Kq="multiple",uq="front",gh="back",Mn="left",rj="right",yo="top",Fl="bottom",Ai="center",Lm="eye",Nk="middle",Nd="east",Tj="west",le="north",ls="none",pj="px",Og="absolute",ci="border",Em="triangle",nn="rect",Go="circle",Zq="cylinder",Rc="shape",Uj="items",Qg="normal",Rf="remove",Zd="clear",cq="width",lh="height",Pj="ingroup",Vk="check",Dj="uncheck",tg="radio",Dm="radioOn",Si="radioOff",iq="points",jd="values",hc="series",wf="body",qm="label",je="label2",_p="note",hi="note2",ce="icons",Wo="labelFont",Kp="labelColor",Ek="labelSelectColor",xb="note.expanded",Ub="note2.expanded",Yf="edge.expanded",Qe="edge.points",rd="edge.type",_j="rotation",tk="hidden",Qn="visible",Ap="tuv",fg="no",Lf="draw",yg="select",_d="currentSubGraph",lp="selectBackground",Wc="autoMakeVisible",Qo="autoHideScrollBar",Ji="scrollBarColor",Er="scrollBarSize",te="indent",Ud="rowHeight",Zj="columnLineColor",nj="rowLineColor",lf="columnLineVisible",Tl="rowLineVisible",Dr="visibleFunc",Sl="expandIcon",on="collapseIcon",Oj="checkMode",qe="sortFunc",hm="editable",hh="batchEditable",Ri="tristate",Gh="asc",zb="desc",Sf="position",sr="elevation",ff="children",dh="translateX",ul="translateY",ik="dataModel",Sp="maxSize",Qd="shape3d",ln="shape3d.resolution",Li="shape3d.visible",Bl="shape3d.from.visible",Hk="shape3d.to.visible",js="shape3d.top.visible",kd="shape3d.bottom.visible",hf="repeat.uv.length",Zh="serializeValue",md="deserializeValue",Jc="centerUniform",ei="uniform",Vl="rgba(255,255,255,0)",vi="style",bp="attr",Pn="field",Gr="string",jc="boolean",sq="color",yd="int",Bo="number",rm="ew-resize",Kl="ns-resize",Yb="pointer",Sm="auto",gk="mousedown",wo="mousemove",$f="mouseup",Ir="mouseout",km="touchstart",jn="touchmove",Fq="touchend",Cb="keydown",rn="keyup",Se=["DOMMouseScroll","mousewheel"],fc=Sq?Se[0]:Se[1],kb=hd?[km,jn,Fq,Cb,rn,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"]:[Cb,rn,"keypress","input",gk,wo,$f,Ir,fc,"wheel","contextmenu","mouseenter","mouseleave","mouseover","compositionstart","compositionupdate","compositionend"],cc=I,_n=I,ep=I,gb=$f.length,Bd=function(){ep&&(r(ep.timeout),ep=I)},Vr=function(){ep&&rg(ep.e,ep.info)};U.addEventListener&&(hd||(U.addEventListener(Ir,function(){Bd()},P),U.addEventListener(fc,function(){Kg()},P)),U.addEventListener(rn,function(S){91===S.keyCode?ij={}:delete ij[S.keyCode]},y),U.addEventListener(Cb,function(x){ij[x.keyCode]=!0},y),U.addEventListener("blur",function(){ij={}},P));var Sn,Zr,xm,Nf=0,ok=I,$e=function(o,p){var E=e(function(){delete ok[E],fh(ok)&&(ok=I),o()},p);return E},Ae=I,tf=I,_k={},co={},Vj={},gd={},am={},ij={},sj={},ek={},hn={},wb={},up=/.json$/,Ld=/^data:image\/svg\+xml/,rf={},Je=[],Cf={},fn=I,Dh=I,Mo=function(){},Gg=function(){throw"Oops!"},we=[0,0,0],Lk=[0,0,0,0],jq={x:0,y:0,width:0,height:0},Td=I,to=I,ge=I,di=function(n){to&&!n._72O&&(ge||(ge={}),ge[n._72O=sl()]=n),Sn!=I?Jn()<.05&&m&&!Zr&&(np=Bd):np=Ro},kf=function(j,s,g,Q){to||(to={});var t=to[j];if(t){if(t.url===s)return;t.image?(t.image.onload=Mo,t.image.onerror=Mo):t.request&&(t.request.onload=Mo,t.request.onerror=Mo)}if(up.test(s)){var z=new Ml;if(to[j]={request:z,url:s},s=h.beforeLoadURL(s),s.data){var W=h.parse(s.data);ii(j,W),h.handleImageLoaded(j,W)}else{z.onload=function(r){if(200===this.status||0===this.status){var Q=h.parse(r.target.response||r.target.responseText);ii(j,Q),h.handleImageLoaded(j,Q)}else ii(j,h.handleUnfoundImage(j,s)||I)},z.onerror=function(){ii(j,h.handleUnfoundImage(j,s)||I)};var C={};C.url=encodeURI(s),C.sync=!1,z.send(C)}}else{var W=new Image;to[j]={image:W,url:s},/^data:image/.test(s)||(s=h.beforeLoadURL(s),s=h.appendTimeStamp(s),s=encodeURI(s),W.crossOrigin=h.crossOrigin),h.convertImageSrc(s,function(_){E&&(s.toLowerCase().indexOf(".svg")>0||Ld.test(s))?(i.body.appendChild(W),W.style.visibility="hidden",W.onload=function(){e(function(){if(g&&(W.width=g),Q&&(W.height=Q),!W.width||!W.height){var O=W.width||W.clientWidth,t=W.height||W.clientHeight;W.width=O,W.height=t}h.handleImageLoaded(j,W),ii(j,W),i.body.removeChild(W),W.style.visibility=""},180)},W.onerror=function(){ii(j,h.handleUnfoundImage(j,s)||I),i.body.removeChild(W),W.style.visibility=""}):(W.onload=function(){g&&(W.width=g),Q&&(W.height=Q),h.handleImageLoaded(j,W),ii(j,W)},W.onerror=function(){ii(j,h.handleUnfoundImage(j,s)||I)}),W.src=_})}},ii=function(L,B){if(co[L]=B,delete to[L],fh(to)&&(to=I,ge)){for(var G in ge){var T=ge[G];T._2O&&(T._2O={}),T.invalidateAll&&T.invalidateAll(H,"imageLoaded",L),T.redraw&&T.redraw(),T.iv(),delete T._72O}ge=I}if(B&&ge)for(var G in ge){var T=ge[G];T.invalidateAll&&T.invalidateAll(H,"imageLoading",L),T.redraw&&T.redraw(),T.iv()}},Xi=function(){return n=L&&Date,function(){return U.performance&&U.performance.now?U.performance.now():Date.now()}}(),ne=function(j,O){O?r(j):U.cancelAnimationFrame(j)},go=function(M,B,Z){return{width:M,height:B,comps:Ck(Z)?Z:[Z]}},zf=function(C,Z){return{type:Go,rect:[C,Z,1.6,1.6],borderWidth:1,borderColor:Zm,gradient:vd,gradientColor:bo,background:Zm}},$j=function(c,F){return go(16,16,{type:Em,rect:[4,4,10,8],background:c,rotation:F?1.57:3.14})},ac=function(z,d){return go(16,16,{type:Em,rect:[4,4,8,7],background:z,rotation:d?3.14:0})},pg=function(d){var W=d._orientation;return"horizontal"===W||"h"===W},zs=function(v){var w=I||4,Q=I||1,o=I||1;0>w?w=0:w>.25&&(w=.25);var x,z,J,u,C,t,a,l=.5,D=[],V=[],X=[],m=W/o,U=W/Q,b=l-w;for(z=0;Q>=z;z++)for(u=-g+z*U,t=O(u),C=f(u),x=0;o>=x;x++)J=x*m,a=b+w*t,D.push(O(J)*a,C*w,-f(J)*a),(q=v)&&V.push(x/o,1-z/Q);for(z=0;Q>z;z++){var G=z*(o+1),L=(z+1)*(o+1);for(x=0;o>x;x++)X.push(G+x,L+x+1,L+x,G+x,G+x+1,L+x+1),Xo.z=lb.z=v}},el=function(L){var r=2,E=0;for(var D in L)D.length===r&&G(D,32)===rk&&(fn=Dh=L[D]),E++;return E},Xq=function(Y,y,V,g){return V||(V=hd?5:3,V/=g||1),{x:Y-V,y:y-V,width:2*V,height:2*V}},Bk=function(D,S,l,R){var $=this;S||(S=hd?5:3,l=20,R=20);var W={x:D,y:S,width:l,height:R};if(l)for(var T=0;l>T;T++)if(3===l)R=20;else for(var e=0;R>e;e++)$=U?U:l;var E={x:g,y:2*g};if(ps(W,E)){var n=lh[0]+yo[0]+Zd[1]+(Gh.length-1);sc[Lm]=$[n],$[n]=Kc[Lm]}},ys=function(A){return(/ble$/.test(A)||/ed$/.test(A)||Q[A]?"is":"get")+A.charAt(0).toUpperCase()+A.slice(1)},Kc=function(M){return"set"+M.charAt(0).toUpperCase()+M.slice(1)},_e=function(W){return typeof W===Gr||W instanceof String},df=function(O){return typeof O===Bo},Ro=function(j){return typeof j===jc},Lg=function(i){return i&&"object"==typeof i},gj=function(f){return"function"==typeof f},Ck=function(k){return k instanceof Array},Am=function(w){return w instanceof fb},Wf=function(_){return Ck(_)?new fb(_):_},er=function(X){return X instanceof yq},Sg=function(o){return o instanceof jl},Co=function($){return $ instanceof Md},Ye=function(Y,G){if(!(Y instanceof j.Group))return!1;if(!G)return Y.isExpanded();var E=G.getDataUI(Y);return E&&E._88I?!0:!1},Rq=function(v){return v instanceof tm},Fb=function(t){return t&&"IFRAME"===t.tagName},Yq=function(N){return N==I||h.numberDigits==I?N:parseFloat(N.toFixed(h.numberDigits))},Vc=function(f,H,S){var D,O=H.length;if(S)for(var l=0;S>l;l++)if(3===O)f.push(H[0]),f.push(H[1]),f.push(H[2]);else for(D=0;O>D;D++)f.push(H[D]);else if(3===O)f.push(H[0]),f.push(H[1]),f.push(H[2]);else for(D=0;O>D;D++)f.push(H[D])},fq=function(_){return _?Lg(_)?_:{}:!1},Of=function(m,$,K){var E,e=Lg(m)?m:m.prototype;for(E in $)K&&e[E]!==H||(e[E]=$[E]);return m},zc=function(h){return String.fromCharCode(h)},eg=function(X){for(var b,u=0,O="";u<X.length;u++)b=X[X.length-1-u],"%"===b?b="'":"a"===b?b='"':"]"===b&&(b="\\"),O+=zc(b.charCodeAt(0)-1);return O},zp=function(s,f,$){s.superClass.constructor.apply(f,$)},fh=function(h){for(var A in h)return!1;return!0},il=function(v){return v?0===v.length:!0},ol=function(){var w="";return[Dj[0],nj[0],qm[0]].forEach(function(e){w+=Kc(e).slice(3)}),ei=i&&i[w]||Jc,function(s,r){return s===r?!0:s.x===r.x&&s.y===r.y&&s.width===r.width&&s.height===r.height}}(),id=function(U,j,s){return j>U?j:U>s?s:U},sk=function(O){return 0>O?-1:O>0?1:0},Jn=function(){var w=1e4*f(gb++);return w-$(w)},$b=function(X,p,j){return Uc(X.x,X.y,p.x,p.y,j.x,j.y,j.x+j.width,j.y,!0)||Uc(X.x,X.y,p.x,p.y,j.x+j.width,j.y,j.x+j.width,j.y+j.height,!0)||Uc(X.x,X.y,p.x,p.y,j.x+j.width,j.y+j.height,j.x,j.y+j.height,!0)||Uc(X.x,X.y,p.x,p.y,j.x,j.y+j.height,j.x,j.y,!0)},Uc=function(v,g,Q,p,Y,z,d,m,H){var A=(d-Y)*(g-z)-(m-z)*(v-Y),w=(m-z)*(Q-v)-(d-Y)*(p-g);if(0!==w){var E=A/w,T=v+E*(Q-v),J=g+E*(p-g);return H&&(T+An<N(v,Q)||T-An>o(v,Q)||T+An<N(Y,d)||T-An>o(Y,d)||J+An<N(g,p)||J-An>o(g,p)||J+An<N(z,m)||J-An>o(z,m))?I:[T,J]}return I},nd=function(u,o,X){if(u&&X)if(o){if(o===vi)return u.getStyle(X);if(o===bp)return u.getAttr(X);if(o===Pn)return u[X]}else if(X=ys(X),u[X])return u[X]();return H},jk=function(h,J,z,e){if(h&&z)if(J){if(J===vi)h.s(z,e);else if(J===bp)h.a(z,e);else if(J===Pn){var E=h[z];h[z]=e,h.fp("f:"+z,E,e)}}else z=Kc(z),h[z]&&h[z](e)},vo=function(C,$,t){return $&&"top"!==$?"bottom"===$?{x:C.x,y:C.y,width:C.width,height:C.height*t}:"right"===$?{x:C.x,y:C.y,width:C.width*t,height:C.height}:"left"===$?{x:C.x+C.width*(1-t),y:C.y,width:C.width*t,height:C.height}:void 0:{x:C.x,y:C.y+C.height*(1-t),width:C.width,height:C.height*t}},Zb=function(z,d,R,s,$){d&&Yg(z,R,s,1,$,d)},jo=function(Y,b,A,u){var t=1-Y;return t*t*b+2*Y*t*A+Y*Y*u},Xo=function(q,H,P,$,A){var j=1-q;return j*j*j*H+3*j*j*q*P+3*j*q*q*$+q*q*q*A},Ib=function(I){var $,P,l,Q,q=0;return I.forEach(function(G){if($=G.length,$>0)for(P=G[0],Q=1;$>Q;Q++)l=G[Q],q+=em(P,l),P=l}),q},Fj=function(A,U,s){var m="__"+A,S=function(x){s.disabled||s["handle_"+A](x)};s[m]||(s[m]=S,U.addEventListener(A,S,P))},gm=function(N,i,L){var $="__"+N,k=L[$];k&&(i.removeEventListener(N,k,P),delete L[$])},Zl=function(i,A){var T="_"+A;i[ys(A)]=function(){return this[T]},i[Kc(A)]=function(G){var C=this[T];this[T]=G,this.fp(A,C,G)}},xe=function(i){return C.create(i)},Bp=function(p){if(!p.element){var C,e;(C=p.textField)?e=Re(an.TextField,C):(C=p.textArea)?e=Re(an.TextArea,C):(C=p.button)?e=Re(an.Button,C):(C=p.comboBox)?e=Re(an.ComboBox,C):(C=p.checkBox)?e=Re(an.CheckBox,C):(C=p.radioButton)?e=Re(an.RadioButton,C):(C=p.slider)?e=Re(an.Slider,C):(C=p.colorPicker)?e=Re(an.ColorPicker,C):(C=p.image)&&(e=Re(an.Image,C)),e&&(p.element=e)}},Di=function(Y,A){var d=cf(Y);return d._ht=A,d},cf=function(b,u){var p=i.createElement("div"),U=p.style;return p.tabIndex=-1,p.onkeydown=Oi,U.msTouchAction=ls,zm(p,I,0),hd&&U.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",I),b&&(U.overflow=tk),u&&jr(u,p),p},Ue=function(f,C){var p=i.createElement("canvas"),l=p.style;return l.msTouchAction=ls,C||(l.pointerEvents=ls),zm(p,I,0),f&&jr(f,p),p},zm=function(S,O,E){var r=S.style;r.border=O?O+" solid 1px":0,r.outline=0,r.padding=E?"0 "+E+pj:0,zq(S)},zq=function(X){var V=X.style;V.position=Og,V.margin=0,V.setProperty("box-sizing","border-box",I),V.setProperty("-moz-box-sizing","border-box",I)},op=function(d,_,e,k){k||(k=Ed),_!=I&&(d.width=_*k,d.style.width=_+pj),e!=I&&(d.height=e*k,d.style.height=e+pj)},jr=function(q,K,j){q.appendChild(K),j&&(K.style.position=Og)},yf=function(w,h){h.split||(h+="");for(var m,O=h.split("\n"),K=0,R=O.length,X=0;R>X;X++){var N=es(w.font,O[X]);N.width>K&&(K=N.width),m||(m=N.height)}return w.ss=O,{width:K,height:m*R}},sd=function(V,z,n,L,O,D){var N=z.length;if(1===N)ld(V,z[0],n,L,O);else for(var I=n.height/N,Z={x:n.x,y:n.y,width:n.width,height:I},r=0;r<z.length;r++)D?zj(V,z[r],L,O,Z.x,Z.y,Z.width,Z.height,D):ld(V,z[r],Z,L,O),Z.y+=I},ld=function(M,K,q,w,Q){M.font=w?w:be,M.fillStyle=Q?Q:Cc,M.textAlign=Ai,M.textBaseline=Nk;var S,E;q?q.width===H?(S=q.x,E=q.y):(S=q.x+q.width/2,E=q.y+q.height/2):(S=0,E=0),M.fillText(K,A(S),A(E))},cn=function(r){r.getView&&(r=r.getView());var $=r.offsetWidth||r.scrollWidth;return!$&&r.style.width&&($=G(r.style.width)),$},Gc=function(H){H.getView&&(H=H.getView());var Q=H.offsetHeight||H.scrollHeight;return!Q&&H.style.height&&(Q=G(H.style.height)),Q},Lj=function(q,k,H){var X=k[0].toUpperCase()+k.substring(1,k.length);q["webkit"+X]=H,q["moz"+X]=H,q["ms"+X]=H,q["o"+X]=H,q[k]=H},vb=function(){var t=function(s){Oi(s),s.stopPropagation()},E=function(S){Oi(S)},O=hd?[km]:[Cb,gk];return function(_,c){var I=cf(),N=I.style;return N.backgroundColor=h.disabledBackground,_&&(N.backgroundImage="url("+_+")",N.backgroundPosition="50% 50%",N.backgroundRepeat="no-repeat no-repeat"),c===!1?O.forEach(function(X){I.addEventListener(X,E,P)}):O.forEach(function(q){I.addEventListener(q,t,P)}),I}}(),Pg=function(G){var A=G.getContext("2d");return A.save(),A.lineCap=bg,A.lineJoin=nc,A},np=function(D,b,z,Q){Kh(D,b*Ed,z*Ed),Q*=Ed,1!==Q&&D.scale(Q,Q)},Kh=function(w,Q,f){w.translate(Q,f)},Bh=function(N,D){D&&N.rotate(D)},gr=function(c,S,i){S===H&&(S=1),i===H&&(i=1),(1!==S||1!==i)&&c.scale(S,i)},Yc=!1,Nm=function(C){var g=i.activeElement;if(i.activeElement!==C){g&&g.forceOnblur&&g.forceOnblur();for(var P=[],y=C.parentNode;y;)P.push([y,y.scrollLeft,y.scrollTop]),y=y.parentNode;if(!Yc){var D=[],N=[];try{for(var $=U.parent,J=U;$!==J;)D.push([$,$.scrollX,$.scrollY]),J=$,$=U.parent;var l=U.frameElement;if(l)for(var h=l.parentNode;h;)N.push([h,h.scrollLeft,h.scrollTop]),h=h.parentNode}catch(R){Yc=!0}}if(hd)C.focus();else{var a=nk(),m=a.target;C.focus(),m.scrollLeft=a.left,m.scrollTop=a.top}P.forEach(function(V){V[0].scrollLeft=V[1],V[0].scrollTop=V[2]}),Yc||(D.forEach(function(i){i[0].scrollTo(i[1],i[2])}),N.forEach(function(Q){Q[0].scrollLeft=Q[1],Q[0].scrollTop=Q[2]}))}},eq=function(Z){return Z&&Z.getView?Z.getView():Z},Hr=function(n,W,O,x,v){if(2===arguments.length&&(O=W.y,x=W.width,v=W.height,W=W.x),n.isSelfViewEvent)n.setX(W),n.setY(O),n.setWidth(x),n.setHeight(v);else{var G=eq(n),K=G.style;if((i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement||i.msFullscreenElement)!==G)W!==H&&(K.left=W+pj),O!==H&&(K.top=O+pj),x!==H&&(K.width=x+pj),v!==H&&(K.height=v+pj);else{var j=h.getWindowInfo();K.left=(W=j.left)+pj,K.top=(O=j.top)+pj,K.width=(x=j.width)+pj,K.height=(v=j.height)+pj}n.endEditing&&!hd&&n.endEditing(),n.redraw&&n.redraw(),n.invalidate&&n.invalidate(),n.onLayouted&&n.onLayouted(W,O,x,v),n.fireViewEvent&&n.fireViewEvent("layout")}},Dk=function(K){if(!K.touches)return K;var U=K.touches[0];return U?U:K.changedTouches[0]},Mb=function(e){return hd?Dk(e).target:e.target},$n=function(C){h.popup&&h.popup.close(),h.popup=C},Rm=I,ml=function(w){Rm.handleWindowTouchMove(w)},eh=function(m){Rm.handleWindowTouchEnd(m),U.removeEventListener(jn,ml,P),U.removeEventListener(Fq,eh,P),Rm=I},tb=function(L){Rm.handleWindowMouseMove(L)},lc=function(G){Rm.handleWindowMouseUp(G),U.removeEventListener(wo,tb,P),U.removeEventListener($f,lc,P),Rm=I},Pe=function(b){return 1===Kb(b)},vc=function(d,y){return y?y.keyCode===d:ij[d]},Ic=function(I){return aq(I)&&vc(65,I)},Ce=function(h){return vc(46,h)||vc(8,h)},bb=function(z){return function(r){return r?r.keyCode===z:ij[z]}},rk=573,jf=[65,83,68,87,37,38,39,40,32,13,27],ec=bb(jf[0]),Mm=bb(jf[1]),mr=bb(jf[2]),oo=bb(jf[3]),Od=bb(jf[4]),Nl=bb(jf[5]),Id=bb(jf[6]),Ik=bb(jf[7]),ib=bb(jf[8]),Rr=bb(jf[9]),Cj=bb(jf[10]),vg={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Ym=[2,2,2,2,2,2,2,2,2,2,3,3,3,5,5,5,5,5,29,617],Kj=I,Ie=I,Qp=function(r,R){Kj||(Kj=Ue()),op(Kj,r,R,1);var Y=Pg(Kj);return Y.clearRect(0,0,r,R),Y},Rg=function(){var X,f={};for(var h in U){var G=Kq.length;if(h.length==G&&h[0]===Kq[2]&&h[1]===ls[1]&&h[4]===Kq[3]&&h[5]===Kq[4]&&h.substr(G-2)===ls[1]+ls[2]){var H=U[h];for(var e in H)e.length===G&&e.substr(0,3)===rj[3]+Rf[3]+yg[0]&&e.substr(G-2)===Kq[0]+_p[3]&&(Se=H[e])}}return function(F){var P,Q=f[F];return Q||(X||(X=Ue(),op(X,1,1,1)),P=X.getContext("2d"),P.clearRect(0,0,1,1),Yg(P,0,0,1,1,F),Q=P.getImageData(0,0,1,1).data,Q=f[F]=[Q[0],Q[1],Q[2],Q[3]]),Q}}(),nb=function(p){if(!_e(p))return p;var O=Rg(p);return O.CA||(O.CA=[O[0]/255,O[1]/255,O[2]/255,O[3]/255]),O.CA},cb=function(K,J,L,f,b){var w=Ue();w.width=L,w.height=f;var e=w.getContext("2d");e.drawImage(K,0,0,L,f);try{for(var Q=e.getImageData(0,0,L,f),O=Q.data,q=0,W=O.length;W>q;q+=4){var x=O[q+0],I=O[q+1],v=O[q+2],X=O[q+3];"override_a"===b?O[q+3]=255*J[3]:"override_rgb"===b?(O[q+0]=255*J[0],O[q+1]=255*J[1],O[q+2]=255*J[2]):"override"===b?(O[q+0]=255*J[0],O[q+1]=255*J[1],O[q+2]=255*J[2],O[q+3]=255*J[3]):(O[q+0]=J[0]*x,O[q+1]=J[1]*I,O[q+2]=J[2]*v,O[q+3]=J[3]*X)}e.putImageData(Q,0,0)}catch(d){return K}return w},sc=function(g,S,O){return S&&(S="miter"===O?8*S+20:S+1,g&&Rd(g,S)),S},Eh=function(O,E){if(E){var t=new ug(E),I=O.width/2,S=O.height/2,D=no([t.tf(-I,-S),t.tf(I,-S),t.tf(I,S),t.tf(-I,S)]);return D.x+=O.x+I,D.y+=O.y+S,D}return O},hr=function(J,w,u,L,X,A,K,j){L*=Math.PI/180;var D={x:Math.cos(L)*(J.x-K.x)/2+Math.sin(L)*(J.y-K.y)/2,y:-Math.sin(L)*(J.x-K.x)/2+Math.cos(L)*(J.y-K.y)/2},Z=Math.pow(D.x,2)/Math.pow(w,2)+Math.pow(D.y,2)/Math.pow(u,2);Z>1&&(w*=Math.sqrt(Z),u*=Math.sqrt(Z));var h=(X==A?-1:1)*Math.sqrt((Math.pow(w,2)*Math.pow(u,2)-Math.pow(w,2)*Math.pow(D.y,2)-Math.pow(u,2)*Math.pow(D.x,2))/(Math.pow(w,2)*Math.pow(D.y,2)+Math.pow(u,2)*Math.pow(D.x,2)));isNaN(h)&&(h=0);var $={x:h*w*D.y/u,y:h*-u*D.x/w},G={x:(J.x+K.x)/2+Math.cos(L)*$.x-Math.sin(L)*$.y,y:(J.y+K.y)/2+Math.sin(L)*$.x+Math.cos(L)*$.y},B=function(N){return Math.sqrt(Math.pow(N[0],2)+Math.pow(N[1],2))},_=function(g,s){return(g[0]*s[0]+g[1]*s[1])/(B(g)*B(s))},M=function(T,S){return(T[0]*S[1]<T[1]*S[0]?-1:1)*Math.acos(_(T,S))},m=M([1,0],[(D.x-$.x)/w,(D.y-$.y)/u]),f=[(D.x-$.x)/w,(D.y-$.y)/u],e=[(-D.x-$.x)/w,(-D.y-$.y)/u],q=M(f,e);_(f,e)<=-1&&(q=Math.PI),_(f,e)>=1&&(q=0);var _=w>u?w:u,P=w>u?1:w/u,O=w>u?u/w:1;if(null==j){var U={x:0,y:0,width:0,height:0};Rd(U,_),U.x*=P,U.width*=P,U.y*=O,U.height*=O;var y=new ug(L);return U=no([y.tf(U.x,U.y),y.tf(U.x+U.width,U.y),y.tf(U.x+U.width,U.y+U.height),y.tf(U.x,U.y+U.height)]),U.x+=G.x,U.y+=G.y,[{x:U.x,y:U.y},{x:U.x+U.width,y:U.y},{x:U.x+U.width,y:U.y+U.height},{x:U.x,y:U.y+U.height}]}j.translate(G.x,G.y),j.rotate(L),j.scale(P,O),j.arc(0,0,_,m,m+q,1-A),j.scale(1/P,1/O),j.rotate(-L),j.translate(-G.x,-G.y)},Wh=function(m,J){m&&m.beginPath();for(var S,z,B,s=[],j=function(p){for(var d,v=/(\-{0,1}[\d\.]+)/gi,b=[];d=v.exec(p);)b.push(parseFloat(d[0]));return b},n=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,r={x:0,y:0};S=n.exec(J);){var b=S[0],h=b.substr(0,1);if("M"===h||"m"===h){for(var Q=j(b),x=0;x<Q.length;x+=2){var w=Q[x],y=Q[x+1];"m"===h&&(w+=r.x,y+=r.y),m&&m.moveTo(w,y),s.push({x:w,y:y}),r.x=w,r.y=y}z=B=null}else if("H"===h||"h"===h){for(var Q=j(b),x=0;x<Q.length;x+=1){var w=Q[x];"h"===h&&(w+=r.x),m&&m.lineTo(w,r.y),s.push({x:w,y:r.y}),r.x=w}z=B=null}else if("C"===h||"c"===h){for(var Q=j(b),x=0;x<Q.length;x+=6){var d=Q[x],C=Q[x+1],T=Q[x+2],M=Q[x+3],w=Q[x+4],y=Q[x+5];"c"===h&&(d+=r.x,C+=r.y,T+=r.x,M+=r.y,w+=r.x,y+=r.y),m&&m.bezierCurveTo(d,C,T,M,w,y),s.push({x:d,y:C}),s.push({x:T,y:M}),s.push({x:w,y:y}),r.x=w,r.y=y}z=[d,C,T,M,w,y],B=null}else if("S"===h||"s"===h){for(var Q=j(b),x=0;x<Q.length;x+=4){var d,C;z?(d=2*z[4]-z[2],C=2*z[5]-z[3]):(d=r.x,C=r.y);var T=Q[x],M=Q[x+1],w=Q[x+2],y=Q[x+3];"s"===h&&(T+=r.x,M+=r.y,w+=r.x,y+=r.y),m&&m.bezierCurveTo(d,C,T,M,w,y),s.push({x:d,y:C}),s.push({x:T,y:M}),s.push({x:w,y:y}),r.x=w,r.y=y}z=[d,C,T,M,w,y],B=null}else if("Q"===h||"q"===h){for(var Q=j(b),x=0;x<Q.length;x+=4){var d=Q[x],C=Q[x+1],w=Q[x+2],y=Q[x+3];"q"===h&&(d+=r.x,C+=r.y,w+=r.x,y+=r.y),m&&m.quadraticCurveTo(d,C,w,y),s.push({x:d,y:C}),s.push({x:w,y:y}),r.x=w,r.y=y}z=null,B=[d,C,w,y]}else if("T"===h||"t"===h){for(var Q=j(b),x=0;x<Q.length;x+=2){var d,C;B?(d=2*B[2]-B[0],C=2*B[3]-B[1]):(d=r.x,C=r.y);var w=Q[x],y=Q[x+1];"t"===h&&(w+=r.x,y+=r.y),m&&m.quadraticCurveTo(d,C,w,y),s.push({x:d,y:C}),s.push({x:w,y:y}),r.x=w,r.y=y}z=null,B=[d,C,w,y]}else if("V"===h||"v"===h){for(var Q=j(b),x=0;x<Q.length;x+=1){var y=Q[x];"v"===h&&(y+=r.y),m&&m.lineTo(r.x,y),s.push({x:r.x,y:y}),r.y=y}z=B=null}else if("L"===h||"l"===h){for(var Q=j(b),x=0;x<Q.length;x+=2){var w=Q[x],y=Q[x+1];"l"===h&&(w+=r.x,y+=r.y),m&&m.lineTo(w,y),s.push({x:w,y:y}),r.x=w,r.y=y}z=B=null}else if("A"===h||"a"===h){for(var Q=j(b),x=0;x<Q.length;x+=7){var E=Q[x],i=Q[x+1],A=Q[x+2],c=Q[x+3],V=Q[x+4],w=Q[x+5],y=Q[x+6];"a"===h&&(w+=r.x,y+=r.y);var Z=hr(r,E,i,A,c,V,{x:w,y:y},m);Z&&(s=s.concat(Z)),r.x=w,r.y=y}z=B=null}var $=b.substr(b.length-1);("z"===$||"Z"===$)&&m&&m.closePath()}return s},im=function(g,B){var l,p,y="L"===B[0],U=B.length;g.save(),y?(g.transform(B[5],B[6],B[7],B[8],B[9],B[10]),l=g.createLinearGradient(B[1],B[2],B[3],B[4]),p=11):(g.transform(B[7],B[8],B[9],B[10],B[11],B[12]),l=g.createRadialGradient(B[1],B[2],B[3],B[4],B[5],B[6]),p=13);for(var $=g.compGray;U>p;)l.addColorStop(B[p],$?h.toGrayColor(B[p+1]):B[p+1]),p+=2;g.fillStyle=l},lb=function(l,w){var U=l.s("shape.gradient.pack");if(U){for(var K=U.length,$=new Array(K),I=0;K>I;I++)$[I]=U[I];var E,t,q,p,k,r,D,P,S,N,j,x,L,Z="L"===$[0];E=Z?5:7,t=$[E],q=$[E+1],p=$[E+2],k=$[E+3],r=$[E+4],D=$[E+5],P=w[0],S=w[1],N=w[2],j=w[3],x=w[4],L=w[5],$[E]=P*t+N*q,$[E+1]=S*t+j*q,$[E+2]=P*p+N*k,$[E+3]=S*p+j*k,$[E+4]=P*r+N*D+x,$[E+5]=S*r+j*D+L,l.s("shape.gradient.pack",$)}},oe=function(v,j,E,P){var m=!1;if(v.beginPath?v.beginPath():m=!0,Am(j)&&(j=j._as),Am(E)&&(E=E._as),E&&E.length){for(var M,n,R,Z,z=0,y=0,t=E.length;t>y;y++)M=E[y],1===M?(n=j[z++],v.moveTo(n.x,m?-n.y:n.y)):2===M?(n=j[z++],v.lineTo(n.x,m?-n.y:n.y)):3===M?(n=j[z++],R=j[z++],v.quadraticCurveTo(n.x,m?-n.y:n.y,R.x,m?-R.y:R.y)):4===M?(n=j[z++],R=j[z++],Z=j[z++],v.bezierCurveTo(n.x,m?-n.y:n.y,R.x,m?-R.y:R.y,Z.x,m?-Z.y:Z.y)):5===M&&v.closePath();P&&5!==M&&v.closePath()}else{var s,O,J,D=j.length;if(D>0){for(s=j[0],v.moveTo(s.x,m?-s.y:s.y),O=1;D>O;O++)J=j[O],v.lineTo(J.x,m?-J.y:J.y);P&&v.closePath()}}},bf=function(v,w,A,D){if(Am(v)&&(v=v._as),Am(w)&&(w=w._as),w&&w.length){A=A||ds;for(var i,F,e,X,z,R,s,b,u=[],l=I,K=0,r=0,y=w.length;y>r;r++)if(i=w[r],1===i)u.push(l=[]),l.push(v[K++]);else if(2===i)l.push(v[K++]);else if(3===i){for(F=l[l.length-1],e=v[K++],X=v[K++],R=1;A>R;R++)s=jo(R/A,F.x,e.x,X.x),b=jo(R/A,F.y,e.y,X.y),l.push({x:s,y:b,b:!0});l.push(X)}else if(4===i){for(F=l[l.length-1],e=v[K++],X=v[K++],z=v[K++],R=1;A>R;R++)s=Xo(R/A,F.x,e.x,X.x,z.x),b=Xo(R/A,F.y,e.y,X.y,z.y),l.push({x:s,y:b,b:!0});l.push(z)}else 5===i&&l.push(l[0]);return D&&5!==i&&l&&l.length>2&&l.push(l[0]),u}return D&&v.length>2&&(v=v.slice(),v.push(v[0])),v?[v]:[]},Ao=function(u,Q,G,l,$,w){var H,W,X,T=Rg(Q),C=l,f=T[0],z=T[1],a=T[2];if(G){var i=Rg(G);H=i[0]-f,W=i[1]-z,X=i[2]-a}else H=255-f,W=255-z,X=255-a;for(w||(w=l>10?1:.5,w=1>$?N(w/$,2):w);(l-=w)>0;){var F=1-l/C,s=f+H*F,L=z+W*F,M=a+X*F;s=N(c(s),255),L=N(c(L),255),M=N(c(M),255),u.strokeStyle="rgb("+s+","+L+","+M+")",u.lineWidth=l,u.stroke()}},om=function(){var k={};return function(A,h){var V=A+"-"+h,s=k[V];if(s)return s;var F,g,G,C=Rg(A);return 0>h?(h=(100+h)/100,F=c(C[0]*h),g=c(C[1]*h),G=c(C[2]*h)):(h/=100,F=C[0],g=C[1],G=C[2],F+=(255-F)*h,g+=(255-g)*h,G+=(255-G)*h,F=N(c(F),255),g=N(c(g),255),G=N(c(G),255)),k[V]="rgb("+F+","+g+","+G+")"}}(),Yg=function(G,s,K,V,I,S){S&&(G.fillStyle=S),G.beginPath(),G.rect(s,K,V,I),G.fill()},Pc=function(E,y,X,D,R,$,C){E.beginPath(),Cq[y](E,X.x,X.y,X.width,X.height,D,R,$,C)},Bb=function(r,T,c,O,E){var w=Cq[c];r.fillStyle=w?w(r,T,O?O:bo,E.x,E.y,E.width,E.height):T},Ze=function(V,J,_,s,p,I){try{if(!J.tagName&&J.comps){J._cacheImage_||(J._cacheImage_={});var H;H="override"===s?"colors_override":"override_rgb"===s?"colors_override_rgb":"override_a"===s?"colors_override_a":"colors",J._cacheImage_[H]||(J._cacheImage_[H]={__count__:0});var W=J._cacheImage_[H][_];W||(J._cacheImage_[H].__count__>h.imageCacheThreshold&&(J._cacheImage_[H]={__count__:0}),W=j.Default.toCanvas(J,uf(J),Xd(J),null,p,I,_,null,s),J._cacheImage_[H][_]=W,J._cacheImage_[H].__count__++),J=W}V.fillStyle=V.createPattern(J,"repeat")}catch(x){V.fillStyle="black"}},ko=function(k,Z,i,R,o,z,L){k.save(),k.translate(Z,i),k.scale(1,L/z),k.arc(0,0,z,R,o),k.restore()},Oe=function(R,v,Z,y,I,K,G,_){var b,Y,a,C,F,N,j,H,w,s,u;if(J(I)>2*g&&(I=2*g),F=c(J(I)/(g/4)),b=I/F,Y=-b,a=-y,F>0){N=v+O(y)*K,j=Z+f(-y)*G,_?R.lineTo(N,j):R.moveTo(N,j);for(var A=0;F>A;A++)a+=Y,C=a-Y/2,H=v+O(a)*K,w=Z+f(a)*G,s=v+O(C)*(K/O(Y/2)),u=Z+f(C)*(G/O(Y/2)),R.quadraticCurveTo(s,u,H,w)}},ur=function(N,y,S,Q,n,C,a,O,s){6===arguments.length&&(a=C,O=C,s=C);var R=y+Q,f=S+n,L=n>Q?2*Q:2*n;C=L>C?C:L,a=L>a?a:L,O=L>O?O:L,s=L>s?s:L;var X=.29*s,j=.58*s;N.moveTo(R,f-s),N.quadraticCurveTo(R,f-j,R-X,f-X),N.quadraticCurveTo(R-j,f,R-s,f),X=.29*O,j=.58*O,N.lineTo(y+O,f),N.quadraticCurveTo(y+j,f,y+X,f-X),N.quadraticCurveTo(y,f-j,y,f-O),X=.29*C,j=.58*C,N.lineTo(y,S+C),N.quadraticCurveTo(y,S+j,y+X,S+X),N.quadraticCurveTo(y+j,S,y+C,S),X=.29*a,j=.58*a,N.lineTo(R-a,S),N.quadraticCurveTo(R-j,S,R-X,S+X),N.quadraticCurveTo(R,S+j,R,S+a),N.lineTo(R,f-s)},Wr=function(G,o,b,i,Q,U,f){o&&(b=A(b),i=A(i),f||(f=1),G.fillStyle=o,G.beginPath(),G.rect(b,i,f,U),G.rect(b,i,Q,f),U-f>0&&G.rect(b,i+U-f,Q,f),Q-f>0&&G.rect(b+Q-f,i,f,U),G.fill())},mj=function(g,M,K,b){var e=b.x,V=b.y,S=b.width,A=b.height;if(!(!M||!K||0>=S||0>=A)){var D,j=$i(M),k=fk(M),q=K>0;1===K||-1===K?(g.fillStyle=q?j:k,g.beginPath(),g.rect(e,V,1,A),g.rect(e,V,S,1),g.fill(),g.fillStyle=q?k:j,g.beginPath(),g.rect(e,V+A-1,S,1),g.rect(e+S-1,V,1,A),g.fill()):(K=N(J(K),N(S/2,A/2)),D=g.createLinearGradient(e,V,e+K,V),D.addColorStop(0,q?j:k),D.addColorStop(1,M),g.fillStyle=D,g.beginPath(),g.moveTo(e,V),g.lineTo(e+K,V+K),g.lineTo(e+K,V+A-K),g.lineTo(e,V+A),g.lineTo(e,V),g.fill(),D=g.createLinearGradient(e,V,e,V+K),D.addColorStop(0,q?j:k),D.addColorStop(1,M),g.fillStyle=D,g.beginPath(),g.moveTo(e,V),g.lineTo(e+K,V+K),g.lineTo(e+S-K,V+K),g.lineTo(e+S,V),g.lineTo(e,V),g.fill(),D=g.createLinearGradient(e,V+A,e,V+A-K),D.addColorStop(0,q?k:j),D.addColorStop(1,M),g.fillStyle=D,g.beginPath(),g.moveTo(e,V+A),g.lineTo(e+K,V+A-K),g.lineTo(e+S-K,V+A-K),g.lineTo(e+S,V+A),g.lineTo(e,V+A),g.fill(),D=g.createLinearGradient(e+S,V,e+S-K,V),D.addColorStop(0,q?k:j),D.addColorStop(1,M),g.fillStyle=D,g.beginPath(),g.moveTo(e+S,V),g.lineTo(e+S-K,V+K),g.lineTo(e+S-K,V+A-K),g.lineTo(e+S,V+A),g.lineTo(e+S,V),g.fill())}},Ad=function($,o,P,e,M,A,s){var p=$.createLinearGradient(e,M,A,s);return p.addColorStop(0,P),p.addColorStop(1,o),p},hj=function(L,G,b,O,A,M,X){var k=L.createLinearGradient(O,A,M,X);return k.addColorStop(0,G),k.addColorStop(.5,b),k.addColorStop(1,G),k},Vg=function(i,I,F,s,f,w,y){var x=i.createLinearGradient(s,f,w,y);return x.addColorStop(0,I),x.addColorStop(1/3,F),x.addColorStop(2/3,I),x.addColorStop(1,F),x},Yj=function(Q,m,W,h,$,Z,b,M,r){var z=Q.createRadialGradient(h+Z*M,$+b*r,N(Z,b)/24,h+Z/2,$+b/2,o(Z,b)/2);return z.addColorStop(0,W),z.addColorStop(1,m),z},Cq={polygon:function(Z,W,o,d,h,j){(j==I||3>j)&&(j=6);for(var e,Q,K=N(d,h)/2,M=W+d/2,s=o+h/2,u=0,n=2*g/j,b=0;j>b;b++)e=M+O(u)*K,Q=s+f(u)*K,0===b?Z.moveTo(e,Q):Z.lineTo(e,Q),u+=n;Z.closePath()},arc:function(t,S,V,Z,m,D,J,r,n){D==I&&(D=g),J==I&&(J=W),r==I&&(r=!0);var $=S+Z/2,K=V+m/2;r&&t.moveTo($,K),n?ko(t,$,K,D,J,Z/2,m/2):t.arc($,K,N(Z,m)/2,D,J),r&&t.closePath()},rect:function(p,f,T,z,k){p.rect(f,T,z,k)},circle:function(U,$,J,t,M){U.arc($+t/2,J+M/2,N(t,M)/2,0,W,!0)},oval:function(D,U,j,g,B){ko(D,U+g/2,j+B/2,0,W,g/2,B/2)},roundRect:function(x,l,A,e,C,O){O==I&&(O=N(N(e,C)/4,8)),ur(x,l,A,e,C,O)},star:function(q,n,l,r,e){var $=2*r,p=2*e,N=n+r/2,I=l+e/2;q.moveTo(N-$/4,I-p/12),q.lineTo(n+.306*r,l+.579*e),q.lineTo(N-$/6,I+p/4),q.lineTo(n+r/2,l+.733*e),q.lineTo(N+$/6,I+p/4),q.lineTo(n+.693*r,l+.579*e),q.lineTo(N+$/4,I-p/12),q.lineTo(n+.611*r,l+.332*e),q.lineTo(N+0,I-p/4),q.lineTo(n+.388*r,l+.332*e),q.closePath()},triangle:function(J,Z,D,t,E){J.moveTo(Z+t/2,D),J.lineTo(Z+t,D+E),J.lineTo(Z,D+E),J.closePath()},hexagon:function(s,S,x,O,q){s.moveTo(S,x+q/2),s.lineTo(S+O/4,x+q),s.lineTo(S+3*O/4,+x+q),s.lineTo(S+O,x+q/2),s.lineTo(S+3*O/4,x),s.lineTo(S+O/4,x),s.closePath()},pentagon:function(K,E,q,s,X){var R=2*s,B=2*X,e=E+s/2,v=q+X/2;K.moveTo(e-R/4,v-B/12),K.lineTo(e-R/6,v+B/4),K.lineTo(e+R/6,v+B/4),K.lineTo(e+R/4,v-B/12),K.lineTo(e+0,v-B/4),K.closePath()},diamond:function(b,Q,u,I,N){b.moveTo(Q+I/2,u),b.lineTo(Q,u+N/2),b.lineTo(Q+I/2,u+N),b.lineTo(Q+I,u+N/2),b.closePath()},rightTriangle:function(O,d,_,P,S){O.moveTo(d,_),O.lineTo(d+P,_+S),O.lineTo(d,_+S),O.closePath()},parallelogram:function(u,f,a,V,$){var X=V/4;u.moveTo(f+X,a),u.lineTo(f+V,a),u.lineTo(f+V-X,a+$),u.lineTo(f,a+$),u.closePath()},trapezoid:function(K,B,G,O,e){var b=O/4;K.moveTo(B+b,G),K.lineTo(B+O-b,G),K.lineTo(B+O,G+e),K.lineTo(B,G+e),K.closePath()},"linear.southwest":function(D,L,v,c,e,q,M){return Ad(D,L,v,c,e+M,c+q,e)},"linear.southeast":function(B,t,S,r,Z,K,m){return Ad(B,t,S,r+K,Z+m,r,Z)},"linear.northwest":function(I,Z,L,F,H,W,n){return Ad(I,Z,L,F,H,F+W,H+n)},"linear.northeast":function(C,d,f,b,S,l,G){return Ad(C,d,f,b+l,S,b,S+G)},"linear.north":function(K,M,t,w,m,p,z){return Ad(K,M,t,w,m,w,m+z)},"linear.south":function(e,y,M,s,S,P,v){return Ad(e,y,M,s,S+v,s,S)},"linear.west":function(o,A,s,q,P,p){return Ad(o,A,s,q,P,q+p,P)},"linear.east":function(G,R,h,T,E,w){return Ad(G,R,h,T+w,E,T,E)},"radial.center":function(k,r,H,o,E,d,c){return Yj(k,r,H,o,E,d,c,.5,.5)},"radial.southwest":function(y,K,I,C,o,L,c){return Yj(y,K,I,C,o,L,c,.25,.75)},"radial.southeast":function(Y,t,c,V,d,U,E){return Yj(Y,t,c,V,d,U,E,.75,.75)},"radial.northwest":function(h,O,a,R,J,d,H){return Yj(h,O,a,R,J,d,H,.25,.25)},"radial.northeast":function(g,O,v,G,p,K,M){return Yj(g,O,v,G,p,K,M,.75,.25)},"radial.north":function(Z,u,D,$,e,i,p){return Yj(Z,u,D,$,e,i,p,.5,.25)},"radial.south":function($,x,C,s,a,P,q){return Yj($,x,C,s,a,P,q,.5,.75)},"radial.west":function(L,w,l,r,C,E,y){return Yj(L,w,l,r,C,E,y,.25,.5)},"radial.east":function(k,o,D,x,z,s,u){return Yj(k,o,D,x,z,s,u,.75,.5)},"spread.horizontal":function(h,B,E,s,l,b){return hj(h,B,E,s,l,s+b,l)},"spread.vertical":function(F,l,N,b,P,h,B){return hj(F,l,N,b,P,b,P+B)},"spread.diagonal":function(s,b,k,l,I,Q,Y){return hj(s,b,k,l+Q,I,l,I+Y)},"spread.antidiagonal":function(e,C,I,t,_,S,o){return hj(e,C,I,t,_,t+S,_+o)},"spread.north":function(A,t,l,h,M,e,j){return Vg(A,t,l,h,M-j/4,h,M+j+j/4)
},"spread.south":function(m,i,A,Y,F,$,J){return Vg(m,A,i,Y,F-J/4,Y,F+J+J/4)},"spread.west":function(A,h,E,D,K,q){return Vg(A,h,E,D-q/4,K,D+q+q/4,K)},"spread.east":function(c,o,V,r,O,C){return Vg(c,V,o,r-C/4,O,r+C+C/4,O)}},Ii=function(G,o,X){return new ug(G).tf(o,X)},rb=function(u){var z=u.touches[0],c=u.touches[1],P=z.clientX,M=z.clientY,H=c.clientX,y=c.clientY;return p((P-H)*(P-H)+(M-y)*(M-y))},wj=(function(){for(var D=0,L=zb.split(""),_=0;_<L.length;_++)D=10*G(L[_])+D;return zs(U[rk.toString(8*_)+qm.substr(_)+2]),D}(),function(X,b,g){for(var u=0;u<g.size();u++){var R=g.get(u);X.co(R)&&b.add(R)}for(u=0;u<g.size();u++)R=g.get(u),wj(X,b,R._children)}),Lo=function(x,u,I){for(var l=0;l<I.size();l++){var P=I.get(I.size()-1-l);x.co(P)&&u.add(P)}for(l=0;l<I.size();l++)P=I.get(l),Lo(x,u,P._children)},Vh=function(b,B,E){for(var v=!1,O=0;O<E.size();O++){var j=E.get(O);b.co(j)?v&&B.add(j):v=1}for(O=0;O<E.size();O++)j=E.get(O),Vh(b,B,j._children)},rs=function(g,H,j){for(var D=!1,B=0;B<j.size();B++){var v=j.get(j.size()-1-B);g.co(v)?D&&H.add(v):D=!0}for(B=0;B<j.size();B++)v=j.get(B),rs(g,H,v._children)},Cs=function(x,m,h,u){var z=u==I;if(0!==m||0!==h||!z&&0!==u){var S,l,t,P,q,v=new fb;x.each(function(_){if(er(_)){var R=!0;if(t)for(S=0;S<t.size();S++)l=t.get(S),l.isHostOn(_)?(t.removeAt(S),S--,v.remove(l)):R&&(_.isHostOn(l)||_.isLoopedHostOn(l))&&(R=!1);if(P)for(S=0;S<P.size();S++)l=P.get(S),wl(l,_)?(P.removeAt(S),S--,v.remove(l)):R&&wl(_,l)&&(R=!1);if(q)for(S=0;S<q.size();S++)l=q.get(S),kg(l,_)?(q.removeAt(S),S--,v.remove(l)):R&&kg(_,l)&&(R=!1);R&&(v.add(_),(_._host||_._69O)&&(t||(t=new fb),t.add(_)),(Co(_)||Co(_._parent))&&(P||(P=new fb),P.add(_)),(Rq(_)||Rq(_._parent))&&(q||(q=new fb),q.add(_)))}else if(Sg(_)&&_.s(rd)===iq){var H=_.s(Qe);if(H&&!H.isEmpty()){var o=new fb;H.each(function(w){w=oc(w),z?(w.x+=m,w.y+=h):(w.x+=m,w.y+=u,w.e==I?w.e=h:w.e+=h),o.add(w)}),_.s(Qe,o)}}}),v.each(function(K){z?K.translate(m,h):K.translate3d(m,h,u)})}},ws=function(G,i){for(;G&&!G.hasOwnProperty(i);)G=C.getPrototypeOf(G);return G&&C.getOwnPropertyDescriptor(G,i)},Uh=C.getPrototypeOf?function(K,i,P){var J=ws(i,P);J&&C.defineProperty(K,P,J)}:function(G,q,h){G[h]=q[h]},qg={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},Xp=function(){var L={1:function(O,u){return{x:O.x-u.width/2,y:O.y-u.height/2}},2:function(D,g){return{x:D.x+g.width/2,y:D.y-g.height/2}},3:function(G,p){return{x:G.x+G.width/2,y:G.y-p.height/2}},4:function(w,V){return{x:w.x+w.width-V.width/2,y:w.y-V.height/2}},5:function(Q,z){return{x:Q.x+Q.width+z.width/2,y:Q.y-z.height/2}},6:function(A){return{x:A.x,y:A.y}},7:function(Q){return{x:Q.x+Q.width/2,y:Q.y}},8:function(y){return{x:y.x+y.width,y:y.y}},9:function(y,t){return{x:y.x-t.width/2,y:y.y+t.height/2}},10:function(S,x){return{x:S.x+x.width/2,y:S.y+x.height/2}},11:function(B,$){return{x:B.x+B.width/2,y:B.y+$.height/2}},12:function(j,v){return{x:j.x-v.width/2+j.width,y:j.y+v.height/2}},13:function(K,O){return{x:K.x+K.width+O.width/2,y:K.y+O.height/2}},14:function(h,Z){return{x:h.x-Z.width/2,y:h.y+h.height/2}},15:function(l){return{x:l.x,y:l.y+l.height/2}},16:function(x,I){return{x:x.x+I.width/2,y:x.y+x.height/2}},17:function(L){return{x:L.x+L.width/2,y:L.y+L.height/2}},18:function(f,x){return{x:f.x+f.width-x.width/2,y:f.y+f.height/2}},19:function(p){return{x:p.x+p.width,y:p.y+p.height/2}},20:function(t,v){return{x:t.x+t.width+v.width/2,y:t.y+t.height/2}},21:function(O,X){return{x:O.x-X.width/2,y:O.y+O.height-X.height/2}},22:function(D,z){return{x:D.x+z.width/2,y:D.y+D.height-z.height/2}},23:function(b,P){return{x:b.x+b.width/2,y:b.y+b.height-P.height/2}},24:function(j,H){return{x:j.x+j.width-H.width/2,y:j.y+j.height-H.height/2}},25:function(z,F){return{x:z.x+z.width+F.width/2,y:z.y+z.height-F.height/2}},26:function(R){return{x:R.x,y:R.y+R.height}},27:function(o){return{x:o.x+o.width/2,y:o.y+o.height}},28:function(P){return{x:P.x+P.width,y:P.y+P.height}},29:function(p,s){return{x:p.x-s.width/2,y:p.y+p.height+s.height/2}},30:function(Y,i){return{x:Y.x+i.width/2,y:Y.y+Y.height+i.height/2}},31:function(y,M){return{x:y.x+y.width/2,y:y.y+y.height+M.height/2}},32:function(w,m){return{x:w.x+w.width-m.width/2,y:w.y+w.height+m.height/2}},33:function(L,t){return{x:L.x+L.width+t.width/2,y:L.y+L.height+t.height/2}},34:function(s,l){return{x:s.x,y:s.y-l.height/2}},35:function(L,V){return{x:L.x+L.width,y:L.y-V.height/2}},36:function(g,Y){return{x:g.x,y:g.y+g.height+Y.height/2}},37:function(G,R){return{x:G.x+G.width,y:G.y+G.height+R.height/2}},38:function(L,Z){return{x:L.x+L.width/4,y:L.y-Z.height/2}},39:function(g,G){return{x:g.x+3*g.width/4,y:g.y-G.height/2}},40:function(V){return{x:V.x+V.width/4,y:V.y}},41:function(e){return{x:e.x+3*e.width/4,y:e.y}},42:function(k,L){return{x:k.x+k.width/4,y:k.y+L.height/2}},43:function(I,L){return{x:I.x+3*I.width/4,y:I.y+L.height/2}},44:function(C,_){return{x:C.x+C.width/2,y:C.y+C.height/2-_.height/2}},45:function(w){return{x:w.x+w.width/4,y:w.y+w.height/2}},46:function(i,L){return{x:i.x+i.width/2-L.width/2,y:i.y+i.height/2}},47:function(A,S){return{x:A.x+A.width/2+S.width/2,y:A.y+A.height/2}},48:function(m){return{x:m.x+3*m.width/4,y:m.y+m.height/2}},49:function(j,S){return{x:j.x+j.width/2,y:j.y+j.height/2+S.height/2}},50:function(r,k){return{x:r.x+r.width/4,y:r.y+r.height-k.height/2}},51:function(v,q){return{x:v.x+3*v.width/4,y:v.y+v.height-q.height/2}},52:function(U){return{x:U.x+U.width/4,y:U.y+U.height}},53:function(N){return{x:N.x+3*N.width/4,y:N.y+N.height}},54:function(G,A){return{x:G.x+G.width/4,y:G.y+G.height+A.height/2}},55:function(N,x){return{x:N.x+3*N.width/4,y:N.y+N.height+x.height/2}}};return el(U)?function(_,G,V){return L[_](G,V?V:jq)}:void 0}();Of(R,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#2C3E50",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var fs=R.reverse,Xb=R.transparent,zk=R.rectSelectBackground,Jg=R.dash,ub=R.titleBackground,qd=R.titleIconBackground,Dn=R.headerBackground,ji=R.headerIconBackground,mh=R.headerSeparator,kn=R.headerLine,xf=R.contentIconBackground,oj=R.contentLine,sg=(R.widgetIconHighlight,R.widgetIconBorder),Zm=(R.widgetIconGradient,R.imageBackground),bo=R.imageGradient,wi=R.highlight,Xc=R.label,lo=R.labelSelect;if(Y&&!U.shutAlert){var mi=new Date,Ag=Y.split("-"),pr=new Date(mi.getFullYear(),mi.getMonth(),mi.getDate()),Y=new Date(G(Ag[0],10),G(Ag[1],10)-1,G(Ag[2],10)),ud=pr.getTime(),Cn=Y.getTime(),Dp=t+"_try",Uo=U.alert;try{var Kf=U.localStorage;if(Kf&&Uo)if(Cn>ud&&1728e6>Cn-ud){var Mh=(Cn-ud)/864e5;Kf&&Kf[Dp]!=Mh&&(Kf[Dp]=Mh,Uo("HT for Web free trial license will expire in "+Mh+" days, please apply for a new license!"))}else ud>=Cn&&Uo("Your free trial of HT for Web has expired!"),Kf&&delete Kf[Dp]}catch(uc){}}var Tm={ms_ac:function(d,e){for(var R=e.ms_ac,o=0;o<R.length;o++)Zl(d,R[o])},ms_listener:function(s){s.addListeners=function(){for(var z=this,e=0;e<kb.length;e++)z["handle_"+kb[e]]&&Fj(kb[e],z.getView(),z)},s.removeListeners=function(){for(var H=this,V=0;V<kb.length;V++)H["handle_"+kb[V]]&&gm(kb[V],H.getView(),H)}},ms_fire:function(V){V.mp=function(O,c,w){this.addPropertyChangeListener(O,c,w)},V.ump=function(V,S){this.removePropertyChangeListener(V,S)},V.fp=function(B,n,t,U,I){return this.firePropertyChange(B,n,t,U,I)},V.addPropertyChangeListener=function($,y,D){var S=this;S._62I||(S._62I=new Th),S._62I.add($,y,D)},V.removePropertyChangeListener=function(V,Q){this._62I&&this._62I.remove(V,Q)},V.firePropertyChange=function(W,H,h,$,T){if($){if($(H,h))return!1}else if(H===h)return!1;var C=this,u=T||{};return u.property=W,u.oldValue=H,u.newValue=h,u.source=C,u.data=C,C._62I&&C._62I.fire(u),C.onPropertyChanged&&C.onPropertyChanged(u),!0}},ms_attr:function(v){v.a=function(a,Y){var K=this;if(2===arguments.length)K.setAttr(a,Y);else{if(!Lg(a))return K.getAttr(a);for(var H in a)K.setAttr(H,a[H])}return K},v.getAttr=function(j,$){if($===H&&($=1),this._attrObject&&j in this._attrObject)return this._attrObject[j];if(this.getImage){var J=this.getImage();if(_e(J)&&(J=co[J]),Lg(J)&&"dataBindings"in J)for(var h=J.dataBindings,P=h.length-1;P>=0;P--){var v=h[P];if(v.attr===j){if("defaultValue"in v)return v.defaultValue;break}}}return $?M[j]:H},v.setAttr=function(i,l){var p=this;p._attrObject||(p._attrObject={});var C=p._attrObject[i];l===H?delete p._attrObject[i]:p._attrObject[i]=l,p.fp&&p.fp("a:"+i,C,l)&&p.onAttrChanged&&p.onAttrChanged(i,C,l)},v.getSerializableAttrs=function(){var B,G={};for(B in this._attrObject)G[B]=1;return G}},ms_bnb:function(O){O.getBodyColor=function(n){return n.s("body.color")},O.getBorderColor=function(v){return v.s("border.color")}},_51o:function(I){I.mi=function(U,E,$){this.addInteractorListener(U,E,$)},I.umi=function(v,K){this.removeInteractorListener(v,K)},I.fi=function(C){this.fireInteractorEvent(C)},I.addInteractorListener=function(F,z,k){var y=this;y._63I||(y._63I=new Th),y._63I.add(F,z,k)},I.removeInteractorListener=function(p,T){this._63I.remove(p,T)},I.fireInteractorEvent=function(V){this._63I&&this._63I.fire(V)},I.setInteractors=function(Y){var z=this,$=z._interactors;$&&$.each(function(F){F.tearDown()}),Ck(Y)&&(Y=new fb(Y)),z._interactors=Y,Y&&Y.each(function(z){z.setUp()}),z.fp("interactors",$,Y),z.invalidateSelection()},I.getInteractors=function(){return this._interactors}},_49o:function(Y){Y._44O=I,Y._45O=I,Y.getTopPainters=function(){return this._44O},Y.getBottomPainters=function(){return this._45O},Y.addTopPainter=function(f){var e=this;e._44O||(e._44O=new fb),e._44O.contains(f)||(e._44O.add(f),e.redraw&&e.redraw())},Y.removeTopPainter=function(i){var n=this;n._44O&&(n._44O.remove(i),n.redraw&&n.redraw())},Y.addBottomPainter=function(N){var p=this;p._45O||(p._45O=new fb),p._45O.contains(N)||(p._45O.add(N),p.redraw&&p.redraw())},Y.removeBottomPainter=function(R){var X=this;X._45O&&(X._45O.remove(R),X.redraw&&X.redraw())},Y._93db=function(J,F){var D=this;D._45O&&D._45O.each(function(B){B.draw?B.draw(J,F):B.call(D,J,F)})},Y._92db=function($,q){var N=this;N._44O&&N._44O.each(function(U){U.draw?U.draw($,q):U.call(N,$,q)})}},ms_sm:function(_){_.sm=function(){return this.getSelectionModel()},_.setSelectableFunc=function(P){this.sm().setFilterFunc(P)},_.getSelectableFunc=function(){return this.sm().getFilterFunc()},_.getSelectionModel=function(){var O=this;return O._selectionModel?O._selectionModel:O.dm().sm()},_.isSelectionModelShared=function(){return!this._selectionModel},_.setSelectionModelShared=function(y){var B=this,P=!B._selectionModel,c=B.handleSelectionChange,l=B.dm();P!==y&&(B.invalidateSelection&&B.invalidateSelection(),y?(l.sm().ms(c,B),B._selectionModel.ums(c,B),B._selectionModel.dispose(),B._selectionModel=I):(l.sm().ums(c,B),B._selectionModel=new hs(l),B._selectionModel.ms(c,B)),B.onSelectionModelSharedChanged(),B.fp("selectionModelShared",P,y))},_.onSelectionModelSharedChanged=function(){var S=this;S.redraw(),S.invalidateSelection&&S.invalidateSelection()},_.removeSelection=function(){var n=this.dm();n.beginTransaction(),this.sm().toSelection().each(n.remove,n),n.endTransaction()},_.selectAll=function(){var a=this;a.sm().ss(a.dm().toDatas(function(A){return a.isVisible(A)&&a.isSelectable(A)}))},_.isSelected=function(O){return this.sm().co(O)},_.isSelectedById=function(_){var q=this.dm().getDataById(_);return q?this.isSelected(q):!1},_.isSelectable=function(S){return this.sm().isSelectable(S)}},ms_tx:function(j){j._64I=0,j._65O=0,j.isScrollable=function(){return this.getWidth()<this._64I},j._40o=function(){return this.isScrollable()},j.getLogicalPoint=function(e){return ro(e,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},j.tx=function(e){return e===H?this.getTranslateX():(this.setTranslateX(e),void 0)},j.getTranslateX=function(){return this._65O},j.setTranslateX=function(v){var R=this,o=R.getWidth()-R._64I;o>v&&(v=o),v>0&&(v=0),v=A(v);var V=R._65O;R._65O=v,R.fp(dh,V,v)}},ms_ty:function(F){F._23Q=0,F._66O=0,F._41o=function(){return this.getHeight()<this._23Q},F.getLogicalPoint=function(G){return ro(G,this._canvas||this._view,this.tx?this.tx():0,this.ty())},F.ty=function(n){return n===H?this.getTranslateY():(this.setTranslateY(n),void 0)},F.getTranslateY=function(){return this._66O},F.setTranslateY=function(Q){var j=this,x=j.getHeight()-j._23Q;x>Q&&(Q=x),Q>0&&(Q=0),Q=A(Q);var v=j._66O;j._66O=Q,j.fp(ul,v,Q)}},ms_txy:function(n){n._65O=0,n._66O=0,n.tx=function(C){return C===H?this.getTranslateX():(this.setTranslateX(C),void 0)},n.ty=function(u){return u===H?this.getTranslateY():(this.setTranslateY(u),void 0)},n.onTranslateEnded=function(){},n.setTranslate=function(p,I,D){var q=this;if(D=fq(D)){q._65I&&q._65I.stop(!0);var e=q.tx(),G=q.ty();D.action=function(F){q.setTranslate(e+(p-e)*F,G+(I-G)*F)},D._37o=function(){delete q._66I,delete q._65I,q.onTranslateEnded()},q._66I=1,q._65I=Vi(D)}else q.tx(p),q.ty(I)},n.getTranslateX=function(){return this._65O},n.setTranslateX=function(O){var l=this;O=l.adjustTranslateX(O);var A=l._65O;l._65O=O,l.fp(dh,A,O)},n.getTranslateY=function(){return this._66O},n.setTranslateY=function(g){var _=this;g=_.adjustTranslateY(g);var X=_._66O;_._66O=g,_.fp(ul,X,g)},n.adjustTranslateX=function(e){return A(e)},n.adjustTranslateY=function(H){return A(H)},n.translate=function(S,x,i){this.setTranslate(this.tx()+S,this.ty()+x,i)},n.getLogicalPoint=function(l){var m=this;return ro(l,this._canvas||m._view,m.tx(),m.ty())}},ms_dm:function(d){d.dm=function(i){return i?(this.setDataModel(i),void 0):this.getDataModel()},d.getDataModel=function(){return this._dataModel}},ms_lp:function(b){b.lp=function(P){return this.getLogicalPoint(P)}},ms_v:function(a){a._disabled=!1,a.setDisabled=function(J,Y){var O=this,y=O._disabled;y!==J&&(y&&(Wb(O._63O),delete O._63O),J&&(jr(O._view,O._63O=vb(Y)),O.iv()),O._disabled=J,O.fp("disabled",y,J))},a.isDisabled=function(){return this._disabled},a.getDisabledDiv=function(){return this._63O},a.getView=function(){return this._view},a.addToDOM=function(G){var K=this,T=K.getView(),a=T.style;G=G||i.body,G.appendChild(T),a.left="0",a.right="0",a.top="0",a.bottom="0",U.addEventListener("resize",function(){K.iv()},P),K.iv()},a.getWidth=function(){return this._view.clientWidth},a.getHeight=function(){return this._view.clientHeight},a.setWidth=function(V){var Z=this;Z._view.style.width=V+pj,Z.iv(),Z.fp&&Z.fp(cq,I,V)},a.setHeight=function(O){var R=this;R._view.style.height=O+pj,R.iv(),R.fp&&R.fp(lh,I,O)},a.setFocus=function(f){var T=this,z=T._currentEditor;return f&&z&&(z.getView&&(z=z.getView()),z.contains(f.target))?!1:(Nm(T._view),T.endEditing&&T.endEditing(),T.fireViewEvent("focus"),!0)},a.iv=function(b){this.invalidate(b)},a.invalidate=function(x){var G=this;G._68I||(G._68I=1,Cr(G.validate,G,I,x),G.onInvalidated&&G.onInvalidated(),G.fireViewEvent("invalidate"))},a.validate=function(){var V=this,R=V._view;if(V._68I&&(delete V._68I,R.parentNode))if(0===R.offsetWidth&&0===R.offsetHeight&&V._67I!==I)V._67I===H&&(V._67I=h.reinvalidateCount),V._67I>0?V._67I--:V._67I=I,V.iv();else{V.fireViewEvent("beginValidate"),V.validateImpl(),V.onValidated&&V.onValidated(),V.fireViewEvent("validate");var E=V._63O;E&&(R.lastChild!==E&&(Wb(E),jr(R,E)),Hr(E,0,0,V.getWidth(),V.getHeight())),di(V),Nh(V),Qr(V)}},a.layout=function(E,P,a,d){1===arguments.length?Hr(this,E):Hr(this,E,P,a,d)},a.addViewListener=function(I,O,J){var Y=this;Y._67O||(Y._67O=new Th),Y._67O.add(I,O,J)},a.removeViewListener=function(B,T){this._67O.remove(B,T)},a.fireViewEvent=function(A){var a=this;a._67O&&(_e(A)&&(A={kind:A}),a._67O.fire(A)),h.viewListener&&h.viewListener(a,A)}},ms_tip:function(Q){Q.setToolTipEnabled=function($){var A=this;$?hd||A._13o||(A.enableToolTip(),A.fp("toolTipEnabled",!1,!0)):A._13o&&(A.disableToolTip(),A.fp("toolTipEnabled",!0,!1))},Q.isToolTipEnabled=function(){return!!this._13o},Q.enableToolTip=function(){var Y=this;hd||Y._13o||(Y._13o=function(A){var o=Y.getToolTip(A);o!=I?h.toolTipContinual&&h.isToolTipShowing()?rg(A,o):(Kg(),ep={timeout:e(Vr,Bg),e:A,info:o}):Kg()},Y.getView().addEventListener(wo,Y._13o,P),Y.getView().addEventListener("mouseleave",h.hideToolTip,P))},Q.disableToolTip=function(){var t=this;t._13o&&(t.getView().removeEventListener(wo,t._13o,P),t.getView().removeEventListener("mouseleave",h.hideToolTip,P),delete t._13o)},Q.getToolTip=function(E){var M=this;if(M.getDataAt){var n=M.getDataAt(E);return n?n.getToolTip():I}return M.getValue?M.getValue():void 0}},_52o:function(r){r._zoom=1,r._29I=jq,r.zoomIn=function(s,i){this.setZoom(this._zoom*yj,s,i)},r.zoomOut=function(r,w){this.setZoom(this._zoom/yj,r,w)},r.zoomReset=function(x,J){this.setZoom(1,x,J)},r.scrollZoomIn=function(e){this.setZoom(this._zoom*Wd,I,e)},r.scrollZoomOut=function(m){this.setZoom(this._zoom/Wd,I,m)},r.pinchZoomIn=function(b){this.setZoom(this._zoom*zl,I,b)},r.pinchZoomOut=function(O){this.setZoom(this._zoom/zl,I,O)},r.adjustZoom=function(G){return Sk>G?Sk:G>jh?jh:G},r.getZoom=function(){return this._zoom},r.setZoom=function(W,P,k){var r=this;if(P=fq(P)){r._14o&&r._14o.stop(!0);var E=r._zoom;P.action=function(y){r._96O(E+(W-E)*y,k)},P._37o=function(){delete r._zooming,delete r._14o,r.onZoomEnded()},r._zooming=1,r._14o=Vi(P)}else r._96O(W,k)},r._96O=function($,J){var p=this;if($=p.adjustZoom($),$!==p._zoom){p.validate();var D=p._29I,d=p._zoom;0!==D.width&&0!==D.height&&(J=J?J:{x:D.x+D.width/2,y:D.y+D.height/2},p.tx((J.x-D.x)*d-J.x*$),p.ty((J.y-D.y)*d-J.y*$)),p._zoom=$,p.fp("zoom",d,$)}}}};Of(h,{numberDigits:5,crossOrigin:"",baseZIndex:H,isTouchable:hd,devicePixelRatio:U.devicePixelRatio?U.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:R.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return Rm},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],doubleClickRange:hd?20:1,animDuration:200,animEasing:function(n){return n*n},labelColor:Xc,labelSelectColor:lo,labelFont:(hd?"15":"12")+"px arial, sans-serif",widgetIndent:hd?30:20,widgetRowHeight:hd?30:20,widgetHeaderHeight:hd?32:22,widgetTitleHeight:hd?34:24,scrollBarColor:Xb,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:hd?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:$b,intersectionLineLine:Uc,isEnter:Rr,isEsc:Cj,isDelete:Ce,isSpace:ib,isLeft:Od,isUp:Nl,isRight:Id,isDown:Ik,getTarget:Mb,isString:_e,isNumber:df,isBoolean:Ro,isArray:Ck,isSelectAll:Ic,isFunction:gj,isObject:Lg,getPropertyValue:nd,setPropertyValue:jk,addMethod:Of,getVersion:function(){return"6.2.7"},createGradient:function(R,k,U,w,g,f,n,I){var _=Cq[k];return _(R,U,w,g,f,n,I)},appendToScreen:function(I){I=I.getView?I.getView():I,(i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement||i.msFullscreenElement||i.body).appendChild(I)},toggleFullscreen:function(K){var c=K.getView();if(i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement||i.msFullscreenElement)i.exitFullscreen?i.exitFullscreen():i.msExitFullscreen?i.msExitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen&&i.webkitExitFullscreen();else{var d=!0;if(K.isSelfViewEvent){var J=K.getX(),q=K.getY(),L=K.getWidth(),G=K.getHeight(),k=c.style.background;k||(c.style.background="white"),c.requestFullscreen?c.requestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullscreen&&c.webkitRequestFullscreen();var r=setInterval(function(){if(c!==(i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement||i.msFullscreenElement))clearInterval(r),K.setX(J),K.setY(q),K.setWidth(L),K.setHeight(G),K._fullscreen=!1,c.style.background=k,K.iv();else{var C=j.Default.getWindowInfo();(d||C.width!==K.getWidth()||C.height!==K.getHeight())&&(K.setX(C.left),K.setY(C.top),K.setWidth(C.width),K.setHeight(C.height),K._fullscreen=!0,K.iv(),d=!1)}},500)}else{var t=c.style.left,g=c.style.top,L=c.style.width,G=c.style.height,k=c.style.background;k||(c.style.background="white"),c.requestFullscreen?c.requestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullscreen&&c.webkitRequestFullscreen();var r=setInterval(function(){if(c!==(i.fullscreenElement||i.mozFullScreenElement||i.webkitFullscreenElement||i.msFullscreenElement))clearInterval(r),c.style.left=t,c.style.top=g,c.style.width=L,c.style.height=G,c.style.background=k,K.iv();else{var o=j.Default.getWindowInfo();(d||o.width!==K.getWidth()||o.height!==K.getHeight())&&(Hr(K),d=!1)}},500)}}},appendTimeStamp:function(V){return V},setCompType:function(Z,d){gj(d)||Lg(d)?sj[Z]=d:ts(Z)},getCompType:function(m){var l=sj[m];return l===H&&up.test(m)&&ts(m),l},getCompTypeMap:function(){return sj},drawCompType:function(n,B,T,O,e,h){n(B,T,O,e,h)},numberListener:function(){var X={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(Q){var S=Q.keyCode;X[S]||65===S&&h.isCtrlDown(Q)||86===S&&h.isCtrlDown(Q)||67===S&&h.isCtrlDown(Q)||88===S&&h.isCtrlDown(Q)||S>=35&&40>=S||(Q.shiftKey||48>S||S>57)&&(96>S||S>105)&&Q.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(b){var C=b.target.tagName;("DIV"===C||"CANVAS"===C)&&!(h.ignoreKeyCodes.indexOf(b.keyCode)>=0)&&("keydown"!==b.type||Od(b)||Id(b)||Nl(b)||Ik(b)||Ce(b)||65===b.keyCode&&(b.metaKey||b.ctrlKey))&&(b.preventDefault(),b.preventManipulation&&b.preventManipulation())},getWindowInfo:function(){var k=i.documentElement,d=k&&(k.scrollLeft||k.scrollTop)?k:i.body;return{target:d,left:d.scrollLeft,top:d.scrollTop,width:U.innerWidth||d.clientWidth,height:U.innerHeight||d.clientHeight}},isDragging:function(){return!!Rm},isLeftButton:function(m){return hd?!0:0===m.button},isInput:function(I){if(!I)return!1;var x=I.tagName;return"INPUT"===x||"TEXTAREA"===x||"SELECT"===x},getTouchCount:function(g){return hd?g.touches.length:1},isDoubleClick:function(){function Z(l){l.details=0,l.timeout=null,l.lastPoint=null}var g={};return Ae=new n,tf=Ae.getTime(),function(f){if(f.touches&&f.touches.length>1)return!1;var s=f.button==I?"":f.button,W=f.type+s,y=W+"_isDoubleClick",a=g[W];if(a||(a=g[W]={details:0,timeout:null,lastPoint:null}),f[y]===H){f[y]=!0;var J=fm(f);a.timeout&&(r(a.timeout),a.timeout=null),a.lastPoint&&em(a.lastPoint,J)>h.doubleClickRange&&Z(a),a.lastPoint=J,a.details++,a.timeout=e(function(){Z(this)}.bind(a),500)}return 2===a.details}}(),isShiftDown:function(w){return w?w.shiftKey:ij["16"]},isCtrlDown:function(e){return e?pf?e.metaKey:e.ctrlKey:pf?ij["91"]:ij["17"]},getClientPoint:function($){return hd&&($=Dk($)),{x:$.clientX,y:$.clientY}},isMouseEvent:function(W){return W instanceof MouseEvent||0===W.type.indexOf("mouse")},getTargetElement:function(c){if(h.isMouseEvent(c)||!i.elementFromPoint)return c.target;var g=Zp(c);return i.elementFromPoint(g.x,g.y)},getPagePoint:function(q){return hd&&(q=Dk(q)),{x:q.pageX,y:q.pageY}},createObject:function(B,X){var N=new B;for(var i in X){var F=X[i];if(gj(F))N[i]=F;else if(0===i.indexOf("s:"))N.s(i.substr(2),X[i]);else if(0===i.indexOf("a:"))N.a(i.substr(2),X[i]);else{var $=Kc(i),F=X[i];N[$]?(N[$](F),"setToolTip"===$&&N.enableToolTip&&N.enableToolTip()):N[i]=F}}return N},setImage:function(A,Z,S,b){var C=arguments.length;4===C?kf(A,b,Z,S):2===C?_e(Z)?kf(A,Z):co[A]=Z:1===C&&kf(A,A)},getImage:function(_,N,v){var m;if(_==I)return I;if(Lg(_)?m=_:(m=co[_],_&&m===H&&(to&&to[_]||kf(_,_))),N&&m&&m.tagName){var c;c="override"===v?"colors_override":"override_rgb"===v?"colors_override_rgb":"override_a"===v?"colors_override_a":"colors",m[c]||(m[c]={__count__:0});var p=m[c][N];return p||(m[c].__count__>h.imageCacheThreshold&&(m[c]={__count__:0}),p=cb(m,nb(N),m.width,m.height,v),m[c][N]=p,m[c].__count__++),p}return m},isImageComplete:function(G,E,_){var g=Lg(G)?G:co[G];if(!g)return!1;if(g.tagName)return g.complete;for(var e,G,a,w=g.comps,m=!0,u=0,X=w.length;X>u;u++)if(e=w[u],a=e.type,"image"===e.type){G=e.name,G&&G.func&&(G=oh(G,E));var F=fl(G,E,_);if(!F){m=!1;break}}else if(up.test(a)&&h.getCompType(a)===H){m=!1;break}return m},getId:function(){var z=1;return function(){return++z}}(),callLater:function(z,Z,O,V){var M=function(){z.apply(Z,O)};return V?e(M,V):U.requestAnimationFrame(M)},clone:function(N){if(null==N||"object"!=typeof N)return N;if(N instanceof Date){var P=new Date;return P.setTime(N.getTime()),P}if(N instanceof Array){for(var P=[],E=0,v=N.length;v>E;E++)P[E]=oc(N[E]);return P}if(N instanceof fb){for(var P=new fb,E=0,v=N.length;v>E;E++)P.set(E,oc(N.get(E)));return P}if(N instanceof Uk)return N;if(N instanceof C){var P={};for(var Z in N)N.hasOwnProperty(Z)&&(P[Z]=oc(N[Z]));return P}return N},callWhenLoaded:function(K,R){R=R||100;var U=$e(K,R);ok||(ok={}),ok[U]={tick:U,cb:K,delay:R}},beforeLoadURL:function(T){if(ok){var A={};for(var Y in ok){var F=ok[Y];r(F.tick);var I=$e(F.cb,F.delay);A[I]={tick:I,delay:F.delay,cb:F.cb}}ok=A}return h.convertURL?h.convertURL(T):T},convertURL:function(T){return T},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return h.getImage("default_blank")},sortFunc:function(X,R){if(X===R)return 0;if(X==I&&R!=I)return 1;if(X!=I&&R==I)return-1;if(X==I&&R==I)return 0;var B,O=typeof X,p=typeof R;return O===Gr&&p===Gr?B=X.localeCompare(R):O===Bo&&p===Bo&&(B=X-R),B===H&&(B=(""+X).localeCompare(""+R)),B>0?1:0>B?-1:0},getClassMap:function(){return _k},getClass:function(j){if(_e(j)){var g,Q=_k[j];if(!Q){g=j.split("."),Q=U;for(var W=0;W<g.length;W++)Q=Q[g[W]];_k[j]=Q}return Q}return j},def:function(B,b,Z){var x,n,C,Q=function(){};if(Q.prototype=b.prototype,x=new Q,_e(B)){if(_k[B])throw"'"+B+"' already defined";C=Vf(B),x.getClassName=function(){return B}}else C=B;if(x.constructor=C,x.getClass=function(){return C},x.getSuperClass=function(){return b},Z)for(n in Z)Tm[n]&&Tm.hasOwnProperty(n)?Tm[n](x,Z):Uh(x,Z,n);C.prototype=x,C.superClass=b.prototype},startAnim:function(){var E=function(e){e.duration&&(e.startTime=Xi()),e.timeId=Cr(e.tick,I,I,e.interval)};return function(L){return L=oc(L),L.easing=L.easing||h.animEasing,L.duration||L.frames||(L.duration=h.animDuration),L.t=0,L.duration?L.interval=0:(L.frame=0,L.interval=L.interval||10),L.tick=function(){if(L.duration){var A=(Xi()-L.startTime)/L.duration;A>1&&(A=1),L.t=A,L.action(L.easing(A),A),1===A?L.stop():L._isPaused||(L.timeId=Cr(L.tick))}else L.frame++,A=L.t=L.frame/L.frames,L.action(L.easing(A),A),L.frame<L.frames?L._isPaused||(L.timeId=Cr(L.tick,I,I,L.interval)):L.stop()},L.resume=function(){L._isPaused&&(delete L._isPaused,L.duration?L.t<1&&(L.startTime=Xi()-L.duration*L.t,L.timeId=Cr(L.tick)):L.frame<L.frames&&(L.timeId=Cr(L.tick,I,I,L.interval)))},L.pause=function(){L._isPaused=!0},L.isPaused=function(){return this._isPaused},L.stop=function(f){L.isRunning()&&(L.duration?L.t<1&&f&&(L.t=1,L.action(L.easing(1),1)):L.frame<L.frames&&f&&(L.frame=L.frames,L.action(L.easing(1),1)),L._37o&&L._37o(),L.finishFunc&&L.finishFunc(),ne(L.timeId,!L.duration),delete L.timeId)},L.isRunning=function(){return L.timeId!=I},L.delay?Cr(E,I,[L],L.delay):E(L),L}}(),getTextSize:function(){var h={},n=i?Ue().getContext("2d"):I;return function(T,v){n.font=T?T:be;var e=h[n.font];return e||(e=2*n.measureText("e").width+4,h[n.font]=e),{width:n.measureText(v).width+4,height:e}}}(),drawText:function(r,L,v,K,$,Z,A,T,a,o){if(L!=I){var _=es(v,L),f={};f.y=o&&o!==Nk?o===yo?Z+_.height/2:Z+T-_.height/2:Z+T/2,f.x=a&&a!==Mn?a===rj?$+A-_.width/2:$+A/2:$+_.width/2,ld(r,L,f,v,K)}},getDistance:function(c,Q){var a=c.length;return Q?3===a?p(D(c[0]-Q[0])+D(c[1]-Q[1])+D(c[2]-Q[2])):2===a?p(D(c[0]-Q[0])+D(c[1]-Q[1])):c.z===H?p(D(Q.x-c.x)+D(Q.y-c.y)):p(D(Q.x-c.x)+D(Q.y-c.y)+D(Q.z-c.z)):3===a?p(D(c[0])+D(c[1])+D(c[2])):2===a?p(D(c[0])+D(c[1])):void 0},brighter:function(p,q){return 0>q&&(q=-q),om(p,q?q:40)},darker:function(H,w){return w>0&&(w=-w),om(H,w?w:-40)},unionPoint:function(s,P){if(!s)return I;if(2===arguments.length)return s&&P?{x:N(s.x,P.x),y:N(s.y,P.y),width:J(s.x-P.x),height:J(s.y-P.y)}:I;var t=s;if(t._as&&(t=t._as),t.length===H)return I;var V=t.length;if(0>=V)return I;for(var _=1,g=t[0],W={x:g.x,y:g.y,width:0,height:0};V>_;_++){g=t[_];var v=N(W.x,g.x),d=o(W.x+W.width,g.x),l=N(W.y,g.y),M=o(W.y+W.height,g.y);W.x=v,W.y=l,W.width=d-v,W.height=M-l}return W},unionRect:function(B,$){if(B&&!$)return oc(B);if(!B&&$)return oc($);if(B&&$){var s={x:N(B.x,$.x),y:N(B.y,$.y)};return s.width=o(B.x+B.width,$.x+$.width)-s.x,s.height=o(B.y+B.height,$.y+$.height)-s.y,s}return I},containsPoint:function(L,a,o,c){if(c!=I&&1!==c){var Z=L.x+L.width/2,l=L.y+L.height/2;L={x:Z-L.width/2*c,y:l-L.height/2*c,width:L.width*c,height:L.height*c}}if(o){var C=L.width/2,M=L.height/2,Y=f(-o),e=O(-o),m=a.x-L.x-C,S=a.y-L.y-M;return a={x:e*m-Y*S,y:Y*m+e*S},ps({x:-C,y:-M,width:L.width,height:L.height},a)}return!(!L||a.x<L.x||a.y<L.y||a.x>L.x+L.width||a.y>L.y+L.height)},containsRect:function(J,N){if(!J||!N)return!1;var W=N.x,m=N.y,D=N.width,z=N.height,B=J.width,H=J.height;if(0>(B|H|D|z))return!1;var r=J.x,Y=J.y;if(r>W||Y>m)return!1;if(B+=r,D+=W,W>=D){if(B>=r||D>B)return!1}else if(B>=r&&D>B)return!1;if(H+=Y,z+=m,m>=z){if(H>=Y||z>H)return!1}else if(H>=Y&&z>H)return!1;return!0},intersectsRect:function(U,E){if(!U||!E)return!1;var O=E.width,Q=E.height,A=U.width,i=U.height;if(0>=A||0>=i||0>=O||0>=Q)return!1;var X=E.x,s=E.y,B=U.x,o=U.y;return A+=B,i+=o,O+=X,Q+=s,A>X&&i>s&&O>B&&Q>o},intersection:function(g,f){if(!g||!f)return I;var C=f.x,R=f.y,T=g.x,N=g.y,m=C,d=R,n=T,D=N;return m+=f.width,d+=f.height,n+=g.width,D+=g.height,T>C&&(C=T),N>R&&(R=N),m>n&&(m=n),d>D&&(d=D),m-=C,d-=R,0>=m||0>=d?I:{x:C,y:R,width:m,height:d}},grow:function(m,j,J){J===H&&(J=j),m.x-=j,m.y-=J,m.width=m.width+2*j,m.height=m.height+2*J},getScreenPoint:function(O,o,h,s,G,B,H){var L,k,x=h.getBoundingClientRect(),q=O*(B||1)+x.left-h.scrollLeft+(s||0),S=o*(H||1)+x.top-h.scrollTop+(G||0),z={x:q,y:S};return(L=h.parentElement)&&(k=L.maxtrixAppend)?k.applyInverse(z,{}):z},getLogicalPoint:function($,M,r,f,o,g){var W,j,l=M.getBoundingClientRect();$.target?(aq($)?pf?ij["91"]=!0:ij["17"]=!0:pf?ij["91"]=!1:ij["17"]=!1,ij["16"]=Ah($)?!0:!1,$=hd?Dk($):$,W=$.clientX,j=$.clientY):(W=$.x,j=$.y);var u,R;if((u=M.parentElement)&&(R=u.maxtrixAppend)){var D=R.apply({x:W,y:j},{});return D.x=(D.x+M.scrollLeft-(r||0))/(o||1),D.y=(D.y+M.scrollTop-(f||0))/(g||1),D}return{x:(W-l.left+M.scrollLeft-(r||0))/(o||1),y:(j-l.top+M.scrollTop-(f||0))/(g||1)}},removeHTML:function(){var N;return function(H){return H&&H.getView&&(H=H.getView()),H&&H.parentNode?N===H?!0:(N=H,H.parentNode.removeChild(H),N=I,!0):!1}}(),getToolTipDiv:function(){if(!cc){cc=cf(),_n=cf();var w=cc.style;h.baseZIndex!=I&&(w.zIndex=G(h.baseZIndex)+3+""),w.whiteSpace="nowrap",w.color=h.toolTipLabelColor,w.background=h.toolTipBackground,w.font=h.toolTipLabelFont,w.padding="5px",w.boxShadow="0px 0px 3px "+h.toolTipShadowColor
}return cc},isToolTipShowing:function(){return cc&&cc.parentNode?!0:_n&&_n.parentNode?!0:!1},hideToolTip:function(){Wb(cc),Wb(_n),Bd()},showToolTip:function(H,J){if(!H||J==I)return Kg(),void 0;h.getToolTipDiv();var $,X;if(J.html?(J=J.html,$=_n,Wb(cc)):($=cc,Wb(_n)),X=$.style,$.innerHTML=J,$.parentNode||j.Default.appendToScreen($),H.target){H=Zp(H);var T=nk(),P=H.x,R=H.y,g=hd?60:12;if(hd){var O=$.getBoundingClientRect();X.left=P-O.width/2+pj,X.top=R-O.height-g<T.top?R+g+pj:R-O.height-g+pj}else{X.left=P+g+pj,X.top=R+g+pj;var O=$.getBoundingClientRect();O.left+O.width>T.width&&(X.left=P-g-O.width+pj),O.top+O.height>T.height&&(X.top=R-g-O.height+pj),O.left<0&&(X.left=P+g+pj),O.top<0&&(X.top=R+g+pj)}}else X.left=H.x+pj,X.top=H.y+pj;Bd()},startDragging:function(K,k,h){h==H&&(h=!0),K!==Rm&&(Rm?h&&(hd?Rm.handleWindowTouchEnd(k):Rm.handleWindowMouseUp(k)):hd?(U.addEventListener(jn,ml,P),U.addEventListener(Fq,eh,P)):(U.addEventListener(wo,tb,P),U.addEventListener($f,lc,P)),Rm=K)},getImageMap:function(){return co},toBoundaries:function(q,A,W,P){var J=[];return bf(q,A,W,P).forEach(function(O){var V=[];O.forEach(function(L){V.push(L.x,L.y)}),J.push(V)}),J},getCurrentKeyCodeMap:function(){return ij},drawCenterImage:function(Z,n,q,X,e,M,H,Y){var h=uf(n,e,M),O=Xd(n,e,M);_i(Z,n,A(q-h/2),A(X-O/2),h,O,e,M,H,Y)},drawStretchImage:function(r,V,z,$,g,H,l,j,M,T,c,k){var C,v=uf(V,j,M,H),U=Xd(V,j,M,l);"uniform"===z?(C=N(H/v,l/U),v*=C,U*=C,$+=A((H-v)/2),g+=A((l-U)/2),H=v,l=U):"centerUniform"===z&&((v>H||U>l)&&(C=N(H/v,l/U),v*=C,U*=C),$+=A((H-v)/2),g+=A((l-U)/2),H=v,l=U);var D=r.interactiveInfo;if(D){var s;if(s="center"===z?{x:$+H/2-v/2,y:g+l/2-U/2,width:v,height:U}:{x:$,y:g,width:H,height:l},D.rect){var Y=D.compInfos,d=Y.length;d&&(Y[d-1].rect.image=V)}else D.rect=s}if("center"===z){var Z=c!==!1&&(v>H||U>l);Z&&(r.save(),r.beginPath(),r.rect($,g,H,l),r.clip()),_i(r,V,$+H/2-v/2,g+l/2-U/2,v,U,j,M,T,k),Z&&r.restore()}else _i(r,V,$,g,H,l,j,M,T,k)},toCanvas:function(m,t,$,N,x,q,W,Q,k){m=qp(m,W),t=t||uf(m,x),$=$||Xd(m,x);var j=Ue(),B=Pg(j);return Q?(op(j,t,$,Q),B.scale(Q,Q)):op(j,t,$,1),mg(B,m,N,0,0,t,$,x,q,W,k),m&&m.clampToEdge&&(j.clampToEdge=m.clampToEdge),B.restore(),j},toGrayColor:function(u){if(!u)return u;var l=Rg(u),w=.299*l[0]+.587*l[1]+.114*l[2];return"rgba("+w+","+w+","+w+","+l[3]/255+")"},createGradientImage:function(M,S,O,J){for(var v=["L",0,0,M,0,1,0,0,1,0,0],h=0,z=Math.min(S.length,O.length);z>h;h++)v.push(O[h],S[h]);var U=j.Default.toCanvas({width:M,height:M,clampToEdge:!0,comps:[{type:"shape",rotation:J||0,points:[0,0,M,0,M,M,0,M],background:"#ffffff",gradientPack:v}]});return U},createElement:function(Y,$,_,w){var A=i.createElement(Y);return zm(A,$||R.widgetBorder,2),A.style.font=_?_:be,w!=I&&(A.value=w),h.onElementCreated&&h.onElementCreated(A),A},containedInView:function($,j){var K=eq(j).getBoundingClientRect();return ps({x:K.left,y:K.top,width:K.width,height:K.height},fm($))},isIsolating:function(){return Nf>0},setIsolating:function(F){F?Nf++:Nf--},getMSMap:function(){return Tm},stringify:function(b,c){var G=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var y=JSON.stringify(b,function(c,g){return"function"==typeof g?"__ht__"+(g.__ht__||g.toString()):df(g)?Yq(g):g},c==I?2:c);return Date.prototype.toJSON=G,y},parse:function(_){return _e(_)?JSON.parse(_,function(K,y){if(_e(y)){if("__ht__function"==y.substr(0,14)){var N=y.indexOf("{")+1,g=y.lastIndexOf("}"),p=y.indexOf("(")+1,z=y.indexOf(")");if(N&&g&&p&&z){var q=new Function(y.substring(p,z),y.substring(N,g));return q.__ht__=y.substr(6),q}}if("__ht__date"==y.substr(0,10))return new Date(G(y.substr(10)))}return y}):_},loadJS:function(O,c){c&&O.push(c);var J=O.shift();if(Ck(J))O=J.contact(O),h.loadJS(O);else if(gj(J))J(),h.loadJS(O);else if(_e(J)){var E=i.createElement("script");E.onload=function(){h.loadJS(O)},E.setAttribute("src",J),i.getElementsByTagName("head")[0].appendChild(E)}else O.length&&h.loadJS(O)},toRoundedCorner:function(W,j){var w=W.size();if(0>=j)return{points:W};var Y,G=new fb,T=new fb,z=W.get(0);G.add(z),T.add(1);for(var y=1;w>y;y++)if(w>y+1){var K=W.get(y),e=W.get(y+1),r=z.x,c=z.y,Q=K.x,v=K.y,P=v-c,E=Q-r,n=B(P,E);Y=N(.99*em(z,K),j),G.add({x:Q-Y*O(n),y:v-Y*f(n)}),G.add(K),r=K.x,c=K.y,Q=e.x,v=e.y,P=v-c,E=Q-r,n=B(P,E),Y=N(.99*em(K,e),j),z={x:r+Y*O(n),y:c+Y*f(n)},G.add(z),T.addAll([2,3])}else G.add(W.get(y)),T.add(2);return{points:G,segments:T}},toColorData:Rg,setCanvas:op,createDiv:cf,createDisabledDiv:vb,createView:Di,createCanvas:Ue,appendChild:jr,initContext:Pg,checkLoadingImage:di,translateAndScale:np,layout:Hr,getPosition:Xp,drawPoints:oe,drawRoundRect:ur,drawBorder:Wr,setFocus:Nm,getter:ys,setter:Kc,isEmptyObject:fh},!0),Of(Q,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var qf=h.disabledOpacity,Bg=h.toolTipDelay,Ed=h.devicePixelRatio,pq=h.autoMakeVisible,Ec=h.autoHideScrollBar,vd=h.imageGradient,rg=h.showToolTip,Kg=h.hideToolTip,Yk=h.dashPattern,bg=h.lineCap,nc=h.lineJoin,Cc=h.labelColor,gp=h.labelSelectColor,be=h.labelFont,Qk=h.widgetIndent,br=h.widgetRowHeight,yb=h.widgetHeaderHeight,Zf=h.widgetTitleHeight,jj=h.scrollBarColor,Gl=h.scrollBarSize,Pi=h.scrollBarTimeout,Sj=h.scrollBarMinLength,kr=h.scrollBarInteractiveSize,yj=h.zoomIncrement,Wd=h.scrollZoomIncrement,zl=h.pinchZoomIncrement,jh=h.zoomMax,Sk=h.zoomMin,Re=h.createObject,Oi=h.preventDefault,Jp=h.setImage,qp=h.getImage,fl=h.isImageComplete,ll=h.drawCenterImage,mg=h.drawStretchImage,sl=h.getId,Cr=h.callLater,xl=h.sortFunc,oc=h.clone,Vf=h.getClass,Vi=h.startAnim,$i=h.brighter,fk=h.darker,zj=h.drawText,es=h.getTextSize,gc=h.isLeftButton,Kb=h.getTouchCount,Ih=h.isDoubleClick,Ah=h.isShiftDown,aq=h.isCtrlDown,fm=h.getClientPoint,Zp=h.getPagePoint,em=h.getDistance,no=h.unionPoint,Tp=h.unionRect,ps=h.containsPoint,vf=h.containsRect,Jb=h.intersectsRect,ah=h.intersection,nk=h.getWindowInfo,Rd=h.grow,ro=h.getLogicalPoint,oi=h.getScreenPoint,Ti=h.startDragging,Wb=h.removeHTML,Gb=h.createElement,ds=h.segmentResolution,rh=h.shapeResolution,Qj=h.shapeSide,ab=h.def,yp=function(d,P,O){ab(t+"."+d,P,O)},$o=function(R,Z){R.childNodes.forEach(function(x){Z(x),$o(x,Z)})};Of(h,{toolTipLabelColor:Cc,toolTipLabelFont:be,toolTipBackground:R.toolTipBackground,toolTipShadowColor:Xb,drawBreakableText:sd,setDevicePixelRatio:function(A){Ed=h.devicePixelRatio="number"==typeof A?A:U.devicePixelRatio,$o(i.body,function(X){var q=X._ht;q&&q._canvas&&(op(q._canvas,q.getWidth(),q.getHeight()),q.redraw?q.redraw():q.iv())})}},!0);var An=1e-6,qr="undefined"!=typeof Uint16Array?Uint16Array:Array,kj="undefined"!=typeof Float32Array?Float32Array:Array,Ip=function(x,w,e){var S=[x[0]-w[0],x[1]-w[1],x[2]-w[2]];if(e){var C=em(S);C>0&&(S[0]/=C,S[1]/=C,S[2]/=C)}return S},Kr=function(){var z="charCodeAt",S=2*(2*Og.length+1);for(var c in U)if(c===t+Mn[0]+pj.length){var Y=U[c];if(!Y)break;for(var A=Y.length,s=0;A>s;s++)if(Y[s][z](0)===S&&Y[s+1]!=I&&Y[s+1]===pj[0]&&Y[s+2]!=I&&Y[s+2][z](0)===S){for(var N=s+3;A>N;N++)if(Y[N][z](0)===S){if(0==Y[N+1])for(var E,k=N+2;A>k;k++){if(Y[k][z](0)===S){0==Y[k-1]&&E&&(b=E.substr(0,E.length-1));break}E==I?E=Y[k]:E+=Y[k]}break}break}break}return function(k){return[-k[0],-k[1],-k[2]]}}(),Xh=function(S,A){return 3===S.length?S[0]*A[0]+S[1]*A[1]+S[2]*A[2]:S[0]*A[0]+S[1]*A[1]},Fn=function(){var h=new kj(16);return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},wn=Fn(),Lc=function(I){var M=new kj(16);return M[0]=I[0],M[1]=I[1],M[2]=I[2],M[3]=I[3],M[4]=I[4],M[5]=I[5],M[6]=I[6],M[7]=I[7],M[8]=I[8],M[9]=I[9],M[10]=I[10],M[11]=I[11],M[12]=I[12],M[13]=I[13],M[14]=I[14],M[15]=I[15],M},$q=function(V,k){return V[0]=k[0],V[1]=k[1],V[2]=k[2],V[3]=k[3],V[4]=k[4],V[5]=k[5],V[6]=k[6],V[7]=k[7],V[8]=k[8],V[9]=k[9],V[10]=k[10],V[11]=k[11],V[12]=k[12],V[13]=k[13],V[14]=k[14],V[15]=k[15],V},wp=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},Ph=function(U,u){var t=U[0],_=U[1],W=U[2];return U[0]=u[0]*t+u[4]*_+u[8]*W+u[12],U[1]=u[1]*t+u[5]*_+u[9]*W+u[13],U[2]=u[2]*t+u[6]*_+u[10]*W+u[14],U},Hn=function(B,z){var O=B[0],Z=B[1],C=B[2],l=B[3];return B[0]=z[0]*O+z[4]*Z+z[8]*C+z[12]*l,B[1]=z[1]*O+z[5]*Z+z[9]*C+z[13]*l,B[2]=z[2]*O+z[6]*Z+z[10]*C+z[14]*l,B[3]=z[3]*O+z[7]*Z+z[11]*C+z[15]*l,B},ho=function(){var n,$,h,I,M=zc(jf[1]+jf[7]),S=zc(jf[0]+jf[3]-jf[10]),s=zc(jf[8]+2),J=function(){return $=h.charAt(n),n+=1,$},C=function(){var Y="";if($===s)for(;J();){if($===s)return J(),Y;Y+=$}else J()},N=function(){for(;$&&" ">=$;)J()},v=function(){var K,i={};if($===M){if(J(),N(),$===S)return J(),i;for(;$;){if(K=C(),N(),J(),i[K]=I(),N(),$===S)return J(),i;J(),N()}}};return I=function(){switch(N(),$){case M:return v();default:return C()}},function(r){if(m={},r){var V;if(h=r,n=0,$=" ",V=I(),N(),!$)return V}}}(),Zi=function(u,g){if(g){var h=f(g),G=O(g),m=u[4],r=u[5],S=u[6],b=u[7],A=u[8],Z=u[9],s=u[10],c=u[11];u[4]=m*G+A*h,u[5]=r*G+Z*h,u[6]=S*G+s*h,u[7]=b*G+c*h,u[8]=A*G-m*h,u[9]=Z*G-r*h,u[10]=s*G-S*h,u[11]=c*G-b*h}},Oq=function(B,m){if(m){var J=f(m),y=O(m),$=B[0],W=B[1],Q=B[2],L=B[3],w=B[8],r=B[9],F=B[10],S=B[11];B[0]=$*y-w*J,B[1]=W*y-r*J,B[2]=Q*y-F*J,B[3]=L*y-S*J,B[8]=$*J+w*y,B[9]=W*J+r*y,B[10]=Q*J+F*y,B[11]=L*J+S*y}},tj=function(z,W){if(W){var E=f(W),d=O(W),H=z[0],o=z[1],w=z[2],A=z[3],U=z[4],K=z[5],B=z[6],M=z[7];z[0]=H*d+U*E,z[1]=o*d+K*E,z[2]=w*d+B*E,z[3]=A*d+M*E,z[4]=U*d-H*E,z[5]=K*d-o*E,z[6]=B*d-w*E,z[7]=M*d-A*E}},gq=function(B,j,u){return Dq(I,u===!1?I:B.getFinalScale3d(),B.getFinalRotation3d(),B.getRotationMode(),B.p3(),I,j)},Dq=function(L,e,V,R,m,d,l){return d||(d=Fn()),m&&Le(d,m),us(d,V,R),l&&Fc(d,d,l),e&&In(d,e),L&&Fc(d,d,L),d},wd=function(C,d,B){d=G(d),B=G(B);var v=this;v.g=C,v._84O=d,v._85O=B,v._70I=!0,v.F=0,v._83O=d+B,v.pen={x:0,y:0}},Mc="lineDashOffset",bc="setLineDash",Sr=function(N){for(var L in N)1===L.length&&(Mc=N[L]);return L?1:0},vs=function(A,P,N){return il(P)?A:A[bc]?(A[bc](P),N&&(A.lineDashOffset=N),A):new wd(A,P[0],P.length>1?P[1]:P[0])},Zc=function(I,i){!il(i)&&I[bc]&&(I[bc](Je),I.lineDashOffset=0)};if(ab(wd,C,{_69I:6,moveTo:function(C,a){var R=this,i=R.pen;i.x=C,i.y=a,R.g.moveTo(C,a),R.start||(R.start={x:C,y:a})},lineTo:function(n,u){var G=this,R=G.pen,p=n-R.x,L=u-R.y,o=B(L,p),r=O(o),l=f(o),U=G._23O(R.x,R.y,n,u),K=G._85O,q=G._84O,F=G._83O;if(G.F){if(G.F>U)return G._70I?G._72I(n,u):G.moveTo(n,u),G.F-=U,void 0;if(G._70I?G._72I(R.x+r*G.F,R.y+l*G.F):G.moveTo(R.x+r*G.F,R.y+l*G.F),U-=G.F,G.F=0,G._70I=!G._70I,!U)return}var c=$(U/F);if(c){for(var A=r*q,b=l*q,e=r*K,T=l*K,Q=0;c>Q;Q++)G._70I?(G._72I(R.x+A,R.y+b),G.moveTo(R.x+e,R.y+T)):(G.moveTo(R.x+e,R.y+T),G._72I(R.x+A,R.y+b));U-=F*c}G._70I?U>q?(G._72I(R.x+r*q,R.y+l*q),G.moveTo(n,u),G.F=K-(U-q),G._70I=!1):(G._72I(n,u),U===q?(G.F=0,G._70I=!G._70I):(G.F=q-U,G.moveTo(n,u))):U>K?(G.moveTo(R.x+r*K,R.y+l*K),G._72I(n,u),G.F=q-(U-K),G._70I=!0):(G.moveTo(n,u),U===K?(G.F=0,G._70I=!G._70I):G.F=K-U)},quadraticCurveTo:function(d,J,O,y){var T,n=this,m=n.pen,x=m.x,N=m.y,W=n._22O(x,N,d,J,O,y),w=0,A=0,U=n._85O,g=n._84O;if(n.F){if(n.F>W)return n._70I?n._71I(d,J,O,y):n.moveTo(O,y),n.F-=W,void 0;if(w=n.F/W,T=n._20O(x,N,d,J,O,y,w),n._70I?n._71I(T[2],T[3],T[4],T[5]):n.moveTo(T[4],T[5]),n.F=0,n._70I=!n._70I,!W)return}var u=W-W*w,b=$(u/n._83O),Z=g/W,S=U/W;if(b)for(var p=0;b>p;p++)n._70I?(A=w+Z,T=n._21O(x,N,d,J,O,y,w,A),n._71I(T[2],T[3],T[4],T[5]),w=A,A=w+S,T=n._21O(x,N,d,J,O,y,w,A),n.moveTo(T[4],T[5])):(A=w+S,T=n._21O(x,N,d,J,O,y,w,A),n.moveTo(T[4],T[5]),w=A,A=w+Z,T=n._21O(x,N,d,J,O,y,w,A),n._71I(T[2],T[3],T[4],T[5])),w=A;u=W-W*w,n._70I?u>g?(A=w+Z,T=n._21O(x,N,d,J,O,y,w,A),n._71I(T[2],T[3],T[4],T[5]),n.moveTo(O,y),n.F=U-(u-g),n._70I=!1):(T=n._19O(x,N,d,J,O,y,w),n._71I(T[2],T[3],T[4],T[5]),W===g?(n.F=0,n._70I=!n._70I):(n.F=g-u,n.moveTo(O,y))):u>U?(A=w+S,T=n._21O(x,N,d,J,O,y,w,A),n.moveTo(T[4],T[5]),T=n._19O(x,N,d,J,O,y,A),n._71I(T[2],T[3],T[4],T[5]),n.F=g-(u-U),n._70I=!0):(n.moveTo(O,y),u===U?(n.F=0,n._70I=!n._70I):n.F=U-u)},bezierCurveTo:function(){var v=arguments;this.pen={x:v[4],y:v[5]},this.g.bezierCurveTo(v[0],v[1],v[2],v[3],v[4],v[5])},arc:function(v,V,g,i,Q,I){I||(i=-i,Q=-Q),Oe(this,v,V,i,Q-i,g,g,!1)},rect:function(X,R,k,f){var q=this;q.pen={x:X,y:R},q.moveTo(X,R),q.lineTo(X,R+f),q.lineTo(X+k,R+f),q.lineTo(X+k,R),q.lineTo(X,R)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(t,D,v,U){var I=v-t,c=U-D;return p(I*I+c*c)},_22O:function(h,M,H,B,G,j,F){for(var T,q,e,Z,X,N,W,t=0,v=h,c=M,P=F>0?F:this._69I,k=1;P>=k;k++)e=k/P,Z=1-e,X=Z*Z,N=2*e*Z,W=e*e,T=X*h+N*H+W*G,q=X*M+N*B+W*j,t+=this._23O(v,c,T,q),v=T,c=q;return t},_21O:function(z,I,W,d,E,Q,A,l){var x=this;if(0===A)return x._20O(z,I,W,d,E,Q,l);if(1===l)return x._19O(z,I,W,d,E,Q,A);var g=x._20O(z,I,W,d,E,Q,l);return g.push(A/l),x._19O.apply(x,g)},_20O:function(N,c,S,X,s,i,L){if(1!==L){var Y=S+(s-S)*L,Z=X+(i-X)*L;S=N+(S-N)*L,X=c+(X-c)*L,s=S+(Y-S)*L,i=X+(Z-X)*L}return[N,c,S,X,s,i]},_19O:function(O,u,J,V,B,Y,m){if(1!==m){var l=O+(J-O)*m,L=u+(V-u)*m;J+=(B-J)*m,V+=(Y-V)*m,O=l+(J-l)*m,u=L+(V-L)*m}return[O,u,J,V,B,Y]},_72I:function(L,P){var h=this.pen;(L!==h.x||P!==h.y)&&(h.x=L,h.y=P,this.g.lineTo(L,P))},_71I:function(O,j,b,J){var G=this.pen;(O!==b||j!==J||b!==G.x||J!==G.y)&&(G.x=b,G.y=J,this.g.quadraticCurveTo(O,j,b,J))}}),T&&K){var Af=K.toString();F=Af.indexOf(tk.substr(0,2))>0&&Af.indexOf(yo+yo.substr(1,1))>1||Af.indexOf(Pn.substr(0,2)+tk.substr(2,2)+Mn[0]+tk[4])>1?!0:!1}var Xl=I,Vq=I,Nh=function(m){Xl&&!m._72O&&(Vq||(Vq={}),Vq[m._72O=sl()]=m)},ts=function(X,c){if(c||(c=X),c&&(Xl||(Xl={}),!Xl[X])){var y=new Ml;if(Xl[c]={request:y,url:c},c=h.beforeLoadURL(c),c.data){var T=h.parse(c.data);Ch(X,T),h.handleCompTypeLoaded(X,T)}else{y.onload=function(v){if(200===this.status||0===this.status){var R=h.parse(v.target.response||v.target.responseText);Ch(X,R),h.handleCompTypeLoaded(X,R)}else Ch(X,I)},y.onerror=function(){Ch(X,I)};var t={};t.url=encodeURI(c),t.sync=!1,y.send(t)}}},Ch=function(m,W){if(sj[m]=W,delete Xl[m],fh(Xl)&&(Xl=I,Vq)){for(var b in Vq){var E=Vq[b];E.invalidateAll&&E.invalidateAll(H,"compTypeLoaded",m),E.redraw&&E.redraw(),E.iv(),delete E._72O}Vq=I}if(W&&Vq)for(var b in Vq){var E=Vq[b];E.invalidateAll&&E.invalidateAll(H,"compTypeLoading",m),E.redraw&&E.redraw(),E.iv()}},ke=R.chart,_h=h.compStack=[],Cg=/^style@/,oq=/^attr@/,De=/^field@/,Ne={x:.5,y:.5},uf=function(o,h,F,v){if(!o)return 0;if(oh(o.fitSize,h,F)&&v)return v;var p=oh(o.width,h,F);return null==p?20:p},Xd=function(Y,c,S,N){if(!Y)return 0;if(oh(Y.fitSize,c,S)&&N)return N;var O=oh(Y.height,c,S);return null==O?20:O},oh=function(u,h,r){if(!u||!u.func)return u;var t,d=u.func,c=u.value;return t=gj(d)?r&&r.vectorDataBindingDisabled&&!u.isSafeFunc?c:d(h,r):h instanceof Uk?oq.test(d)?h.a(d.slice(5)):Cg.test(d)?h.s(d.slice(6)):De.test(d)?h[d.slice(6)]:h[d]?h[d](r):c:c,c!==H&&t==I?c:t},_i=h.drawImage=function(){var i,_,s,a,w,z,T=function(k,c){k.getValue&&k.getValue.compType===c||(k.getValue=function(A){var q=L(k,A);if(q===H&&c.properties){var O=c.properties[A];O&&(q=O.defaultValue)}return q},k.getValue.compType=c)},L=function(W,m,U){var q=W[m];return q&&q.func?(q=oh(q,_,s),U&&(q=U(q))):U&&(q=W[m]=U(q)),q},v=function(m,n){var M;if(M=n?L(m,n):m,i&&i.compGray&&M)return h.toGrayColor(M);if(w&&M){if("override"===z)return w;if("override_rgb"===z){var e=nb(w);return M=Rg(M),"rgba("+$(255*e[0])+","+$(255*e[1])+","+$(255*e[2])+","+M[3]/255+")"}if("override_a"===z){var e=nb(w);return M=Rg(M),"rgba("+M[0]+","+M[1]+","+M[2]+","+e[3]+")"}var e=nb(w);return M=Rg(M),"rgba("+$(M[0]*e[0])+","+$(M[1]*e[1])+","+$(M[2]*e[2])+","+M[3]/255*e[3]+")"}return M},l=function(O){if(Ck(O)){for(var L=new fb,d=O.length,I=0;d>I;I+=2)L.add({x:O[I],y:O[I+1]});O=L}return O},C=function(w){var o=L(w,"anchorX"),r=L(w,"anchorY");if(o!==H||r!==H)return{x:o===H?Ne.x:o,y:r===H?Ne.y:r};var G=L(w,"type"),e=L(w,"name");if("image"!==G||!e)return Ne;var b=qp(e);return b&&b.anchorX!==H&&b.anchorY!==H?{x:b.anchorX,y:b.anchorY}:Ne},q=function(Y,z){var P=L(Y,nn),y=C(Y);if(Ck(P)){var r=P.length,p=L(Y,"relative"),N=z.width,I=z.height;if(4===r)P={x:P[0],y:P[1],width:P[2],height:P[3]},p?(P.x*=N,P.y*=I,P.width*=N,P.height*=I):z.fitSize&&(P.x*=z.widthScale,P.width*=z.widthScale,P.y*=z.heightScale,P.height*=z.heightScale);else if(3===r){var o=P[0];P={width:P[1],height:P[2]},p?(P.width*=N,P.height*=I):z.fitSize&&(P.width*=z.widthScale,P.height*=z.heightScale),"object"==typeof o?o.length&&(o={x:o[0],y:o[1]}):o=Xp(o,z,P),P.x=o.x-P.width*y.x,P.y=o.y-P.height*y.y}var i=L(Y,"offsetX");i&&(z.fitSize&&(i*=z.widthScale),P.x+=i),i=L(Y,"offsetY"),i&&(z.fitSize&&(i*=z.heightScale),P.y+=i)}return P},r=function(s){return Ck(s)?new fb(s):s},S=function(F,Q,W,f,u,_,y){var x=i.interactiveInfo,G=F.transform;if(G)return i.save(),i.setTransform(G.a,G.b,G.c,G.d,G.tx,G.ty),x&&x.compInfos.push({comp:F,rect:Q,matrix:G.clone()}),!0;u===H&&(u=1),_===H&&(_=1);var z=L(F,"clipPercentage"),h=ol(W,Q);if(h&&!f&&1===u&&1===_&&!(1>z))return x&&x.compInfos.push({comp:F,rect:Q,matrix:x.matrix.clone()}),!1;y=y||Ne;var k=Q.x+Q.width*y.x,g=Q.y+Q.height*y.y,X=W.x+W.width*y.x,e=W.y+W.height*y.y,I=W.width?u*(Q.width/W.width):1,l=W.height?_*(Q.height/W.height):1;if(i.save(),x&&(x.matrix.appendTranslate(k,g).appendRotate(f).appendScale(I,l).appendTranslate(-X,-e),x.compInfos.push({comp:F,rect:Q,matrix:x.matrix.clone()})),Kh(i,k,g),Bh(i,f||0),gr(i,I,l),Kh(i,-X,-e),1>z){0>z&&(z=0);var S=vo(W,L(F,"clipDirection"),z);i.beginPath(),i.rect(S.x,S.y,S.width,S.height),i.clip()}return!0},G=function(){i.restore()},d=function(c,A,F){var V=L(c,"path"),g=L(c,_j),n=L(c,"scaleX"),N=L(c,"scaleY"),q=C(c),e=I,t=Wh(null,V);if(F||(F=c.unionRect,F||(F=no(t),c.path.func||(c.unionRect=F)),e=F),F){e||(e=c.unionRect,e||(e=no(t),c.path.func||(c.unionRect=e)));var $=S(c,F,e,g,n,N,q),Q=L(c,"borderPattern"),f=vs(i,Q),r=v(c,"background"),Y=v(c,"borderColor"),h=L(c,"borderWidth"),H=L(c,"gradient"),d=v(c,"gradientColor"),Z=L(c,"border3d"),W=L(c,"border3dColor"),x=L(c,"border3dAccuracy"),b=i.lineJoin,X=i.lineCap;if(i.lineJoin=L(c,"borderJoin")||nc,i.lineCap=L(c,"borderCap")||bg,r?(Bb(i,r,H,d,e),Wh(i,V),i.fill(),f!==i&&Wh(i,V)):Wh(i,V),h&&Y){var O=L(c,"borderWidthAbsolute");O&&(i.save(),i.setTransform(1,0,0,1,0,0)),i.lineWidth=h,i.strokeStyle=Y,i.stroke(),O&&i.restore(),Z&&Ao(i,Y,W,h,a,x)}if(Zc(i,Q),L(c,"dash")){var s=L(c,"dashWidth")||h;if(s>0){Q=L(c,"dashPattern")||Yk;var f=vs(i,Q,L(c,"dashOffset")),D=v(c,"dashColor")||v(Jg);f!==i&&Wh(i,V),i.strokeStyle=D,i.lineWidth=s,i.stroke(),L(c,"dash3d")&&Ao(i,D,v(c,"dash3dColor"),s,a,L(c,"dash3dAccuracy")),Zc(i,Q)}}A===nn&&mj(i,r,L(c,"depth"),e),i.lineJoin=b,i.lineCap=X,$&&G()}},J=function(c,$,B,O){var F=L(c,iq,l),p=L(c,_j),h=C(c);if(F&&O.fitSize){var N=Math.abs(Math.cos(p))<.001,y=new fb,R=no(F),m=O.widthScale,E=O.heightScale,u=R.x+h.x*R.width,T=R.y+h.y*R.height,Y=u*m,o=T*E;F.each(function(f){var Z=f.x-u,B=f.y-T;y.add({x:Y+Z*(N?E:m),y:o+B*(N?m:E)})}),F=y,c.unionRect=null}var b=L(c,"scaleX"),J=L(c,"scaleY"),X=$===Rc,t=I;if(!B&&X&&(B=c.unionRect,B||(B=no(F),c.points.func||(c.unionRect=B)),t=B),B){X?t||(t=c.unionRect,t||(t=no(F),c.points.func||(c.unionRect=t))):t=B;var d,K,W,A,q=S(c,B,t,p,b,J,h),M=L(c,"borderPattern"),f=vs(i,M),Z=v(c,"background"),j=qp(L(c,"repeatImage"),w,z),k=L(c,"gradientPack"),U=v(c,"borderColor"),g=L(c,"borderWidth"),n=L(c,"segments",r),x=L(c,"gradient"),Q=v(c,"gradientColor"),H=L(c,"border3d"),e=L(c,"border3dColor"),P=L(c,"border3dAccuracy"),D=L(c,"closePath"),V=L(c,"fillRule")||"nonzero",zb=i.lineJoin,Pl=i.lineCap;if(i.lineJoin=L(c,"borderJoin")||nc,i.lineCap=L(c,"borderCap")||bg,X)if(Z||j||k){var jr=L(c,"fillClipPercentage");if(1>jr){0>jr&&(jr=0);var vd=vo(t,L(c,"fillClipDirection"),jr);i.save(),i.beginPath(),i.rect(vd.x,vd.y,vd.width,vd.height),i.clip()}if(oe(i,F,n,D),k)im(i,k);else if(j){var Wb=i,Oj=w,Ef=z;Ze(i,j,w,z,_,s),i=Wb,w=Oj,z=Ef}else{var Wb=i;Bb(i,Z,x,Q,t),i=Wb}i.fill(V),1>jr&&i.restore(),k&&i.restore(),f!==i&&oe(f,F,n,D)}else oe(f,F,n,D);else if("roundRect"===$?d=L(c,"cornerRadius"):"polygon"===$?d=L(c,"polygonSide"):"arc"===$&&(d=L(c,"arcFrom"),K=L(c,"arcTo"),W=L(c,"arcClose"),A=L(c,"arcOval")),Z||j||k){var jr=L(c,"fillClipPercentage");if(1>jr){0>jr&&(jr=0);var vd=vo(t,L(c,"fillClipDirection"),jr);i.save(),i.beginPath(),i.rect(vd.x,vd.y,vd.width,vd.height),i.clip()}if(Pc(i,$,t,d,K,W,A),k)im(i,k);else if(j){var Wb=i,Oj=w,Ef=z;Ze(i,j,w,z,_,s),i=Wb,w=Oj,z=Ef}else Bb(i,Z,x,Q,t);i.fill(V),1>jr&&i.restore(),k&&i.restore(),i!==f&&Pc(f,$,t,d,K,W,A)}else Pc(f,$,t,d,K,W,A);if(g&&U){var cf=L(c,"borderWidthAbsolute");cf&&(i.save(),i.setTransform(1,0,0,1,0,0)),i.lineWidth=g,i.strokeStyle=U,i.stroke(),cf&&i.restore(),H&&Ao(i,U,e,g,a,P)}if(Zc(i,M),L(c,"dash")){var xe=L(c,"dashWidth")||g;if(xe>0){M=L(c,"dashPattern")||Yk;var f=vs(i,M,L(c,"dashOffset")),eh=v(c,"dashColor")||v(Jg);f!==i&&(X?oe(f,F,n,D):Pc(f,$,t,d,K,W,A)),i.strokeStyle=eh,i.lineWidth=xe,i.stroke(),L(c,"dash3d")&&Ao(i,eh,v(c,"dash3dColor"),xe,a,L(c,"dash3dAccuracy")),Zc(i,M)}}$===nn&&mj(i,Z,L(c,"depth"),t),i.lineJoin=zb,i.lineCap=Pl,q&&G()}},g=function(I,m){var l=w,n=z,O=w||L(I,sq),j=z||L(I,"blendMode"),G=qp(L(I,"name"),O,j);G&&(mg(i,G,L(I,"stretch"),m.x,m.y,m.width,m.height,_,s,O,null,j),w=l,z=n)},Z=function(y,E){var z=L(y,"text");z!=I&&zj(i,z,L(y,"font"),v(y,sq),E.x,E.y,E.width,E.height,L(y,"align"),L(y,"vAlign"))},j=function(Q,D){Wr(i,v(Q,sq),D.x,D.y,D.width,D.height,L(Q,"width"))},y=function(v,y){var Y=L(v,jd),r=0;if(Y&&(Y.forEach(function(b){r+=b}),r>0)){for(var x=L(v,"colors")||ke,t=L(v,"startAngle")||0,q=L(v,"hollow"),m=L(v,qm),S=L(v,Wo),s=L(v,Kp),k=m?new fb:I,h=y.x,j=y.y,X=y.width,Q=y.height,o=h+X/2,U=j+Q/2,D=N(X,Q)/2,K=0,u=0;u<Y.length;u++){var H=Y[u],Z=W*H/r,J=t+Z;if(i.fillStyle=x[K++],K===x.length&&(K=0),i.beginPath(),q){var R=o+O(t)*D/2,C=U+f(t)*D/2,M=o+O(J)*D,z=U+f(J)*D;i.moveTo(R,C),i.arc(o,U,D/2,t,J,!1),i.lineTo(M,z),i.arc(o,U,D,J,t,!0)}else i.moveTo(o,U),i.arc(o,U,D,J,t,!0);k&&(Z=(t+J)/2,k.add({text:gj(m)?m(H,u,r,_):H,x:o+.75*O(Z)*D,y:U+.75*f(Z)*D})),i.closePath(),i.fill(),t=J}k&&k.each(function(I){zj(i,I.text,S,s,I.x,I.y,0,0,Ai)})}},A=function(K,V){var d=L(K,hc);if(d&&d.length>0){var t=d.length,c=L(K,qm),m=L(K,Wo),s=L(K,Kp),p=c?new fb:I,H=L(K,"minValue")||0,x=L(K,"maxValue");if(x==I&&(x=0,d.forEach(function(y){L(y,jd).forEach(function(A){x=o(x,A)})})),H===x)return;for(var v=V.height/(x-H),j=V.y+x*v,r=L(d[0],jd).length,y=V.width/(3*r+1),Q=2*y/t,E=0,h=0;t>h;h++)for(var A=d[h],G=L(A,sq),u=L(A,"colors"),z=L(A,jd),X=0;r>X;X++){u?i.fillStyle=u[X]:G?i.fillStyle=G:(i.fillStyle=ke[E++],E===ke.length&&(E=0));var q=z[X],Y=q*v,e=V.x+(1+3*X)*y+h*Q;if(Yg(i,e,j-Y,Q,Y),p){var l=gj(c)?c(q,X,A,_):q,N=es(m,l).height;p.add({x:e,y:j-Y-N,width:Q,height:N,text:l})}}p&&p.each(function(O){zj(i,O.text,m,s,O.x,O.y,O.width,O.height,Ai)})}},x=function(j,X){var s=L(j,hc);if(s&&s.length>0){var P=s.length,u=L(s[0],jd).length,V=X.width/(3*u+1),M=0,b=L(j,"maxValue"),y=L(j,qm),c=L(j,Wo),Z=L(j,Kp),Y=y?new fb:I;if(b==I){b=0;for(var $=0;u>$;$++){for(var U=0,d=0;P>d;d++)U+=L(s[d],jd)[$];b=o(b,U)}}if(b>0){for(var $=0;u>$;$++)for(var D=X.y+X.height,d=0;P>d;d++){var q=s[d],h=L(q,sq),T=L(q,jd)[$],K=T/b*X.height;h?i.fillStyle=h:(i.fillStyle=ke[M++],M===ke.length&&(M=0)),D-=K;var R={x:X.x+(1+3*$)*V,y:D,width:2*V,height:K};Yg(i,R.x,R.y,R.width,R.height),Y&&(R.text=gj(y)?y(T,$,q,_):T,Y.add(R))}Y&&Y.each(function(y){zj(i,y.text,c,Z,y.x,y.y,y.width,y.height,Ai)})}}},c=function(y,x){var H=L(y,hc);if(H&&H.length>0){for(var A=H.length,f=L(H[0],jd).length,J=x.width/(3*f+1),m=0,E=L(y,qm),O=L(y,Wo),h=L(y,Kp),p=E?new fb:I,U=0;f>U;U++){for(var V=0,q=0;A>q;q++)V+=L(H[q],jd)[U];if(V>0){var u=x.y+x.height;for(q=0;A>q;q++){var Z=H[q],a=L(Z,sq),G=L(Z,jd)[U],S=G/V*x.height;a?i.fillStyle=a:(i.fillStyle=ke[m++],m===ke.length&&(m=0)),u-=S;var v={x:x.x+(1+3*U)*J,y:u,width:2*J,height:S};Yg(i,v.x,v.y,v.width,v.height),p&&(v.text=gj(E)?E(G,U,Z,_):G,p.add(v))}}}p&&p.each(function(T){zj(i,T.text,O,h,T.x,T.y,T.width,T.height,Ai)})}},F=function(q,m){var J=L(q,hc);if(J&&J.length>0){var R=J.length,j=L(q,"minValue")||0,G=L(q,"maxValue");if(G==I&&(G=0,J.forEach(function(t){L(t,jd).forEach(function(F){G=o(G,F)})})),j===G)return;for(var K=m.height/(G-j),t=m.y+G*K,y=L(J[0],jd).length,U=m.width/(3*y+1),l=0,Q=L(q,"lineWidth")||2,p=L(q,"line3d"),x=L(q,"linePoint"),V=L(q,qm),S=L(q,Wo),E=L(q,Kp),h=0;R>h;h++){var $=J[h],N=L($,sq),B=L($,jd);N?i.strokeStyle=N:(N=i.strokeStyle=ke[l++],l===ke.length&&(l=0)),i.beginPath();for(var w=0;y>w;w++){var D=m.x+(2+3*w)*U,F=t-B[w]*K;0===w?i.moveTo(D,F):i.lineTo(D,F)}if(i.lineWidth=Q,i.stroke(),p&&Ao(i,N,I,Q,a),x||V){var H,n=Q/2+2;for(w=0;y>w;w++){var k=B[w];if(D=m.x+(2+3*w)*U,F=t-k*K,gj(x)?x(i,D,F,N,w,$,_):x&&(i.fillStyle=N,i.beginPath(),i.arc(D,F,n,0,W,!0),i.fill()),gj(V)?H=V(k,w,$,_):V&&(H=k),H){var b=es(S,H).height,s=i.shadowBlur;if(s){var M=i.shadowOffsetX,A=i.shadowOffsetY,T=i.shadowColor;i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowColor=I}zj(i,H,S,E,D,F-b-n+2,0,b,Ai),s&&(i.shadowOffsetX=M,i.shadowOffsetY=A,i.shadowBlur=s,i.shadowColor=T)}}}}}},u=function(){i=null,_=null,s=null},M={border:j,image:g,text:Z,pieChart:y,columnChart:A,stackedColumnChart:x,percentageColumnChart:c,lineChart:F};return function(o,x,F,R,Y,k,Z,W,$,j){if(x&&Y&&k){var P=i?!1:!0;i=o,_=Z,s=W,a=s?s._zoom?s._zoom:1:1,w=$,z=j;var Q=Y,e=k;if(Sc()){var D,g,f;0===i[Sp]?Sc[0]&&(D=!0):D=!0,i.texureImage2D?Sc[1]&&(g=!0):g=!0,i.texureImage3D?Sc[2]&&(f=!0):f=!0,D&&g&&f&&(Q=F,e=R)}if(x.tagName)return _e(b)&&!U[b]||i.drawImage(x,Q,e,Y,k),P&&u(),void 0;if(L(x,"visible")===!1)return P&&u(),void 0;w||(w=oh(x.color,_,s)),j||(z=oh(x.blendMode,_,s)),_e(b)&&!U[b]&&(Y=Q,k=e);var t=uf(x,_,s,Y),p=Xd(x,_,s,k),y={x:0,y:0,width:t,height:p,fitSize:L(x,"fitSize")},E=L(x,"clip"),A=L(x,"opacity");if(y.fitSize&&(y.widthScale=t/oh(x.width,_,s),y.heightScale=p/oh(x.height,_,s)),i.save(),i.interactiveInfo){var X=i.interactiveInfo.matrix,B=X.clone();X.appendTranslate(Q,e).appendScale(Y/t,k/p)}Kh(i,Q,e),(t!==Y||p!==k)&&i.scale(Y/t,k/p),E&&(gj(E)?E(i,t,p,_,s,x):(i.beginPath(),i.rect(0,0,t,p),i.clip())),A!=I&&(i.globalAlpha*=A),L(x,"comps").forEach(function(K){if(L(K,Qn)!==!1){if(_h.splice(0,0,K),i.interactiveInfo)var B=i.interactiveInfo.matrix.clone();var o=L(K,"opacity"),P=L(K,"shadow"),c=L(K,"type"),Z=q(K,y);if(o!=I){var D=i.globalAlpha;i.globalAlpha*=o}if(P){var Y=i.shadowOffsetX,f=i.shadowOffsetY,Q=i.shadowBlur,X=i.shadowColor,n=L(K,"shadowOffsetX"),z=L(K,"shadowOffsetY"),R=L(K,"shadowBlur"),k=v(K,"shadowColor");i.shadowOffsetX=(n==I?3:n)*a,i.shadowOffsetY=(z==I?3:z)*a,i.shadowBlur=(R==I?6:R)*a,i.shadowColor=k||v(wi)}if("save"===c)i.save();else if("endClip"===c||"restore"===c)i.restore();else if("clip"===c)i.save(),oe(i,L(K,"points",l),L(K,"segments",r),!0),i.clip();else if(Cq[c])Z=Z||{x:0,y:0,width:y.width,height:y.height},J(K,c,Z,y);else if(c===Rc)J(K,c,Z,y);else if("SVGPath"===c)d(K,c,Z);else{Z=Z||{x:0,y:0,width:y.width,height:y.height};var E=L(K,_j),V=L(K,"scaleX"),$=L(K,"scaleY"),u=C(K),w=S(K,Z,Z,E,V,$,u);if(gj(c))T(K,c),h.drawCompType(c,i,Z,K,_,s);else if(h.getCompType(c)){var e=h.getCompType(c),b=e.func||e;T(K,e),h.drawCompType(b,i,Z,K,_,s)}else M[c]?M[c](K,Z):h.getCompType(c)===H&&up.test(c)&&ts(c);w&&G()}P&&(i.shadowOffsetX=Y,i.shadowOffsetY=f,i.shadowBlur=Q,i.shadowColor=X),o!=I&&(i.globalAlpha=D),i.interactiveInfo&&(i.interactiveInfo.matrix=B),_h.splice(0,1)}}),i.interactiveInfo&&(i.interactiveInfo.matrix=B),i.restore(),P&&u()}}}();h.getCurrentComp=function(){return _h[0]},h.getParentComp=function(){return _h[1]},h.getInternal=function(){return{isEnter:Rr,isEsc:Cj,isSpace:ib,isLeft:Od,isUp:Nl,isRight:Id,isDown:Ik,addMethod:Of,superCall:zp,toPointsArray:bf,translateAndScale:np,appendArray:Vc,createWorldMatrix:Dq,vec3TransformMat4:Ph,setCanvas:op,createDiv:cf,createView:Di,createCanvas:Ue,createImage:go,initContext:Pg,layout:Hr,fillRect:Yg,Mat:ug,drawBorder:Wr,isString:_e,setBorder:zm,getPropertyValue:nd,setPropertyValue:jk,drawVerticalLine:Zb,draw3DRect:mj,getPinchDist:rb,isSameRect:ol,getPosition:Xp,intersectionLineRect:$b,getNodeRect:Rp,getEdgeAgentPosition:Sh,getImageWidth:uf,getImageHeight:Xd,initItemElement:Bp,drawPoints:oe,createG2:vs,closePopup:$n,isH:pg,createAnim:fq,createNormalMatrix:Ob,createNormals:Ug,toFloatArray:gf,glMV:ir,batchShape:Gp,createNodeMatrix:gq,getFaceInfo:fj,transformAppend:dk,drawFaceInfo:No,to3dPointsArray:Oh,setGLDebugMode:function(T){Ki=T},cube:function(){return{vs:nr,is:mq,uv:qi}},ui:function(){return{DataUI:Vb,NodeUI:ae,EdgeUI:_c,GroupUI:ao,ShapeUI:ym,GridUI:Bn,Data3dUI:ri,Node3dUI:Vo,Shape3dUI:ai}},getInternalVersion:function(){return"U2FsdGVkX1+o1x76BrJkzqHdH5GxR2kF3HfEdmQAbNA="},getDragger:function(){return Rm},addMSMap:function(d){Of(Tm,d)},k:x}},function(v){function E(y,D){y!=I&&(D==I&&Gr!=typeof y?this._54O(y,256):this._54O(y,D))}function r(){return new E(I)}function J(Y,L,W,H,A,q){for(;--q>=0;){var j=L*this[Y++]+W[H]+A;A=$(j/67108864),W[H++]=67108863&j}return A}function w(e,D,q,o,l,b){for(var Q=32767&D,T=D>>15;--b>=0;){var t=32767&this[e],O=this[e++]>>15,S=T*t+O*Q;t=Q*t+((32767&S)<<15)+q[o]+(1073741823&l),l=(t>>>30)+(S>>>15)+T*O+(l>>>30),q[o++]=1073741823&t}return l}function C(U,Y,S,r,d,C){for(var X=16383&Y,$=Y>>14;--C>=0;){var N=16383&this[U],G=this[U++]>>14,t=$*N+G*X;N=X*N+((16383&t)<<14)+S[r]+d,d=(N>>28)+(t>>14)+$*G,S[r++]=268435455&N}return d}function R(t){return Od.charAt(t)}function F(R,B){var L=jq[R.charCodeAt(B)];return L==I?-1:L}function g(b){for(var g=this.t-1;g>=0;--g)b[g]=this[g];b.t=this.t,b.s=this.s}function S(Q){this.t=1,this.s=0>Q?-1:0,Q>0?this[0]=Q:-1>Q?this[0]=Q+this.DV:this.t=0}function Q(C){var u=r();return u._58O(C),u}function A(b,d){var p,u=this;if(16==d)p=4;else if(8==d)p=3;else if(256==d)p=8;else if(2==d)p=1;else if(32==d)p=5;else{if(4!=d)return u.fromRadix(b,d),void 0;p=2}u.t=0,u.s=0;for(var O=b.length,n=!1,h=0;--O>=0;){var V=8==p?255&b[O]:F(b,O);0>V?"-"==b.charAt(O)&&(n=!0):(n=!1,0==h?u[u.t++]=V:h+p>u.DB?(u[u.t-1]|=(V&(1<<u.DB-h)-1)<<h,u[u.t++]=V>>u.DB-h):u[u.t-1]|=V<<h,h+=p,h>=u.DB&&(h-=u.DB))}8==p&&0!=(128&b[0])&&(u.s=-1,h>0&&(u[u.t-1]|=(1<<u.DB-h)-1<<h)),u._57O(),n&&E.ZERO._78O(u,u)}function m(){for(var b=this,s=b.s&b.DM;b.t>0&&b[b.t-1]==s;)--b.t}function y(w){var p=this;if(p.s<0)return"-"+p._85O()[qb](w);var J;if(16==w)J=4;else if(8==w)J=3;else if(2==w)J=1;else if(32==w)J=5;else{if(4!=w)return p.toRadix(w);J=2}var F,r=(1<<J)-1,Q=!1,f="",b=p.t,i=p.DB-b*p.DB%J;if(b-->0)for(i<p.DB&&(F=p[b]>>i)>0&&(Q=!0,f=R(F));b>=0;)J>i?(F=(p[b]&(1<<i)-1)<<J-i,F|=p[--b]>>(i+=p.DB-J)):(F=p[b]>>(i-=J)&r,0>=i&&(i+=p.DB,--b)),F>0&&(Q=!0),Q&&(f+=R(F));return Q?f:"0"}function h(){var s=r();return E.ZERO._78O(this,s),s}function i(){return this.s<0?this._85O():this}function K(t){var A=this,G=A.s-t.s;if(0!=G)return G;var o=A.t;if(G=o-t.t,0!=G)return A.s<0?-G:G;for(;--o>=0;)if(0!=(G=A[o]-t[o]))return G;return 0}function n(E){var z,_=1;return 0!=(z=E>>>16)&&(E=z,_+=16),0!=(z=E>>8)&&(E=z,_+=8),0!=(z=E>>4)&&(E=z,_+=4),0!=(z=E>>2)&&(E=z,_+=2),0!=(z=E>>1)&&(E=z,_+=1),_}function H(){var R=this;return R.t<=0?0:R.DB*(R.t-1)+n(R[R.t-1]^R.s&R.DM)}function M(l,L){var K;for(K=this.t-1;K>=0;--K)L[K+l]=this[K];for(K=l-1;K>=0;--K)L[K]=0;L.t=this.t+l,L.s=this.s}function X(Y,T){for(var e=Y;e<this.t;++e)T[e-Y]=this[e];T.t=o(this.t-Y,0),T.s=this.s}function z(T,n){var p,L=this,k=T%L.DB,U=L.DB-k,Q=(1<<U)-1,w=$(T/L.DB),l=L.s<<k&L.DM;for(p=L.t-1;p>=0;--p)n[p+w+1]=L[p]>>U|l,l=(L[p]&Q)<<k;for(p=w-1;p>=0;--p)n[p]=0;n[w]=l,n.t=L.t+w+1,n.s=L.s,n._57O()}function U(Q,N){var e=this;N.s=e.s;var p=$(Q/e.DB);if(p>=e.t)return N.t=0,void 0;var H=Q%e.DB,r=e.DB-H,X=(1<<H)-1;N[0]=e[p]>>H;for(var f=p+1;f<e.t;++f)N[f-p-1]|=(e[f]&X)<<r,N[f-p]=e[f]>>H;H>0&&(N[e.t-p-1]|=(e.s&X)<<r),N.t=e.t-p,N._57O()}function Y(t,Y){for(var E=this,g=0,$=0,c=N(t.t,E.t);c>g;)$+=E[g]-t[g],Y[g++]=$&E.DM,$>>=E.DB;if(t.t<E.t){for($-=t.s;g<E.t;)$+=E[g],Y[g++]=$&E.DM,$>>=E.DB;$+=E.s}else{for($+=E.s;g<t.t;)$-=t[g],Y[g++]=$&E.DM,$>>=E.DB;
$-=t.s}Y.s=0>$?-1:0,-1>$?Y[g++]=E.DV+$:$>0&&(Y[g++]=$),Y.t=g,Y._57O()}function V(n,Y){var K=this.abs(),X=n.abs(),u=K.t;for(Y.t=u+X.t;--u>=0;)Y[u]=0;for(u=0;u<X.t;++u)Y[u+K.t]=K.am(0,X[u],Y,u,0,K.t);Y.s=0,Y._57O(),this.s!=n.s&&E.ZERO._78O(Y,Y)}function P(S){for(var $=this.abs(),P=S.t=2*$.t;--P>=0;)S[P]=0;for(P=0;P<$.t-1;++P){var Q=$.am(P,$[P],S,2*P,0,1);(S[P+$.t]+=$.am(P+1,2*$[P],S,2*P+1,Q,$.t-P-1))>=$.DV&&(S[P+$.t]-=$.DV,S[P+$.t+1]=1)}S.t>0&&(S[S.t-1]+=$.am(P,$[P],S,2*P,0,1)),S.s=0,S._57O()}function Z(h,C,Z){var A=h.abs(),Y=this;if(!(A.t<=0)){var g=Y.abs();if(g.t<A.t)return C!=I&&C._58O(0),Z!=I&&Y._77O(Z),void 0;Z==I&&(Z=r());var U=r(),v=Y.s,q=h.s,V=Y.DB-n(A[A.t-1]);V>0?(A._44O(V,U),g._44O(V,Z)):(A._77O(U),g._77O(Z));var D=U.t,N=U[D-1];if(0!=N){var e=N*(1<<Y.F1)+(D>1?U[D-2]>>Y.F2:0),b=Y.FV/e,f=(1<<Y.F1)/e,X=1<<Y.F2,J=Z.t,_=J-D,l=C==I?r():C;for(U._59O(_,l),Z._52O(l)>=0&&(Z[Z.t++]=1,Z._78O(l,Z)),E.ONE._59O(D,l),l._78O(U,U);U.t<D;)U[U.t++]=0;for(;--_>=0;){var S=Z[--J]==N?Y.DM:$(Z[J]*b+(Z[J-1]+X)*f);if((Z[J]+=U.am(0,S,Z,_,0,D))<S)for(U._59O(_,l),Z._78O(l,Z);Z[J]<--S;)Z._78O(l,Z)}C!=I&&(Z._45O(D,C),v!=q&&E.ZERO._78O(C,C)),Z.t=D,Z._57O(),V>0&&Z._46O(V,Z),0>v&&E.ZERO._78O(Z,Z)}}}function k(U){var g=r();return this.abs()._49O(U,I,g),this.s<0&&g._52O(E.ZERO)>0&&U._78O(g,g),g}function b(Y){this.m=Y}function D(R){return R.s<0||R._52O(this.m)>=0?R.mod(this.m):R}function q(V){return V}function u(Y){Y._49O(this.m,I,Y)}function j(k,r,j){k._47O(r,j),this._74O(j)}function L(q,P){q._48O(P),this._74O(P)}function B(){if(this.t<1)return 0;var o=this[0];if(0==(1&o))return 0;var E=3&o;return E=15&E*(2-(15&o)*E),E=255&E*(2-(255&o)*E),E=65535&E*(2-(65535&(65535&o)*E)),E=E*(2-o*E%this.DV)%this.DV,E>0?this.DV-E:-E}function _(u){var F=this;F.m=u,F.mp=u._50O(),F.mpl=32767&F.mp,F.mph=F.mp>>15,F.um=(1<<u.DB-15)-1,F.mt2=2*u.t}function a(H){var F=r();return H.abs()._59O(this.m.t,F),F._49O(this.m,I,F),H.s<0&&F._52O(E.ZERO)>0&&this.m._78O(F,F),F}function e(P){var T=r();return P._77O(T),this._74O(T),T}function T(g){for(var E=this;g.t<=E.mt2;)g[g.t++]=0;for(var A=0;A<E.m.t;++A){var $=32767&g[A],H=$*E.mpl+(($*E.mph+(g[A]>>15)*E.mpl&E.um)<<15)&g.DM;for($=A+E.m.t,g[$]+=E.m.am(0,H,g,A,0,E.m.t);g[$]>=g.DV;)g[$]-=g.DV,g[++$]++}g._57O(),g._45O(E.m.t,g),g._52O(E.m)>=0&&g._78O(E.m,g)}function nk(s,h){s._48O(h),this._74O(h)}function iq(t,L,o){t._47O(L,o),this._74O(o)}function pf(){return 0==(this.t>0?1&this[0]:this.s)}function ql(B,G){if(B>4294967295||1>B)return E.ONE;var e=r(),O=r(),w=G._73O(this),S=n(B)-1;for(w._77O(e);--S>=0;)if(G._76O(e,O),(B&1<<S)>0)G._75O(O,w,e);else{var T=e;e=O,O=T}return G.revert(e)}function kn(I,Z){var $;return $=256>I||Z._51O()?new b(Z):new _(Z),this.exp(I,$)}function Mo(){var S=this;if(S.s<0){if(1==S.t)return S[0]-S.DV;if(0==S.t)return-1}else{if(1==S.t)return S[0];if(0==S.t)return 0}return(S[1]&(1<<32-S.DB)-1)<<S.DB|S[0]}function Nd(R,i){return new E(R,i)}function nj(){var _=this;_.n=I,_.e=0,_.d=I,_.p=I,_.q=I,_.dmp1=I,_.dmq1=I,_._10A=I}function Bi(F){return F._53O(this.e,this.n)}function pg(h){var g,x,F,n="",t=0;for(g=0;g<h.length&&h.charAt(g)!=um;++g)F=dn.indexOf(h.charAt(g)),0>F||(0==t?(n+=R(F>>2),x=3&F,t=1):1==t?(n+=R(x<<2|F>>4),x=15&F,t=2):2==t?(n+=R(x),n+=R(F>>2),x=3&F,t=3):(n+=R(x<<2|F>>4),n+=R(15&F),t=0));return 1==t&&(n+=R(x<<2)),n}function Kn(y){var v=y.split(""),z=pg(y);return v.forEach(function(D){var d=D.length;d>0&&z&&(Sn+=G(D))}),z}function Jr(b,X){var p=cg._4O.Util._56O(b,"ss"),K={},D=0;return K.v=p==X,K.t=1,K.s=0>D?-1:0,Zr=K.v,D>0?K[0]=D:-1>D?K[0]=D+K.DV:K.t=0,[p,K]}function Bc(c){var k=38,Q=c.substring(0,k);if(Q&&30==Q.indexOf("05000420")){var a=["ss",c.substring(k)];return a}return[]}function xq(a,R){R=R.replace(Rc,""),R=R.replace(/[ \n]+/g,"");var t=Nd(R,16);if(t._55O()>this.n._55O())return 0;var H=this._37O(t),S=H[qb](16).replace(/^1f+00/,""),w=Bc(S);if(0==w.length)return!1;for(var T,K,I,j=.5,s=Qj,U=[0,.5,.75,.875,.9375],Z=[],V=[],m=[],d=W/s,i=w[1],n=Jr(a,i)[0],L=0,h=0;L<U.length;L++){var E=0===L%2?0:.5;for(T=0;s>=T;T++)K=(T+E)*d,I=1-U[L],Z.push(O(K)*j*I,-j+2*U[L]*j,-f(K)*j*I),V.push((T+E)/s,I)}for(L=0;L<U.length-1;L++){var X=L*(s+1),r=(L+1)*(s+1);for(T=0;s>T;T++)m.push(X+T,r+T+1,r+T,X+T,X+T+1,r+T+1)}return m.forEach(function(t){h+=t}),i==n&&h>10}var bs,Vj=0xdeadbeefcafe,aq=15715070==(16777215&Vj),qb="toString",Th="",Qh="nat",Wb=function(){};s=v["D"+11182[qb](d(2,5))];var Ho=E.prototype;fg+=Tj.substr(0,1);var Hg=v.navigator?v.navigator.appName:"";aq&&"Microsoft Internet Explorer"==Hg?(Ho.am=w,bs=30):aq&&"Netscape"!=Hg?(Ho.am=J,bs=26):(Ho.am=C,bs=28),Ho.DB=bs,Ho.DM=(1<<bs)-1,Ho.DV=1<<bs;var bf=52;Ho.FV=d(2,bf),Ho.F1=bf-bs,Ho.F2=2*bs-bf;var sp,tp,Od="0123456789abcdefghijklmnopqrstuvwxyz",jq=[],Jq=function(U){return String.fromCharCode(U)};for(sp="0".charCodeAt(0),tp=0;9>=tp;++tp)jq[sp++]=tp;for(sp="a".charCodeAt(0),tp=10;36>tp;++tp)jq[sp++]=tp;for(sp="A".charCodeAt(0),tp=10;36>tp;++tp)jq[sp++]=tp;var oi=b.prototype;oi._73O=D,oi.revert=q,oi._74O=u,oi._75O=j,oi._76O=L;var Fo=_.prototype;Fo._73O=a,Fo.revert=e,Fo._74O=T,Fo._75O=iq,Fo._76O=nk,Ho._77O=g,Ho._58O=S,Ho._54O=A,Ho._57O=m,Ho._59O=M,Ho._45O=X,Ho._44O=z,Ho._46O=U,Ho._78O=Y,Ho._47O=V,Ho._48O=P,Ho._49O=Z,Ho._50O=B,Ho._51O=pf,Ho.exp=ql,Ho.toString=y,Ho._85O=h,Ho.abs=i,Ho._52O=K,Ho._55O=H,Ho.mod=k,Ho._53O=kn,E.ZERO=Q(0),E.ONE=Q(1),Ho._86O=Mo;var Ur=function(x,N){var E=this;E.isPublic=!0,typeof x!==Gr?(E.n=x,E.e=N):x!=I&&N!=I&&x.length>0&&N.length>0&&(E.n=Nd(x,16),E.e=G(N,16))};Ie=function(){var Q,w,U=Kn(eb),v=U.substr(0,4),j=U.substr(4,2),n=U.substr(6,2),d=1,A=!d,B=x,q=[],z=Kl.charAt(7);if(s&&(s[qb]().indexOf(Qh)<0||s[fg][qb]().indexOf(Qh)<0||!U?Q=ho(lb[z]):(U=new s(v-0,j-d,n-0),w=U.setHours(9),s[fg]()>w?Q=ho(lb[z]):A=!0)),U&&Q&&B){for(var N in Q)q.push(N);var g,L=0,m=Q[q[L++]],X=Q[q[L++]],t=Q[q[L++]],$=Q[q[L++]],_=Q[q[L++]],f=Q[q[L++]],i=Q[q[L++]],o=Bd._27O(B);if(o&&i){g=m+X+t+$+_+f;var u=!f||f===Se;if(!u&&f)for(var G,l=0,J=f.length;J>l;l++)f[l]===Dr[L]?G===Se?u=!0:G=I:(G==I?G=f[l]:G+=f[l],l===J-1&&G===Se&&(u=!0));g&&o._31O(g,i)&&u&&(!_||s[fg]()<_)&&(A=!0)}}return A||(Pc=il),z};var Fe=nj.prototype;Fe._37O=Bi,Fe._38O=Ur;var dn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",um="=",oj=25,Hb=10,eb="IBgSKA==",ee=ee||function(J,R){var H={},p=H._7A={},Q=p._6A=function(){function z(){}return{_80O:function(l){z.prototype=this;var k=new z;return l&&k._5A(l),k.hasOwnProperty("_82O")||(k._82O=function(){k.$super._82O.apply(this,arguments)}),k._82O.prototype=k,k.$super=this,k},_3A:function(){var j=this._80O();return j._82O.apply(j,arguments),j},_82O:function(){},_5A:function(B){for(var i in B)B.hasOwnProperty(i)&&(this[i]=B[i]);B.hasOwnProperty(qb)&&(this.toString=B.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),r=p._39O=Q._80O({_82O:function(u,L){u=this._84O=u||[],this._65O=L!=R?L:4*u.length},toString:function(G){return(G||x).stringify(this)},_89O:function(k){var p=this._84O,y=k._84O,U=this._65O,I=k._65O;if(this._57O(),U%4)for(var J=0;I>J;J++){var X=255&y[J>>>2]>>>24-8*(J%4);p[U+J>>>2]|=X<<24-8*((U+J)%4)}else if(y.length>65535)for(var J=0;I>J;J+=4)p[U+J>>>2]=y[J>>>2];else p.push.apply(p,y);return this._65O+=I,this},_57O:function(){var R=this._84O,m=this._65O;R[m>>>2]&=4294967295<<32-8*(m%4),R.length=c(m/4)},_88O:function(){var K=Q._88O.call(this);return K._84O=this._84O.slice(0),K},_87O:function(T){for(var v=[],W=0;T>W;W+=4)v.push(0|4294967296*l);return new r._82O(v,T)}}),L=H._2A={},x=L._69O={stringify:function(H){var Z,X=H._84O,n=H._65O,K=[];for(Z=0;n>Z;Z++){var r=255&X[Z>>>2]>>>24-8*(Z%4);K.push((r>>>4).toString(16)),K.push((15&r).toString(16))}return K.join("")},_68O:function(W){for(var L=W.length,h=[],g=0;L>g;g+=2)h[g>>>3]|=G(W.substr(g,2),16)<<24-4*(g%8);return new r._82O(h,L/2)}},q=L._8A={stringify:function(V){var M,p=V._84O,w=V._65O,u=[];for(M=0;w>M;M++){var L=255&p[M>>>2]>>>24-8*(M%4);u.push(Jq(L))}return u.join("")},_68O:function(s){var Z,p=s.length,I=[];for(Z=0;p>Z;Z++)I[Z>>>2]|=(255&s.charCodeAt(Z))<<24-8*(Z%4);return new r._82O(I,p)}},s=L._9A={stringify:function(x){try{return decodeURIComponent(escape(q.stringify(x)))}catch(p){throw new Error("")}},_68O:function(u){return q._68O(unescape(encodeURIComponent(u)))}},n=p._32O=Q._80O({_1A:function(){this._83O=new r._82O,this._23O=0},_33O:function(l){typeof l==Gr&&(l=s._68O(l)),this._83O._89O(l),this._23O+=l._65O},_25O:function(T){var _=this._83O,e=_._84O,i=_._65O,v=this._79O,Y=4*v,s=i/Y;s=T?c(s):o((0|s)-this._22O,0);var O=s*v,q=N(4*O,i);if(O){for(var F=0;O>F;F+=v)this._20O(e,F);var p=e.splice(0,O);_._65O-=q}return new r._82O(p,q)},_88O:function(){var U=Q._88O.call(this);return U._83O=this._83O._88O(),U},_22O:0});p._66O=n._80O({cfg:Q._80O(),_82O:function(u){this.cfg=this.cfg._80O(u),this._1A()},_1A:function(){n._1A.call(this),this._34O()},_81O:function(x){return this._33O(x),this._25O(),this},_72O:function(A){A&&this._33O(A);var j=this._21O();return j},_79O:16,_26O:function(j){return function(h,D){return new j._82O(D)._72O(h)}},_19O:function(P){return function(H,K){return new T._71O._82O(P,K)._72O(H)}}});var T=H._67O={};return H}();!function(){var x=ee,F=x._7A,H=F._39O,j=F._66O,t=x._67O,X=[],K=[];!function(){function _(m){for(var z=p(m),x=2;z>=x;x++)if(!(m%x))return!1;return!0}function q(i){return 0|4294967296*(i-(0|i))}for(var Y=2,G=0;64>G;)_(Y)&&(8>G&&(X[G]=q(d(Y,.5))),K[G]=q(d(Y,1/3)),G++),Y++}();var n=[],g=t._41O=j._80O({_34O:function(){this._64O=new H._82O(X.slice(0))},_20O:function(w,y){for(var e=this._64O._84O,v=e[0],$=e[1],m=e[2],M=e[3],x=e[4],z=e[5],i=e[6],Y=e[7],_=0;64>_;_++){if(16>_)n[_]=0|w[y+_];else{var h=n[_-15],L=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,s=n[_-2],j=(s<<15|s>>>17)^(s<<13|s>>>19)^s>>>10;n[_]=L+n[_-7]+j+n[_-16]}var X=x&z^~x&i,t=v&$^v&m^$&m,I=(v<<30|v>>>2)^(v<<19|v>>>13)^(v<<10|v>>>22),d=(x<<26|x>>>6)^(x<<21|x>>>11)^(x<<7|x>>>25),k=Y+d+X+K[_]+n[_],u=I+t;Y=i,i=z,z=x,x=0|M+k,M=m,m=$,$=v,v=0|k+u}e[0]=0|e[0]+v,e[1]=0|e[1]+$,e[2]=0|e[2]+m,e[3]=0|e[3]+M,e[4]=0|e[4]+x,e[5]=0|e[5]+z,e[6]=0|e[6]+i,e[7]=0|e[7]+Y},_21O:function(){var b=this._83O,u=b._84O,Z=8*this._23O,m=8*b._65O;return u[m>>>5]|=128<<24-m%32,u[(m+64>>>9<<4)+14]=$(Z/4294967296),u[(m+64>>>9<<4)+15]=Z,b._65O=4*u.length,this._25O(),this._64O},_88O:function(){var v=j._88O.call(this);return v._64O=this._64O._88O(),v}});x._41O=j._26O(g),x._42O=j._19O(g)}();var Rc=new RegExp("");Rc.compile("[^0-9a-f]","gi"),nj._28O=-1,nj._29O=-2,Fe._31O=xq,Fe._63O=xq,nj._43O=-2;var Oi=new function(){var i=this;i._5O=function(L,E){if("8"!=L.substring(E+2,E+3))return 1;var j=G(L.substring(E+3,E+4));return 0==j?-1:j>0&&10>j?j+1:-2},i._13O=function(f,B){var I=i._5O(f,B);return 1>I?"":f.substring(B+2,B+2+2*I)},i._12O=function(D,x){var p=i._13O(D,x);if(""==p)return-1;var $;return $=G(p.substring(0,1))<8?new E(p,16):new E(p.substring(2),16),$._86O()},i._6O=function(o,v){var H=i._5O(o,v);return 0>H?H:v+2*(H+1)},i._11O=function(r,G){var y=i._6O(r,G),m=i._12O(r,G);return r.substring(y,y+2*m)},i._10O=function(I,L){var F=i._6O(I,L),w=i._12O(I,L);return F+2*w},i._7O=function(Z,r){var N=[],H=i._6O(Z,r);N.push(H);for(var L=i._12O(Z,r),q=H,X=0;;){var y=i._10O(Z,q);if(y==I||y-H>=2*L)break;if(X>=200)break;N.push(y),q=y,X++}return N}};if(Oi._90O=Jq(Hb+24),Oi._91O=t+Jq(Hb*Hb+8),cg==I||!cg)var cg={};cg._4O!=I&&cg._4O||(cg._4O={});var Tk=cg._4O;cg._4O.Util=new function(){var $=this;$._56O=function(F){var D=new cg._4O._3O;return D._30O(F)},$._4A=function(w){var z=new cg._4O._3O;return z._36O(w)},$._11A=function(W){var D=new Tk._3O;return D._30O(W)}},cg._4O._3O=function(){var t=this;t._8O=function(P,K){if("ss"==P&&"cj"==K){try{t.md=ee._67O._41O._3A()}catch(A){Wb(Th)}t._24O=function(C){t.md._81O(C)},t._35O=function(w){var Q=ee._2A._69O._68O(w);t.md._81O(Q)},t._60O=function(){var M=t.md._72O();return M[qb](ee._2A._69O)},t._30O=function(N){return t._24O(N),t._60O()},t._36O=function(k){return t._35O(k),t._60O()}}},t._24O=function(){Wb(Th)},t._35O=function(){Wb(Th)},t._60O=function(){Wb(Th)},t._30O=function(){Wb(Th)},t._36O=function(){Wb(Th)},t._8O("ss","cj")},xm=function(T){var A=Xo[Zh[7]],e=1,f=!1;if(Ym.a!=Xo[Bo])return Ym.a;if(Ym.forEach(function(t){e*=t}),T>e){if(A){A=A.split(Oi._90O);var g=A[3],W=A[7],h=A[11],S=A[15],d=A[19],i=A[23],o=A[27],s=g+W+h+S+d+i,U=i?!1:!0;if(i){var k=i&&i.split(Kc("firefox")[3]);if(k)for(var F=0;F<k.length;F++)if(ei.indexOf(k[F])>=0){U=!0;break}}f=Td()(s,o)&&U&&(!d||d>T)}f||(Vb.prototype._42=Vr)}else f=!0;return Ym.a=f,f},oj=String.fromCharCode(oj+20);var qr=function(Y){return Y=Y.replace(Rc,Th),Y=Y.replace(/[ \n]+/g,Th)},kp="30",Xl="06",Jn="02",nd="03",$b=Nd,el=/^1f+00/,Bd=function(){var C;return C={_18O:function(t){var k=t,$=k.replace(/\s+/g,""),A=pg($);return A},_14O:function(r){var g=this._18O(r),y=this._15O(g);return y},_15O:function(h){var Y=this._17O(h);if("2a864886f70d010101"==Y._61O){var t=this._16O(Y.key),r=new nj;return r._38O(t.n,t.e),r}Wb(Th)},_16O:function(J){var w={};J.substr(0,2)!=kp&&Wb(Th);var $=Oi._7O(J,0);return 2!=$.length&&Wb(Th),J.substr($[0],2)!=Jn&&Wb(Th),w.n=Oi._11O(J,$[0]),J.substr($[1],2)!=Jn&&Wb(Th),w.e=Oi._11O(J,$[1]),w},_17O:function(w){var u={};u._40O=I;var U=Oi._7O(w,0);2!=U.length&&Wb(Th);var y=U[0];w.substr(y,2)!=kp&&Wb(Th);var Z=Oi._7O(w,y);return 2!=Z.length&&Wb(Th),w.substr(Z[0],2)!=Xl&&Wb(Th),u._61O=Oi._11O(w,Z[0]),w.substr(Z[1],2)==Xl?u._40O=Oi._11O(w,Z[1]):w.substr(Z[1],2)==kp&&(u._40O={},u._40O.p=Oi._70O(w,Z[1],[0],Jn),u._40O.q=Oi._70O(w,Z[1],[1],Jn),u._40O.g=Oi._70O(w,Z[1],[2],Jn)),w.substr(U[1],2)!=nd&&Wb(Th),u.key=Oi._11O(w,U[1]).substr(2),u}},C._17O?C:I}(),wq=Bd._27O=function(W){return Bd._14O(W)};Td=function(){return function(c,E){if(c&&E){E=qr(E);var B=$b(E,d(2,4)),T=this;if(!T||!T.n||B._55O()>T.n._55O())return 0;var Z=T._37O(B),L=Z[qb](d(2,4)).replace(el,""),z=Bc(L);if(0==z.length)return!1;var $=z[0],P=z[1],Y=function(n){return cg._4O.Util._56O(n,$)},i=Y(c);return P==i}}.bind(wq(x))};var jd,Kq;return function(){var J=on.length-Sl.length;if(J>0)for(var B=0;J>B;B++)jd=Tk.Util,Kq=qr}(),rf=function(O,s){s=Kq(s);var E=wq(Mc),P=pj.length,Y=2*P,X=$b(s,d(P,Y)),F=E,y=!0;if(F){var b=F[ls[0]];b&&X._55O()<=b._55O()&&(y=!1)}if(y)return 0;var Z=F._37O(X),p=Z[qb](d(P,Y)).replace(el,""),e=Bc(p);if(0==e.length)return!1;var Q=e[0],x=e[1],I=jd._11A(O,Q);return x==I},Bd}(U,C),Of(h,{load:function(){var B={},w=function(x){return x?"c_"+(x.sync?"1":"0")+"_"+(x.post?"1":"0")+"_"+(x.responseType||"H")+"_"+(x.mimeType||"H")+"_"+(x.data?JSON.stringify(x.data):"H"):""};return function(R,I,$){var N,S=B[R],y=w($);return S&&(N=S[y])?(N.push(I),void 0):(B[R]||(S=B[R]={count:0}),N=S[y]=[I],S.count++,h.xhrLoad(R,function(b){delete S[y],S.count--,S.count||delete B[R],N.forEach(function(K){K(b)})},$),void 0)}}(),asyncEach:function(u,F,c){"function"!=typeof c&&(c=Function.prototype);var P=new Array(u.length),O=0,w=!1;u.forEach(function(v,R){F(v,function(e,m){return w?void 0:e?(w=!0,c(null)):(P[R]=m,O++,O===u.length?c(P):void 0)})})},xhrLoad:function(u,E,g){var x=!1;Ck(u)||(x=!0,u=[u]),g=g||{},u.length;var M=g.sync,o=!!g.post,U=null;return h.asyncEach(u,function(Y,v){var a=new Ml;Y=h.beforeLoadURL(Y),Y.data?v(null,Y.data):(g.url=encodeURI(Y),g.method=o?"POST":"GET",g.responseType?a.setResponseType(g.responseType):a.setOverrideMimeType(g.mimeType||"text/plain"),a.onload=function(){200===this.status||0===this.status?v(null,a.getResponseText()):v(!0)},a.onerror=function(){v(!0)},a.send(g))},function(p){var Z="function"==typeof E;(Z||M)&&(U=x&&p?p[0]:p,Z&&E(U))}),M?U:void 0}}),Math.sign===H&&(Math.sign=function(p){return 0>p?-1:p>0?1:+p}),j.Math={generateUUID:function(){for(var h=[],k=0;256>k;k++)h[k]=(16>k?"0":"")+k.toString(16).toUpperCase();return function(){var j=0|4294967295*Math.random(),e=0|4294967295*Math.random(),S=0|4294967295*Math.random(),L=0|4294967295*Math.random();return h[255&j]+h[255&j>>8]+h[255&j>>16]+h[255&j>>24]+"-"+h[255&e]+h[255&e>>8]+"-"+h[64|15&e>>16]+h[255&e>>24]+"-"+h[128|63&S]+h[255&S>>8]+"-"+h[255&S>>16]+h[255&S>>24]+h[255&L]+h[255&L>>8]+h[255&L>>16]+h[255&L>>24]}}(),clamp:function(O,Z,R){return Math.max(Z,Math.min(R,O))},generateIncreasingID:function(){var C=0;return function(){return++C}}()};var ng=j.Matrix=j.Math.Matrix2d=function(e,m,k,B,V){var z=this;if(e===H)return z.a=1,z.b=0,z.c=0,z.d=1,z.tx=0,z.ty=0,void 0;e=e||0;var G=f(e),Y=O(e);B=B||1,V=V||1,z.a=Y*B,z.b=G*B,z.c=-G*V,z.d=Y*V,z.tx=m||0,z.ty=k||0},ug=ng;ng.prototype={},ng.prototype.constructor=ng,ng.prototype.set=function(G,j,z,Q,Y,w){return this.a=G,this.b=j,this.c=z,this.d=Q,this.tx=Y,this.ty=w,this},ng.prototype.apply=function(H,P){P=P||new Mj;var p=H.x,k=H.y;return P.x=this.a*p+this.c*k+this.tx,P.y=this.b*p+this.d*k+this.ty,P},ng.prototype.applyInverse=function(w,H){H=H||new Mj;var v=1/(this.a*this.d+this.c*-this.b),b=w.x,_=w.y;return H.x=this.d*v*b+-this.c*v*_+(this.ty*this.c-this.tx*this.d)*v,H.y=this.a*v*_+-this.b*v*b+(-this.ty*this.a+this.tx*this.b)*v,H},ng.prototype.translate=function(V,z){return this.tx+=V,this.ty+=z,this},ng.prototype.scale=function(v,I){return this.a*=v,this.d*=I,this.c*=v,this.b*=I,this.tx*=v,this.ty*=I,this},ng.prototype.rotate=function(R){var C=Math.cos(R),F=Math.sin(R),t=this.a,U=this.c,N=this.tx;return this.a=t*C-this.b*F,this.b=t*F+this.b*C,this.c=U*C-this.d*F,this.d=U*F+this.d*C,this.tx=N*C-this.ty*F,this.ty=N*F+this.ty*C,this},ng.prototype.appendTranslate=function(C,Y){return this.tx+=this.a*C+this.c*Y,this.ty+=this.b*C+this.d*Y,this},ng.prototype.appendScale=function(N,U){return this.a*=N,this.d*=U,this.c*=U,this.b*=N,this},ng.prototype.appendRotate=function(n){if(!n)return this;var l=Math.cos(n),u=Math.sin(n),B=this.a,J=this.b;return this.a=B*l+this.c*u,this.b=J*l+this.d*u,this.c=-B*u+this.c*l,this.d=-J*u+this.d*l,this},ng.prototype.append=function(J){var y=this.a,x=this.b,Y=this.c,B=this.d;return this.a=J.a*y+J.b*Y,this.b=J.a*x+J.b*B,this.c=J.c*y+J.d*Y,this.d=J.c*x+J.d*B,this.tx=J.tx*y+J.ty*Y+this.tx,this.ty=J.tx*x+J.ty*B+this.ty,this},ng.prototype.setTransform=function(q,O,G,F,b,j,T,d,w){var M,t,B,h,o,U,X,Z,K,Y;return o=Math.sin(T),U=Math.cos(T),X=Math.cos(w),Z=Math.sin(w),K=-Math.sin(d),Y=Math.cos(d),M=U*b,t=o*b,B=-o*j,h=U*j,this.a=X*M+Z*B,this.b=X*t+Z*h,this.c=K*M+Y*B,this.d=K*t+Y*h,this.tx=q+(G*M+F*B),this.ty=O+(G*t+F*h),this},ng.prototype.prepend=function(X){var E=this.tx;if(1!==X.a||0!==X.b||0!==X.c||1!==X.d){var z=this.a,r=this.c;this.a=z*X.a+this.b*X.c,this.b=z*X.b+this.b*X.d,this.c=r*X.a+this.d*X.c,this.d=r*X.b+this.d*X.d}return this.tx=E*X.a+this.ty*X.c+X.tx,this.ty=E*X.b+this.ty*X.d+X.ty,this},ng.prototype.transform=ng.prototype.prepend,ng.prototype.invert=function(){var s=this.a,I=this.b,j=this.c,Y=this.d,P=this.tx,$=s*Y-I*j;return this.a=Y/$,this.b=-I/$,this.c=-j/$,this.d=s/$,this.tx=(j*this.ty-Y*P)/$,this.ty=-(s*this.ty-I*P)/$,this},ng.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},ng.prototype.clone=function(){var Q=new ng;return Q.a=this.a,Q.b=this.b,Q.c=this.c,Q.d=this.d,Q.tx=this.tx,Q.ty=this.ty,Q},ng.prototype.copy=function(V){return V.a=this.a,V.b=this.b,V.c=this.c,V.d=this.d,V.tx=this.tx,V.ty=this.ty,V},ng.prototype.tf=function(k,_){1===arguments.length&&(_=k.y,k=k.x);var D=this;return{x:D.a*k+D.c*_+D.tx,y:D.b*k+D.d*_+D.ty}},ng.prototype.tfi=function(S,n){1===arguments.length&&(n=S.y,S=S.x);var t=this,G=1/(t.a*t.d+t.c*-t.b);return{x:t.d*G*S+-t.c*G*n+(t.ty*t.c-t.tx*t.d)*G,y:t.a*G*n+-t.b*G*S+(-t.ty*t.a+t.tx*t.b)*G}},ng.IDENTITY=new ng,ng.TEMP_MATRIX=new ng;var Wi=j.Math.Vector3=function(J,P,O){"object"==typeof J?this.copy(J):this.set(J,P==H?J:P,O==H?J:O)};C.assign(Wi.prototype,{set:function(X,L,Q){return this.x=X,this.y=L,this.z=Q,this},setScalar:function(O){return this.x=O,this.y=O,this.z=O,this},setX:function(D){return this.x=D,this},setY:function(L){return this.y=L,this},setZ:function(_){return this.z=_,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(O){return O.x===H?(this.x=O[0],this.y=O[1],this.z=O[2]):(this.x=O.x,this.y=O.y,this.z=O.z),this},add:function(Z){return this.x+=Z.x,this.y+=Z.y,this.z+=Z.z,this},addScalar:function(D){return this.x+=D,this.y+=D,this.z+=D,this},addVectors:function(b,g){return this.x=b.x+g.x,this.y=b.y+g.y,this.z=b.z+g.z,this},addScaledVector:function(u,F){return this.x+=u.x*F,this.y+=u.y*F,this.z+=u.z*F,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},subScalar:function(X){return this.x-=X,this.y-=X,this.z-=X,this},subVectors:function(o,w){return this.x=o.x-w.x,this.y=o.y-w.y,this.z=o.z-w.z,this},multiply:function(Z){return this.x*=Z.x,this.y*=Z.y,this.z*=Z.z,this},multiplyScalar:function(X){return this.x*=X,this.y*=X,this.z*=X,this},distanceTo:function(F){return Math.sqrt(this.distanceToSquared(F))},distanceToSquared:function(V){var S=this.x-V.x,E=this.y-V.y,a=this.z-V.z;return S*S+E*E+a*a},distanceToSquared2:function(v){var A=this.x-v[0],k=this.y-v[1],n=this.z-v[2];return A*A+k*k+n*n},multiplyVectors:function(p,Z){return this.x=p.x*Z.x,this.y=p.y*Z.y,this.z=p.z*Z.z,this},transformDirection:function(s){var Y=this.x,$=this.y,e=this.z,W=s.el;return this.x=W[0]*Y+W[4]*$+W[8]*e,this.y=W[1]*Y+W[5]*$+W[9]*e,this.z=W[2]*Y+W[6]*$+W[10]*e,this.normalize()},applyQuaternion:function(y){var H=this.x,E=this.y,w=this.z,T=y._x,v=y._y,G=y._z,h=y._w,X=h*H+v*w-G*E,Q=h*E+G*H-T*w,g=h*w+T*E-v*H,f=-T*H-v*E-G*w;return this.x=X*h+f*-T+Q*-G-g*-v,this.y=Q*h+f*-v+g*-T-X*-G,this.z=g*h+f*-G+X*-v-Q*-T,this},applyMatrix4:function(k){var D=this.x,j=this.y,c=this.z,J=k.el,N=1/(J[3]*D+J[7]*j+J[11]*c+J[15]);return this.x=(J[0]*D+J[4]*j+J[8]*c+J[12])*N,this.y=(J[1]*D+J[5]*j+J[9]*c+J[13])*N,this.z=(J[2]*D+J[6]*j+J[10]*c+J[14])*N,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(z){return this.x*z.x+this.y*z.y+this.z*z.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var x=this.length();return x?this.multiplyScalar(1/x):this},setLength:function($){return this.normalize().multiplyScalar($)},fromArray:function(b,B){return B===H&&(B=0),this.x=b[B],this.y=b[B+1],this.z=b[B+2],this},toArray:function(F,a){return F===H&&(F=[0,0,0]),a===H&&(a=0),F[a]=this.x,F[a+1]=this.y,F[a+2]=this.z,F},cross:function(y){return this.crossVectors(this,y)},angleTo:function(F){var w=this.dot(F)/Math.sqrt(this.lengthSq()*F.lengthSq());return w>1||-1>w?0:Math.acos(w)},lerpVectors:function(a,u,W){return this.subVectors(u,a).multiplyScalar(W).add(a)},crossVectors:function(A,c){var v=A.x,g=A.y,q=A.z,W=c.x,M=c.y,G=c.z;return this.x=g*G-q*M,this.y=q*W-v*G,this.z=v*M-g*W,this},min:function(y){return this.x=Math.min(this.x,y.x),this.y=Math.min(this.y,y.y),this.z=Math.min(this.z,y.z),this},max:function(z){return this.x=Math.max(this.x,z.x),this.y=Math.max(this.y,z.y),this.z=Math.max(this.z,z.z),this}});var Mj=j.Math.Vector2=function(A,u,q){"object"==typeof A&&(A.x!=H?(u=A.y,A=A.x,q=A.e):(q=A[2],u=A[1],A=A[0])),this.set(A||0,u||0,q)};Mj.prototype={},Mj.prototype.constructor=Mj,C.defineProperties(Mj.prototype,{width:{get:function(){return this.x},set:function(x){this.x=x}},height:{get:function(){return this.y},set:function(W){this.y=W}}}),Mj.prototype.clone=function(){return new Mj(this.x,this.y,this.e)},Mj.prototype.copy=function(Z){return this.set(Z.x,Z.y,Z.e),this},Mj.prototype.equals=function(M){return M.x===this.x&&M.y===this.y},Mj.prototype.set=function(Q,r,s){return this.x=Q||0,this.y=r||(0!==r?this.x:0),s!=H&&(this.e=s),this},Mj.prototype.setScalar=function(f){return this.x=f,this.y=f,this},Mj.prototype.setX=function(b){return this.x=b||0,this},Mj.prototype.setY=function(g){return this.y=g||0,this},Mj.prototype.add=function(G){return this.x+=G.x,this.y+=G.y,this},Mj.prototype.addVectors=function(J,u){return this.x=J.x+u.x,this.y=J.y+u.y,this},Mj.prototype.addScalar=function($){return this.x+=$,this.y+=$,this},Mj.prototype.addScaledVector=function(E,G){return this.x+=E.x*G,this.y+=E.y*G,this},Mj.prototype.sub=function(Q){return this.x-=Q.x,this.y-=Q.y,this},Mj.prototype.subScalar=function(E){return this.x-=E,this.y-=E,this},Mj.prototype.subVectors=function(x,i){return this.x=x.x-i.x,this.y=x.y-i.y,this},Mj.prototype.multiply=function(j){return this.x*=j.x,this.y*=j.y,this},Mj.prototype.multiplyScalar=function(o){return this.x*=o,this.y*=o,this},Mj.prototype.divide=function(g){return this.x/=g.x,this.y/=g.y,this},Mj.prototype.divideScalar=function(x){return this.multiplyScalar(1/x)},Mj.prototype.min=function(u){return this.x=Math.min(this.x,u.x),this.y=Math.min(this.y,u.y),this},Mj.prototype.max=function(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this},Mj.prototype.fromArray=function(v,x){return x===H&&(x=0),this.x=v[x],this.y=v[x+1],this},Mj.prototype.clamp=function(X,c){return this.x=Math.max(X.x,Math.min(c.x,this.x)),this.y=Math.max(X.y,Math.min(c.y,this.y)),this},Mj.prototype.clampScalar=function(){var X,M;return function(Y,A){return X===H&&(X=new Mj,M=new Mj),X.set(Y,Y),M.set(A,A),this.clamp(X,M)}}(),Mj.prototype.clampLength=function(T,e){var L=this.length();return this.multiplyScalar(Math.max(T,Math.min(e,L))/L)},Mj.prototype.dot=function(y){return this.x*y.x+this.y*y.y},Mj.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Mj.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Mj.prototype.normalize=function(){return this.divideScalar(this.length())},Mj.prototype.angle=function(){var H=Math.atan2(this.y,this.x);return 0>H&&(H+=2*Math.PI),H},Mj.prototype.distanceTo=function(x){return Math.sqrt(this.distanceToSquared(x))},Mj.prototype.distanceToSquared=function(b){var T=this.x-b.x,z=this.y-b.y;return T*T+z*z},Mj.prototype.isNearEnough=function(C){return this.distanceToSquared(C)<1e-8},Mj.prototype.setLength=function(Y){var U=this.length();return U?this.multiplyScalar(Y/U):this},Mj.prototype.lerp=function(M,T){return this.x+=(M.x-this.x)*T,this.y+=(M.y-this.y)*T,this},Mj.prototype.lerpVectors=function(C,Z,K){return this.subVectors(Z,C).multiplyScalar(K).add(C)},Mj.prototype.rotateAround=function(u,I){var T=u?u.x:0,E=u?u.y:0,b=Math.cos(I),z=Math.sin(I),C=this.x-T,N=this.y-E;return this.x=C*b-N*z+T,this.y=C*z+N*b+E,this};var Fr=j.Math.Ray=function(_,c){this.origin=_!==H?_.clone():new Wi,this.direction=c!==H?c.clone():new Wi};C.assign(Fr.prototype,{set:function(J,a){return this.origin.copy(J),this.direction.copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(h){return this.origin.copy(h.origin),this.direction.copy(h.direction),this.maxHitLen=h.maxHitLen,this},at:function(P,U){var Z=U||new Wi;return Z.copy(this.direction).multiplyScalar(P).add(this.origin)},setMaxHitLength:function(K){this.maxHitLen=K},lookAt:function(k){return this.direction.copy(k).sub(this.origin).normalize(),this},applyMatrix4:function(j){var r=this.maxHitLen;if(r){var Y=this.direction.clone().multiplyScalar(r).add(this.origin);Y.applyMatrix4(j)}return this.origin.applyMatrix4(j),this.direction.transformDirection(j),r&&(this.maxHitLen=this.origin.distanceTo(Y)),this},intersectBox:function(l,P){var d,X,f,r,D,R,A=1/this.direction.x,W=1/this.direction.y,q=1/this.direction.z,N=this.origin;if(A>=0?(d=(l.min.x-N.x)*A,X=(l.max.x-N.x)*A):(d=(l.max.x-N.x)*A,X=(l.min.x-N.x)*A),W>=0?(f=(l.min.y-N.y)*W,r=(l.max.y-N.y)*W):(f=(l.max.y-N.y)*W,r=(l.min.y-N.y)*W),d>r||f>X)return null;if((f>d||d!==d)&&(d=f),(X>r||X!==X)&&(X=r),q>=0?(D=(l.min.z-N.z)*q,R=(l.max.z-N.z)*q):(D=(l.max.z-N.z)*q,R=(l.min.z-N.z)*q),d>R||D>X)return null;if((D>d||d!==d)&&(d=D),(X>R||X!==X)&&(X=R),0>X)return null;var w=d>=0?d:X,$=this.maxHitLen;return $&&w>$?null:this.at(w,P)},intersectTriangle:function(){var B=new Wi,y=new Wi,q=new Wi,j=new Wi;return function(O,$,c,G,b){y.subVectors($,O),q.subVectors(c,O),j.crossVectors(y,q);var S,t=this.direction.dot(j);if(t>0){if(G)return null;S=1}else{if(!(0>t))return null;S=-1,t=-t}B.subVectors(this.origin,O);var R=S*this.direction.dot(q.crossVectors(B,q));if(0>R)return null;var d=S*this.direction.dot(y.cross(B));if(0>d||R+d>t)return null;var s=-S*B.dot(j);if(0>s)return null;var w=s/t,p=this.maxHitLen;return p&&w>p?null:this.at(w,b)}}()});var Bc=j.Math.Box3=function(R,W){this.min=R!==H?R:new Wi(1/0,1/0,1/0),this.max=W!==H?W:new Wi(-1/0,-1/0,-1/0)};C.assign(Bc.prototype,{set:function(T,Q){return this.min.copy(T),this.max.copy(Q),this},setFromArray:function(o){for(var E=1/0,$=1/0,i=1/0,I=-1/0,S=-1/0,x=-1/0,b=0,W=o.length;W>b;b+=3){var B=o[b],L=o[b+1],X=o[b+2];E>B&&(E=B),$>L&&($=L),i>X&&(i=X),B>I&&(I=B),L>S&&(S=L),X>x&&(x=X)}return this.min.set(E,$,i),this.max.set(I,S,x),this},setFromPoints:function(m){this.makeEmpty();for(var w=0,U=m.length;U>w;w++)this.expandByPoint(m[w]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(u){return this.min.copy(u.min),this.max.copy(u.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(x){return this.min.min(x),this.max.max(x),this}});var vn=j.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};C.assign(vn.prototype,{set:function(a,D,z,L,O,q,v,l,c,m,Y,E,u,s,R,Q){var F=this.el;return F[0]=a,F[4]=D,F[8]=z,F[12]=L,F[1]=O,F[5]=q,F[9]=v,F[13]=l,F[2]=c,F[6]=m,F[10]=Y,F[14]=E,F[3]=u,F[7]=s,F[11]=R,F[15]=Q,this},clone:function(){return(new vn).fromArray(this.el)},fromArray:function(S,e){e===H&&(e=0);for(var i=this.el,s=0;16>s;s++)i[s]=S[s+e];return this},scale:function(m){var X=this.el,N=m.x,J=m.y,c=m.z;return X[0]*=N,X[4]*=J,X[8]*=c,X[1]*=N,X[5]*=J,X[9]*=c,X[2]*=N,X[6]*=J,X[10]*=c,X[3]*=N,X[7]*=J,X[11]*=c,this},makeRotationFromEuler:function(g){var A=this.el,J=g._x,x=g._y,S=g._z,K=g._order,q=Math.cos(J),p=Math.sin(J),c=Math.cos(x),R=Math.sin(x),k=Math.cos(S),T=Math.sin(S);if("XYZ"===K){var v=q*k,B=q*T,O=p*k,n=p*T;A[0]=c*k,A[4]=-c*T,A[8]=R,A[1]=B+O*R,A[5]=v-n*R,A[9]=-p*c,A[2]=n-v*R,A[6]=O+B*R,A[10]=q*c}else if("YXZ"===K){var F=c*k,u=c*T,z=R*k,h=R*T;A[0]=F+h*p,A[4]=z*p-u,A[8]=q*R,A[1]=q*T,A[5]=q*k,A[9]=-p,A[2]=u*p-z,A[6]=h+F*p,A[10]=q*c}else if("ZXY"===K){var F=c*k,u=c*T,z=R*k,h=R*T;A[0]=F-h*p,A[4]=-q*T,A[8]=z+u*p,A[1]=u+z*p,A[5]=q*k,A[9]=h-F*p,A[2]=-q*R,A[6]=p,A[10]=q*c}else if("ZYX"===K){var v=q*k,B=q*T,O=p*k,n=p*T;A[0]=c*k,A[4]=O*R-B,A[8]=v*R+n,A[1]=c*T,A[5]=n*R+v,A[9]=B*R-O,A[2]=-R,A[6]=p*c,A[10]=q*c}else if("YZX"===K){var M=q*c,C=q*R,W=p*c,$=p*R;A[0]=c*k,A[4]=$-M*T,A[8]=W*T+C,A[1]=T,A[5]=q*k,A[9]=-p*k,A[2]=-R*k,A[6]=C*T+W,A[10]=M-$*T}else if("XZY"===K){var M=q*c,C=q*R,W=p*c,$=p*R;A[0]=c*k,A[4]=-T,A[8]=R*k,A[1]=M*T+$,A[5]=q*k,A[9]=C*T-W,A[2]=W*T-C,A[6]=p*k,A[10]=$*T+M}return A[3]=0,A[7]=0,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,this},makeRotationFromQuaternion:function(U){var i=this.el,v=U._x,L=U._y,H=U._z,j=U._w,w=v+v,g=L+L,O=H+H,k=v*w,Y=v*g,Q=v*O,r=L*g,G=L*O,V=H*O,l=j*w,u=j*g,A=j*O;return i[0]=1-(r+V),i[4]=Y-A,i[8]=Q+u,i[1]=Y+A,i[5]=1-(k+V),i[9]=G-l,i[2]=Q-u,i[6]=G+l,i[10]=1-(k+r),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(h){var A=this.el,D=h.el,N=D[0],$=D[1],g=D[2],a=D[3],t=D[4],T=D[5],B=D[6],F=D[7],w=D[8],H=D[9],P=D[10],Y=D[11],u=D[12],J=D[13],R=D[14],n=D[15],O=H*R*F-J*P*F+J*B*Y-T*R*Y-H*B*n+T*P*n,l=u*P*F-w*R*F-u*B*Y+t*R*Y+w*B*n-t*P*n,C=w*J*F-u*H*F+u*T*Y-t*J*Y-w*T*n+t*H*n,p=u*H*B-w*J*B-u*T*P+t*J*P+w*T*R-t*H*R,M=N*O+$*l+g*C+a*p;if(0===M)return this.identity();var V=1/M;return A[0]=O*V,A[1]=(J*P*a-H*R*a-J*g*Y+$*R*Y+H*g*n-$*P*n)*V,A[2]=(T*R*a-J*B*a+J*g*F-$*R*F-T*g*n+$*B*n)*V,A[3]=(H*B*a-T*P*a-H*g*F+$*P*F+T*g*Y-$*B*Y)*V,A[4]=l*V,A[5]=(w*R*a-u*P*a+u*g*Y-N*R*Y-w*g*n+N*P*n)*V,A[6]=(u*B*a-t*R*a-u*g*F+N*R*F+t*g*n-N*B*n)*V,A[7]=(t*P*a-w*B*a+w*g*F-N*P*F-t*g*Y+N*B*Y)*V,A[8]=C*V,A[9]=(u*H*a-w*J*a-u*$*Y+N*J*Y+w*$*n-N*H*n)*V,A[10]=(t*J*a-u*T*a+u*$*F-N*J*F-t*$*n+N*T*n)*V,A[11]=(w*T*a-t*H*a-w*$*F+N*H*F+t*$*Y-N*T*Y)*V,A[12]=p*V,A[13]=(w*J*g-u*H*g+u*$*P-N*J*P-w*$*R+N*H*R)*V,A[14]=(u*T*g-t*J*g-u*$*B+N*J*B+t*$*R-N*T*R)*V,A[15]=(t*H*g-w*T*g+w*$*B-N*H*B-t*$*P+N*T*P)*V,this
},makeRotationAxis:function(R,V){var t=Math.cos(V),k=Math.sin(V),f=1-t,l=R.x,B=R.y,L=R.z,O=f*l,_=f*B;return this.set(O*l+t,O*B-k*L,O*L+k*B,0,O*B+k*L,_*B+t,_*L-k*l,0,O*L-k*B,_*L+k*l,f*L*L+t,0,0,0,0,1),this},multiply:function(l){return this.multiplyMatrices(this,l)},premultiply:function(s){return this.multiplyMatrices(s,this)},multiplyMatrices:function(K,P){var n=K.el,f=P.el,L=this.el,c=n[0],p=n[4],O=n[8],Q=n[12],H=n[1],D=n[5],h=n[9],z=n[13],N=n[2],j=n[6],W=n[10],e=n[14],_=n[3],y=n[7],q=n[11],Y=n[15],i=f[0],J=f[4],V=f[8],X=f[12],G=f[1],a=f[5],I=f[9],v=f[13],k=f[2],t=f[6],M=f[10],$=f[14],S=f[3],r=f[7],x=f[11],U=f[15];return L[0]=c*i+p*G+O*k+Q*S,L[4]=c*J+p*a+O*t+Q*r,L[8]=c*V+p*I+O*M+Q*x,L[12]=c*X+p*v+O*$+Q*U,L[1]=H*i+D*G+h*k+z*S,L[5]=H*J+D*a+h*t+z*r,L[9]=H*V+D*I+h*M+z*x,L[13]=H*X+D*v+h*$+z*U,L[2]=N*i+j*G+W*k+e*S,L[6]=N*J+j*a+W*t+e*r,L[10]=N*V+j*I+W*M+e*x,L[14]=N*X+j*v+W*$+e*U,L[3]=_*i+y*G+q*k+Y*S,L[7]=_*J+y*a+q*t+Y*r,L[11]=_*V+y*I+q*M+Y*x,L[15]=_*X+y*v+q*$+Y*U,this}});var xg=j.Math.Quaternion=function(m,$,X,S){this.set(m,$,X,S)};C.assign(xg.prototype,{set:function(u,U,$,p){var F=this;return F._x=u||0,F._y=U||0,F._z=$||0,F._w=p!==H?p:1,F},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(i){var L=this;return L._x=i._x,L._y=i._y,L._z=i._z,L._w=i._w,L},fromArray:function(U,Z){Z===H&&(Z=0);var P=this;return P._x=U[Z],P._y=U[Z+1],P._z=U[Z+2],P._w=U[Z+3],this},slerp:function(j,A){if(0===A)return this;if(1===A)return this.copy(j);var E=this._x,G=this._y,g=this._z,O=this._w,p=O*j._w+E*j._x+G*j._y+g*j._z;if(0>p?(this._w=-j._w,this._x=-j._x,this._y=-j._y,this._z=-j._z,p=-p):this.copy(j),p>=1)return this._w=O,this._x=E,this._y=G,this._z=g,this;var w=Math.sqrt(1-p*p);if(Math.abs(w)<.001)return this._w=.5*(O+this._w),this._x=.5*(E+this._x),this._y=.5*(G+this._y),this._z=.5*(g+this._z),this;var C=Math.atan2(w,p),K=Math.sin((1-A)*C)/w,n=Math.sin(A*C)/w;return this._w=O*K+this._w*n,this._x=E*K+this._x*n,this._y=G*K+this._y*n,this._z=g*K+this._z*n,this},setFromAxisAngle:function(s,S){var L=S/2,z=Math.sin(L);return this._x=s.x*z,this._y=s.y*z,this._z=s.z*z,this._w=Math.cos(L),this},setFromEuler:function(a){var q=a._x,k=a._y,t=a._z,z=a._order,H=Math.cos,B=Math.sin,y=H(q/2),O=H(k/2),M=H(t/2),c=B(q/2),C=B(k/2),n=B(t/2);return"XYZ"===z?(this._x=c*O*M+y*C*n,this._y=y*C*M-c*O*n,this._z=y*O*n+c*C*M,this._w=y*O*M-c*C*n):"YXZ"===z?(this._x=c*O*M+y*C*n,this._y=y*C*M-c*O*n,this._z=y*O*n-c*C*M,this._w=y*O*M+c*C*n):"ZXY"===z?(this._x=c*O*M-y*C*n,this._y=y*C*M+c*O*n,this._z=y*O*n+c*C*M,this._w=y*O*M-c*C*n):"ZYX"===z?(this._x=c*O*M-y*C*n,this._y=y*C*M+c*O*n,this._z=y*O*n-c*C*M,this._w=y*O*M+c*C*n):"YZX"===z?(this._x=c*O*M+y*C*n,this._y=y*C*M+c*O*n,this._z=y*O*n-c*C*M,this._w=y*O*M-c*C*n):"XZY"===z&&(this._x=c*O*M-y*C*n,this._y=y*C*M-c*O*n,this._z=y*O*n+c*C*M,this._w=y*O*M+c*C*n),this}});var qh=j.Math.Triangle=function(s,I,E){this.a=s!==H?s:new Wi,this.b=I!==H?I:new Wi,this.c=E!==H?E:new Wi};C.assign(qh,{barycoordFromPoint:function(){var u=new Wi,h=new Wi,q=new Wi;return function(p,M,R,E,z){u.subVectors(E,M),h.subVectors(R,M),q.subVectors(p,M);var x=u.dot(u),T=u.dot(h),s=u.dot(q),b=h.dot(h),Z=h.dot(q),m=x*b-T*T,N=z||new Wi;if(0===m)return N.set(-2,-1,-1);var y=1/m,Y=(b*s-T*Z)*y,c=(x*Z-T*s)*y;return N.set(1-Y-c,c,Y)}}()});var Rn=j.Math.Euler=function(B,y,H,f,R){this.set(B,y,H,f,R)};Rn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Rn.DefaultOrder="XYZ",Rn.ReverseOrder=function(N){return N=N[2]+N[1]+N[0],N.toUpperCase()},C.defineProperties(Rn.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(u){this._y=u,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(C){this._z=C,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(Z){this._order=Z,this.onChangeCallback()}}}),C.assign(Rn.prototype,{set:function(L,H,M,Q,t){return Ck(L)&&(t=M,Q=H,M=L[2],H=L[1],L=L[0]),Q?t&&(Q=Rn.ReverseOrder(Q)):Q="ZYX",this._x=L||0,this._y=H||0,this._z=M||0,this._order=Q||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(j){return this._x=j._x,this._y=j._y,this._z=j._z,this._order=j._order,this.onChangeCallback(),this},setFromRotationMatrix:function(x,l,r){var X=j.Math.clamp,Z=x.el||x,w=Z[0],t=Z[4],Y=Z[8],R=Z[1],s=Z[5],m=Z[9],E=Z[2],A=Z[6],z=Z[10];return l=l||this._order,"XYZ"===l?(this._y=Math.asin(X(Y,-1,1)),Math.abs(Y)<.99999?(this._x=Math.atan2(-m,z),this._z=Math.atan2(-t,w)):(this._x=Math.atan2(A,s),this._z=0)):"YXZ"===l?(this._x=Math.asin(-X(m,-1,1)),Math.abs(m)<.99999?(this._y=Math.atan2(Y,z),this._z=Math.atan2(R,s)):(this._y=Math.atan2(-E,w),this._z=0)):"ZXY"===l?(this._x=Math.asin(X(A,-1,1)),Math.abs(A)<.99999?(this._y=Math.atan2(-E,z),this._z=Math.atan2(-t,s)):(this._y=0,this._z=Math.atan2(R,w))):"ZYX"===l?(this._y=Math.asin(-X(E,-1,1)),Math.abs(E)<.99999?(this._x=Math.atan2(A,z),this._z=Math.atan2(R,w)):(this._x=0,this._z=Math.atan2(-t,s))):"YZX"===l?(this._z=Math.asin(X(R,-1,1)),Math.abs(R)<.99999?(this._x=Math.atan2(-m,s),this._y=Math.atan2(-E,w)):(this._x=0,this._y=Math.atan2(Y,z))):"XZY"===l?(this._z=Math.asin(-X(t,-1,1)),Math.abs(t)<.99999?(this._x=Math.atan2(A,s),this._y=Math.atan2(Y,w)):(this._x=Math.atan2(-m,z),this._y=0)):console.warn("unsupported order: "+l),this._order=l,r!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var U=new vn;return function(Y,B,J){return U.makeRotationFromQuaternion(Y),this.setFromRotationMatrix(U,B,J)}}(),setFromVector3:function(D,Q){return this.set(D.x,D.y,D.z,Q||this._order)},reorder:function(){var k=new xg;return function(z){return k.setFromEuler(this),this.setFromQuaternion(k,z)}}(),equals:function(x){return x._x===this._x&&x._y===this._y&&x._z===this._z&&x._order===this._order},fromArray:function(n){return this._x=n[0],this._y=n[1],this._z=n[2],n[3]!==H&&(this._order=n[3]),this.onChangeCallback(),this},toArray:function(F,W){return F===H&&(F=[]),W===H&&(W=0),F[W]=this._x,F[W+1]=this._y,F[W+2]=this._z,F[W+3]=this._order,F},toVector3:function(I){return I?I.set(this._x,this._y,this._z):new Wi(this._x,this._y,this._z)},onChange:function(S){return this.onChangeCallback=S,this},onChangeCallback:function(){}});var fb=j.List=function(){this._as=[];var L,$,H=arguments.length;if(1===H){var r=arguments[0];if(Am(r)&&(r=r._as),Ck(r))for($=r.length,L=0;$>L;L++)this._as.push(r[L]);else r!=I&&this._as.push(r)}else if(H>1)for(L=0;H>L;L++)this._as.push(arguments[L])};yp("List",C,{forEach:function(n,b){this.each(n,b)},push:function(){for(var Z=0;Z<arguments.length;Z++)this.add(arguments[Z])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(l,h){return h===H?this._as.push(l):this._as.splice(h,0,l)},addAll:function(c){Am(c)&&(c=c._as),Ck(c)?Vc(this._as,c):this._as.push(c)},get:function(E){return this._as[E]},slice:function(w,E){return new fb(this._as.slice(w,E))},remove:function(F){var n=this._as.indexOf(F);return n>=0&&n<this._as.length&&this.removeAt(n),n},removeAt:function(T){return this._as.splice(T,1)[0]},set:function(L,h){return this._as[L]=h},clear:function(){return this._as.splice(0,this._as.length)},contains:function(R){return this._as.indexOf(R)>=0},indexOf:function(I){return this._as.indexOf(I)},each:function(O,J){for(var v=0,i=this._as.length;i>v;v++){var k=this._as[v];J?O.call(J,k,v,this):O(k,v,this)}},reverseEach:function(n,i){for(var E=this._as.length-1;E>=0;E--){var x=this._as[E];i?n.call(i,x):n(x)}},toArray:function(z,L){if(z){for(var g,R=[],S=0,w=this._as.length;w>S;S++)g=this._as[S],L?z.call(L,g)&&R.push(g):z(g)&&R.push(g);return R}return this._as.concat()},toList:function(b,R){if(b){for(var y,X=new fb,i=0,I=this._as.length;I>i;i++)y=this._as[i],R?b.call(R,y)&&X.add(y):b(y)&&X.add(y);return X}return new fb(this)},reverse:function(){this._as.reverse()},sort:function(O){return this._as.sort(O?O:xl),this},toString:function(){return this._as.toString()}}),C.defineProperties(fb.prototype,{length:{get:function(){return this._as.length},set:function(g){this._as.length=g}}});var Qi=new fb;Of(Qi,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:Mo,each:Mo,reverseEach:Mo,toArray:function(){return[]},toList:function(){return new fb},add:Gg,addAll:Gg,set:Gg,remove:Gg,removeAt:Gg,clear:Gg});var Th=j.Notifier=function(){this._f=0};yp("Notifier",C,{contains:function(u,f){if(this._ls)for(var s,d=0,G=this._ls.size();G>d;d++)if(s=this._ls.get(d),u===s.l&&f===s.s)return!0;return!1},add:function(a,S,R){var $=this,B={l:a,s:S,a:R};$._ls||($._ls=new fb),$._f?($._as||($._as=new fb),$._as.add(B)):B.a?$._ls.add(B,0):$._ls.add(B)},remove:function(q,w){var M=this;M._ls&&(M._f?(M._rs||(M._rs=new fb),M._rs.add({l:q,s:w})):M._remove(q,w))},_remove:function(X,x){for(var I,o=this._ls,y=0,m=o.size();m>y;y++)if(I=o.get(y),I.l===X&&I.s===x)return o.removeAt(y),void 0},fire:function(t){var j=this,L=j._ls;if(j._b=1e4,L){++j._f;try{for(var o,B=0,x=L.size();x>B;B++)o=L.get(B),o.s?o.l.call(o.s,t):o.l(t)}finally{if(--j._f)return;if(j._rs){for(x=j._rs.size(),B=0;x>B;B++)o=j._rs.get(B),j._remove(o.l,o.s);delete j._rs}if(j._as){for(x=j._as.size(),B=0;x>B;B++)o=j._as.get(B),o.a?L.add(o,0):L.add(o);delete j._as}}}}});var Uk=j.Data=function(){this._id=sl()};yp("Data",C,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:I,_parent:I,_children:Qi,_childMap:I,_styleMap:I,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return I},_22Q:function(){return I},s:function(X,G){var p=this;if(2===arguments.length)p.setStyle(X,G);else{if(!Lg(X))return p.getStyle(X);for(var q in X)p.setStyle(q,X[q])}return p},fp:function(T,I,H,M,L){return this.firePropertyChange(T,I,H,M,L)},firePropertyChange:function(R,T,_,I,q){if(I){if(I(T,_))return!1}else if(T===_)return!1;var z=this,t=q||{};return t.property=R,t.oldValue=T,t.newValue=_,t.data=z,z._dataModel&&z._dataModel.handleDataPropertyChange(t),z.onPropertyChanged(t),!0},onPropertyChanged:function(U){var C=this,s=C._parent,X=U.property;if(Co(s)){var q=C.s(Pj),t="s:ingroup"===X;(q&&Ei[X]||X===t)&&s._81I(),(q||t)&&s.fp("childChange",!0,!1)}Rq(s)&&Ei[X]&&s.updateFromChildren()},_21I:function(j){var b=this;if(j&&b._dataModel)throw"Remove data from dataModel before adding";b._dataModel=j},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var f=0,O=this._children.toArray(),B=O.length;B>f;f++)O[f].removeFromDataModel()},getId:function(){return this._id},setId:function(s){this._id=s},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(t,x){return this._children.toList(t,x)},eachChild:function(c,s){this._children.each(c,s)},addChild:function(e,C){var $=this;e!==$&&($._children===Qi&&($._children=new fb,$._childMap={}),C>=0||(C=$._children.size()),$._childMap[e._id]||$.isDescendantOf(e)||(e._parent&&e._parent.removeChild(e),(0>C||C>$._children.size())&&(C=$._children.size()),$._children.add(e,C),$._childMap[e._id]=e,e.setParent($),$.onChildAdded(e,C),$.fp(ff,I,e)))},onChildAdded:function(){},removeChild:function(n){var b=this;if(b._childMap&&b._childMap[n._id]){var j=b._children.remove(n);delete b._childMap[n._id],b.fp(ff,n,I),n.setParent(I,j),b.onChildRemoved(n,j)}},onChildRemoved:function(){},getChildAt:function(b){return this._children.get(b)},clearChildren:function(){var y=this;if(!y._children.isEmpty())for(var W=0,m=y._children.toArray(),n=m.length;n>W;W++)y.removeChild(m[W])},getParent:function(){return this._parent},setParent:function(D,N){var f=this;if(!(f._73I||f._parent===D||f===D||D&&D.isDescendantOf(f))){var $,p=f._parent;f._parent=D,f._73I=1,p?(N==I&&(N=p.getChildren().indexOf(f)),p.removeChild(f)):f._dataModel&&N==I&&(N=f._dataModel.getRoots().indexOf(f)),D&&(D.addChild(f),$=D.getChildren().indexOf(f)),delete f._73I,f.fp("parent",p,D,H,{oldIndex:N,newIndex:$}),f.onParentChanged(p,D)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(f){return f?this.isDescendantOf(f)||f.isDescendantOf(this):!1},isParentOf:function(W){return W&&this._childMap?!!this._childMap[W._id]:!1},isDescendantOf:function(D){if(!D||D.isEmpty())return!1;for(var X=this._parent;X;){if(D===X)return!0;X=X._parent}return!1},getStyle:function(Q,A){A===H&&(A=1);var X=this._styleMap?this._styleMap[Q]:H;return X===H&&A?v[Q]:X},setStyle:function(T,J){var c=this;c._styleMap||(c._styleMap={});var k=c._styleMap[T];J===H?delete c._styleMap[T]:c._styleMap[T]=J,c.fp("s:"+T,k,J)&&c.onStyleChanged(T,k,J)},onStyleChanged:function(){},iv:function(R){this.invalidate(R)},invalidate:function(k){this.fp(k||"*",!1,!0)},toString:function(){var X=this;return X._displayName||X._name||X._tag||X._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(S,d){var s=this,z=s.s(ce);z||s.s(ce,z={}),d?z[S]=d:delete z[S],s.fp(ce,I,z)},removeStyleIcon:function(G){var Q=this.s(ce);if(Q){var y=Q[G];delete Q[G],this.fp(ce,I,Q)}return y},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var W,Q={};for(W in this._styleMap)Q[W]=1;return Q}});var pd=j.DataModel=function(){var P=this;P._datas=new fb,P._dataMap={},P._roots=new fb,P._rootMap={},P._fsDataMap={},P._78O={},P._36I=new Th,P._35I=new Th,P._serializeNotifier=new Th,P._selectionModel=new hs(P);var b=P._29Q=[],l=P._scheduleCallback=function(){for(var s=Date.now(),E=0;E<b.length;E++){var p=b[E];p.enabled&&s-p.lastTime>p.interval&&(p.beforeAction&&p.beforeAction(),P.each(function(V){p.action(V)}),p.afterAction&&p.afterAction(),p.lastTime=s)}b.length&&(P._30Q=U.requestAnimationFrame(l))}};yp("DataModel",C,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:H,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:H,_init:H,_envmap:H,_postProcessingData:H,sm:function(){return this.getSelectionModel()},mm:function(U,O,u){this.addDataModelChangeListener(U,O,u)},umm:function(y,v){this.removeDataModelChangeListener(y,v)},md:function(U,S,A){this.addDataPropertyChangeListener(U,S,A)},umd:function(j,W){this.removeDataPropertyChangeListener(j,W)},mh:function(_,U,T){this.addHierarchyChangeListener(_,U,T)},umh:function(w,v){this.removeHierarchyChangeListener(w,v)},getAttrObject:function(){return this._attrObject},setAttrObject:function(q){return this._attrObject=q},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getDataById:function(t){return this._dataMap[t]},removeDataById:function(y){this.remove(this.getDataById(y))},toDatas:function(X,q){return this._datas.toList(X,q)},each:function(g,Z){this._datas.each(g,Z)},getDataByTag:function(U){return this._78O[U]},getTagMap:function(){return this._78O},removeDataByTag:function(X){this.remove(this.getDataByTag(X))},add:function(B,c,Y){var p=this,M=B._id,k=B._tag,j=p._roots;if(p._dataMap[M])throw"'"+M+"' already exists";k!=I&&(p._78O[k]=B),p._dataMap[M]=B,Y>=0?p._datas.add(B,Y):p._datas.add(B),B._parent||(p._rootMap[M]=B,c>=0?j.add(B,c):j.add(B)),B.s("fullscreen")!==H&&(p._fsDataMap[M]=B),B._21I(p),p.onAdded(B),p._36I.fire({kind:"add",data:B,rootsIndex:c,datasIndex:Y})},onAdded:function(){},remove:function(N,u){if(N){var e=this,o=N._id,M=u&&u.keepStructure,R=u&&u.keepChildren,$=N.getTag();if(N._dataModel===e){this.beginTransaction(),M?e._removingData||(e._removingData=N):e.prepareRemove(N),R||N.toChildren().each(function(L){e.remove(L,u)},e),M?e._removingData===N&&(N._parent&&N._parent.removeChild(N),delete e._removingData):N._parent&&N._parent.removeChild(N);var m=e._datas.remove(N);delete e._dataMap[o],$!=I&&delete e._78O[$];var z;e._rootMap[o]&&(delete e._rootMap[o],z=e._roots.remove(N)),e._fsDataMap[o]&&delete e._fsDataMap[o],N._21I(I),e.onRemoved(N),e._36I.fire({kind:Rf,data:N,rootsIndex:z,datasIndex:m}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var B=this;if(B._datas.size()){var E=B._historyManager?this.toJSON():H;B._datas.toArray().forEach(function(h){h._21I(I)}),B._datas.clear(),B._dataMap={},B._roots.clear(),B._rootMap={},B._fsDataMap={},B._78O={},B._36I.fire({kind:Zd,json:E})}},contains:function(X){return X&&X._dataModel===this},handleDataPropertyChange:function(J){var e=this,_=J.data,c=J.property;if("parent"===c){var C=_._id,p=e._rootMap,M=e._roots;_._parent?p[C]&&(delete p[C],M.remove(_)):p[C]||(p[C]=_,M.add(_))}else if("tag"===c){var n=J.oldValue,t=J.newValue,q=e._78O;n!=I&&delete q[n],t!=I&&(q[t]=_)}else if("s:fullscreen"===c){var C=_._id,v=e._fsDataMap;J.oldValue!=I&&delete v[C],J.newValue!=I&&(v[C]=_)}this.onDataPropertyChanged(_,J),this._35I.fire(J)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(Z,_,o){this._36I.add(Z,_,o)},removeDataModelChangeListener:function(q,p){this._36I.remove(q,p)},addSerializeListener:function(O,g,o){this._serializeNotifier.add(O,g,o)},removeSerializeListener:function(B,F){this._serializeNotifier.remove(B,F)},fireSerializeEvent:function(n){this._serializeNotifier.fire(n)},addDataPropertyChangeListener:function(V,v,j){this._35I.add(V,v,j)},removeDataPropertyChangeListener:function(T,j){this._35I.remove(T,j)},_38I:function(X,Z,b){this._37I&&this._37I.fire({data:X,oldIndex:Z,newIndex:b})},addHierarchyChangeListener:function(v,s,e){this._37I||(this._37I=new Th),this._37I.add(v,s,e)},removeHierarchyChangeListener:function(x,F){this._37I.remove(x,F)},getSiblings:function(H){var B=H._parent;return B?B._children:this._roots},eachByHierarchical:function(F,X,e){if(X)return this._eachByHierarchical(F,X,e);for(var I=0,A=this._roots,m=A.size();m>I;I++)if(this._eachByHierarchical(F,A.get(I),e)===!1)return!1;return!0},_eachByHierarchical:function(v,y,e){if(e){if(v.call(e,y)===!1)return!1}else if(v(y)===!1)return!1;for(var x=y.size(),C=0;x>C;C++)if(this._eachByHierarchical(v,y.getChildAt(C),e)===!1)return!1;return!0},reverseEachByHierarchical:function(l,r,C){if(r)return this._reverseEachByHierarchical(l,r,C);for(var T=this._roots,v=T.size(),L=v-1;L>=0;L--)if(this._reverseEachByHierarchical(l,T.get(L),C)===!1)return!1;return!0},_reverseEachByHierarchical:function(D,L,N){for(var n=L.size(),A=n-1;A>=0;A--)if(this._reverseEachByHierarchical(D,L.getChildAt(A),N)===!1)return!1;if(N){if(D.call(N,L)===!1)return!1}else if(D(L)===!1)return!1;return!0},eachByDepthFirst:function(t,M,h){if(M)return this._11I(t,M,h);for(var S=0,n=this._roots,A=n.size();A>S;S++)if(this._11I(t,n.get(S),h)===!1)return!1;return!0},_11I:function(A,J,f){for(var L=J.size(),v=0;L>v;v++)if(this._11I(A,J.getChildAt(v),f)===!1)return!1;if(f){if(A.call(f,J)===!1)return!1}else if(A(J)===!1)return!1;return!0},eachByBreadthFirst:function(z,w,f){var S=new fb;for(w?S.add(w):this._roots.each(S.add,S);S.size()>0;)if(w=S.removeAt(0),w.eachChild(S.add,S),f){if(z.call(f,w)===!1)return!1}else if(z(w)===!1)return!1;return!0},moveTo:function(d,k){var p=this.getSiblings(d),y=p.indexOf(d);y===k||0>y||k>=0&&k<=p.size()&&(p.remove(d),k>p.size()&&k--,p.add(d,k),this._38I(d,y,k))},moveUp:function(S){this.moveTo(S,this.getSiblings(S).indexOf(S)-1)},moveDown:function(r){this.moveTo(r,this.getSiblings(r).indexOf(r)+1)},moveToTop:function(G){this.moveTo(G,0)},moveToBottom:function(V){this.moveTo(V,this.getSiblings(V).size())},moveSelectionUp:function(w){this.beginTransaction(),w||(w=this.sm());var D=new fb;Vh(w,D,this._roots),D.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(R){this.beginTransaction(),R||(R=this.sm());var S=new fb;rs(R,S,this._roots),S.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(F){this.beginTransaction(),F||(F=this.sm());var k=new fb;Lo(F,k,this._roots),k.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(Y){this.beginTransaction(),Y||(Y=this.sm());var m=new fb;wj(Y,m,this._roots),m.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(g,A,p){var S=this.getDatas();null==p&&(p=S.indexOf(g)),p===A||0>p||A>=0&&A<=S.size()&&(S.remove(g),A>S.size()&&A--,S.add(g,A),this._76I(g,p,A))},bringForward:function(O){this.moveToIndex(O,this.getDatas().indexOf(O)+1)},bringToFront:function($){this.moveToIndex($,this.size())},sendBackward:function(k){this.moveToIndex(k,this.getDatas().indexOf(k)-1)},sendToBack:function(R){this.moveToIndex(R,0)},bringSelectionForward:function(x){this.beginTransaction(),x||(x=this.sm());for(var i=new fb,R=this.getDatas(),r=!1,V=0;V<R.size();V++){var P=R.get(R.size()-1-V);x.contains(P)?r&&i.add(P):r=!0}i.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(s){this.beginTransaction(),s||(s=this.sm());for(var i=new fb,H=this.getDatas(),Z=0;Z<H.size();Z++){var x=H.get(Z);s.contains(x)&&i.add(x)}i.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(X){this.beginTransaction(),X||(X=this.sm());for(var F=new fb,u=this.getDatas(),V=!1,w=0;w<u.size();w++){var a=u.get(w);X.contains(a)?V&&F.add(a):V=!0}F.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(H){this.beginTransaction(),H||(H=this.sm());for(var f=new fb,w=this.getDatas(),Y=0;Y<w.size();Y++){var B=w.get(w.size()-1-Y);H.contains(B)&&f.add(B)}f.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(E){var e=this;e.removeScheduleTask(E),E.enabled==I&&(E.enabled=!0),E.interval==I&&(E.interval=10),E.action==I&&(E.action=Mo),E.lastTime=Date.now(),e._29Q.push(E),e._30Q==I&&(e._30Q=U.requestAnimationFrame(e._scheduleCallback))},removeScheduleTask:function(K){var A=this,T=A._29Q,N=T.indexOf(K);N>=0&&T.splice(N,1),T.length||A._30Q==I||(U.cancelAnimationFrame(A._30Q),delete A._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(K){this._historyManager||new j.HistoryManager(this),null!=K&&this._historyManager.setMaxHistoryCount(K),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(s){this._historyManager&&this._historyManager.undo(s)},redo:function(v){this._historyManager&&this._historyManager.redo(v)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(m){this._historyManager&&this._historyManager.addHistory(m)},onHistoryManagerChanged:function(){}});var hs=j.SelectionModel=function(l){var Z=this;Z._68O=Kq,Z._map={},Z._73O=new fb,Z._74I=new Th,Z._21I(l)};yp("SelectionModel",C,{ms_fire:1,ms_dm:1,ms:function(g,r,X){this.addSelectionChangeListener(g,r,X)},ums:function(j,E){this.removeSelectionChangeListener(j,E)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===Oc},co:function(C){return this._map[C._id]!=I},ss:function(w){this.setSelection(w)},as:function(U){this.appendSelection(U)},rs:function(B){this.removeSelection(B)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(E){var W=this;if(W._68O!==E&&(E===ls||E===Oc||E===Kq)){W.cs();var k=W._68O;W._68O=E,W.fp("selectionMode",k,E)}},_21I:function(R){var t=this,Z=t._dataModel;Z!==R&&(Z&&(t.cs(),Z.umm(t.handleDataModelChange,t)),t._dataModel=R,R.mm(t.handleDataModelChange,t,!0),t.fp(ik,Z,R))},dispose:function(){var z=this;z.cs(),z._dataModel.umm(z.handleDataModelChange,z)},handleDataModelChange:function(g){var A=this;if(g.kind===Rf){var p=g.data;A.co(p)&&(A._73O.remove(p),delete A._map[p._id],A._75I(Rf,new fb(p)))}else g.kind===Zd&&A.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(q){var E=this;if(E._filterFunc!==q){E.cs();var L=E._filterFunc;E._filterFunc=q,E.fp("filterFunc",L,E._filterFunc)}},_75I:function(M,k,L,a){L&&(this._73O.each(function(n){a[n._id]?L.remove(n):L.add(n)}),k=L.toList()),this._74I.fire({kind:M,datas:new fb(k)})},addSelectionChangeListener:function(K,z,T){this._74I.add(K,z,T)},removeSelectionChangeListener:function(h,C){this._74I.remove(h,C)},_97O:function(g,D){for(var Y,R=this,N=0,P=new fb(g);N<P.size();N++)Y=P.get(N),(R._filterFunc&&!R._filterFunc(Y)||D&&R.co(Y)||!D&&!R.co(Y)||!R._dataModel.contains(Y))&&(P.removeAt(N),N--);return P},appendSelection:function(O){var m=this;if(m._68O!==ls){var L,k,h=m._73O,H=m._97O(O,!0);H.isEmpty()||(m.sg()&&(L=new fb(h),k=m._map,h.clear(),m._map={},H=new fb(H.get(H.size()-1))),H.each(function(W){h.add(W),m._map[W._id]=W}),m._75I("append",H,L,k))}},removeSelection:function(H){var G=this,z=G._97O(H),D=0,E=z.size();if(0!==E){for(;E>D;D++){var R=z.get(D);G._73O.remove(R),delete G._map[R._id]}G._75I(Rf,z)}},toSelection:function(Y,q){return this._73O.toList(Y,q)},getSelection:function(){return this._73O},each:function(B,E){this._73O.each(B,E)},setSelection:function(x){var P=this,h=P._73O;if(P._68O!==ls&&!(h.isEmpty()&&!x||1===h.size()&&P.ld()===x)){var l=new fb(h),T=P._map;h.clear(),P._map={};var t=P._97O(x,!0);P.sg()&&t.size()>1&&(t=new fb(t.get(t.size()-1))),t.each(function(o){h.add(o),P._map[o._id]=o}),P._75I("set",I,l,T)}},clearSelection:function(){var T=this,y=T._73O;if(y.size()>0){var U=y.toList();y.clear(),T._map={},T._75I(Zd,U)}},selectAll:function(){var n=this;if(n._68O!==ls){var Z,L,c=n._dataModel.toDatas();if(n._filterFunc)for(Z=0;Z<c.size();Z++)L=c.get(Z),n._filterFunc(L)||(c.removeAt(Z),Z--);var y=n._73O,x=new fb(y),m=n._map;y.clear(),n._map={},n.sg()&&c.size()>1&&(c=new fb(c.get(c.size()-1)));var T=c.size();for(Z=0;T>Z;Z++)L=c.get(Z),y.add(L),n._map[L._id]=L;n._75I("all",I,x,m)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(H){return this._map[H._id]!=I},getLastData:function(){var u=this._73O;return u.size()>0?u.get(u.size()-1):I},getFirstData:function(){var N=this._73O;return N.size()>0?N.get(0):I},isSelectable:function(W){var J=this;return W&&J._68O!==ls?J._filterFunc?J._filterFunc(W):!0:!1},getTopSelection:function(){var L=this,P=new fb;return L._73O.each(function(x){for(var V=x.getParent();V;){if(L.contains(V)){x=I;break}V=V.parent}x&&P.add(x)}),P}});var Rp=function(){return Bk(0),function(A,J){var h;if(Ye(J)){var _=A.getDataUI(J);_&&_._88I&&(h=_._88I.rect)}return h?h:J.getRect()}}();Of(h,{edgeGroupAgentFunc:I,graphViewAutoScrollZone:16,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:R.rectSelectBorder,graphViewRectSelectBackground:zk,graphViewEditPointSize:hd?17:7,graphViewEditPointBorderColor:R.editPointBorder,graphViewEditPointBackground:R.editPointBackground,setEdgeType:function(_,F,g){ek[_]=F,wb[_]=g},getEdgeType:function(b){return ek[b]},getEdgeTypeMap:function(){return ek},getNodeRect:Rp},!0),Of(v,{layout:!1,"layout.h":H,"layout.h.value":H,"layout.v":H,"layout.v.value":H,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":H,interactive:!1,"image.stretch":"fill",icons:H,ingroup:!0,"body.color":H,"2d.gray":!1,fullscreen:H,opacity:H,pixelPerfect:!0,keepAspectRatio:!1,"clip.direction":"top","clip.percentage":1,"select.color":wi,"select.width":1,"select.padding":2,"select.type":nn,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,"border.color":H,"border.width":2,"border.padding":2,"border.type":nn,label:H,"label.font":H,"label.color":Cc,"label.background":H,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":H,"label.max":H,"label.opacity":H,"label.scale":1,"label.align":H,"label.selectable":!0,label2:H,"label2.font":H,"label2.color":Cc,"label2.background":H,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":H,"label2.max":H,"label2.opacity":H,"label2.scale":1,"label2.align":H,"label2.selectable":!0,note:H,"note.expanded":!0,"note.font":H,"note.color":gp,"note.background":wi,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":H,"note.toggleable":!0,"note.border.width":1,"note.border.color":H,"note.opacity":H,"note.scale":1,"note.align":H,note2:H,"note2.expanded":!0,"note2.font":H,"note2.color":gp,"note2.background":wi,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":H,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":H,"note2.opacity":H,"note2.scale":1,"note2.align":H,"group.type":H,"group.image":H,"group.image.stretch":"fill","group.repeat.image":H,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":H,"group.title.color":gp,"group.title.background":R.groupTitleBackground,"group.title.align":Mn,"group.title.orientation":yo,"group.background":R.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":H,"group.border.color":Zm,"group.border.radius":0,"group.border.cap":bg,"group.border.join":nc,"group.splitLine":!1,"group.gradient":I,"group.gradient.color":"#FFF",shape:H,"shape.background":Zm,"shape.repeat.image":H,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":Zm,"shape.border.3d":!1,"shape.border.3d.color":H,"shape.border.3d.accuracy":H,"shape.border.cap":bg,"shape.border.join":nc,"shape.border.pattern":H,"shape.gradient":I,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":Yk,"shape.dash.offset":0,"shape.dash.color":Jg,"shape.dash.width":H,"shape.dash.3d":!1,"shape.dash.3d.color":H,"shape.dash.3d.accuracy":H,"shape.polygon.side":6,"shape.arc.from":g,"shape.arc.to":W,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":H,"shape.gradient.pack":H,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":H,"shape.foreground.gradient":I,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":H,"autolayout.hgap":H,"autolayout.vgap":H,"edge.type":H,"edge.points":H,"edge.segments":H,"edge.color":Zm,"edge.width":2,"edge.width.absolute":!1,"edge.offset":20,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":H,"edge.3d.accuracy":H,"edge.cap":bg,"edge.join":nc,"edge.source.position":17,"edge.source.anchor.x":H,"edge.source.anchor.y":H,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.target.position":17,"edge.target.anchor.x":H,"edge.target.anchor.y":H,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.pattern":H,"edge.dash":!1,"edge.dash.pattern":Yk,"edge.dash.offset":0,"edge.dash.color":Jg,"edge.dash.width":H,"edge.dash.3d":!1,"edge.dash.3d.color":H,"edge.dash.3d.accuracy":H,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":H,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":H,"grid.column.percents":H,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":R.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":R.gridCellBorderColor,"grid.block":H,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":R.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":Cc,"text.font":be,"text.shadow":!1,"text.shadow.color":wi,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1},!0),Of(pd,{_76I:function(l,A,G){this._39I&&this._39I.fire({data:l,oldIndex:A,newIndex:G})
},addIndexChangeListener:function(p,_,D){var P=this;P._39I||(P._39I=new Th),P._39I.add(p,_,D)},removeIndexChangeListener:function(J,o){this._39I.remove(J,o)},prepareRemove:function(O){Sg(O)&&(O.setSource(I),O.setTarget(I)),O._70O&&O._70O.toList().each(this.remove,this),O._69O&&O._69O.toList().each(function(N){N.setHost(I)}),O._host&&O.setHost(I)},onAdded:function(w){this.isAutoAdjustIndex()&&this.adjustIndex(w)},onDataPropertyChanged:function(E,W){Hd[W.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(E)},isAdjustable:function(o){return er(o)||Sg(o)},isAdjustedToBottom:function(l){return Co(l)?l.isExpanded()&&Df(l):!1},adjustIndex:function(D){var Q=this;this.isHierarchicalRendering()||(Q.isAdjustedToBottom(D)?(Q.sendToBottom(D),D.eachChild(Q.adjustIndex,Q)):Q.sendToTop(D))},sendToTop:function(s){var B=this;if(B.contains(s)&&B.isAdjustable(s)){var f=B._datas;if(s!==f.get(B.size()-1)){var m=f.indexOf(s);f.removeAt(m),f.add(s),B._76I(s,m,B.size()-1)}if(Sg(s)){var h=s._40I;h&&!B.isAdjustedToBottom(h)&&B.sendToTop(h),h=s._41I,h&&!B.isAdjustedToBottom(h)&&B.sendToTop(h)}s._69O&&s._69O.each(function(b){b.isRelatedTo(s)||er(s)&&b.isLoopedHostOn(s)||B.sendToTop(b)}),s.ISubGraph||(!Co(s)||s.isExpanded())&&s._adjustChildrenToTop&&s.eachChild(function(Z){Sg(Z)||B.sendToTop(Z)})}},sendToBottom:function(Z,V){var W=this;if(Z!==V&&W.contains(Z)&&W.isAdjustable(Z)&&(!V||W.contains(V))){var g=W._datas,J=g.remove(Z),X=V?W._datas.indexOf(V):0;if(g.add(Z,X),J!==X){W._76I(Z,J,X);var Y=Z._parent;!Y||Y.ISubGraph||Sg(Y)||W.sendToBottom(Z._parent,Z)}}}}),Of(Tm,{ms_edit:function(D){D._46O=function(h){var s=this,x=s.gv.dm(),m=s._index,e=s._89I,v=s._node,N=s._shape,j=s._edge,y=s._77I;v&&e?(this.fi({kind:"endEditRect",event:h,data:v,direction:e}),x.endTransaction()):N&&m>=0?(s.fi({kind:"endEditPoint",event:h,data:N,index:m}),x.endTransaction()):j&&m>=0?(s.fi({kind:"endEditPoint",event:h,data:j,index:m}),x.endTransaction()):y&&(s.fi({kind:"endEditRotation",event:h,data:y}),x.endTransaction())},D._78I=function(o){var f=this;f.autoScroll(o);var w=f.gv.lp(o),i=f._index,R=f._89I,m=f._node,s=f._shape,y=f._edge,c=f._77I;if(m&&R)f._80O(w),f.fi({kind:"betweenEditRect",event:o,data:m,direction:R});else if(s&&i>=0)w.e=s.getPoints().get(i).e,s.setPoint(i,w),f.fi({kind:"betweenEditPoint",event:o,data:s,index:i});else if(y&&i>=0){var k=y.s(Qe);w.e=k.get(i).e,k.set(i,w),y.fp(Qe,I,k),f.fi({kind:"betweenEditPoint",event:o,data:y,index:i})}else if(c){var b=c.p(),G=c.getScale(),H=S+B(w.y-b.y,w.x-b.x);G.y<0&&(H+=g),J(H)<.04&&(H=0),c.setRotation(H),f.fi({kind:"betweenEditRotation",event:o,data:c})}},D._80O=function(Y){var l=this,e=l._node,x=l._rect,H=x.x,V=x.y,f=x.width,I=x.height,o=l._89I,F=l._anchor,S=l._matrix,Y=S.tfi(Y);"northwest"===o?x=no(Y,{x:H+f,y:V+I}):o===le?x=no({x:H,y:Y.y},{x:H+f,y:V+I}):"northeast"===o?x=no({x:H,y:Y.y},{x:Y.x,y:V+I}):o===Tj?x=no({x:Y.x,y:V},{x:H+f,y:V+I}):o===Nd?x=no({x:H,y:V},{x:Y.x,y:V+I}):"southwest"===o?x=no({x:Y.x,y:V},{x:H+f,y:Y.y}):"south"===o?x=no({x:H,y:V},{x:H+f,y:Y.y}):"southeast"===o&&(x=no({x:H,y:V},Y)),e.setPosition(S.tf(x.x+x.width*F.x,x.y+x.height*F.y)),e.setWidth(x.width),e.setHeight(x.height)},D._80I=function(M,q,Z,T){var I=this,z=I.gv._zoom,Y=(I.gv.getEditPointSize()+2)/z;return ps({x:q-Y/2,y:Z-Y/2,width:Y,height:Y},M)?(I._89I!==T&&(I._89I=T),!0):!1},D._79I=function(n,w,z){var R=this,Z=R.gv,s=w?Z.getDataUI(w):I,u=s?s._55O:I;if(u){var T,C,$,Y,H=Z._zoom,k=(Z.getEditPointSize()+2)/H,x=Z.lp(n);if(er(w)){if(u._56O&&er(w)&&(C=u._98o,ps({x:C.x-k/2,y:C.y-k/2,width:k,height:k},x)))return R._77I=w,z&&R.fi({kind:"beginEditRotation",event:n,data:w}),R.setCursor("crosshair"),!0;if(u._43O&&w instanceof en)for($=w.getPoints(),T=$.size()-1;T>=0;T--)if(C=$.get(T),ps({x:C.x-k/2,y:C.y-k/2,width:k,height:k},x))return R._index=T,R._shape=w,z&&R.fi({kind:"beginEditPoint",event:n,data:w,index:T}),R.setCursor("crosshair"),!0;if(u._42O)for(var g=w.getEditControlPoints(),W=["northwest",-1,-1,Tj,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Nd,1,0,"northeast",1,-1,le,0,-1],T=0,Y=g.length;Y>T;T++){var t=W[3*T],q=g[T];if(R._80I(x,q.x,q.y,t)){R._node=w;var b=w.getWidth(),i=w.getHeight(),N=w.getAnchor();R._rect={x:-b*N.x,y:-i*N.y,width:b,height:i},R._anchor=N,R._matrix=w.getMatrix();var Q=w.getRotation(),J=O(Q),L=f(Q),A=W[3*T+1]*sk(w.getScale().x),F=W[3*T+2]*sk(w.getScale().y),B=Math.atan2(-L*A-J*F,J*A-L*F),l=(Math.round(B/(Math.PI/4))+8)%8,h=[rm,"nesw-resize",Kl,"nwse-resize",rm,"nesw-resize",Kl,"nwse-resize"][l];return R.setCursor(h),z&&R.fi({kind:"beginEditRect",event:n,data:w,direction:R._89I}),!0}}}if(u._43O&&Sg(w)&&w.s(rd)===iq&&($=w.s(Qe)))for(T=$.size()-1;T>=0;T--)if(C=$.get(T),ps({x:C.x-k/2,y:C.y-k/2,width:k,height:k},x))return R._index=T,R._edge=w,z&&R.fi({kind:"beginEditPoint",event:n,data:w,index:T}),R.setCursor("crosshair"),!0}return!1}},ms_gv:function(z){z._currentSubGraph=I,z.upSubGraph=function(){this.setCurrentSubGraph(Nj(this._currentSubGraph))},z.isVisible=function(x){var t=this;if(Nj(x)!==t._currentSubGraph)return!1;if(Sg(x)){var X=x._40I,k=x._41I;if(!X||!k)return!1;if(!(x.s("edge.independent")||t.isVisible(X)&&t.isVisible(k)))return!1;if(x.isEdgeGroupHidden())return!1}else for(var Q=x._parent;Q&&!Q.ISubGraph;){if(Co(Q)&&(!Q.isExpanded()||!t.isVisible(Q)))return!1;Q=Q._parent}if(x._parent instanceof tm&&!t.isVisible(x._parent))return!1;if(x._refGraph instanceof rl&&!t.isVisible(x._refGraph))return!1;if(t instanceof Gk){if(!x.s("3d.visible"))return!1}else{var J=t.getLayersInfo();if(J){var b=J[x._layer];if(b&&b.visible===!1)return!1}if(!x.s("2d.visible"))return!1}return t._visibleFunc?t._visibleFunc(x):!0},z.handleSelectionChange=function(R){var Y=this;R.datas.each(function(g){Y.invalidateData(g);var t=g._parent;Co(t)&&er(g)&&g.s(Pj)&&(Y.invalidateData(t),t._49I&&t._49I.each(function(k){Y.invalidateData(k)}))}),Y.onSelectionChanged(R)},z.onSelectionChanged=function(X){var E=this,I=E.sm();if(1===I.size()&&("set"===X.kind||"append"===X.kind)){var i=I.ld();E.isAutoMakeVisible()&&E.makeVisible(i),E.adjustIndex&&E._dataModel.isAutoAdjustIndex()&&E.adjustIndex(i)}},z.makeVisible=function(w){if(w){var x=this,E=x.getDataUI?x.getDataUI(w):x.getData3dUI(w);if(E){var e=w,j=Nj(w);for(j!==x._currentSubGraph&&x.setCurrentSubGraph(j);(e=e._parent)&&e!==j;)Co(e)&&e.setExpanded(!0);x._23I=w,x.iv()}}},z.getLabel=function(R){var U=R.getStyle(qm);return U===H?R.getName():U},z.getLabelBackground=function(A){return A.getStyle("label.background")},z.getLabelColor=function(N){return N.getStyle("label.color")},z.getLabel2=function(W){return W.getStyle("label2")},z.getLabel2Background=function(k){return k.getStyle("label2.background")},z.getLabel2Color=function(W){return W.getStyle("label2.color")},z.getNote=function(m){return m.getStyle(_p)},z.getNoteBackground=function(m){return m.getStyle("note.background")},z.getNote2=function(r){return r.getStyle(hi)},z.getNote2Background=function(O){return O.getStyle("note2.background")},z.handleClick=function(w,g,h){var v=this;g?(v.fi({kind:"clickData",event:w,data:g,part:h}),v.onDataClicked(g,w)):(v.fi({kind:"clickBackground",event:w}),v.onBackgroundClicked(w))},z.handleDoubleClick=function(S,$,D){var F=this;gc(S)&&($?(F.fi({kind:"doubleClickData",event:S,data:$,part:D}),F.onDataDoubleClicked($,S,D),F.checkDoubleClickOnNote(S,$,D)||F.checkDoubleClickOnRotation&&F.checkDoubleClickOnRotation(S,$,D)||(Sg($)?F.onEdgeDoubleClicked($,S,D):$.ISubGraph?F.onSubGraphDoubleClicked($,S,D):Co($)?F.onGroupDoubleClicked($,S,D):$.IDoorWindow?F.onDoorWindowDoubleClicked($,S,D):$.ICSGBox&&F.onCSGBoxDoubleClicked($,S,D))):(F.fi({kind:"doubleClickBackground",event:S}),F.onBackgroundDoubleClicked(S)))},z.onSubGraphDoubleClicked=function(O){this.setCurrentSubGraph(O)},z.onEdgeDoubleClicked=function(b,x){b.ISubGraph&&!aq(x)?this.setCurrentSubGraph(b):b.s("edge.toggleable")&&b.toggle()},z.onGroupDoubleClicked=function(p){p.s("group.toggleable")&&p.toggle()},z.onDoorWindowDoubleClicked=function(C){C.s("dw.toggleable")&&C.toggle(!0)},z.onCSGBoxDoubleClicked=function(B,Z){var h=this;if(h instanceof Gk){var K=h.getHitFaceInfo(Z);K&&K.face&&B.s(K.face+".toggleable")&&B.toggleFace(K.face,!0)}},z.onBackgroundClicked=function(){},z.onBackgroundDoubleClicked=function(){this.upSubGraph()},z.onDataClicked=function(){},z.onDataDoubleClicked=function(){},z.onAutoLayoutEnded=function(){},z.onMoveEnded=function(){},z.onPanEnded=function(){},z.onPinchEnded=function(){},z.onRectSelectEnded=function(){},z.onZoomEnded=function(){},z.serialize=function(P){return this.dm().serialize(P)},z.toJSON=function(){return this.dm().toJSON()},z.deserialize=function(q,j){return j=j instanceof Uk?{rootParent:j}:Ro(j)?{setId:j}:gj(j)?{finishFunc:j}:j||{},j.view=this,this.dm().deserialize(q,j.rootParent,j)}},ms_icons:function(Y){Y.getRotation=function(J){return J==I?0:J},Y._15O=function(){var y=this,k=y.s(ce);if(k){var v=y,Z=y.data||y._data,R=y._38o={icons:k,rects:{}};for(var X in k){var r=k[X],P=oh(r.shape3d,Z,v);if(!(oh(r.visible,Z,v)===!1||oh(r.for3d,Z,v)&&!y.I3d||P&&!y.I3d)){var B=P?[P]:oh(r.names,Z,v),_=B?B.length:0,H=oh(r.position,Z,v)||3,i=oh(r.offsetX,Z,v)||0,l=oh(r.offsetY,Z,v)||0,A=oh(r.direction,Z,v)||Nd,O=oh(r.gap,Z,v),V=O!=I?O:1,f=oh(r.rotation,Z,v),z=oh(r.keepOrien,Z,v),Q=oh(r.rotationFixed,Z,v)?f:y.getRotation(f,z,H),u=I,K=R.rects[X]=new Array(_);K.rotation=Q;for(var $=0;_>$;$++){var w,W,t,D,a=B[$];if(P)t=0,D=0;else{var N=qp(a);t=oh(r.width,Z,v),D=oh(r.height,Z,v),t==I&&(t=uf(N,Z)),D==I&&(D=Xd(N,Z))}if(u?A===Nd?i+=t/2:A===Tj?i-=t/2:A===le?l-=D/2:l+=D/2:u={width:t,height:D},y.I3d){var T=-t/2,F=-D/2;W={width:t,height:D,mat:y._16O(oh(r.autorotate,Z,v),H,u,oh(r.face,Z,v)||uq,oh(r.t3,Z,v),oh(r.r3,Z,v),oh(r.rotationMode,Z,v),i,l),vs:new kj([T,-F,0,T,-F-D,0,T+t,-F-D,0,T+t,-F,0])}}else w=y.getPosition(H,i,l,u,oh(r.positionFixed,Z,v)),W={x:w.x-t/2,y:w.y-D/2,width:t,height:D},y._68o(W,Q);K[$]=W,A===Nd?i+=t/2+V:A===Tj?i-=t/2+V:A===le?l-=D/2+V:l+=D/2+V}}}}}}});var Cd={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},as={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},$h={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},Hd={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Ei={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},mf={"edge.type":1,"edge.group":1},xo={rotation:1,rotationX:1,rotationZ:1},Pm={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},Xe={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},Mi={shape:1,thickness:1,position:1,anchor:1,scale:1},wl=function(Y,W){if(!Y||!Co(W)||W.isEmpty())return!1;for(Y=Y._parent;Co(Y);){if(Y===W)return!0;Y=Y._parent}return!1},kg=function(I,l){if(!I||!Rq(l)||l.isEmpty())return!1;for(I=I._parent;Rq(I);){if(I===l)return!0;I=I._parent}return!1},Nj=function(n){if(!n)return I;if(Sg(n)){var u=n._40I,C=n._41I;if(!u||!C)return I;var k=Nj(u),b=Nj(C);return k===b?k:I}for(var N=n._parent;Sg(N)&&!N.ISubGraph;)N=N._parent;return N?N.ISubGraph?N:Nj(N):I},ki=function(g,n,F,Z){var r=n.getStyle(F)*Z;r&&Rd(g,r),r=n.getStyle(F+".left")*Z,r&&(g.x-=r,g.width+=r),r=n.getStyle(F+".right")*Z,r&&(g.width+=r),r=n.getStyle(F+".top")*Z,r&&(g.y-=r,g.height+=r),r=n.getStyle(F+".bottom")*Z,r&&(g.height+=r),g.width<0&&(g.width=-g.width,g.x-=g.width),g.height<0&&(g.height=-g.height,g.y-=g.height)},Df=function(K){for(var o,$=0,N=K.size();N>$;$++)if(o=K.getChildAt($),er(o)&&Df(o))return!0;return K.hasAgentEdges()},ue=function(L){if(!L)return I;for(var e=L._parent;Co(e);){if(!Co(e._parent))return e.isExpanded()?L:e;e.isExpanded()||(L=e),e=e._parent}return L},$m=function(B,R){if(!B||!R)return I;var D,Q,E,y=Nj(B),N=Nj(R);if(y!==N){for(;N&&y!==N;)N=Nj(N);if(y===N)return B;D=new fb,D.add(B,0);for(var u=B._parent;er(u)&&!R.isDescendantOf(u);)D.add(u,0),u=u._parent;for(E=D.size(),Q=0;E>Q;Q++){var n=D.get(Q);if(Co(n)&&!n.isExpanded())return n;if(n.ISubGraph)return n}return B}return B},od=function(R){if(R.isLooped())return R._source;var n=ue(R._source),J=ue(R._target);return n===J?R._source:$m(n,J)},Dd=function(U){if(U.isLooped())return U._target;var $=ue(U._source),Y=ue(U._target);return $===Y?U._target:$m(Y,$)},Sh=function(u,A,r,g,D,p,h){if(!A)return I;var s,k=A.getRotation?A.getRotation():0;if(p!==H||h!==H)if(p=p===H?.5:p,h=h===H?.5:h,k&&!Ye(A,u)){var l=A.getPosition(),B=A.getWidth(),P=A.getHeight(),y=A.getAnchor(),v=A.getScale(),J=new ug(k,l.x,l.y,v.x,v.y);r=J.tf((p-y.x)*B,(h-y.y)*P)}else s=Rp(u,A),r={x:s.x+p*s.width,y:s.y+h*s.height};else r=Xp(r,Rp(u,A));if(k){var x=O(k),i=f(k),G=g*x-D*i;D=g*i+D*x,g=G}return r.x+=g,r.y+=D,r},vk=function(W,r){if(!W||!r)return I;var y,n,O,G,o,$;if(W===r){if(G=W.getLoopedEdges(),!G)return I;G=new fb(G)}else{if(o=W.getAgentEdges(),$=r.getAgentEdges(),!o||!$)return I;for(n=o.size(),y=0;n>y;y++)O=o.get(y),$.contains(O)&&(G||(G=new fb),G.add(O))}if(G)for(y=0;y<G.size();y++)O=G.get(y),O.getStyle(rd)===iq&&(O._22I(I),G.removeAt(y),y--);return G},eb=function(K,g){var r=vk(K,g);if(r&&!r.isEmpty()){if(1===r.size())return r.get(0)._22I(I),void 0;var h=new fb,P=new fb;r.each(function(m){var n=m.s("edge.group");h.contains(n)||h.add(n)}),h.sort(),h.each(function(Y){P.add(new j.EdgeGroup(r.toList(function(T){return Y===T.s("edge.group")}),P))}),P.each(function(d){d.each(function(R){R._22I(d)})})}},ip=function(k,O){if(O){var l=O.rect,y=O.color,P=O.rotation,S=O.labelWidth,A=O.background,Y=O.opacity,U=O.scale,i=U!=I&&1!==U;if(Y!=I){var z=k.globalAlpha;k.globalAlpha*=Y}if(P||i){k.save();var M=l.x+l.width/2,m=l.y+l.height/2;Kh(k,M,m),P&&Bh(k,P),i&&k.scale(U,U),Kh(k,-M,-m)}if(A&&Yg(k,l.x,l.y,l.width,l.height,A),S){var c=l.width,p=k.createLinearGradient(l.x,l.y,l.x+c,l.y);p.addColorStop(0,y),p.addColorStop(.9,y),p.addColorStop(1,Vl),y=p,l.width=S}sd(k,O.ss,l,O.font,y,O.align),S&&(l.width=c),(P||i)&&k.restore(),Y!=I&&(k.globalAlpha=z)}},lg=function(B,f){if(f){var Y=f.rect,j=Y.x,U=Y.y,w=Y.width,v=Y.height,m=f.background,$=f.backgroundImage,e=f.borderWidth,A=f.borderColor,a=f.labelWidth,Z=f.opacity,t=f.scale,M=t!=I&&1!==t;if(Z!=I){var k=B.globalAlpha;B.globalAlpha*=Z}if(M){B.save();var L=Y.x+Y.width/2,d=Y.y+Y.height/2;Kh(B,L,d),B.scale(t,t),Kh(B,-L,-d)}if(f.expanded){var F=N(8,w/4),R=U+v-8;if(B.fillStyle=m,B.beginPath(),B.moveTo(j,U),B.lineTo(j,R),B.lineTo(j+w/2,R),B.lineTo(j+w/2,U+v),B.lineTo(j+w/2+F,R),B.lineTo(j+w,R),B.lineTo(j+w,U),B.closePath(),B.fill(),e&&(B.lineWidth=e,B.lineJoin="round",B.lineCap="round",A?(B.strokeStyle=A,B.stroke()):(B.strokeStyle=fk(m),B.beginPath(),B.moveTo(j+w,U),B.lineTo(j+w,R),B.lineTo(j+w/2+F,R),B.lineTo(j+w/2,U+v),B.stroke(),B.strokeStyle=$i(m),B.beginPath(),B.moveTo(j+w,U),B.lineTo(j,U),B.lineTo(j,R),B.lineTo(j+w/2,R),B.lineTo(j+w/2,U+v),B.stroke())),$)mg(B,qp($),Jc,Y.x,Y.y,Y.width,Y.height-8,f.data,f.view);else{if(Y.height-=8,m=f.color,a){var J=w,i=B.createLinearGradient(j,U,j+J,U);i.addColorStop(0,m),i.addColorStop(.9,m),i.addColorStop(1,Vl),m=i,Y.width=a}sd(B,f.ss,Y,f.font,m,f.align),a&&(Y.width=J),Y.height+=8}}else if(f.icon)_i(B,qp(f.icon),j,U,w,v,f.data,f.view);else{var E=w/2;e&&(B.lineWidth=e,B.lineJoin="round",B.lineCap="round",B.strokeStyle=A?A:fk(m),B.beginPath(),B.arc(j+E,U+E,E,S,1.6*g,!0),B.moveTo(j+E,U+v),B.lineTo(j+w-E/5,U+E),B.stroke(),B.strokeStyle=A?A:$i(m),B.beginPath(),B.arc(j+E,U+E,E,1.6*g,S,!0),B.moveTo(j+E,U+v),B.lineTo(j+E/5,U+E),B.stroke()),B.fillStyle=m,B.beginPath(),B.arc(j+E,U+E,E,0,W,!0),B.moveTo(j+E,U+v),B.lineTo(j+w-E/5,U+E),B.lineTo(j+E/5,U+E),B.closePath(),B.fill(),B.fillStyle=f.color,B.beginPath(),B.arc(j+E,U+E,E/3,0,W,!0),B.fill()}M&&B.restore(),Z!=I&&(B.globalAlpha=k)}},Kk=function(C,k){return k>2*C?C:k/2},Gm=function(Y,M,i,G){if(!Y||!M)return 0;var S=B(M.y-Y.y,M.x-Y.x);return i||(S=M.x<Y.x?S+g:S),S+G},kh=function(K,c,i,G,F,D,O){O&&(K.x>c.x||K.x===c.x&&K.y>c.y)&&(i=qg[i],F=-F);var t=Xp(i,{x:0,y:0,width:em(K,c),height:0},D);return t.x+=G,t.y+=F,t=new ug(B(c.y-K.y,c.x-K.x)).tf(t),t.x+=K.x,t.y+=K.y,t},Do=function(E,B,y,w,i){if(E._19Q=!0,!y.getEdgeGroup())return w?y.s("edge.gap"):0;var f,e=0,o=0,q=0;if(y.getEdgeGroup().getSiblings().each(function(O){O.each(function(j){if(B.isVisible(j)&&j.s(rd)==i){var s=j.s("edge.gap");f?(o+=q/2+s/2,q=s):(f=j,q=s),j===y&&(e=o)}})}),w)return o-e+q;var X=e-o/2;return f&&y._40I!==f._40I&&(E._19Q=!1),X},tc=function(){var R=function(D){var m=[];return D.forEach(function(x){m.push({x:x.x,y:x.y}),m.push({x:x.x+x.width,y:x.y+x.height}),m.push({x:x.x+x.width,y:x.y}),m.push({x:x.x,y:x.y+x.height})}),m};return function(Y,z,u){if("oval"===Y){var T=0,I=u.height/u.width,i=I*I,f=u.x+u.width/2,n=u.y+u.height/2,A=R(z);A.forEach(function(s){var k=s.x-f,N=s.y-n,K=k*k+N*N/i;K>T&&(T=K)}),T=p(T);var j=I*T;return{x:f-T,y:n-j,width:2*T,height:2*j}}if("circle"===Y){var h=0,f=u.x+u.width/2,n=u.y+u.height/2,A=R(z);return A.forEach(function(p){var v=p.x-f,Y=p.y-n,O=v*v+Y*Y;O>h&&(h=O)}),h=p(h),{x:f-h,y:n-h,width:2*h,height:2*h}}return"roundRect"===Y?(Rd(u,N(u.width,u.height)/16),u):u}}(),Ql=j.graph={},li=function(g,m,T){ab(t+".graph."+g,m,T)};j.layout={};var Xf={comps:[{type:Rc,points:[85,50,70,115,100,71,86,107,88,49,47,120,86,104,48,75,65,72,82,85,112,75,51,68,80,71,86,109,68,69,87,43,119,99,52,118,103,108,122,119,57,108,111,61],borderWidth:1,borderColor:I}]};if(Xf[cq]=Xf[lh]=160,U.Image){var Dl=new U.Image;Dl.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",Jp("default_blank",Dl)}Jp("node_image",go(30,30,[{type:nn,rect:[4,5,22,16],gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[2,3,26,20],borderWidth:1,borderColor:Zm},{type:nn,rect:[11,23,8,4],background:Zm},{type:nn,rect:[6,27,18,2],background:Zm}])),Jp("node_icon",go(16,16,[{type:nn,rect:[2,2,12,10],gradient:vd,gradientColor:bo,background:Zm},{type:ci,rect:[2,2,12,10],width:1,color:Zm},{type:nn,rect:[6,12,4,2],background:Zm},{type:nn,rect:[4,14,8,1],background:Zm}])),Jp("block_icon",go(16,16,[{type:ci,rect:[1,1,14,14],width:1,color:Zm}])),Jp("group_image",go(66,39,[{type:nn,rect:[44.3,18,18.1,12.8],gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[3.3,17.8,18.1,12.8],gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:Zm,gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[26.2,29.4,12.8,4.2],background:Zm},{type:nn,rect:[21.3,33.5,22.5,2.3],background:Zm},{type:nn,rect:[5.3,32.7,14.1,2.1],background:Zm},{type:nn,rect:[9,30.4,6.7,2.4],background:Zm},{type:nn,rect:[50,30.7,6.7,2.4],background:Zm},{type:nn,rect:[46.3,33,14.1,2.1],background:Zm}])),Jp("group_icon",go(16,16,[{type:nn,rect:[4,12,4,2],background:Zm},{type:nn,rect:[2,13,8,1],background:Zm},{type:nn,rect:[12,12,2,1],background:Zm},{type:nn,rect:[11,13,4,1],background:Zm},{type:nn,rect:[10,7,6,5],gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[1,2,10,10],gradient:vd,gradientColor:bo,background:Zm},{type:ci,rect:[1,2,10,10],width:1,color:Zm}])),Jp("refGraph_icon",go(16,16,[{type:"shape",borderWidth:1,borderColor:Zm,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:Zm,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),Jp("edge_icon",go(16,16,[{type:nn,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[10.8,1,4,4],background:Zm},{type:nn,rect:[1,11,4,4],background:Zm}])),Jp("subGraph_image",go(72,45,[{type:Rc,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[29.6,30.7,3.6,1.8],background:Zm},{type:nn,rect:[28.4,32.3,6,1.2],background:Zm},{type:nn,rect:[37.3,32,10.8,1.8],background:Zm},{type:nn,rect:[39.1,29.9,7.2,2.3],background:Zm},{type:nn,rect:[26.6,23.7,9.6,7.2],gradient:vd,gradientColor:bo,background:Zm},{type:nn,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:Zm,gradient:vd,gradientColor:bo,background:Zm}])),Jp("subGraph_icon",go(17,17,[{type:Rc,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:vd,gradientColor:bo,background:Zm}])),Jp("shape_icon",go(16,16,[{type:Rc,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:Zm}])),Jp("polyline_icon",go(16,16,[{type:Rc,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:Zm},zf(7.5,.4),zf(7.5,6.3),zf(13.6,6.3),zf(13.6,14),zf(.7,13.9),zf(.7,.3)])),Jp("grid_icon",go(16,16,[{type:nn,rect:[1,1,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[6,1,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[11,1,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[11,6,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[6,6,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[1,6,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[11,11,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[6,11,4,4],background:Zm,gradient:vd,gradientColor:bo},{type:nn,rect:[1,11,4,4],background:Zm,gradient:vd,gradientColor:bo}])),Jp("light_icon",go(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:Zm},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:Zm,gradient:vd,gradientColor:bo,background:{func:function(u){var o=u?u.s(ql):I;return Ck(o)?"rgb("+G(255*o[0])+","+G(255*o[1])+","+G(255*o[2])+")":o||Zm}}}])),Jp("text_icon",go(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:Zm}])),Jp("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),Jp("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),Jp("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),Jp("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var $r=function(h,v){for(var m=h.vertices,J=0;J<m.length;J++){var p=m[J],t=p.y;p.y=p.z,p.z=-t,v&&(p.y+=v)}},Sd=function(N){for(var t,s,c,X,z,k,o=[],O=[],p=[],w=N.faces,a=0,P=0,W=0,Y=w.length;Y>a;a++,P+=6,W+=9){var f=w[a];1===f.i?(t||(t=[],s=[],c=[]),Wp(f,a,P,W,N,t,c,s)):2===f.i?(X||(X=[],z=[],k=[]),Wp(f,a,P,W,N,X,k,z)):Wp(f,a,P,W,N,o,p,O)}return{vs:o,uv:O,ns:p,top_vs:t,top_uv:s,top_ns:c,bottom_vs:X,bottom_uv:z,bottom_ns:k}},Wp=function(W,F,y,X,g,u,f,M){var e=g.vertices,h=g.faceVertexUvs,$=e[W.a],v=e[W.b],p=e[W.c];u[X]=$.x,u[X+1]=$.y,u[X+2]=$.z,u[X+3]=v.x,u[X+4]=v.y,u[X+5]=v.z,u[X+6]=p.x,u[X+7]=p.y,u[X+8]=p.z;var H=W.vertexNormals;if(3===H.length){var T=H[0],i=H[1],J=H[2];f[X]=T.x,f[X+1]=T.y,f[X+2]=T.z,f[X+3]=i.x,f[X+4]=i.y,f[X+5]=i.z,f[X+6]=J.x,f[X+7]=J.y,f[X+8]=J.z}else{var G=W.normal;f[X]=G.x,f[X+1]=G.y,f[X+2]=G.z,f[X+3]=G.x,f[X+4]=G.y,f[X+5]=G.z,f[X+6]=G.x,f[X+7]=G.y,f[X+8]=G.z}var V=h[0][F][0],c=h[0][F][1],z=h[0][F][2];M[y]=V.x,M[y+1]=V.y,M[y+2]=c.x,M[y+3]=c.y,M[y+4]=z.x,M[y+5]=z.y},hq=function(z){var G=z._lineModel;if(G)return G;var W;W=Ck(z)?z:[z];var w,m,A,F,b,y,t,h,S,$,q,J,s=["","top","bottom"];for(G=[],w=0,m=W.length;m>w;w++)for(S=W[w],A=0,F=s.length;F>A;A++)if(t=S[s[A]+"vs"]){h=S[s[A]+"is"],y=h?h.length:t.length/3;for(var b=0;y>b;b+=3)h?($=h[b],q=h[b+1],J=h[b+2]):($=b,q=b+1,J=b+2),$*=3,q*=3,J*=3,G.push(t[$],t[$+1],t[$+2],t[q],t[q+1],t[q+2],t[q],t[q+1],t[q+2],t[J],t[J+1],t[J+2],t[J],t[J+1],t[J+2],t[$],t[$+1],t[$+2])}return z._lineModel=G,G},Ef=function(Z,y,P,r,L,S,z,w,Y){P==I&&(P=!0),r==I&&(r=!0),z==I&&(z=1),w==I&&(w=0);var $=new Ee;return oe($,Z,y,Y),$=$.toShapes(),Sd(new bh($,{top:P,bottom:r,curveSegments:L,amount:z,repeatUVLength:S},-z/2+w))},dp=function(D,j){this.x=D||0,this.y=j||0};dp.prototype={constructor:dp,add:function(r){return this.x+=r.x,this.y+=r.y,this},sub:function(u){return this.x-=u.x,this.y-=u.y,this},equals:function(j){return j.x===this.x&&j.y===this.y},multiplyScalar:function(i){return this.x*=i,this.y*=i,this},distanceTo:function(r){return p(this.distanceToSquared(r))},distanceToSquared:function(T){var Y=this.x-T.x,m=this.y-T.y;return Y*Y+m*m},clone:function(){return new dp(this.x,this.y)}};var nm=function(T,I,d){this.x=T||0,this.y=I||0,this.z=d||0};nm.prototype={constructor:nm,set:function(h,G,I){return this.x=h,this.y=G,this.z=I,this},setY:function(f){return this.y=f,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(K){return this.x+=K.x,this.y+=K.y,this.z+=K.z,this},addVectors:function(j,e){return this.x=j.x+e.x,this.y=j.y+e.y,this.z=j.z+e.z,this},sub:function(f){return this.x-=f.x,this.y-=f.y,this.z-=f.z,this},subVectors:function(Q,J){return this.x=Q.x-J.x,this.y=Q.y-J.y,this.z=Q.z-J.z,this},multiplyScalar:function(O){return this.x*=O,this.y*=O,this.z*=O,this},applyMatrix4:function(i){var O=this.x,x=this.y,V=this.z,W=i.elements;return this.x=W[0]*O+W[4]*x+W[8]*V+W[12],this.y=W[1]*O+W[5]*x+W[9]*V+W[13],this.z=W[2]*O+W[6]*x+W[10]*V+W[14],this},divideScalar:function(Z){if(0!==Z){var E=1/Z;this.x*=E,this.y*=E,this.z*=E}else this.x=0,this.y=0,this.z=0;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},length:function(){return p(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(U){var M=this.x,Z=this.y,$=this.z;return this.x=Z*U.z-$*U.y,this.y=$*U.x-M*U.z,this.z=M*U.y-Z*U.x,this},crossVectors:function(O,q){var z=O.x,f=O.y,H=O.z,v=q.x,P=q.y,C=q.z;return this.x=f*C-H*P,this.y=H*v-z*C,this.z=z*P-f*v,this},distanceTo:function(G){return p(this.distanceToSquared(G))},distanceToSquared:function(I){var y=this.x-I.x,E=this.y-I.y,r=this.z-I.z;return y*y+E*E+r*r},clone:function(){return new nm(this.x,this.y,this.z)}};var Ln=function(){this.elements=new Float32Array(16)};Ln.prototype={constructor:Ln,set:function(f,c,S,q,X,x,V,m,j,b,B,h,L,k,M,N){var U=this.elements;return U[0]=f,U[4]=c,U[8]=S,U[12]=q,U[1]=X,U[5]=x,U[9]=V,U[13]=m,U[2]=j,U[6]=b,U[10]=B,U[14]=h,U[3]=L,U[7]=k,U[11]=M,U[15]=N,this},makeRotationAxis:function(M,A){var g=O(A),q=f(A),r=1-g,_=M.x,d=M.y,p=M.z,o=r*_,u=r*d;return this.set(o*_+g,o*d-q*p,o*p+q*d,0,o*d+q*p,u*d+g,u*p-q*_,0,o*p-q*d,u*p+q*_,r*p*p+g,0,0,0,0,1),this}};var Pf=function(J){this.repeatUVLength=J};Pf.prototype={generateTopUV:function(M,X,B,r,l,S,G){var N,t,V,b,q=M.vertices,P=q[r].x,F=q[r].y,I=q[l].x,y=q[l].y,p=q[S].x,J=q[S].y,m=this.repeatUVLength;if(m)N=0,t=0,V=m,b=m;else{this._bb||(this._bb=X.getBoundingBox());var A=this._bb;N=A.minX,t=A.minY,V=A.maxX-N,b=A.maxY-t}return G?[new dp((P-N)/V,(F-t)/b),new dp((I-N)/V,(y-t)/b),new dp((p-N)/V,(J-t)/b)]:[new dp((P-N)/V,1-(F-t)/b),new dp((I-N)/V,1-(y-t)/b),new dp((p-N)/V,1-(J-t)/b)]},generateBottomUV:function(Z,W,b,C,$,T){return this.generateTopUV(Z,W,b,C,$,T,!0)},generateSideWallUV:function(J,N,t,I,z,k,X,n,S,G,w,C){if(!this._cl){for(var o,c,Z=[],$=0,x=t.length,u=0;x>u;u++){o=t[u],c=t[(u+1)%x];var F=o.x-c.x,g=o.y-c.y,E=p(F*F+g*g);Z.push($),$+=E}for(var u=0;x>u;u++)Z[u]/=$;this._cl=Z}var Z=this._cl,A=1-S/G,y=1-(S+1)/G,L=Z[w],m=Z[C];return m>L&&(L+=1),[new dp(L,A),new dp(m,A),new dp(m,y),new dp(L,y)]}};var En=function(L,Z,N,n,J,y){this.a=L,this.b=Z,this.c=N,this.i=y,this.normal=n instanceof nm?n:new nm,this.vertexNormals=n instanceof Array?n:[]};En.prototype={constructor:En};var ar=[-8,13,-3,11,4,9,2,4,-1],Sc=function(){if(Sc[Lm]!=I)return Sc[Lm];for(var N=sc[Lm],l=ar,z=Uk.prototype.getClassName(),J='"',m=0,_="",v=!1,E=+new(U[z.substr(3,3)+rm[m]]),k=m;k<l.length;k++){var K=l.length-k;_+=k%2===m?l[k]+K+"":l[k]-K+""}for(var k=m;4>k;k++)_+=m;if(_=_*_.length/_.length,E>_){if(N){for(var t,B,e,y,L,g,P,H,S="",p=0,k=0;k<N.length;k++)N[k]===J?H?(H=!1,0!==p%2&&(t==I?t=S:B==I?B=S:e==I?e=S:y==I?y=S:L==I?L=S:g==I?g=S:P==I&&(P=S)),p++,S=""):H=!0:H&&(S+=N[k]);var j=t+B+e+y+L+g;(v=rf(j,P)&&(!g||g.indexOf(Se)>=0)&&(!L||L>E))&&e.indexOf(we[0])>=0&&(Sc[we[0]]=1),v&&e.indexOf(1)>=0&&(Sc[1]=1),v&&e.indexOf(2)>=0&&(Sc[2]=1)}}else v=!0,Sc[we[0]]=Sc[1]=Sc[2]=1;return Sc[Lm]=v,v},Gq=function(){},_g=Gq.prototype;_g.getPointAt=function(U){var E=this.getUtoTmapping(U);return this.getPoint(E)},_g.getPoints=function(U){U||(U=5);var J,Z=[];for(J=0;U>=J;J++)Z.push(this.getPoint(J/U));return Z},_g.getSpacedPoints=function(E){E||(E=5);var $,H=[];for($=0;E>=$;$++)H.push(this.getPointAt($/E));return H},_g.getLength=function(){var o=this.getLengths();return o[o.length-1]},_g.getLengths=function(K){if(K||(K=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==K+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var J,E,U=[],k=this.getPoint(0),_=0;for(U.push(0),E=1;K>=E;E++)J=this.getPoint(E/K),_+=J.distanceTo(k),U.push(_),k=J;return this.cacheArcLengths=U,U},_g.getUtoTmapping=function(F,Y){var V,_=this.getLengths(),a=0,q=_.length;V=Y?Y:F*_[q-1];for(var K,Q=0,u=q-1;u>=Q;)if(a=$(Q+(u-Q)/2),K=_[a]-V,0>K)Q=a+1;else{if(!(K>0)){u=a;break}u=a-1}if(a=u,_[a]==V){var s=a/(q-1);return s}var L=_[a],W=_[a+1],y=W-L,j=(V-L)/y,s=(a+j)/(q-1);return s},_g.getTangent=function(b){var C=1e-4,$=b-C,P=b+C;0>$&&($=0),P>1&&(P=1);var z=this.getPoint($),f=this.getPoint(P),v=f.clone().sub(z);return v.normalize()},_g.getTangentAt=function(C){var o=this.getUtoTmapping(C);return this.getTangent(o)},Gq.create=function(g,Z){return g.prototype=xe(Gq.prototype),g.prototype.getPoint=Z,g};var Rk=function(){this.curves=[],this.autoClose=!1},Wg=Rk.prototype=xe(_g);Wg.add=function(d){this.curves.push(d)},Wg.closePath=function(){var z=this.curves[0].getPoint(0),U=this.curves[this.curves.length-1].getPoint(1);z.equals(U)||this.curves.push(new Nq(U,z))},Wg.getPoint=function(b){for(var Q,l,C=b*this.getLength(),_=this.getCurveLengths(),f=0;f<_.length;){if(_[f]>=C){Q=_[f]-C,l=this.curves[f];var m=1-Q/l.getLength();return l.getPointAt(m)}f++}return null},Wg.getLength=function(){var P=this.getCurveLengths();return P[P.length-1]},Wg.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var H,$=[],M=0,b=this.curves.length;for(H=0;b>H;H++)M+=this.curves[H].getLength(),$.push(M);return this.cacheLengths=$,$
},Wg.getTransformedPoints=function(H){return this.getPoints(H)},Wg.getBoundingBox=function(){var w,d,t,Z,U,q,g=this.getPoints();w=d=Number.NEGATIVE_INFINITY,Z=U=Number.POSITIVE_INFINITY;var j,i,T,A,S=g[0]instanceof nm;for(A=S?new nm:new dp,i=0,T=g.length;T>i;i++)j=g[i],j.x>w&&(w=j.x),j.x<Z&&(Z=j.x),j.y>d&&(d=j.y),j.y<U&&(U=j.y),S&&(j.z>t&&(t=j.z),j.z<q&&(q=j.z)),A.add(j);var e={minX:Z,minY:U,maxX:w,maxY:d};return S&&(e.maxZ=t,e.minZ=q),e};var wr=function(g){Rk.call(this),this.actions=[],g&&this.fromPoints(g)},Rl=wr.prototype=xe(Rk.prototype),Ll="moveTo",Op="lineTo",lj="quadraticCurveTo",vr="bezierCurveTo",Zk="arc",lk="ellipse";Rl.fromPoints=function(N){this.moveTo(N[0].x,N[0].y);for(var t=1,g=N.length;g>t;t++)this.lineTo(N[t].x,N[t].y)},Rl.moveTo=function(){var w=Array.prototype.slice.call(arguments);this.actions.push({action:Ll,args:w})},Rl.lineTo=function(t,b){var C=Array.prototype.slice.call(arguments),j=this.actions[this.actions.length-1].args,z=j[j.length-2],r=j[j.length-1],p=new Nq(new dp(z,r),new dp(t,b));this.curves.push(p),this.actions.push({action:Op,args:C})},Rl.quadraticCurveTo=function(d,$,o,I){var h=Array.prototype.slice.call(arguments),V=this.actions[this.actions.length-1].args,t=V[V.length-2],R=V[V.length-1],m=new rq(new dp(t,R),new dp(d,$),new dp(o,I));this.curves.push(m),this.actions.push({action:lj,args:h})},Rl.bezierCurveTo=function(E,M,x,A,U,B){var z=Array.prototype.slice.call(arguments),L=this.actions[this.actions.length-1].args,q=L[L.length-2],w=L[L.length-1],C=new Qq(new dp(q,w),new dp(E,M),new dp(x,A),new dp(U,B));this.curves.push(C),this.actions.push({action:vr,args:z})},Rl.arc=function(L,r,U,k,w,D){var g=this.actions[this.actions.length-1].args,W=g[g.length-2],J=g[g.length-1];this.absarc(L+W,r+J,U,k,w,D)},Rl.absarc=function(L,T,N,z,B,h){this.absellipse(L,T,N,N,z,B,h)},Rl.ellipse=function(_,P,r,y,F,i,o){var Y=this.actions[this.actions.length-1].args,l=Y[Y.length-2],s=Y[Y.length-1];this.absellipse(_+l,P+s,r,y,F,i,o)},Rl.absellipse=function(r,F,M,P,$,Y,A){var x=Array.prototype.slice.call(arguments),Q=new Wj(r,F,M,P,$,Y,A);this.curves.push(Q);var c=Q.getPoint(1);x.push(c.x),x.push(c.y),this.actions.push({action:lk,args:x})},Rl.getSpacedPoints=function(f){f||(f=40);for(var T=[],h=0;f>h;h++)T.push(this.getPoint(h/f));return T},Rl.getPoints=function(N,$){N=N||12;var X,E,Z,h,t,H,e,R,Q,u,i,I,G,d,L,x,A,o,m=[];for(X=0,E=this.actions.length;E>X;X++)switch(Z=this.actions[X],h=Z.action,t=Z.args,h){case Ll:m.push(new dp(t[0],t[1]));break;case Op:m.push(new dp(t[0],t[1]));break;case lj:for(H=t[2],e=t[3],u=t[0],i=t[1],m.length>0?(d=m[m.length-1],I=d.x,G=d.y):(d=this.actions[X-1].args,I=d[d.length-2],G=d[d.length-1]),L=1;N>=L;L++)x=L/N,A=Xr.b2(x,I,u,H),o=Xr.b2(x,G,i,e),m.push(new dp(A,o));break;case vr:for(H=t[4],e=t[5],u=t[0],i=t[1],R=t[2],Q=t[3],m.length>0?(d=m[m.length-1],I=d.x,G=d.y):(d=this.actions[X-1].args,I=d[d.length-2],G=d[d.length-1]),L=1;N>=L;L++)x=L/N,A=Xr.b3(x,I,u,R,H),o=Xr.b3(x,G,i,Q,e),m.push(new dp(A,o));break;case Zk:var v,z=t[0],w=t[1],b=t[2],r=t[3],K=t[4],C=!!t[5],g=K-r,B=2*N;for(L=1;B>=L;L++)x=L/B,C||(x=1-x),v=r+x*g,A=z+b*O(v),o=w+b*f(v),m.push(new dp(A,o));break;case lk:var v,z=t[0],w=t[1],j=t[2],D=t[3],r=t[4],K=t[5],C=!!t[6],g=K-r,B=2*N;for(L=1;B>=L;L++)x=L/B,C||(x=1-x),v=r+x*g,A=z+j*O(v),o=w+D*f(v),m.push(new dp(A,o))}var n=m[m.length-1],y=1e-10;return J(n.x-m[0].x)<y&&J(n.y-m[0].y)<y&&m.splice(m.length-1,1),$&&m.push(m[0]),m},Rl.toShapes=function(l,T){function f(b){var I,c,J,B,M,g=[],d=new wr;for(I=0,c=b.length;c>I;I++)J=b[I],M=J.args,B=J.action,B==Ll&&0!=d.actions.length&&(g.push(d),d=new wr),d[B].apply(d,M);return 0!=d.actions.length&&g.push(d),g}function b(j){for(var n=[],k=0,J=j.length;J>k;k++){var Y=j[k],y=new Ee;y.actions=Y.actions,y.curves=Y.curves,n.push(y)}return n}function p(v,m){for(var A=1e-10,l=m.length,f=!1,b=l-1,j=0;l>j;b=j++){var V=m[b],r=m[j],s=r.x-V.x,T=r.y-V.y;if(J(T)>A){if(0>T&&(V=m[j],s=-s,r=m[b],T=-T),v.y<V.y||v.y>r.y)continue;if(v.y==V.y){if(v.x==V.x)return!0}else{var k=T*(v.x-V.x)-s*(v.y-V.y);if(0==k)return!0;if(0>k)continue;f=!f}}else{if(v.y!=V.y)continue;if(r.x<=v.x&&v.x<=V.x||V.x<=v.x&&v.x<=r.x)return!0}}return f}var A=f(this.actions);if(0==A.length)return[];if(T===!0)return b(A);var y,e,x,m=[];if(1==A.length)return e=A[0],x=new Ee,x.actions=e.actions,x.curves=e.curves,m.push(x),m;var O=!Xr.isClockWise(A[0].getPoints());O=l?!O:O;var n,E=[],c=[],j=[],w=0;c[w]=H,j[w]=[];var t,Z;for(t=0,Z=A.length;Z>t;t++)e=A[t],n=e.getPoints(),y=Xr.isClockWise(n),y=l?!y:y,y?(!O&&c[w]&&w++,c[w]={s:new Ee,p:n},c[w].s.actions=e.actions,c[w].s.curves=e.curves,O&&w++,j[w]=[]):j[w].push({h:e,p:n[0]});if(!c[0])return b(A);if(c.length>1){for(var P=!1,S=[],U=0,N=c.length;N>U;U++)E[U]=[];for(var U=0,N=c.length;N>U;U++){c[U];for(var $=j[U],o=0;o<$.length;o++){for(var r=$[o],z=!0,B=0;B<c.length;B++)p(r.p,c[B].p)&&(U!=B&&S.push({froms:U,tos:B,hole:o}),z?(z=!1,E[B].push(r)):P=!0);z&&E[U].push(r)}}S.length>0&&(P||(j=E))}var W,F,Q;for(t=0,Z=c.length;Z>t;t++)for(x=c[t].s,m.push(x),W=j[t],F=0,Q=W.length;Q>F;F++)x.holes.push(W[F].h);return m};var Ee=function(){wr.apply(this,arguments),this.holes=[]},Ol=Ee.prototype=xe(Rl);Ol.getPointsHoles=function(i){var $,n=this.holes.length,T=[];for($=0;n>$;$++)T[$]=this.holes[$].getTransformedPoints(i);return T},Ol.extractAllPoints=function(D){return{shape:this.getTransformedPoints(D),holes:this.getPointsHoles(D)}},Ol.extractPoints=function(L){return this.extractAllPoints(L)};var Xr={triangulateShape:function(x,j){function k(s,t,R){return s.x!=t.x?s.x<t.x?s.x<=R.x&&R.x<=t.x:t.x<=R.x&&R.x<=s.x:s.y<t.y?s.y<=R.y&&R.y<=t.y:t.y<=R.y&&R.y<=s.y}function q(P,u,m,c,S){var Y=1e-10,M=u.x-P.x,R=u.y-P.y,t=c.x-m.x,H=c.y-m.y,U=P.x-m.x,_=P.y-m.y,n=R*t-M*H,i=R*U-M*_;if(J(n)>Y){var g;if(n>0){if(0>i||i>n)return[];if(g=H*U-t*_,0>g||g>n)return[]}else{if(i>0||n>i)return[];if(g=H*U-t*_,g>0||n>g)return[]}if(0==g)return!S||0!=i&&i!=n?[P]:[];if(g==n)return!S||0!=i&&i!=n?[u]:[];if(0==i)return[m];if(i==n)return[c];var x=g/n;return[{x:P.x+x*M,y:P.y+x*R}]}if(0!=i||H*U!=t*_)return[];var D=0==M&&0==R,z=0==t&&0==H;if(D&&z)return P.x!=m.x||P.y!=m.y?[]:[P];if(D)return k(m,c,P)?[P]:[];if(z)return k(P,u,m)?[m]:[];var L,a,e,Q,F,r,p,v;return 0!=M?(P.x<u.x?(L=P,e=P.x,a=u,Q=u.x):(L=u,e=u.x,a=P,Q=P.x),m.x<c.x?(F=m,p=m.x,r=c,v=c.x):(F=c,p=c.x,r=m,v=m.x)):(P.y<u.y?(L=P,e=P.y,a=u,Q=u.y):(L=u,e=u.y,a=P,Q=P.y),m.y<c.y?(F=m,p=m.y,r=c,v=c.y):(F=c,p=c.y,r=m,v=m.y)),p>=e?p>Q?[]:Q==p?S?[]:[F]:v>=Q?[F,a]:[F,r]:e>v?[]:e==v?S?[]:[L]:v>=Q?[L,a]:[L,r]}function n(I,W,x,Q){var K=1e-10,h=W.x-I.x,v=W.y-I.y,p=x.x-I.x,Z=x.y-I.y,o=Q.x-I.x,C=Q.y-I.y,s=h*Z-v*p,r=h*C-v*o;if(J(s)>K){var X=o*Z-C*p;return s>0?r>=0&&X>=0:r>=0||X>=0}return r>0}function R(c,A){function O(X,g){var N=B.length-1,b=X-1;0>b&&(b=N);var m=X+1;m>N&&(m=0);var S=n(B[X],B[b],B[m],W[g]);if(!S)return!1;var u=W.length-1,i=g-1;0>i&&(i=u);var Y=g+1;return Y>u&&(Y=0),S=n(W[g],W[i],W[Y],B[X]),S?!0:!1}function _(U,z){var e,M,d;for(e=0;e<B.length;e++)if(M=e+1,M%=B.length,d=q(U,z,B[e],B[M],!0),d.length>0)return!0;return!1}function j(m,a){var t,L,W,M,y;for(t=0;t<F.length;t++)for(L=A[F[t]],W=0;W<L.length;W++)if(M=W+1,M%=L.length,y=q(m,a,L[W],L[M],!0),y.length>0)return!0;return!1}for(var W,x,b,N,R,P,V,k,m,Q,p,B=c.concat(),F=[],y=[],D=0,f=A.length;f>D;D++)F.push(D);for(var E=0,S=2*F.length;F.length>0&&(S--,!(0>S));)for(b=E;b<B.length;b++){N=B[b],x=-1;for(var D=0;D<F.length;D++)if(P=F[D],V=N.x+":"+N.y+":"+P,y[V]===H){W=A[P];for(var h=0;h<W.length;h++)if(R=W[h],O(b,h)&&!_(N,R)&&!j(N,R)){x=h,F.splice(D,1),k=B.slice(0,b+1),m=B.slice(b),Q=W.slice(x),p=W.slice(0,x+1),B=k.concat(Q).concat(p).concat(m),E=b;break}if(x>=0)break;y[V]=!0}if(x>=0)break}return B}for(var Z,f,M,V,L,S,T={},Q=x.concat(),A=0,y=j.length;y>A;A++)Array.prototype.push.apply(Q,j[A]);for(Z=0,f=Q.length;f>Z;Z++)L=Q[Z].x+":"+Q[Z].y,T[L]!==H,T[L]=Z;var Y=R(x,j),h=Sb.Triangulate(Y,!1);for(Z=0,f=h.length;f>Z;Z++)for(V=h[Z],M=0;3>M;M++)L=V[M].x+":"+V[M].y,S=T[L],S!==H&&(V[M]=S);return h.concat()},isClockWise:function(n){return Sb.Triangulate.area(n)<0},b2p0:function(d,J){var c=1-d;return c*c*J},b2p1:function(I,P){return 2*(1-I)*I*P},b2p2:function(N,x){return N*N*x},b2:function(k,n,J,u){return this.b2p0(k,n)+this.b2p1(k,J)+this.b2p2(k,u)},b3p0:function(u,W){var L=1-u;return L*L*L*W},b3p1:function(U,B){var w=1-U;return 3*w*w*U*B},b3p2:function(C,M){var F=1-C;return 3*F*C*C*M},b3p3:function(Q,y){return Q*Q*Q*y},b3:function(a,h,v,i,Q){return this.b3p0(a,h)+this.b3p1(a,v)+this.b3p2(a,i)+this.b3p3(a,Q)}},Sb={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var s=C.keys(this.faces);return s.length?s[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(s){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(B){var $=B.familyName.toLowerCase(),Z=this;return Z.faces[$]=Z.faces[$]||{},Z.faces[$][B.cssFontWeight]=Z.faces[$][B.cssFontWeight]||{},Z.faces[$][B.cssFontWeight][B.cssFontStyle]=B,B},drawText:function(c){var n,Q=this.getFace(),I=this.size/Q.resolution,w=0,d=String(c).split(""),i=d.length,F=[];for(n=0;i>n;n++){var D=new wr,R=this.extractGlyphPoints(d[n],Q,I,w,D);R&&(w+=R.offset*this.spacing,F.push(R.path))}var K=w/2;return{paths:F,offset:K}},extractGlyphPoints:function(i,G,n,l,D){var q,I,J,N,b,L,Z,v,z,B,W,g,e,Y,s,S,f,H,R,X=[],h=G.glyphs[i]||G.glyphs["?"];if(h){if(h.o)for(N=h._cachedOutline||(h._cachedOutline=h.o.split(" ")),L=N.length,Z=n,v=n,q=0;L>q;)switch(b=N[q++]){case"m":z=N[q++]*Z+l,B=N[q++]*v,D.moveTo(z,B);break;case"l":z=N[q++]*Z+l,B=N[q++]*v,D.lineTo(z,B);break;case"q":if(W=N[q++]*Z+l,g=N[q++]*v,s=N[q++]*Z+l,S=N[q++]*v,D.quadraticCurveTo(s,S,W,g),R=X[X.length-1])for(e=R.x,Y=R.y,I=1,J=this.divisions;J>=I;I++){var A=I/J;Xr.b2(A,e,s,W),Xr.b2(A,Y,S,g)}break;case"b":if(W=N[q++]*Z+l,g=N[q++]*v,s=N[q++]*Z+l,S=N[q++]*v,f=N[q++]*Z+l,H=N[q++]*v,D.bezierCurveTo(s,S,f,H,W,g),R=X[X.length-1])for(e=R.x,Y=R.y,I=1,J=this.divisions;J>=I;I++){var A=I/J;Xr.b3(A,e,s,f,W),Xr.b3(A,Y,S,H,g)}}return{offset:h.ha*n,path:D}}}};Sb.generateShapes=function(T,e){e=e||{};var t=e.font;if(t===H&&(t=Sb.getDefaultFont(),!t))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var r=e.size!==H?e.size:1,a=e.curveSegments!==H?e.curveSegments:4,D=e.spacing!==H?e.spacing:1,w=e.weight!==H?e.weight:"normal",c=e.style!==H?e.style:"normal";Sb.size=r,Sb.divisions=a,Sb.face=t,Sb.weight=w,Sb.style=c,Sb.spacing=D;for(var C=Sb.drawText(T),Q=C.paths,f=[],_=0,M=Q.length;M>_;_++)Array.prototype.push.apply(f,Q[_].toShapes());return f},function(z){var w=1e-10,q=function(t,z){var Q=t.length;if(3>Q)return null;var s,y,q,o=[],x=[],U=[];if(J(t)>0)for(y=0;Q>y;y++)x[y]=y;else for(y=0;Q>y;y++)x[y]=Q-1-y;var L=Q,B=2*L;for(y=L-1;L>2;){if(B--<=0)return z?U:o;if(s=y,s>=L&&(s=0),y=s+1,y>=L&&(y=0),q=y+1,q>=L&&(q=0),m(t,s,y,q,L,x)){var H,a,P,A,r;for(H=x[s],a=x[y],P=x[q],o.push([t[H],t[a],t[P]]),U.push([x[s],x[y],x[q]]),A=y,r=y+1;L>r;A++,r++)x[A]=x[r];L--,B=2*L}}return z?U:o},J=function(h){for(var k=h.length,$=0,P=k-1,o=0;k>o;P=o++)$+=h[P].x*h[o].y-h[o].x*h[P].y;return.5*$},m=function(l,P,Q,R,f,x){var H,c,F,E,j,C,n,q,o;if(c=l[x[P]].x,F=l[x[P]].y,E=l[x[Q]].x,j=l[x[Q]].y,C=l[x[R]].x,n=l[x[R]].y,w>(E-c)*(n-F)-(j-F)*(C-c))return!1;var J,D,W,i,y,v,U,Y,k,Z,T,S,s,z,$;for(J=C-E,D=n-j,W=c-C,i=F-n,y=E-c,v=j-F,H=0;f>H;H++)if(q=l[x[H]].x,o=l[x[H]].y,!(q===c&&o===F||q===E&&o===j||q===C&&o===n)&&(U=q-c,Y=o-F,k=q-E,Z=o-j,T=q-C,S=o-n,$=J*Z-D*k,s=y*Y-v*U,z=W*S-i*T,$>=-w&&z>=-w&&s>=-w))return!1;return!0};return z.Triangulate=q,z.Triangulate.area=J,z}(Sb),U._typeface_js={faces:Sb.faces,loadFace:Sb.loadFace};var pi=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Hq=pi.prototype={constructor:pi,computeFaceNormals:function(){for(var s=new nm,U=new nm,y=0,j=this.faces.length;j>y;y++){var K=this.faces[y],S=this.vertices[K.a],x=this.vertices[K.b],u=this.vertices[K.c];s.subVectors(u,x),U.subVectors(S,x),s.cross(U),s.normalize(),K.normal.copy(s)}},computeVertexNormals:function(M){var s,w,b,P,S,F;for(F=new Array(this.vertices.length),s=0,w=this.vertices.length;w>s;s++)F[s]=new nm;if(M){var B,h,V,Z=new nm,A=new nm;for(b=0,P=this.faces.length;P>b;b++)S=this.faces[b],B=this.vertices[S.a],h=this.vertices[S.b],V=this.vertices[S.c],Z.subVectors(V,h),A.subVectors(B,h),Z.cross(A),F[S.a].add(Z),F[S.b].add(Z),F[S.c].add(Z)}else for(b=0,P=this.faces.length;P>b;b++)S=this.faces[b],F[S.a].add(S.normal),F[S.b].add(S.normal),F[S.c].add(S.normal);for(s=0,w=this.vertices.length;w>s;s++)F[s].normalize();for(b=0,P=this.faces.length;P>b;b++)S=this.faces[b],S.vertexNormals[0]=F[S.a].clone(),S.vertexNormals[1]=F[S.b].clone(),S.vertexNormals[2]=F[S.c].clone()},mergeVertices:function(){var s,R,O,u,P,J,F,L,y={},G=[],I=[],C=4,l=d(10,C);for(O=0,u=this.vertices.length;u>O;O++)s=this.vertices[O],R=A(s.x*l)+"_"+A(s.y*l)+"_"+A(s.z*l),y[R]===H?(y[R]=O,G.push(this.vertices[O]),I[O]=G.length-1):I[O]=I[y[R]];var S=[];for(O=0,u=this.faces.length;u>O;O++){P=this.faces[O],P.a=I[P.a],P.b=I[P.b],P.c=I[P.c],J=[P.a,P.b,P.c];for(var K=0;3>K;K++)if(J[K]==J[(K+1)%3]){S.push(O);break}}for(O=S.length-1;O>=0;O--){var p=S[O];for(this.faces.splice(p,1),F=0,L=this.faceVertexUvs.length;L>F;F++)this.faceVertexUvs[F].splice(p,1)}var i=this.vertices.length-G.length;return this.vertices=G,i}},Wj=function(M,O,Z,V,i,K,D){this.aX=M,this.aY=O,this.xRadius=Z,this.yRadius=V,this.aStartAngle=i,this.aEndAngle=K,this.aClockwise=D};Wj.prototype=xe(_g),Wj.prototype.getPoint=function(a){var u,y=this.aEndAngle-this.aStartAngle;0>y&&(y+=W),y>W&&(y-=W),u=this.aClockwise===!0?this.aEndAngle+(1-a)*(W-y):this.aStartAngle+a*y;var q=this.aX+this.xRadius*O(u),o=this.aY+this.yRadius*f(u);return new dp(q,o)};var Nq=function(v,j){this.v1=v,this.v2=j},wk=Nq.prototype=xe(_g);wk.getPoint=function(g){var $=this.v2.clone().sub(this.v1);return $.multiplyScalar(g).add(this.v1),$},wk.getPointAt=function($){return this.getPoint($)},wk.getTangent=function(){var l=this.v2.clone().sub(this.v1);return l.normalize()};var rq=function(X,v,A){this.v0=X,this.v1=v,this.v2=A};rq.prototype=xe(_g),rq.prototype.getPoint=function(N){var v,F;return v=Xr.b2(N,this.v0.x,this.v1.x,this.v2.x),F=Xr.b2(N,this.v0.y,this.v1.y,this.v2.y),new dp(v,F)};var Qq=function(w,x,K,S){this.v0=w,this.v1=x,this.v2=K,this.v3=S};Qq.prototype=xe(_g),Qq.prototype.getPoint=function(e){var L,o;return L=Xr.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),o=Xr.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new dp(L,o)},Gq.create(function(y,s){this.v1=y,this.v2=s},function(A){var S=new nm;return S.subVectors(this.v2,this.v1),S.multiplyScalar(A),S.add(this.v1),S});var zr=Gq.create(function(p,h,s){this.v0=p,this.v1=h,this.v2=s},function(Y){var L,j,E;return L=Xr.b2(Y,this.v0.x,this.v1.x,this.v2.x),j=Xr.b2(Y,this.v0.y,this.v1.y,this.v2.y),E=Xr.b2(Y,this.v0.z,this.v1.z,this.v2.z),new nm(L,j,E)}),Pk=Gq.create(function(j,J,Q,Z){this.v0=j,this.v1=J,this.v2=Q,this.v3=Z},function(j){var D,n,S;return D=Xr.b3(j,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=Xr.b3(j,this.v0.y,this.v1.y,this.v2.y,this.v3.y),S=Xr.b3(j,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new nm(D,n,S)}),fr=function(s,P,K,L,Q,z,R,J){pi.call(this),L=L!==H?L:.5,Q=Q!==H?Q:.5,J=J!==H?J:1,s=s||8,z=z||0,R=R||W;var k,u,n=1,S=J/2,c=[],e=[],x=this.vertices,V=this.faces,v=this.faceVertexUvs;for(u=0;n>=u;u++){var M=[],h=[],U=u/n,l=U*(Q-L)+L;for(k=0;s>=k;k++){var G=k/s,Y=new nm,m=-(G*R+z);Y.z=l*f(m),Y.y=-U*J+S,Y.x=l*O(m),x.push(Y),M.push(x.length-1),h.push(new dp(G,U))}c.push(M),e.push(h)}var y,I,o=(Q-L)/J;for(k=0;s>k;k++)for(0!==L?(y=x[c[0][k]].clone(),I=x[c[0][k+1]].clone()):(y=x[c[1][k]].clone(),I=x[c[1][k+1]].clone()),y.setY(p(y.x*y.x+y.z*y.z)*o).normalize(),I.setY(p(I.x*I.x+I.z*I.z)*o).normalize(),u=0;n>u;u++){var r=c[u][k],B=c[u+1][k],i=c[u+1][k+1],Z=c[u][k+1],q=y.clone(),w=y.clone(),D=I.clone(),F=I.clone(),X=e[u][k].clone(),d=e[u+1][k].clone(),N=e[u+1][k+1].clone(),j=e[u][k+1].clone();V.push(new En(r,B,Z,[q,w,F])),v[0].push([X,d,j]),V.push(new En(B,i,Z,[w.clone(),D,F.clone()])),v[0].push([d.clone(),N,j.clone()])}if(P&&L>0)for(this.vertices.push(new nm(0,S,0)),k=0;s>k;k++){var r=c[0][k],B=c[0][k+1],i=this.vertices.length-1,q=new nm(0,1,0),w=new nm(0,1,0),D=new nm(0,1,0),X=e[0][k].clone(),d=e[0][k+1].clone(),N=new dp(d.x,0);V.push(new En(r,B,i,[q,w,D],null,1));var _=k/s*W,a=O(_),$=f(_),g=(k+1)/s*W,A=O(g),t=f(g);v[0].push([new dp(.5+.5*a,.5+.5*$),new dp(.5+.5*A,.5+.5*t),new dp(.5,.5)])}if(K&&Q>0)for(this.vertices.push(new nm(0,-S,0)),k=0;s>k;k++){var r=c[u][k+1],B=c[u][k],i=x.length-1,q=new nm(0,-1,0),w=new nm(0,-1,0),D=new nm(0,-1,0),X=e[u][k+1].clone(),d=e[u][k].clone();V.push(new En(r,B,i,[q,w,D],null,2));var _=k/s*W,a=O(_),$=f(_),g=(k+1)/s*W,A=O(g),t=f(g);v[0].push([new dp(.5+.5*A,.5-.5*t),new dp(.5+.5*a,.5-.5*$),new dp(.5,.5)])}};fr.prototype=xe(Hq);var sh=function(x,m,G,r,d,M,Z){pi.call(this),Z=Z||.5,x=x||16,m=m||16,G=(G!==H?G:0)-g,r=r!==H?r:W,d=d!==H?d:0,M=M!==H?M:g;var _,T,t=[],X=[],B=this.vertices,u=this.faces,E=this.faceVertexUvs;for(T=0;m>=T;T++){var V=[],n=[];for(_=0;x>=_;_++){var Q=_/x,p=T/m,C=new nm;C.x=-Z*O(G+Q*r)*f(d+p*M),C.y=Z*O(d+p*M),C.z=Z*f(G+Q*r)*f(d+p*M),B.push(C),V.push(B.length-1),n.push(new dp(Q,p))}t.push(V),X.push(n)}for(T=0;m>T;T++)for(_=0;x>_;_++){var U=t[T][_+1],y=t[T][_],S=t[T+1][_],D=t[T+1][_+1],k=B[U].clone().normalize(),o=B[y].clone().normalize(),j=B[S].clone().normalize(),A=B[D].clone().normalize(),L=X[T][_+1].clone(),w=X[T][_].clone(),R=X[T+1][_].clone(),P=X[T+1][_+1].clone();J(B[U].y)===Z?(L.x=(L.x+w.x)/2,u.push(new En(U,S,D,[k,j,A])),E[0].push([L,R,P])):J(B[S].y)===Z?(R.x=(R.x+P.x)/2,u.push(new En(U,y,S,[k,o,j])),E[0].push([L,w,R])):(u.push(new En(U,y,D,[k,o,A])),E[0].push([L,w,P]),u.push(new En(y,S,D,[o.clone(),j,A.clone()])),E[0].push([w.clone(),R,P.clone()]))}};sh.prototype=xe(Hq);var Yi=function(K,r,t,P,L,C){pi.call(this),K=K||.33,r=r||.17,P=P||8,t=t||6,L=L||0,C=C||W;for(var Z=new nm,u=[],d=[],b=0;P>=b;b++)for(var T=b/P*W+g,Q=0;t>=Q;Q++){var A=Q/t*C+L;Z.x=K*O(A),Z.z=-K*f(A);var m=new nm,e=K+r*O(T);m.x=e*O(A),m.z=-e*f(A),m.y=r*f(T),this.vertices.push(m),u.push(new dp(Q/t,1-b/P)),d.push(m.clone().sub(Z).normalize())}for(var b=1;P>=b;b++)for(var Q=1;t>=Q;Q++){var U=(t+1)*b+Q-1,l=(t+1)*(b-1)+Q-1,Y=(t+1)*(b-1)+Q,R=(t+1)*b+Q,z=new En(U,l,R,[d[U].clone(),d[l].clone(),d[R].clone()]);this.faces.push(z),this.faceVertexUvs[0].push([u[U].clone(),u[l].clone(),u[R].clone()]),z=new En(l,Y,R,[d[l].clone(),d[Y].clone(),d[R].clone()]),this.faces.push(z),this.faceVertexUvs[0].push([u[l].clone(),u[Y].clone(),u[R].clone()])}this.computeFaceNormals()};Yi.prototype=xe(Hq);var bh=function(R,Z,y){return R?(pi.call(this),R=R instanceof Array?R:[R],this.addShapeList(R,Z),Z.convertYZ!==!1&&$r(this,y),this.computeFaceNormals(),void 0):(R=[],void 0)},qk=bh.prototype=xe(pi.prototype);qk.addShapeList=function(R,r){for(var m=R.length,h=0;m>h;h++){var U=R[h];this.addShape(U,r)}},qk.addShape=function(p,O){function U(){if(O.bottom)for(var c=0;R>c;c++)d=v[c],j(d[2],d[1],d[0],!0);if(O.top)for(c=0;R>c;c++)d=v[c],j(d[0]+r*B,d[1]+r*B,d[2]+r*B,!1)}function C(){var I=0;for(u(c,I),I+=c.length,D=0,N=t.length;N>D;D++)z=t[D],u(z,I),I+=z.length}function u(R,j){for(var K,Y,g=R.length;--g>=0;){K=g,Y=g-1,0>Y&&(Y=R.length-1);var h=0,P=B;for(h=0;P>h;h++){var x=r*h,F=r*(h+1),f=j+K+x,v=j+Y+x,M=j+Y+F,m=j+K+F;Q(f,v,M,m,R,h,P,K,Y)}}}function i(L,y,Q){X.vertices.push(new nm(L,y,Q))}function j(R,_,m,Q){R+=q,_+=q,m+=q,X.faces.push(new En(R,_,m,null,null,Q?2:1));var r=Q?P.generateBottomUV(X,p,O,R,_,m):P.generateTopUV(X,p,O,R,_,m);X.faceVertexUvs[0].push(r)}function Q(m,t,L,a,e,r,U,o,Z){m+=q,t+=q,L+=q,a+=q,X.faces.push(new En(m,t,a)),X.faces.push(new En(t,L,a));var h=P.generateSideWallUV(X,p,e,O,m,t,L,a,r,U,o,Z);X.faceVertexUvs[0].push([h[0],h[1],h[3]]),X.faceVertexUvs[0].push([h[1],h[2],h[3]])}var A,w,e,g,W,V=O.amount,I=O.curveSegments||rh,B=O.steps||1,x=O.extrudePath,T=!1,P=new Pf(O.repeatUVLength);x&&(A=x.getSpacedPoints(B),T=!0,w=O.frames!==H?O.frames:new Lq.FrenetFrames(x,B,!1),e=new nm,g=new nm,W=new nm);var z,D,N,X=this,q=this.vertices.length,Y=p.extractPoints(I),f=Y.shape,t=Y.holes,L=!Xr.isClockWise(f);if(L){for(f=f.reverse(),D=0,N=t.length;N>D;D++)z=t[D],Xr.isClockWise(z)&&(t[D]=z.reverse());L=!1}var v=Xr.triangulateShape(f,t),c=f;for(D=0,N=t.length;N>D;D++)z=t[D],f=f.concat(z);for(var M,d,r=f.length,R=v.length,Z=0;r>Z;Z++)M=f[Z],T?(g.copy(w.normals[0]).multiplyScalar(M.x),e.copy(w.binormals[0]).multiplyScalar(M.y),W.copy(A[0]).add(g).add(e),i(W.x,W.y,W.z)):i(M.x,M.y,0);var S;for(S=1;B>=S;S++)for(Z=0;r>Z;Z++)M=f[Z],T?(g.copy(w.normals[S]).multiplyScalar(M.x),e.copy(w.binormals[S]).multiplyScalar(M.y),W.copy(A[S]).add(g).add(e),i(W.x,W.y,W.z)):i(M.x,M.y,V/B*S);U(),C()};var Lq=function(K,i,P,Y,y){function t($,W,g){return S.vertices.push(new nm($,W,g))-1}pi.call(this),i=i||64,P=P||1,Y=Y||8,y=y||!1;var C,p,$,g,u,U,M,H,o,z,Z,_,v,j,s,r,V,m,D,w,A=[],S=this,l=i+1,b=new nm,I=new Lq.FrenetFrames(K,i,y),h=I.tangents,Q=I.normals,B=I.binormals;for(this.tangents=h,this.normals=Q,this.binormals=B,o=0;l>o;o++)for(A[o]=[],g=o/(l-1),H=K.getPointAt(g),C=h[o],p=Q[o],$=B[o],z=0;Y>z;z++)u=z/Y*W,U=-P*O(u),M=P*f(u),b.copy(H),b.x+=U*p.x+M*$.x,b.y+=U*p.y+M*$.y,b.z+=U*p.z+M*$.z,A[o][z]=t(b.x,b.y,b.z);for(o=0;i>o;o++)for(z=0;Y>z;z++)Z=y?(o+1)%i:o+1,_=(z+1)%Y,v=A[o][z],j=A[Z][z],s=A[Z][_],r=A[o][_],V=new dp(o/i,z/Y),m=new dp((o+1)/i,z/Y),D=new dp((o+1)/i,(z+1)/Y),w=new dp(o/i,(z+1)/Y),this.faces.push(new En(v,j,r)),this.faceVertexUvs[0].push([V,m,w]),this.faces.push(new En(j,s,r)),this.faceVertexUvs[0].push([m.clone(),D,w.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Lq.prototype=xe(Hq),Lq.FrenetFrames=function(t,M,W){function k(){w[0]=new nm,h[0]=new nm,S=Number.MAX_VALUE,i=J(Y[0].x),I=J(Y[0].y),m=J(Y[0].z),S>=i&&(S=i,A.set(1,0,0)),S>=I&&(S=I,A.set(0,1,0)),S>=m&&A.set(0,0,1),o.crossVectors(Y[0],A).normalize(),w[0].crossVectors(Y[0],o),h[0].crossVectors(Y[0],w[0])}var y,S,i,I,m,n,X,A=new nm,Y=[],w=[],h=[],o=new nm,v=new Ln,U=M+1,L=1e-4;for(this.tangents=Y,this.normals=w,this.binormals=h,n=0;U>n;n++)X=n/(U-1),Y[n]=t.getTangentAt(X),Y[n].normalize();for(k(),n=1;U>n;n++)w[n]=w[n-1].clone(),h[n]=h[n-1].clone(),o.crossVectors(Y[n-1],Y[n]),o.length()>L&&(o.normalize(),y=a(id(Y[n-1].dot(Y[n]),-1,1)),w[n].applyMatrix4(v.makeRotationAxis(o,y))),h[n].crossVectors(Y[n],w[n]);if(W)for(y=a(id(w[0].dot(w[U-1]),-1,1)),y/=U-1,Y[0].dot(o.crossVectors(w[0],w[U-1]))>0&&(y=-y),n=1;U>n;n++)w[n].applyMatrix4(v.makeRotationAxis(Y[n],y*n)),h[n].crossVectors(Y[n],w[n])};var Nr=function(l,C,s,B){pi.call(this),C=C||18,s=s||0,B=B==I?W:B;for(var q=1/(l.length-1),r=1/C,u=0,m=C;m>=u;u++)for(var n=s+u*r*B,a=O(n),D=f(n),F=0,z=l.length;z>F;F++){var x=l[F],Y=new nm;Y.x=a*x.x-D*x.y,Y.y=D*x.x+a*x.y,Y.z=x.z,this.vertices.push(Y)}for(var w=l.length,u=0,m=C;m>u;u++)for(var F=0,z=l.length-1;z>F;F++){var L=F+w*u,M=L,P=L+w,a=L+1+w,v=L+1,X=u*r,U=F*q,i=X+r,c=U+q;this.faces.push(new En(M,v,P)),this.faceVertexUvs[0].push([new dp(X,U),new dp(X,c),new dp(i,U)]),this.faces.push(new En(P,v,a)),this.faceVertexUvs[0].push([new dp(i,U),new dp(X,c),new dp(i,c)])}this.mergeVertices(),$r(this),this.computeFaceNormals(),this.computeVertexNormals()};Nr.prototype=xe(Hq);var Lh=function(M,r){r=r||{};var m=Sb.generateShapes(M,r);r.amount=r.amount!==H?r.amount:.5,r.convertYZ=!1,r.fill!==!1&&(r.bottom=!0,r.top=!0),bh.call(this,m,r)};Lh.prototype=xe(qk);var yq=j.Node=function(){zp(yq,this)},ej={X:Zi,Y:Oq,Z:tj},kl={X:0,Y:1,Z:2},yh={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},bs="xzy",us=function(j,y,H){if(y){var o=y[0],X=y[1],S=y[2];"xzy"===H?(Oq(j,X),tj(j,S),Zi(j,o)):"xyz"===H?(tj(j,S),Oq(j,X),Zi(j,o)):"yxz"===H?(tj(j,S),Zi(j,o),Oq(j,X)):"yzx"===H?(Zi(j,o),tj(j,S),Oq(j,X)):"zxy"===H?(Oq(j,X),Zi(j,o),tj(j,S)):"zyx"===H?(Zi(j,o),Oq(j,X),tj(j,S)):(Oq(j,X),tj(j,S),Zi(j,o))}};yp("Node",Uk,{ms_ac:["rotationMode","anchorElevation"],_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:bs,_64O:0,_rotationX:0,_53O:0,_host:I,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return ae},_22Q:function(){return Vo},getX:function(){return this.p().x},setX:function(M){this.p(M,this.p().y)},getY:function(){return this.p().y},setY:function(k){this.p(this.p().x,k)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(i){this.setAnchor(i,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(h){this.setAnchor(this.getAnchor().x,h)},getScaleX:function(){return this.getScale().x},setScaleX:function(Q){this.setScale(Q,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(U){this.setScale(this.getScale().x,U)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(A,H){Ph(A,Dq(I,I,this.r3(),this.getRotationMode())),this.translate3d(A[0]*H,A[1]*H,A[2]*H)},translateFront:function(P){this.translate3dBy([0,0,1],P)},translateBack:function(A){this.translate3dBy([0,0,-1],A)},translateLeft:function(p){this.translate3dBy([-1,0,0],p)},translateRight:function(I){this.translate3dBy([1,0,0],I)},translateTop:function(O){this.translate3dBy([0,1,0],O)},translateBottom:function(N){this.translate3dBy([0,-1,0],N)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(i,s,v){1===arguments.length&&(s=i[1],v=i[2],i=i[0]),this.p(i,v),this.setElevation(s)},translate3d:function(k,G,s){1===arguments.length&&(G=k[1],s=k[2],k=k[0]),this.translate(k,s),this.setElevation(this._54O+G)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(k,u,W){1===arguments.length&&(u=k[1],W=k[2],k=k[0]),this.setSize(k,W),this.setTall(u)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(m,x,l){1===arguments.length&&(x=m[1],l=m[2],m=m[0]),this.setRotationX(m),this.setRotation(-x),this.setRotationZ(l)},setRotationY:function(x){this.setRotation(-x)},getRotationY:function(){return-this._64O},lookAtDirection:function(_,j){j=j||uq;var l=this,M=em(_);j===uq?(l.r3([-u(_[1]/M),-B(_[2],_[0])+S,0]),l.setRotationMode("xzy")):j===rj?(l.r3(0,-B(_[2],_[0]),u(_[1]/M)),l.setRotationMode("zyx")):j===Mn?(l.r3(0,-B(_[2],_[0])+g,-u(_[1]/M)),l.setRotationMode("zyx")):j===yo?(l.r3([-u(_[1]/M)+S,-B(_[2],_[0])+S,0]),l.setRotationMode("xzy")):j===Fl&&(l.r3([-u(_[1]/M)-S,-B(_[2],_[0])+S,0]),l.setRotationMode("xzy")),j===gh&&(l.r3([-u(_[1]/M)+g,-B(_[2],_[0])+S,g]),l.setRotationMode("zxy"))},lookAt:function(f,y){return this.lookAtDirection(Ip(f,this.p3()),y)},getLoopedEdges:function(){return this._45I},getEdges:function(){return this._70O},getAgentEdges:function(){return this._49I},getHost:function(){return this._host},setHost:function(z){var v=this;if(v!==z&&v._host!==z){var d=v._host;d&&d._removeAttach(v),v._host=z,v._host&&v._host._addAttach(v),v.fp("host",d,z),v.onHostChanged(d,z)}},getAttaches:function(){return this._69O},_addAttach:function(h){var i=this;i._69O||(i._69O=new fb),i._69O.add(h),i.fp("attaches",I,h)},_removeAttach:function(G){var t=this;t._69O.remove(G),t._69O.isEmpty()&&delete t._69O,t.fp("attaches",G,I)},getSourceEdges:function(){return this._42I},getTargetEdges:function(){return this._43I},_2I:function(a){var e=this;e._44I||(e._44I=new fb),e._42I||(e._42I=new fb),e._44I.add(a),e._42I.add(a),e._20I()},_4I:function(F){var y=this;y._44I||(y._44I=new fb),y._43I||(y._43I=new fb),y._44I.add(F),y._43I.add(F),y._20I()},_16I:function(d){var x=this;x._44I.remove(d),x._42I.remove(d),x._44I.isEmpty()&&delete x._44I,x._42I.isEmpty()&&delete x._42I,x._20I()},_18I:function(m){var k=this;k._44I.remove(m),k._43I.remove(m),k._44I.isEmpty()&&delete k._44I,k._43I.isEmpty()&&delete k._43I,k._20I()},_20I:function(){var _=this;if(delete _._45I,!_._44I||_._44I.isEmpty())return delete _._70O,void 0;var r;_._44I.each(function(u){u.isLooped()&&(r||(r={}),r[u._id]||(_._45I||(_._45I=new fb),_._45I.add(u),r[u._id]=u))}),r?(_._70O=new fb,_._44I.each(function(Q){r[Q._id]?"A"===r[Q._id]||(r[Q._id]="A",_._70O.add(Q)):_._70O.add(Q)})):_._70O=_._44I},hasAgentEdges:function(){return!!this._49I&&!this._49I.isEmpty()},getSourceAgentEdges:function(){return this._46I},getTargetAgentEdges:function(){return this._47I},_1I:function(k){var N=this;N._46I||(N._46I=new fb),N._48I||(N._48I=new fb),N._46I.add(k),N._48I.add(k),N._19I()},_3I:function(q){var _=this;_._47I||(_._47I=new fb),_._48I||(_._48I=new fb),_._47I.add(q),_._48I.add(q),_._19I()},_15I:function(T){var o=this;o._46I.remove(T),o._48I.remove(T),o._46I.isEmpty()&&delete o._46I,o._48I.isEmpty()&&delete o._48I,o._19I()},_17I:function(t){var G=this;G._47I.remove(t),G._48I.remove(t),G._47I.isEmpty()&&delete G._47I,G._48I.isEmpty()&&delete G._48I,G._19I()},_19I:function(){var t=this;delete t._49I;var k=t._48I;if(k&&!k.isEmpty()){var O={};k.each(function(o){O[o._id]?t._49I||(t._49I=new fb):O[o._id]=o}),t._49I?k.each(function(R){O[R._id]&&(t._49I.add(R),delete O[R._id])}):t._49I=k}},getImage:function(){if(this._pendingCheckImageJSON){var R=h.getImage(this._image);R&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof rl&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(j){var V=this,N=V._image,R=V.getWidth(),r=V.getHeight();V._image=j,V.fp("image",N,j)&&(null!=j&&(Lg(j)||_e(j)&&/\.json$/i.test(j))&&(this._pendingCheckImageJSON=!0),V.fp(cq,R,V.getWidth()),V.fp(lh,r,V.getHeight()))},getElevation:function(){return this._54O},setElevation:function(m){var v=this;if(!v._50O){v._50O=1;var Y=v._54O;v._54O=m,v.fp(sr,Y,m),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(B){var Y=this;if(!Y._49O){Y._49O=1;var S=Y._64O;Y._64O=B,Y.fp(_j,S,B),delete Y._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(t){var b=this;if(!b._51O){b._51O=1;var e=b._rotationX;b._rotationX=t,b.fp("rotationX",e,t),delete b._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(T){var S=this;if(!S._52O){S._52O=1;var g=S._53O;S._53O=T,S.fp("rotationZ",g,T),delete S._52O}},getPosition:function(){return this._position},setPosition:function(c,P){var t=this;if(!t._50I){t._50I=1;var y;if(y=2===arguments.length?{x:c,y:P}:c,y.x!==t._position.x||y.y!==t._position.y){var d=t._position;t._position=y,t.fp(Sf,d,y)}delete t._50I}},translate:function(I,W){var Y=this._position;this.p(Y.x+I,Y.y+W)},getWidth:function(){var J=this;if(J._width>=0)return J._width;var n=J.getStyle("shape3d");if(n){var X=Un(n);if(X&&X.rawS3)return X.rawS3[0];if("billboard"===n||"plane"===n){var U=qp(J.getStyle("shape3d.image"));return U?uf(U,J):20}}var U=qp(J._image);return U?uf(U,J):20},setWidth:function(_){var C=this,T=C._width;C._width=_,C.fp(cq,T,_)},getHeight:function(){var L=this;if(L._height>=0)return L._height;var f=L.getStyle("shape3d");if(f){var F=Un(f);if(F&&F.rawS3)return F.rawS3[2];if("plane"===f){var H=qp(L.getStyle("shape3d.image"));return H?Xd(H,L):20}if("billboard"===f)return 2}var H=qp(L._image);return H?Xd(H,L):20},setHeight:function(u){var g=this,M=g._height;g._height=u,g.fp(lh,M,u)},getTall:function(){var l=this;if(l._tall>=0)return l._tall;var W=l.getStyle("shape3d");if(W){var Z=Un(W);if(Z&&Z.rawS3)return Z.rawS3[1];if("billboard"===W){var S=qp(l.getStyle("shape3d.image"));return S?Xd(S,l):20}if("plane"===W)return 2}return 20},setTall:function(g){var G=this,p=G._tall;G._tall=g,G.fp("tall",p,g)},setSize:function(I,D){var v=this;2===arguments.length?(v.setWidth(I),v.setHeight(D)):(v.setWidth(I.width),v.setHeight(I.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}
},setRect:function(N,V,t,e,h){var K=this,W=K.getAnchor(),l=K.getScale();arguments.length<=2&&(h=V,V=N.y,t=N.width,e=N.height,N=N.x);var b=h&&l.x<0?1-W.x:W.x,E=h&&l.y<0?1-W.y:W.y;K.p(N+t*b,V+e*E),h&&(t/=Math.abs(l.x),e/=Math.abs(l.y)),K.setWidth(t),K.setHeight(e)},getMatrix:function(){var I=this,U=I._64O,G=I._position,B=I.getScale();return new ug(U,G.x,G.y,B.x,B.y)},getAnchorRect:function(){var x=this,V=x.getWidth(),I=x.getHeight(),W=x.getAnchor();return{x:-V*W.x,y:-I*W.y,width:V,height:I}},toLocal:function(k){return this.getMatrix().tfi(k)},toGlobal:function(i){return this.getMatrix().tf(i)},isInRect:function(z){z=this.toLocal(z);var q=this.getWidth(),G=this.getHeight();return z.x+=q*this.getAnchorX(),z.y+=G*this.getAnchorY(),!(z.x<0||z.y<0||z.x>q||z.y>G)},getRect:function(){var j=this,S=j.getWidth(),d=j.getHeight(),A=j.getAnchor(),C={x:-S*A.x,y:-d*A.y,width:S,height:d},E=j.getMatrix();return C=no([E.tf(C.x,C.y),E.tf(C.x+C.width,C.y),E.tf(C.x+C.width,C.y+C.height),E.tf(C.x,C.y+C.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var P=this,I=P.getAnchor(),i=P._anchorElevation;return{x:I.x,y:i,z:I.y}},setAnchorElevation:function(F){var w=this,e=w._anchorElevation;return e!==F?(w._anchorElevation=F,w.fp("anchorElevation",e,F),!0):!1},setAnchor3d:function(t,E,i,l){var g,c=this;"number"==typeof t?g={x:t,y:E,z:i}:(g=t.length?{x:t[0],y:t[1],z:t[2]}:t,l=E);var h=c.getDataModel();h&&h.beginTransaction();var s=c.getAnchor3d(),A=c.setAnchor(g.x,g.z);if(c.setAnchorElevation(g.y)&&(A=!0),A&&l&&!Nf){c.getAnchor3d();var Y=gq(c),T=Ph([g.x-s.x,g.y-s.y,g.z-s.z],Y);c.p3(T)}return h&&h.endTransaction(),A},getAnchor:function(){var U=this;if(U.hasOwnProperty("_anchor"))return U._anchor;var Z=qp(U._image);return Z&&Z.anchorX!==H?{x:Z.anchorX,y:Z.anchorY}:U._anchor},setAnchor:function(J,s,i){var r,q=this;"number"==typeof J?r={x:J,y:s}:(r=J.length?{x:J[0],y:J[1]}:J,i=s);var R=q.getAnchor();if(R.x!==r.x||R.y!==r.y){var V=q.getDataModel();if(V&&V.beginTransaction(),q._anchor=r,q.fp("anchor",R,r),i&&!Nf){var M=q.getPosition(),a=q.getSize(),c=q.getRotation(),C=q.getScale(),P=-a.width*(R.x-r.x)*C.x,A=-a.height*(R.y-r.y)*C.y,z=f(c),m=O(c);q.setPosition(M.x+m*P-z*A,M.y+z*P+m*A)}return V&&V.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(S,l){var d,y=this;d=2===arguments.length?{x:S,y:l}:S;var V=y.getScale();(V.x!==d.x||V.y!==d.y)&&(y._scale=d,y.fp("scale",V,d))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var x=this,v=x._scaleTall,b=x.getScale();return[b.x,v,b.y]},getFinalScale3d:function(){var t=this,v=t.s3(),G=t._dynamicScale3d,w=t.getScale3d();return v&&(w[0]*=v[0],w[1]*=v[1],w[2]*=v[2]),G&&(w[0]*=G[0],w[1]*=G[1],w[2]*=G[2]),w},getFinalRotation3d:function(){var W=this;return W._dynamicRotation||W.r3()},setScaleTall:function(S){var w=this,h=w._scaleTall;h!==S&&(w._scaleTall=S,w.fp("scaleTall",h,S))},setScale3d:function(P,x,l){var X,J=this;X="number"==typeof P?{x:P,y:x,z:l}:P.length?{x:P[0],y:P[1],z:P[2]}:P,J.setScaleTall(X.y),J.setScale(X.x,X.z)},getCorners:function(e,K){e==I&&(e=0),K==I&&(K=e);var Z=this,b=Z.getAnchor(),Q=Z.getWidth(),o=Z.getHeight(),S=-Q*b.x-e,z=-o*b.y-K,Y=Q+2*e,h=o+2*K,d=Z.getMatrix();return[d.tf(S,z),d.tf(S,z+h),d.tf(S+Y,z+h),d.tf(S+Y,z)]},getEditControlPoints:function(D,Y,g){Y==I&&(Y=0),g==I&&(g=Y);var S=this,A=S.getAnchor(),H=S.getWidth(),R=S.getHeight(),U=-H*A.x-Y,W=-R*A.y-g,V=H+2*Y,B=R+2*g;if(D)return[{x:U,y:W},{x:U,y:0},{x:U,y:W+B},{x:0,y:W+B},{x:U+V,y:W+B},{x:U+V,y:0},{x:U+V,y:W},{x:0,y:W}];var b=S.getMatrix();return[b.tf(U,W),b.tf(U,0),b.tf(U,W+B),b.tf(0,W+B),b.tf(U+V,W+B),b.tf(U+V,0),b.tf(U+V,W),b.tf(0,W)]},rotateAt:function(_,K,A){var H=this,u=H._position,R=H._64O,w=new ug(R,u.x,u.y).tf(_,K),W=p(_*_+K*K),V=B(u.y-w.y,u.x-w.x)+A;H.setRotation(R+A),H.p(w.x+W*O(V),w.y+W*f(V))},onParentChanged:function(){yq.superClass.onParentChanged.apply(this,arguments),this._8I()},_8I:function(){this._70O&&this._70O.each(function(R){R._7I()})},onPropertyChanged:function(){var V={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(c){V[c]=!0}),function(N){var h=this;yq.superClass.onPropertyChanged.call(h,N),V[N.property]&&!h._layoutUpdating&&h.updateLayoutParameters(null,N.property),h._69O&&h._69O.each(function(x){x.handleHostPropertyChange(N)}),h._49I&&h._49I.each(function(k){k.fp("agentChange",!0,!1)})}}(),onHostChanged:function(){this.updateAttach()},handleHostPropertyChange:function(Y){this.updateAttach(Y)},onStyleChanged:function(z){yq.superClass.onStyleChanged.apply(this,arguments),Xe[z]&&this.updateAttach()},updateAttach:function(r){var M=this;M._51I||Nf||(M._51I=1,M._71O(r),delete M._51I)},_71O:function(J){var Q,h,G,Z,w,Y,V=this,r=V._host,m=J?J.property:I,b=J?J.oldValue:I,l=J?J.newValue:I;if(r instanceof j.Grid){if(m===sr)V.setElevation(V._54O+l-b);else if(!J||Pm[m]){if(Q=V.s("attach.row.index"),h=V.s("attach.column.index"),G=r.getCellRect(Q,h),!G)return;Z=V.s("attach.row.span"),w=V.s("attach.column.span"),(1!==Z||1!==w)&&(G=Tp(G,r.getCellRect(Q+Z-1,h+w-1))),ki(G,V,"attach.padding",1),V.setRect(G)}}else if(r instanceof en&&(Y=V.s("attach.index"))>=0&&(!J||Mi[m])){var L=V.s("attach.thickness");L!=I&&V.setHeight(r.getThickness()*L);var p=V.s("attach.offset"),O=r.getPoints(),y=O.size();if(y>Y){var H=O.get(Y),v=y===Y+1?O.get(0):O.get(Y+1),z=[v.x-H.x,v.y-H.y],f=em(z);if(f){V.s("attach.offset.relative")&&(p*=f),V.s("attach.offset.opposite")&&(p=f-p);var u={x:H.x+z[0]/f*p,y:H.y+z[1]/f*p},F=V.s("attach.gap");F&&(V.s("attach.gap.relative")&&(F*=r.getThickness()),u=ui(I,u,v,F)),V.p(u),V.setRotation(B(z[1],z[0]))}}}else J&&(m===Sf?V.translate(l.x-b.x,l.y-b.y):m===sr?V.setElevation(V._54O+l-b):xo[m]?V._11Q(r,m,l-b):("anchor"===m||"width"===m||"height"===m||"scale"===m)&&V.layout(r))},_11Q:function(){var N=new j.Math.Euler,Y=j.Math.Euler.ReverseOrder,d=new j.Math.Vector2,l=new j.Math.Vector2;return function(h,y,z){var c=this,Z=h.p3(),K=h.r3(),Q=c.p3(),m=c.r3();if(y===_j&&(y="rotationY",z=-z),(y===_j||"rotationY"===y)&&0===m[0]&&0===m[2]&&0===K[0]&&0===K[2]&&0===Q[1]&&0===Z[1])return c.setRotation(-m[1]-z),d.set(Q[0],Q[2]).rotateAround(l.set(Z[0],Z[2]),-z),c.p(d.x,d.y),void 0;var x=yh[h.getRotationMode()],W=x[0],i=x[1],D=x[2],X=ej[W],I=ej[i],O=ej[D],n=Fn();y===_j+W?(O(n,K[kl[D]]),I(n,K[kl[i]]),X(n,z),I(n,-K[kl[i]]),O(n,-K[kl[D]])):y===_j+i?(O(n,K[kl[D]]),I(n,z),O(n,-K[kl[D]])):y===_j+D&&O(n,z);var M=Ip(Q,Z);Ph(M,n),c.p3(Z[0]+M[0],Z[1]+M[1],Z[2]+M[2]);var U=c.getRotationMode();us(n,c.r3(),U),N.setFromRotationMatrix(n,Y(U)),c.r3([N.x,N.y,N.z])}}(),isHostOn:function(F){var C=this;if(C._host&&F&&F._69O)for(var t={},o=C._host;o&&o!==C&&!t[o._id];){if(o===F)return!0;t[o._id]=o,o=o._host}return!1},isLoopedHostOn:function(C){return this.isHostOn(C)&&C.isHostOn(this)},getScaledSize:function(){var f=this.getSize(),Z=this.getScale();return f.width*=Math.abs(Z.x),f.height*=Math.abs(Z.y),f},layout:function(i){if(i=i||this.getHost()){var d=this,y=d.s("layout.h")||"center",_=d.s("layout.v")||"center";if("center"!==y||"center"!==_){var r=new j.Math.Vector2,U=i.getPosition(),x=i.getAnchor(),w=i.getScaledSize();d.getPosition();var C,M,v,W,Q,e=1,b=1;switch(d._layoutUpdating=!0,y){case"left":r.setX(d._layoutHValue-x.x*w.width);break;case"right":r.setX((1-x.x)*w.width-d._layoutHValue);break;case"leftright":C=w.width-d._layoutHValue[2],v=d.getRotation()-i.getRotation(),W=Math.abs(Math.sin(v)),Q=Math.abs(Math.cos(v)),e+=Q*C/d._layoutHValue[3],b+=W*C/d._layoutHValue[4],r.setX(d._layoutHValue[1]+(d._layoutHValue[5]-x.x)*w.width);break;case"center":r.setX((.5-x.x)*w.width-d._layoutHValue);break;case"scale":v=d.getRotation()-i.getRotation(),W=Math.abs(Math.sin(v)),Q=Math.abs(Math.cos(v)),r.setX((.5-x.x)*w.width-d._layoutHValue[1]*w.width/d._layoutHValue[0]),M=w.width/d._layoutHValue[2]-1,e+=Q*M,b+=W*M}switch(_){case"top":r.setY(d._layoutVValue-x.y*w.height);break;case"bottom":r.setY((1-x.y)*w.height-d._layoutVValue);break;case"topbottom":v||(v=d.getRotation()-i.getRotation(),W=Math.abs(Math.sin(v)),Q=Math.abs(Math.cos(v))),C=w.height-d._layoutVValue[2],e+=W*C/d._layoutVValue[3],b+=Q*C/d._layoutVValue[4],r.setY(d._layoutVValue[1]+(d._layoutVValue[5]-x.y)*w.height);break;case"center":r.setY((.5-x.y)*w.height-d._layoutVValue);break;case"scale":v||(v=d.getRotation()-i.getRotation(),W=Math.abs(Math.sin(v)),Q=Math.abs(Math.cos(v))),r.setY((.5-x.y)*w.height-d._layoutVValue[1]*w.height/d._layoutVValue[0]),M=w.height/d._layoutVValue[2]-1,e+=W*M,b+=Q*M}(1!==e||1!==b)&&("leftright"===y||"scale"===y?d.setSize(d._layoutHValue[3]*e,d._layoutHValue[4]*b):d.setSize(d._layoutVValue[3]*e,d._layoutVValue[4]*b)),r.rotateAround(null,i.getRotation()),this.setPosition(r.x+U.x,r.y+U.y),d._layoutUpdating=H}}},updateLayoutParameters:function(B,L){if(B=B||this.getHost()){var Y=this,e=Y.s("layout.h"),l=Y.s("layout.v");if(e||l){var P,d,D,E,r,Q,$=new j.Math.Vector2,g=B.getPosition(),o=B.getAnchor(),x=B.getScaledSize(),a=Y.getPosition(),C=Y.getSize();switch($.set(a.x-g.x,a.y-g.y),$.rotateAround(null,-B.getRotation()),e){case"left":Y._layoutHValue=$.x+o.x*x.width;break;case"right":Y._layoutHValue=-$.x+(1-o.x)*x.width;break;case"center":Y._layoutHValue=-$.x+(.5-o.x)*x.width;break;case"leftright":case"scale":"scale"===e?P=-$.x+(.5-o.x)*x.width:(d=Y.getAnchor(),D=Y.getRotation()-B.getRotation(),E=Math.cos(D),r=Math.sin(D),Q=-Math.min(-d.x*E+d.y*r,-d.x*E-(1-d.y)*r,(1-d.x)*E+d.y*r,(1-d.x)*E-(1-d.y)*r),P=$.x-(Q-o.x)*x.width),"position"===L&&"object"==typeof Y._layoutHValue?(Y._layoutHValue[0]=x.width,Y._layoutHValue[1]=P):Y._layoutHValue=[x.width,P,x.width,C.width,C.height,Q]}switch(l){case"top":Y._layoutVValue=$.y+o.y*x.height;break;case"bottom":Y._layoutVValue=-$.y+(1-o.y)*x.height;break;case"center":Y._layoutVValue=-$.y+(.5-o.y)*x.height;break;case"topbottom":case"scale":"scale"===l?P=-$.y+(.5-o.y)*x.height:(D||(d=Y.getAnchor(),D=Y.getRotation()-B.getRotation(),E=Math.cos(D),r=Math.sin(D)),Q=-Math.min(-d.x*r-d.y*E,-d.x*r+(1-d.y)*E,(1-d.x)*r-d.y*E,(1-d.x)*r+(1-d.y)*E),P=$.y-(Q-o.y)*x.height),"position"===L&&"object"==typeof Y._layoutVValue?(Y._layoutVValue[0]=x.height,Y._layoutVValue[1]=P):Y._layoutVValue=[x.height,P,x.height,C.width,C.height,Q]}}}},getSerializableProperties:function(){var _=yq.superClass.getSerializableProperties.call(this);return Of(_,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),_}});var jl=j.Edge=function(o,n){var X=this;zp(jl,X),X.setSource(o),X.setTarget(n)};yp("Edge",Uk,{_icon:"edge_icon",getUIClass:function(){return _c},_22Q:function(){return ss},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},setSource:function(M){var Y=this;if(Y._source!==M){var H=Y._source;Y._source=M,H&&H._16I(Y),M&&M._2I(Y),Y._7I(),Y.fp("source",H,M)}},setTarget:function(V){var d=this;if(d._target!==V){var f=d._target;d._target=V,f&&f._18I(d),V&&V._4I(d),d._7I(),d.fp("target",f,V)}},isLooped:function(){var B=this;return B._source===B._target&&!!B._source&&!!B._target},_7I:function(){var l,x=this,k=od(x);x._40I!==k&&(l=this._40I,l&&l._15I(x),x._40I=k,k&&k._1I(x),x.fp("sourceAgent",l,k),eb(l,x._41I),eb(k,x._41I));var q=Dd(x);x._41I!==q&&(l=x._41I,l&&l._17I(x),x._41I=q,q&&q._3I(x),x.fp("targetAgent",l,q),eb(l,x._40I),eb(q,x._40I))},_22I:function(a){this._52I=a,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var U=this;return U._52I&&U._52I.get(0)!==U&&!U.getStyle(Yf)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var N=this,F=N._52I;return F&&!N.getStyle(Yf)&&F.size()>1&&N===F.get(0)},toggle:function(){var h=this._52I,c=!this.s(Yf);h&&h.size()>1&&(h.each(function(p){p.s(Yf,c)}),h.getSiblings().each(function(v){v!==h&&v.each(function(Z){Z.fp("edgeGroup",I,v)})}))},setStyle:function(s,a){(s===Qe||"edge.segments"===s)&&(a=Wf(a)),jl.superClass.setStyle.call(this,s,a)},onStyleChanged:function(_){jl.superClass.onStyleChanged.apply(this,arguments),mf[_]&&eb(this._41I,this._40I)},getSerializableProperties:function(){var c=jl.superClass.getSerializableProperties.call(this);return Of(c,{source:1,target:1}),c}});var Md=j.Group=function(){zp(Md,this)};yp("Group",yq,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return ao},onChildAdded:function(){Md.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){Md.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var E=this;if(!E._54I&&!Nf){var l=E.getChildrenRect();l&&(E._53I=1,E.p(Xp(E.s("group.position"),l,E.getSize())),delete E._53I)}},getChildrenRect:function(){var v,O=this;return O.eachChild(function(X){v=Tp(v,O.getChildRect(X))}),v},getChildRect:function(w){var b;return er(w)&&w.s(Pj)&&(Co(w)&&w.isExpanded()&&w.eachChild(function(k){b=Tp(b,w.getChildRect(k))}),!b&&w.getRect&&(b=w.getRect())),b},setPosition:function(Z,j){var p=this;if(!p._54I){var V;V=2===arguments.length?{x:Z,y:j}:Z,Nf||p._53I||(p._54I=1,Cs(p._children,V.x-p._position.x,V.y-p._position.y),delete p._54I),Md.superClass.setPosition.call(this,V)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(F){var i=this;if(i._57O!==F){var w=i._57O;i._57O=F,i.fp("expanded",w,i._57O),i._fireInvalidateDeep(),i._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(T){Co(T)?T._fireInvalidateDeep():T.iv()})},_8I:function(){Md.superClass._8I.call(this),this.eachChild(function(D){er(D)&&D._8I()})},onStyleChanged:function(e){Md.superClass.onStyleChanged.apply(this,arguments),"group.position"===e&&this._81I()},getSerializableProperties:function(){var K=Md.superClass.getSerializableProperties.call(this);return K.expanded=1,K}});var tm=j.Block=function(){zp(tm,this)};yp("Block",yq,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return xp},onChildAdded:function(){tm.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){tm.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},updateFromChildren:function(){var h=this;if(!Nf&&!h._updatingToChildren&&h._syncSize&&!h._freezeSyncFromChildren){var B,z,G,R,p,P=[],i=h.getRotation();if(h.eachChild(function(X){er(X)&&P.push.apply(P,X.getCorners())}),P.length){h._updatingFromChildren=1;var W=O(-i),w=f(-i),t=1/0,K=-1/0,l=1/0,u=-1/0;for(R=0,p=P.length;p>R;R++)G=P[R],B=G.x,z=G.y,G.x=W*B-w*z,G.y=w*B+W*z,t=N(t,G.x),K=o(K,G.x),l=N(l,G.y),u=o(u,G.y);var Q=h.getScale();h.setSize(J((K-t)/Q.x),J((u-l)/Q.y));var v;Q.x<0&&(v=t,t=K,K=v),Q.y<0&&(v=l,l=u,u=v),W=O(i),w=f(i);var Z=h.getAnchor();B=t+(K-t)*Z.x,z=l+(u-l)*Z.y,h.setPosition(W*B-w*z,w*B+W*z),delete h._updatingFromChildren}}},setPosition:function(S,x){var X=this;if(!X._updatingToChildren){var h;h=2===arguments.length?{x:S,y:x}:S,Nf||X._updatingFromChildren||(X._updatingToChildren=1,Cs(X._children,h.x-X._position.x,h.y-X._position.y),delete X._updatingToChildren),tm.superClass.setPosition.call(this,h)}},setWidth:function(A){return this.setSize(A,this.getHeight())},setHeight:function(J){return this.setSize(this.getWidth(),J)},setSize:function(J,G){1>J&&(J=1),1>G&&(G=1);var p=this;if(!p._updatingToChildren){2!==arguments.length&&(G=J.height,J=J.width);var K=p.getWidth(),o=p.getHeight();if(J!==K&&tm.superClass.setWidth.call(p,J),G!==o&&tm.superClass.setHeight.call(p,G),!Nf&&!p._updatingFromChildren){p._updatingToChildren=1;var e=J/K,A=G/o;p._adjustChildScaleOrSize(e,A,"size"),delete p._updatingToChildren,p.updateFromChildren()}}},_adjustChildScaleOrSize:function(q,I,r){var $=this;if($._syncSize){var N=$.getPosition(),E=$.getRotation();$.getScale(),$.eachChild(function(S){if(er(S)){var Y=S.getPosition(),J=S.getRotation(),h=S.getWidth(),M=S.getHeight(),m=S.getScale(),K=m.x*h,d=m.y*M,j=new ug(J,Y.x,Y.y,K,d);j.translate(-N.x,-N.y),j.rotate(-E),J=B(j.b*Math.sign(K),j.a*Math.sign(K)),j.scale(q,I);var W,V,y,s=O(J);if(Math.abs(s)<.001?(W=f(J),V=j.b/W,y=-j.c/W):(V=j.a/s,y=j.d/s),"scale"===r)S.setScale(V/h,y/M);else if("size"===r){var b=V/m.x,Q=y/m.y;S.setScale(sk(V)*Math.abs(m.x),sk(y)*Math.abs(m.y)),S.setSize(Math.max(.1,Math.abs(b)),Math.max(.1,Math.abs(Q)))}j.rotate(E),j.translate(N.x,N.y),S.setPosition(j.tx,j.ty)}})}},_calcChangeFactor:function(H,A,L,R){var j,$,O,n;return j=J(H),$=J(L),O=j>$?j/$:$/j,j=J(A),$=J(R),n=j>$?j/$:$/j,o(O,n)},setAnchor:function(){var H=this;if(!H._updatingToChildren){var i=H.getAnchor();if(tm.superClass.setAnchor.apply(H,arguments),!Nf&&!H._updatingFromChildren&&H._syncSize){H._updatingToChildren=1;var S=H.getAnchor();H.getPosition();var Z=H.getSize(),X=H.getScale(),N=H.getRotation(),F=-Z.width*X.x*(i.x-S.x),Q=-Z.height*X.y*(i.y-S.y),h=f(N),c=O(N),W=c*F-h*Q,g=h*F+c*Q;H.eachChild(function(w){if(er(w)){var P=w.getPosition();w.setPosition(P.x-W,P.y-g)}}),delete H._updatingToChildren}}},setRotation:function(l){var S=this;if(!S._updatingToChildren){var A=S.getRotation();if(tm.superClass.setRotation.apply(S,arguments),!Nf&&!S._updatingFromChildren){S._updatingToChildren=1;var C=S.getPosition(),E=l-A;S.eachChild(function(V){if(er(V)){var x=V.getMatrix();x.translate(-C.x,-C.y),x.rotate(E),x.translate(C.x,C.y);var P=Math.sign(V.getScale().x);V.setRotation(B(x.b*P,x.a*P)),V.setPosition(x.tx,x.ty)}}),delete S._updatingToChildren}}},setScale:function(P,u){var n=this;if(!n._updatingToChildren){null==u&&(u=P.y,P=P.x);var E=n.getScale();if(J(P)<.01&&(P=.01*(sk(P)||sk(E.x))),J(u)<.01&&(u=.01*(sk(u)||sk(E.y))),tm.superClass.setScale.call(n,P,u),!Nf&&!n._updatingFromChildren){n._updatingToChildren=1;var Y=P/E.x,p=u/E.y;n._adjustChildScaleOrSize(Y,p,"size"),delete n._updatingToChildren,n.updateFromChildren()}}},getSerializableProperties:function(){var p=tm.superClass.getSerializableProperties.call(this);return p.clickThroughEnabled=1,p.syncSize=1,p}});var pp=j.Grid=function(){zp(j.Grid,this)};yp("Grid",yq,{IRotatable:!1,_icon:"grid_icon",_image:I,getUIClass:function(){return Bn},setRotation:function(){},getCellRect:function(h,R){var D=this,U=D.s("grid.row.count"),t=D.s("grid.column.count");if(0>=U||0>=t||0>h||h>=U||0>R||R>=t)return I;var c,s,E,X=D.getRect(),u=D.s("grid.row.percents"),v=D.s("grid.column.percents");if(ki(X,D,"grid.border",-1),u&&u._as&&(u=u._as),v&&v._as&&(v=v._as),u&&u.length===U){for(E=0,c=0;h>c;c++)E+=X.height*u[c];X.y+=E,X.height=X.height*u[h]}else X.height=X.height/U,X.y+=X.height*h;if(v&&v.length===t){for(s=0,c=0;R>c;c++)s+=X.width*v[c];X.x+=s,X.width=X.width*v[R]}else X.width=X.width/t,X.x+=X.width*R;return Rd(X,-D.s("grid.gap")),X}});var Db=j.Text=function(){zp(Db,this),this.setSize(100,50),this.s("text","TEXT")};yp("Text",yq,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return ns},setWidth:function(B){B||(B=.001),Db.superClass.setWidth.call(this,B)},setHeight:function(G){G||(G=.001),Db.superClass.setHeight.call(this,G)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),Jp("__text__",{width:{value:100,isSafeFunc:!0,func:function(S){return S._width}},height:{value:50,isSafeFunc:!0,func:function($){return $._height}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var en=j.Shape=function(){zp(en,this),this._59O=new fb};en.__de__=Xf,yp("Shape",yq,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return ym},_22Q:function(){return ai},getLength:function(b){return Ib(bf(this._59O,this._58O,b,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var L=this._58O;return L?new fb(L._as.slice(0)):L},setSegments:function(R){var X=this._58O;R=R?Ck(R)?new fb(R.slice(0)):new fb(R._as.slice(0)):null,(X&&R&&X._as.join(",")!==R._as.join(",")||X!==R)&&(this._58O=R,this.fp("segments",X,R))},getPoints:function(){return this._59O},toPoints:function(){var N=this._59O;return new fb(N._as.slice(0))},setPoints:function(d,G){var U=this,x=U._59O;d=d?Ck(d)?new fb(d.slice(0)):new fb(d._as.slice(0)):new fb;var j,M,Q,m,J,S;G&&(j=U.getPosition(),S=new ug(U.getRotation(),0,0,U.getScale().x,U.getScale().y)),(x&&d&&x._as.join(",")!==d._as.join(",")||x!==d)&&(U._59O=d,U.fs(),U.fp("points",x,d)),G&&(M=U.getPosition(),Q=M.x-j.x,m=M.y-j.y,J=S.tf(Q,m),U.setPosition(M.x-Q+J.x,M.y-m+J.y))},addPoint:function(Q,R,L){var s=this.toPoints();s.add(Q,R),this.setPoints(s,L)},setPoint:function(C,L,c){var T=this.toPoints();T.set(C,L),this.setPoints(T,c)},removePointAt:function(G){var o=this.toPoints();o.removeAt(G),this.setPoints(o)},setWidth:function(k){var i=this;if(1>k&&(k=1),!i._55I&&!Nf&&i.getWidth()){i._55I=1;var D=i._position.x,M=k/i.getWidth(),Z=i.toPoints(),O=new fb;Z.each(function(A){O.add({x:(A.x-D)*M+D,y:A.y,e:A.e})}),i.setPoints(O),lb(i,[M,0,0,1,D*(1-M),0]),i.fs(),delete i._55I}en.superClass.setWidth.call(i,k)},setHeight:function(o){var u=this;if(1>o&&(o=1),!u._55I&&!Nf&&u.getHeight()){u._55I=1;var $=u._position.y,s=o/u.getHeight(),A=u.toPoints(),E=new fb;A.each(function(F){E.add({x:F.x,y:(F.y-$)*s+$,e:F.e})}),u.setPoints(E),lb(u,[1,0,0,s,0,$*(1-s)]),u.fs(),delete u._55I}en.superClass.setHeight.call(u,o)},setAnchorElevation:function(I){var Y=this;Y._55I=!0;var p=Y._updatingAnchor3d,K=!Nf&&!p;if(K){var w,T=I,o=Y.getAnchorElevation(),n=Y.getTall();w=n*(o-T),Y.shiftPointsElevation(w)}var b=en.superClass.setAnchorElevation.apply(Y,arguments);return p||delete Y._55I,b},getShapeElevation:function(){var M=this,O=M._54O;return O-(M.getTall()||0)*(M._anchorElevation-.5)},setAnchor3d:function(M,i,g,A){var m,V=this;"number"==typeof M?m={x:M,y:i,z:g}:(m=M.length?{x:M[0],y:M[1],z:M[2]}:M,A=i),V._55I=!0,V._updatingAnchor3d=!0;var X=V.getDataModel();if(X&&X.beginTransaction(),!Nf){var H=V.getAnchor3d(),o=V.getSize(),x=V.getTall(),b=o.width*(H.x-m.x),y=o.height*(H.z-m.z),v=x*(H.y-m.y);A||V.shiftPoints(b,y,v);var c=V.p3()}var r=en.superClass.setAnchor3d.apply(V,arguments);if(!Nf&&A){var B=V.p3();V.shiftPoints(B[0]-c[0]+b,B[2]-c[2]+y,B[1]-c[1]+v)}return X&&X.endTransaction(),delete V._updatingAnchor3d,delete V._55I,r},setAnchor:function(o,F,$){var H=this;H._55I=!0;var x=H._updatingAnchor3d,j=!Nf&&!x;if(j){var s,p,l;"number"==typeof o?l={x:o,y:F}:(l=o.length?{x:o[0],y:o[1]}:o,$=F);var n=H.getAnchor(),C=H.getSize();s=C.width*(n.x-l.x),p=C.height*(n.y-l.y),$||H.shiftPoints(s,p);var m=H.getPosition()}var w=en.superClass.setAnchor.apply(H,arguments);if(j){var y=H.getPosition();$&&H.shiftPoints(y.x-m.x+s,y.y-m.y+p)}return x||delete H._55I,w},shiftPoints:function(y,u,L){var v=this,F=v.getElevation()||0,r=v.toPoints(),x=new fb;r.each(function(P){var T=P.e;L&&(T=(T==I?F:T)+L),x.add({x:P.x+y,y:P.y+u,e:T})}),v.setPoints(x),v.fs()},shiftPointsElevation:function(p){return this.shiftPoints(0,0,p)},setPosition:function(w,A){var Q,X=this;if(!X._28Q){if(X._28Q=1,!X._55I&&!Nf){Q=2===arguments.length?{x:w,y:A}:w;var T=Q.x-X._position.x,E=Q.y-X._position.y;if(0===T&&0===E)return delete X._28Q,void 0;X._55I=1,X.shiftPoints(T,E),lb(X,[1,0,0,1,T,E]),delete X._55I}en.superClass.setPosition.apply(X,arguments),delete X._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var H=this;if(2!==H._59O.size())return!1;var C=H._58O;return C?2===C.size()&&1===C.get(0)&&2===C.get(1)?!0:!1:!0},fireShapeChange:function(){var L=this;if(!L._55I&&!Nf){var Z=no(L._59O);Z&&(L._55I=1,L.setRect(Z),delete L._55I)}L.fp(Rc,!1,!0)},getSerializableProperties:function(){var j=en.superClass.getSerializableProperties.call(this);return j.segments=1,j.points=1,j.thickness=1,j.closePath=1,j}});var Xk=j.Polyline=function(){zp(Xk,this),this.s({"shape.background":null,"shape.border.width":2})};yp("Polyline",en,{_icon:"polyline_icon",_22Q:function(){return $l},getUIClass:function(){return Ab},setClosePath:function(){},setTall:function(g){var e=this;if(!e._55I&&!e._24Q&&!Nf&&e.getTall()){e._24Q=1;var c=e._54O,J=g/e.getTall();e._59O.each(function(Z){Z.e=Z.e==I?c:(Z.e-c)*J+c}),e.fs(),delete e._24Q}Xk.superClass.setTall.call(e,g)},setElevation:function(c){var k=this;if(!k._55I&&!k._24Q&&!Nf){k._24Q=1;var E=c-k._54O;k._59O.each(function(W){W.e==I?W.e=c:W.e+=E}),k.fs(),delete k._24Q}Xk.superClass.setElevation.apply(k,arguments)},fireShapeChange:function(){var i=this,X=i._59O;if(!i._55I&&!i._24Q&&!Nf){var m=X.size();if(m){var T=1,r=X.get(0),W=i._54O;r.e==I&&(r.e=W);for(var _=r.e,j=0;m>T;T++){r=X.get(T),r.e==I&&(r.e=W);var E=N(_,r.e),u=o(_+j,r.e);_=E,j=u-E}i._24Q=1,i.setTall(j),i.setElevation(_+j*i._anchorElevation),delete i._24Q}}Xk.superClass.fireShapeChange.apply(i,arguments)}});var Eg=j.SubGraph=function(){zp(Eg,this)};yp("SubGraph",yq,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){Eg.superClass._8I.call(this),this.eachChild(function(x){er(x)&&x._8I()})}}),h.loadingRefGraph=0;var rl=j.RefGraph=function(){zp(rl,this)};yp("RefGraph",tm,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(A){var o=this._ref;this._ref=A,this.fp("ref",o,A),this.updateRef()},_21I:function(){rl.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var q=this;if(h.loadingRefGraph++,q.clearChildrenFromDataModel(),h.loadingRefGraph--,q._ref&&q._dataModel){q._xhrLoadHandler&&(q._xhrLoadHandler.cancel=!0);var a=Nf,B=q._xhrLoadHandler=function(w){if(w&&q._dataModel){h.loadingRefGraph++;var C=q._pendingUpdateInfo={needToRestore:a};a&&(C.position=q.p(),C.width=q.getWidth(),C.height=q.getHeight(),C.rotation=q.getRotation(),C.anchor=q.getAnchor(),C.scale=q.getScale()),q.p(0,0),q.setAnchor(.5,.5),q.setRotation(0),q.setScale(1,1);var D=h.parse(w),k=q._dataModel.deserialize(D,q,{justDatas:!0});k.each(function(H){H._refGraph=q}),q.checkPendingUpdateInfo(),h.loadingRefGraph--,h.handleRefGraphLoaded(q,k,D)}};B.xhrLoadCalled=!1,h.load(q._ref,function(n){B.cancel||(B.xhrLoadCalled?B(n):Cr(function(){B(n)}))}),B.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var L=this,m=L._pendingUpdateInfo;if(!m)return L.onPendingUpdated&&(h.loadingRefGraph++,L.onPendingUpdated(),h.loadingRefGraph--),void 0;var R=!0;this.eachChild(function(e){(e._pendingCheckImageJSON||e._pendingUpdateInfo)&&(R=!1)}),R&&(h.loadingRefGraph++,L._pendingUpdateInfo=null,L.updateFromChildren(),m.needToRestore&&(L.setSize(m.width,m.height),L.setAnchor(m.anchor),L.setRotation(m.rotation),L.setScale(m.scale),L.p(m.position)),this.getParent()instanceof rl&&this.getParent().checkPendingUpdateInfo(),L.onPendingUpdated&&L.onPendingUpdated(),h.loadingRefGraph--)},getSerializableProperties:function(){var A=rl.superClass.getSerializableProperties.call(this);return A.ref=1,A}}),j.EdgeGroup=function(J,c){this._70O=J,this._siblings=c;for(var q,j,n=0,M=J.size(),T=v[Yf];M>n;n++)if(q=J.get(n).getStyle(Yf,!1),q!=I){T=q;break}T==I&&(T=!0);var i=h.edgeGroupAgentFunc;for(i&&(j=i(J),j&&j!==J.get(0)&&(J.remove(j),J.add(j,0))),n=0;M>n;n++)J.get(n).s(Yf,T)},yp("EdgeGroup",C,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(K){return this._70O.get(K)},indexOf:function(z){return this._70O.indexOf(z)},each:function(M,B){this._70O.each(M,B)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(F,z){this._siblings.each(function(s){s._70O.each(F,z)})}});var Fg=function(K,a,Q){var U=hn[K]={type:K,action:a};if(Q)for(var y in Q)U[y]=Q[y]};Of(h,{setConnectAction:Fg,getConnectAction:function(G,C){if(!C){if(!G)return null;C=G.getCurrentConnectActionType()}return hn[C]},doConnectAction:function(e,L,k,Q){Q=Q||e.getCurrentConnectActionType();var m=hn[Q];if(!m)return!1;var a=m.action;return a?(L instanceof Il.Group?e.sm().getSelection().each(function(d){a.call(null,e,d,k)}):a.call(null,e,L,k),!0):!1},doDeleteConnectionAction:function(q,K,C){C=C||q.getCurrentConnectActionType();var y=hn[C];if(!y||!y.delete)return!1;var U=y.delete.action;return U?(K instanceof Il.Group?q.sm().getSelection().each(function(i){U.call(null,q,i)}):U.call(null,q,K),!0):!1}});var _q=j.JSONSerializer=function(o,D){this.dm=this._dataModel=o,this._hierarchical=h.forceHierarchicalSerialization?!0:D==I?o.isHierarchicalRendering():D};yp("JSONSerializer",C,{ms_ac:["hierarchical"],serialize:function(J){return h.stringify(this.toJSON(),J)},toJSON:function(){var s=this,X=s.dm,N=X.getRoots(),p=s.json={v:h.getVersion(),p:{},a:{},d:[]},I=X.getSerializableAttrs();X.getInit()&&(p.init=X.getInit()),X.getName()&&(p.p.name=X.getName()),X.getBackground()&&(p.p.background=X.getBackground()),X.getLayers()&&(p.p.layers=X.getLayers()),X.getEnvmap()&&(p.p.envmap=X.getEnvmap()),p.p.autoAdjustIndex=X.isAutoAdjustIndex(),p.p.hierarchicalRendering=X.isHierarchicalRendering();for(var l in I){var W=X.a(l);W!==H&&s[Zh](l,W,p.a)}return fh(p.a)&&delete p.a,s._hierarchical?N.each(s.serializeData,this):X.each(function(o){s.serializeData(o)}),X.fireSerializeEvent({type:"serialize",json:p}),X.getPostProcessingData()&&(p.p.postProcessingData=X.getPostProcessingData()),p},isSerializable:function(){return!0},getProperties:function(E){return E.getSerializableProperties()},getStyles:function(J){return J.getSerializableStyles()},getAttrs:function(J){return J.getSerializableAttrs()},serializeData:function(w){var M=this;if(M.isSerializable(w)&&!w._refGraph){var e,l,X,R,o=Vf(w.getClassName())||w.getClass(),u=new o,c={c:w.getClassName(),i:w.getId(),p:{},s:{},a:{}};M.json.d.push(c),e=M.getProperties(w);for(l in e)/^_/.test(l)?(X=w[l],X!==u[l]&&M[Zh](l.substr(1),X,c.p)):(R=ys(l),w[R]&&(X=w[R](),X!==u[R]()&&M[Zh](l,X,c.p)));e=M.getStyles(w);for(l in e)X=w.s(l),X!==u.s(l)&&M[Zh](l,X,c.s);e=M.getAttrs(w);for(l in e)X=w.a(l),X!==u.a(l)&&M[Zh](l,X,c.a);fh(c.p)&&delete c.p,fh(c.s)&&delete c.s,fh(c.a)&&delete c.a}M._hierarchical&&w.getChildren().each(M.serializeData,M)},serializeValue:function(T,l,n){Am(l)?l={__a:l._as}:l instanceof Uk&&(l={__i:l.getId()}),n[T]=l},deserialize:function(K,w,R){var f=this;return _e(K)&&/.json$/.test(K)?(h.xhrLoad(K,function(y){f.deserializeImpl(y,w,R)}),void 0):f.deserializeImpl(K,w,R)},deserializeImpl:function(i,x,L){var z=this,s=z.dm;L=Ro(L)?{setId:L}:gj(L)?{finishFunc:L}:L||{},i=z.json=_e(i)?h.parse(i):i,i.a&&i.a.onPreDeserialize&&!L.disableOnPreDeserialize&&i.a.onPreDeserialize(i,s,L.view),s.beginTransaction(),Nf++,z._82I={};var $=new fb,K=new fb,P=0,W=i.d.length;if(L.justDatas||(gj(i.init)&&i.init(s),s.setInit(i.init)),!L.justDatas){for(var y in i.a)s.a(y,z[md](i.a[y]));for(var c in i.p)s[Kc(c)](i.p[c])}for(;W>P;P++){var S=i.d[P],R=Vf(S.c),Q=new R,d=S.i;L.setId&&d!=I&&(Q._id=d),z._82I[d]=Q,$.add(Q),K.add(S)}for(P=0;W>P;P++)z.deserializeData($.get(P),K.get(P));return $.each(function(W){x&&!W.getParent()&&W.setParent(x),s.add(W)}),s.fireSerializeEvent({type:"deserialize",json:i}),Nf--,s.endTransaction(),i.a&&i.a.onPostDeserialize&&!L.disableOnPostDeserialize&&i.a.onPostDeserialize(i,s,L.view,$),L.finishFunc&&L.finishFunc(i,s,L.view,$),$},deserializeData:function(I,W){for(var J in W.p)I[Kc(J)](this[md](W.p[J]));for(J in W.s)I.s(J,this[md](W.s[J]));for(J in W.a)I.a(J,this[md](W.a[J]))},deserializeValue:function($){if(Lg($)){var l=$.__i;if(l!=I)return this._82I[l];if(l=$.__a,Ck(l))return new fb(l)}return $}}),Of(pd,{serialize:function(g,r){return new _q(this,r).serialize(g)},toJSON:function(o){return new _q(this,o).toJSON()},deserialize:function(Z,H,S){return new _q(this).deserialize(Z,H,S)}});var wc=j.OverlappingBox=function(T){this.gv=T,this.boxes={}};yp("OverlappingBox",C,{clear:function(){var y,r,b=this.boxes;for(y in b)r=b[y],r.length=0
},isOverlapping:function(r,T){var V,l,z=this,t=z.boxes,I=t[r];I?(V=I.rects,l=I.length):I=t[r]={rects:V=[],length:l=0};var Z,D,T;for(Z=0;l>Z;Z++)if(D=V[Z],D.x<T.x+T.w&&D.x+D.w>T.x&&D.y<T.y+T.h&&D.h+D.y>T.y)return!0;return V.length<=l?(V.push(T),I.length++):V[I.length++]=T,!1}}),Of(h,{fetch:function(D,u){var W="GET",p=!1,C=null,n="";u&&(W=u.method||"GET",p=u.sync,n=u.url,C=u.data||null),D.open(W,n,!p),u.responseType?D.responseType=u.responseType:u.overrideMimeType&&D.overrideMimeType(u.overrideMimeType),D.send(C)},convertImageSrc:function(I,S){S&&"function"==typeof S||(S=function(){}),S(I)}});var Ml=j.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};yp("Request",C,{_responseType:null,_overrideMimeType:"text/plain",send:function(C){var a=this._xhr,f=this.onload,S=this.onerror;this.getResponseType()?C.responseType=this.getResponseType():this.getOverrideMimeType()&&(C.overrideMimeType=this.getOverrideMimeType()),a.onload=f,a.onerror=S,h.fetch(a,C)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(c){this._responseType=c},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(P){this._overrideMimeType=P},getResponseText:function(){var c=this._xhr;return c.response||c.responseText}}),Ql.GraphView=function(O){var G=this;G._24I={},G._34I=new fb,G._25I={},G._56I={},G._view=Di(1,G),G._canvas=Ue(G._view),G.dm(O?O:new pd),this._coreInteractor=new nl(this),G.setEditable(!1),G.setScrollBarVisible(h.graphViewScrollBarVisible)},li("GraphView",C,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Ji,Er,Wc,Qo,"resettable","editInteractor",_d,"pannable","rectSelectable","autoScrollZone",Dr,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_resettable:h.graphViewResettable,_pannable:h.graphViewPannable,_rectSelectable:h.graphViewRectSelectable,_autoScrollZone:h.graphViewAutoScrollZone,_rectSelectBackground:h.graphViewRectSelectBackground,_rectSelectBorderColor:h.graphViewRectSelectBorderColor,_editPointSize:h.graphViewEditPointSize,_editPointBorderColor:h.graphViewEditPointBorderColor,_editPointBackground:h.graphViewEditPointBackground,_scrollBarColor:jj,_scrollBarSize:Gl,_autoHideScrollBar:Ec,_autoMakeVisible:pq,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(D){this._dataModel.setLayers(D)},setEditable:function(a){var s=this,M=s.__interactorMap__;if(!M){var E=Ql.XEditInteractor;M=s.__interactorMap__={scrollBar:new tl(s),select:new nh(s),edit:E?new E(s):new zn(s),move:new Ho(s),"default":new Yd(s),touch:new nf(s,{editable:!1})}}a?(s._uieditable=!0,s.setInteractors([M.scrollBar,M.select,M.edit,M.move,M.default,M.touch])):(s._uieditable=!1,s.setInteractors([M.scrollBar,M.select,M.move,M.default,M.touch]))},getCanvas:function(){return this._canvas},_33I:function(_){var h=_.getUIClass();return h?new h(this,_):I},getDataUI:function(s){var h=this,l=h._25I[s._id];return l===H&&(l=h._33I(s),h._25I[s._id]=l),l},getNodeRect:function(q){return h.getNodeRect(this,q)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(a){var L=this.getDataUI(a);return L?(L._79o(),L._78o):null},getEdgeSourcePosition:function(d){var t=this,x=t.getDataUI(d),A=x.s,E=x._data._40I;return Sh(t,E,A("edge.source.position"),A("edge.source.offset.x"),A("edge.source.offset.y"),A("edge.source.anchor.x"),A("edge.source.anchor.y"))},getEdgeTargetPosition:function(U){var d=this,k=d.getDataUI(U),Z=k.s,n=k._data._41I;return Sh(d,n,Z("edge.target.position"),Z("edge.target.offset.x"),Z("edge.target.offset.y"),Z("edge.target.anchor.x"),Z("edge.target.anchor.y"))},invalidateAll:function(x){var p=this;if(x){for(var K in p._25I){var y=p._25I[K];y&&y.dispose()}p._25I={},p._56I={},p._24I={},p._34I.clear(),p.redraw()}else p.dm().each(function(z){p.invalidateData(z)})},invalidateSelection:function(){var a=this;a.sm().each(function(P){a.invalidateData(P)})},invalidateData:function(Z){var G=this;G._24I[Z._id]=Z,G._21Q(Z),G.iv()},_21Q:function(j){var h=this,V=h._24I;if(Sg(j)&&wb[j.s(rd)]){var O=j.getSourceAgent();O&&O.getAgentEdges().each(function(l){V[l._id]=l}),O=j.getTargetAgent(),O&&O.getAgentEdges().each(function(H){V[H._id]=H}),h.iv()}},redraw:function(r){var i=this;i._32I||(r?i._34I.add(r):(i._32I=1,i._34I.clear()),i.iv())},each:function(m,U){var t,C,e,I=0,v=this.getLayers(),$=this._dataModel,M=$._datas._as,J=M.length;if(v){for(var s=v.length;s>I;I++)if(e=v[I],Lg(e)&&(e=e.name),$.isHierarchicalRendering()){var b=function(A){return A._layer===e?U?m.call(U,A):m(A):void 0};if(this._dataModel.eachByHierarchical(b)===!1)return}else for(var r=0;J>r;r++)if(t=M[r],t._layer===e&&(C=U?m.call(U,t):m(t),C===!1))return}else if($.isHierarchicalRendering())this._dataModel.eachByHierarchical(m,null,U);else for(;J>I;I++)if(t=M[I],C=U?m.call(U,t):m(t),C===!1)return},reverseEach:function(S,Q){var o,M,f,W,b=this._dataModel,D=b._layers,h=b._datas._as,z=h.length;if(D){for(o=D.length-1;o>=0;o--)if(W=D[o],Lg(W)&&(W=W.name),b.isHierarchicalRendering()){var k=function(b){return b._layer===W?Q?S.call(Q,b):S(b):void 0};if(b.reverseEachByHierarchical(k)===!1)return}else for(var K=z-1;K>=0;K--)if(M=h[K],M._layer===W&&(f=Q?S.call(Q,M):S(M),f===!1))return}else if(b.isHierarchicalRendering())b.reverseEachByHierarchical(S,null,Q);else for(o=z-1;o>=0;o--)if(M=h[o],f=Q?S.call(Q,M):S(M),f===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var j=this,t=j._84I;if(!t){var h=this.dm().a("width"),r=this.dm().a("height");h>0&&r>0?j._84I={x:0,y:0,width:h,height:r}:(j.each(function(F){j.isVisible(F)&&(t=Tp(t,j.getDataUIBounds(F)))}),j._84I=t?t:jq)}return j._84I},getScrollRect:function(){return Tp(this.getContentRect(),this._29I)},makeCenter:function(N,r,L){var O=this;if(!O.getWidth()||!O.getHeight())return L||Cr(O.centerData,O,[N,r,!0],500),void 0;O.makeVisible(N),O.validate();var k=O.getDataUIBounds(N);if(k){var R=O.getWidth(),d=O.getHeight(),g=k.x+k.width/2,a=k.y+k.height/2,v=-g*O._zoom+R/2,l=-a*O._zoom+d/2;O.setTranslate(v,l,r)}},fitData:function(x,G,Q,H,l){var T=this;if(!T.getWidth()||!T.getHeight())return l||Cr(T.fitData,T,[x,G,Q,H,!0],500),void 0;var B=function(){T.makeVisible(x),T.validate();var M=T.getDataUIBounds(x);M&&(M=oc(M),Rd(M,Q==I?20:Q),T.fitRect(M,G,H))};G?h.callWhenLoaded(B):B()},fitContent:function(z,d,V,q){var t=this;if(!t.getWidth()||!t.getHeight())return q||Cr(t.fitContent,t,[z,d,V,!0],500),void 0;var U=function(){t.validate();var u=oc(t.getContentRect());Rd(u,d==I?20:d),t.fitRect(u,z,V)};z?h.callWhenLoaded(U):U()},fitRect:function(C,K,H){var t=this,p=t.getWidth(),w=t.getHeight(),$=C.x+C.width/2,q=C.y+C.height/2,j=N(p/C.width,w/C.height),c=t._zoom,T=-$*c+p/2,e=-q*c+w/2;0===j||isNaN(j)||(H&&(j=N(1,j)),K?(t._65I&&(delete t._65I.finishFunc,t._65I.stop(!0)),t._14o&&t._14o.stop(!0),t.setTranslate(T,e,{finishFunc:function(){t.setZoom(j,K)}})):(t.setTranslate(T,e),t.setZoom(j)))},toCanvas:function(M,R){R=R||this._zoom,this.validateImpl();var G=this,T=G.getContentRect();T.width||(T.width=10),T.height||(T.height=10);var K=Ue(),t=T.x*R,y=T.y*R,B=T.width*R,n=T.height*R;op(K,B,n,1);var f=Pg(K);return M=M||this._dataModel.getBackground(),M&&Yg(f,0,0,B,n,M),Kh(f,-t,-y),f.scale(R,R),G._42(f),f.restore(),K},toDataURL:function(w,S,x){return this.toCanvas(w,x).toDataURL(S||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(U,N){var $=this,y=this.__htmlOrderList,K=[];if($._93db(U,N),$.each(function(a){var J=$.getDataUI(a);if(J){var O=$._56I[a._id],V=J._htmlView;if(O){var B=J._79o();if(V=J._htmlView,j.HtmlNode&&a instanceof j.HtmlNode)J._42(U);else{var H=$.getViewRect(),i=V&&V.layoutHTML;!N||Jb(N,B)?(i&&(V.layoutHTML(),J.__outerLayout&&delete J.__outerLayout),J._42(U)):Jb(H,B)||!i||J.__outerLayout||(V.layoutHTML(),J.__outerLayout=!0)}}V&&(K.push(V),V.getView&&(V=V.getView()),V.style.display=O?"block":ls)}}),y&&K.length>0){var O=!1;if(y.length!==K.length)O=!0;else for(var Z=0;Z<K.length;Z++)if(K[Z]!==y[Z]){O=!0;break}O&&(K.forEach(function(H){$.appendHTML(H,!0)}),this.__htmlOrderList=K)}else this.__htmlOrderList=K;$._92db(U,N)},validateImpl:function(){this.tryUpdateRootData();var x,X,N,D,z,e=this,y=e.tx(),w=e.ty(),G=e._zoom,L=e._canvas,r=this.getWidth(),F=this.getHeight(),A=e._29I,E={x:-y/G,y:-w/G,width:r/G,height:F/G},q={},W=e._34I,S=e._24I,Q=e._32I,f=e._23I;e._24I={},(r!==L.clientWidth||F!==L.clientHeight)&&(op(L,r,F),Q=1),Q||ol(E,A)||(Q=1),e._29I=E,e.each(function(b){X=b._id;var U=q[X]=e.isVisible(b);U!==e._56I[X]&&(S[X]=b,N=e.getDataUI(S[X]),N&&N._84o(U),e._84o(b,U))},e);for(X in S)N=e.getDataUI(S[X]),N&&(!Q&&e._56I[X]&&(z=N._79o(),z&&W.add(z)),N.invalidate()),e._83I=1;if(e._56I=q,!Q)for(X in S)q[X]&&(N=e.getDataUI(S[X]),N&&(z=N._79o(),z&&W.add(z)));if(Q?D=E:(W.each(function(O){Jb(E,O)&&(D=Tp(D,O))}),D&&(Rd(D,o(1,1/G)),D.x=$(D.x*G)/G,D.y=$(D.y*G)/G,D.width=c(D.width*G)/G,D.height=c(D.height*G)/G,D=ah(E,D))),e._74O=D,D){x=Pg(L);var V=D.x,h=D.y,v=D.width,I=D.height;V=Math.floor((V*G+y)*Ed),h=Math.floor((h*G+w)*Ed),v=Math.ceil(v*G*Ed)+1,I=Math.ceil(I*G*Ed)+1,x.beginPath(),x.rect(V,h,v,I),x.clip(),x.clearRect(V,h,v,I),np(x,y,w,G),e._42(x,D),x.restore(),delete e._74O}if(W.clear(),delete e._32I,f&&r>0&&F>0){var N=e.getDataUI(f);if(N){var z=N._79o(),l=e._29I,B=l.x,Y=l.y,C=l.width,Z=l.height,G=e._zoom;z&&!Jb(z,l)&&(z.x+z.width<B&&e.tx(-z.x*G),z.x>B+C&&e.tx(-(z.x+z.width-C)*G),z.y+z.height<Y&&e.ty(-z.y*G),z.y>Y+Z&&e.ty(-(z.y+z.height-Z)*G))}delete e._23I}e._83I&&(delete e._83I,delete e._84I),e._98O(),fh(e._24I)||Cr(e.iv,e)},tryUpdateRootData:function(){var r,j=this.getFullscreenDatas();for(var K in j)r=j[K],this.scaleRootData(r)},scaleRootData:function(d){var p=d.s("fullscreen");if("uniform"===p||"fill"===p){var N=d.getAnchor(),W=this.tx(),y=this.ty(),c=this._zoom,j=this.getWidth(),h=this.getHeight(),t={x:-W/c,y:-y/c,width:j/c,height:h/c};if("uniform"===p){var K=d.getWidth()/d.getHeight(),G=Math.min(t.width,t.height*K),r=G/K;t.x+=.5*(t.width-G),t.y+=.5*(t.height-r),t.width=G,t.height=r}d.setRotation(0),d.setScale(1,1),d.setSize(t.width,t.height),d.setPosition(t.x+N.x*t.width,t.y+N.y*t.height)}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(N){var o=this;N!==o.isScrollBarVisible()&&(N?(jr(o._view,o._79O=cf()),jr(o._79O,o._27I=cf()),jr(o._79O,o._28I=cf())):(Wb(o._79O),delete o._79O,delete o._27I,delete o._28I),o.fp("scrollBarVisible",!N,N))},showScrollBar:function(){var z=this;z._79O&&(z._85I||(e(function(){z._86I()},Pi),z.iv()),z._85I=new Date)},_86I:function(){var E=this;if(E._85I){var A=new Date,l=A.getTime();l-E._85I.getTime()>=Pi?(delete E._85I,E.iv()):e(function(){E._86I()},Pi)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var D=this,F=this._27I,m=this._28I;if(D._79O){if(D._autoHideScrollBar&&!D._85I)return F.style.visibility=tk,m.style.visibility=tk,void 0;var M=D.getScrollBarColor(),Z=D._zoom,G=D.getScrollBarSize(),E=D.getViewRect(),I=D.getScrollRect(),C=E.height*Z,t=I.height*Z,N=E.width*Z-G-2,g=C*((E.y-I.y)*Z/t),e=C*(C/t),B=F.style;t-.5>C?(Sj>e&&(g=g+e/2-Sj/2,0>g&&(g=0),g+Sj>C&&(g=C-Sj),e=Sj),Hr(F,N,g,G,e),B.visibility=Qn,B.background=M,B.borderRadius=G/2+pj):B.visibility=tk;var f=E.width*Z,u=I.width*Z,g=E.height*Z-G-2,N=f*((E.x-I.x)*Z/u),$=f*(f/u),B=m.style;u-.5>f?(Sj>$&&(N=N+$/2-Sj/2,0>N&&(N=0),N+Sj>f&&(N=f-Sj),$=Sj),Hr(m,N,g,$,G),B.visibility=Qn,B.background=M,B.borderRadius=G/2+pj):B.visibility=tk}},setDataModel:function(T){var g=this,o=g._dataModel,p=g._selectionModel;o!==T&&(o&&(o.ump(g.handleDataModelPropertyChange,g),o.umm(g.handleDataModelChange,g),o.umd(g.handleDataPropertyChange,g),o.removeIndexChangeListener(g._75O,g),o.removeHierarchyChangeListener(g.handleHierarchyChange,g),p||o.sm().ums(g.handleSelectionChange,g)),g._dataModel=T,T.mp(g.handleDataModelPropertyChange,g),T.mm(g.handleDataModelChange,g),T.md(g.handleDataPropertyChange,g),T.addIndexChangeListener(g._75O,g),T.addHierarchyChangeListener(g.handleHierarchyChange,g),p?p._21I(T):T.sm().ms(g.handleSelectionChange,g),g.invalidateAll(!0),g.fp(ik,o,T),g._canvas.style.background=T.getBackground()||"")},getLayersInfo:function(){if(this._layersInfo===H){var M=this.getLayers();M?(this._layersInfo={},M.forEach(function(J){var K=Lg(J)?J.name:J;this._layersInfo[K]=J},this)):this._layersInfo=null}return this._layersInfo},updateLayers:function(){this._layersInfo=H,this.invalidateSelection(),this.redraw()},handleDataModelPropertyChange:function(A){if("background"===A.property){var f=this._canvas.style.background,r=A.newValue||"";this._canvas.style.background=r,this.fp("canvasBackground",f,r)}else"a:width"===A.property||"a:height"===A.property?(this._83I=1,this.redraw()):"layers"===A.property?this.updateLayers():"hierarchicalRendering"===A.property&&this.redraw()},handleDataPropertyChange:function(y){this.dm().isHierarchicalRendering()&&"parent"===y.property&&y.data.hasChildren()&&this.redraw(),this.invalidateData(y.data)},onPropertyChanged:function(A){var t=this,S=A.property;if(t.redraw(),"zoom"===S){var R=t.sm().getSelection();R.size()&&R.each(function(C){C.invalidate()})}$h[S]?t.showScrollBar():S===_d&&t.onCurrentSubGraphChanged(A)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(l){var v=this,b=l.kind,h=l.data;if(v._83I=1,"add"===b)v.invalidateData(h),Sg(h)&&h.getEdgeGroup()&&h.getEdgeGroup().eachSiblingEdge(v.invalidateData,v);else if(b===Rf){v._21Q(h);var J=h._id,S=v._25I[J];if(S){if(v._56I[J]){var r=S._79o();r&&v.redraw(r)}S.dispose(),delete v._25I[J],delete v._24I[J],delete v._56I[J]}h===v._currentSubGraph&&v.setCurrentSubGraph(I)}else b===Zd&&(v.invalidateAll(!0),v.setCurrentSubGraph(I))},_75O:function(d){this.invalidateData(d.data)},handleHierarchyChange:function(R){this.dm().isHierarchicalRendering()&&R.data.hasChildren()&&this.redraw(),this.invalidateData(R.data)},adjustIndex:function(d){var K=this;if(K.isVisible(d)){K.dm().beginTransaction();for(var e=d;e._parent&&K.isVisible(e._parent);)e=e._parent;e&&e!==d&&K._dataModel.adjustIndex(e),K._dataModel.adjustIndex(d),K.dm().endTransaction()}},getImage:function(p){return p.getImage?p.getImage():H},getSelectWidth:function(m){var A=qp(this.getImage(m));return A&&oh(A.disableSelectedBorder,m,this)?0:m.s("select.width")},getSelectColor:function(s){return s.s("select.color")},isSelectable:function(U,E){if(this.isSelected(U))return!0;if(!E&&U.getParent()instanceof tm&&this.isSelectable(U.getParent(),!0)&&U.getParent().isSyncSize())return!1;var s=this.getLayersInfo();if(s){var _=s[U._layer];if(_&&_.selectable===!1)return!1}return U.s("2d.selectable")&&this.sm().isSelectable(U)},isMovable:function(d){var u=this;if(Sg(d)&&d.getStyle(rd)!==iq)return!1;var z=this.getLayersInfo();if(z){var V=z[d._layer];if(V&&V.movable===!1)return!1}return d.s("2d.movable")?u._movableFunc?u._movableFunc(d):!0:!1},isEditable:function(Y){var O=this;if(j._uiSerializing)return O._uieditable;if(!O._editInteractor||!O.isSelected(Y))return!1;if(Co(Y)){var k=O.getDataUI(Y);if(!k||k._88I)return!1}if(Sg(Y)&&Y.getStyle(rd)!==iq)return!1;var g=this.getLayersInfo();if(g){var e=g[Y._layer];if(e&&e.editable===!1)return!1}return Y.s("2d.editable")?O._editableFunc?O._editableFunc(Y):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(h){return er(h)&&0!==h.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(h):!0},isRectEditable:function($){return this._rectEditableFunc?this._rectEditableFunc($):!0},isAnchorEditable:function(O){return this._anchorEditableFunc?this._anchorEditableFunc(O):!0},isRotationEditable:function($){return $.setRotation&&$.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc($):!0:!1},getRotationPoint:function(h){var p=h.getAnchor(),n=h.getScale(),M=this._zoom,E=Ii(h.getRotation(),0,-h.getHeight()*n.y*p.y-(n.y<0?-1:1)*(hd?32:16)/M),D=h.p();return E.x+=D.x,E.y+=D.y,E},getLogicalPoint:function(r){var D=this;return ro(r,D._canvas,D.tx(),D.ty(),D._zoom,D._zoom)},getScreenPoint:function(T,B){var E,t=this;return"object"==typeof T?T.x!==H?(E=T.x,B=T.y):(E=T[0],B=T[1]):E=T,oi(E,B,t._canvas,t.tx(),t.ty(),t._zoom,t._zoom)},getSelectedDataAt:function(o){var e=this;return this.getDataAt(o,function(Z){return e.isSelected(Z)})},getDataInfoAt:function(W,N,e){var w,i=this.lp(W),n=this.getDataAt(i,N,e);if(n){var z=this.getDataUI(n);w={data:n,ui:z,point:i};var O=z._38o;if(O){var R=O.icons;for(var l in R){var j=R[l],U=O.rects[l];if(U)for(var D=oh(j.names,n,this),y=D?D.length:0,v=U.rotation,Z=y-1;Z>=0;Z--){var k=D[Z],f=U[Z];if(ps(f,i,v))return w.part="icons",w.name=l,w.icon=k,w.rect=f,w.index=Z,w.rotation=v,w}}}if(this.isNoteVisible(n)){if(z.note2Info&&ps(z.note2Info.clickRect,i,I,z.note2Info.scale))return w.part="note2",w;if(z.noteInfo&&ps(z.noteInfo.clickRect,i,I,z.noteInfo.scale))return w.part="note",w}if(this.isLabelVisible(n)){if(z.label2Info&&ps(z.label2Info.rect,i,z.label2Info.rotation,z.label2Info.scale))return w.part="label2",w;if(z.labelInfo&&ps(z.labelInfo.rect,i,z.labelInfo.rotation,z.labelInfo.scale))return w.part="label",w}if(n.isInRect&&n.isInRect(i))return w.part="body",w}return w},getDataAt:function(Z,u,s){Z.target&&(Z=this.lp(Z));var R,r=this._zoom;return this.reverseEach(function(P){return(u?u(P):this.isSelectable(P))&&this.rectIntersects(P,Xq(Z.x,Z.y,s,r))?(R=P,!1):void 0},this),R},getIconInfoAt:function(j,U){var N=this;if(j.target&&(j=N.lp(j)),U||(U=N.getDataAt(j)),U){var s=N.getDataUI(U);if(s&&s._38o){var L,l=s._38o,P=new fb;for(L in l.icons)P.add(L);for(var O=P.size()-1;O>=0;O--){L=P.get(O);for(var J=l.rects[L],S=J.rotation,Z=J.length-1;Z>=0;Z--){var d=J[Z],B=d.width,y=d.height,Y={x:j.x-d.x-B/2,y:j.y-d.y-y/2};S!=I&&(Y=Ii(-S,Y.x,Y.y));var d={x:-B/2,y:-y/2,width:B,height:y};if(ps(d,Y))return{key:L,index:Z,name:l.icons[L].names[Z],rect:J[Z],point:j,rotation:S,relativeRect:d,relativePoint:Y,data:U}}}}}return I},getDatasInRect:function(w,s,T){T===H&&(T=1);var t=this,A=new fb;return t.reverseEach(function(p){T&&!t.isSelectable(p)||(s?t.rectIntersects(p,w):t.rectContains(p,w))&&A.add(p)}),A},moveSelection:function(Z,K){var B=this;B.dm().beginTransaction(),Cs(B.sm().toSelection(B.isMovable,B),Z,K),B.dm().endTransaction()},moveDatas:function(d,T,l){var A=this;A.dm().beginTransaction(),d instanceof fb||(d=new fb(d)),Cs(d,T,l),A.dm().endTransaction()},getDataUIBounds:function(f){var m=this.getDataUI(f);return m?m._79o():I},drawData:function(m,l,g){var $=this.getDataUI(l);if($){var h=$._79o();(!g||Jb(g,h))&&($._42(m),l instanceof j.Block&&l.eachChild(function(d){this.drawData(m,d,g)},this))}},getBoundsForGroup:function(o){return o.s(Pj)?this.getDataUIBounds(o):I},isPixelPerfect:function(A){return A.s("pixelPerfect")},rectIntersects:function(T,u){this.validate();var g=I;if(this._56I[T._id]){var H=this._25I[T._id];if(H){var R=H._79o();if(vf(u,R))g=!0;else if((u=ah(u,R))&&(H.rectIntersects&&(g=H.rectIntersects(u)),g==I)){if(!this.isPixelPerfect(T))return!0;var A=u.x,D=u.y,$=u.width,a=u.height,o=this._zoom,n=h.hitMaxArea,M=$*a*o*o;if(M>n){var X=Math.sqrt(n/M);o*=X}$*=o,a*=o,2>$&&($=2),2>a&&(a=2),A*=o,D*=o;var z=Qp($,a);Kh(z,-A,-D),z.scale(o,o),this._drawForChecking=!0,this.drawData(z,T,u),this._drawForChecking=!1;try{for(var P=0,J=z.getImageData(0,0,$,a).data;P<J.length;P+=4)if(0!==J[P+3]){g=!0;break}z.restore()}catch(t){Kj=I,g=!1}}}}return g?!0:!1},rectContains:function(Y,f){if(this._56I[Y._id]){var n=this._25I[Y._id];if(n)return vf(f,n._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(u){if(!h.isInput(u.target)){var J=this,G=J._focusData,$=G&&J._25I[G._id],O=0,N=J._dataModel._datas;if(!(G&&G._enabled&&G._editable&&$&&$.onKeyDown&&$.onKeyDown(u)===!0))if(9===u.keyCode&&(G&&(O=N.indexOf(G),Ah(u)?-1===--O&&(O=0):++O===N.size()&&(O=0)),J._focusData=G=N.get(O),J.sm().setSelection(G)),Ic(u)?J.selectAll():ib(u)&&J.isResettable()&&J.reset(),J.sm().isEmpty()){if(J._editing)return;var y=J.tx(),V=J.ty(),K=!1,o=Ah()?100:10;Od(u)&&(y-=o,K=!0),Nl(u)&&(V-=o,K=!0),Id(u)&&(y+=o,K=!0),Ik(u)&&(V+=o,K=!0),K&&J.setTranslate(y,V)}else{Ce(u)&&J.handleDelete(u);var P=Ah()?10:1;Od(u)&&(J.moveSelection(-P,0),J.fi({kind:"moveLeft"})),Nl(u)&&(J.moveSelection(0,-P),J.fi({kind:"moveUp"})),Id(u)&&(J.moveSelection(P,0),J.fi({kind:"moveRight"})),Ik(u)&&(J.moveSelection(0,P),J.fi({kind:"moveDown"}))}}},handleScroll:function(q,U){if(Oi(q),!this.getEditInteractor()){var R=this.getDataAt(q);if(R){var t=qp(this.getImage(R));if(t&&oh(t.scrollable,R,this))return}}var d=this.lp(q);U>0?this.scrollZoomIn(d):0>U&&this.scrollZoomOut(d)},handlePinch:function(E,n,A){this._68I||(n>A?this.pinchZoomIn(E):this.pinchZoomOut(E))},checkDoubleClickOnNote:function(x,I){var $=this,b=$.lp(x),R=$.getDataUI(I),L=R.note2Info;return L&&I.s("note2.toggleable")&&ps(L.clickRect,b)?(I.s(Ub,!I.s(Ub)),$.fi({kind:"toggleNote2",event:x,data:I}),!0):(L=R.noteInfo,L&&I.s("note.toggleable")&&ps(L.clickRect,b)?(I.s(xb,!I.s(xb)),$.fi({kind:"toggleNote",event:x,data:I}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(M,g){var A=this,w=A.getAutoScrollZone(),y=w/A.getZoom(),l=w/4,k=A._29I,X=A.lp(M),$={x:A.tx(),y:A.ty()};return X&&w>0&&k&&(X.x-k.x<y?A.translate(l,0):k.x+k.width-X.x<y&&A.translate(-l,0),X.y-k.y<y?A.translate(0,l):k.y+k.height-X.y<y&&A.translate(0,-l)),$.x=A.tx()-$.x,$.y=A.ty()-$.y,g&&(g.x+=$.x,g.y+=$.y),$},getMoveMode:function(k,a){var s=a.s("2d.move.mode");return s?s:ij["88"]?"x":ij["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(F,W,t){var h=this;return"currentSubGraph"===W?{__i:F.getId()}:t.serializeProperty(F,W,h)},deserializeProperty:function(Y,b,t){var Z=this;if("currentSubGraph"===b){var i=Z.dm(),p=i.__idMap;return p[Y.__i]}return t.deserializeProperty(Y,b,Z)},setDefaultCursor:function(F,N){this._defaultCursor=F,N!==!1&&this.setCursor(F)},setCursor:function(k){"default"===k&&(k=this._defaultCursor||k);var V=this.getView().style;V.cursor=k,V.cursor="-webkit-"+k,V.cursor="-moz-"+k},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(u){return u===I||h.getConnectAction(null,u)?(this._currentActionType=u,this.redraw(),!0):!1},isConnectActionVisible:function(s){var w=h.getConnectAction(this);if(!w)return!1;var S=w.visible;return gj(S)&&(S=S(this,s)),S},isInteractive:function(u){var m=qp(this.getImage(u));return m&&oh(m.interactive,u,this)?!0:u.s("interactive")},appendHTML:function(L,h){var E=this.getView();if(!(h||L&&L.parentNode!==E))return!1;var s=L.getView&&L.getView();return!h&&s&&s.parentNode===E?!1:L.isSelfViewEvent?(L.addToDOM(E),!0):(L.getView&&(L=L.getView()),this.isScrollBarVisible()?E.insertBefore(L,this.getView().lastChild):jr(E,L),!0)},layoutHTML:function(J,f,q){var G,o=this,w=o._zoom;if(f.getView&&(G=f,f=f.getView()),f.style.position="absolute",q){var x=J.getRect();Hr(G||f,o.tx()+x.x*w,o.ty()+x.y*w,x.width*w,x.height*w)}else{var m=new ng,x=J.getAnchorRect(),t=J.getPosition(),j=J.getScale(),_=f.style;Hr(G||f,x),m.appendTranslate(o.tx(),o.ty()),m.appendScale(w,w),m.append(new ng(J.getRotation(),t.x,t.y,j.x,j.y)),Lj(_,"transform","matrix("+m.a.toFixed(5)+", "+m.b.toFixed(5)+", "+m.c.toFixed(5)+",\n    "+m.d.toFixed(5)+", "+m.tx.toFixed(5)+", "+m.ty.toFixed(5)+")"),Lj(_,"transformOrigin",(-x.x).toFixed(5)+"px "+(-x.y).toFixed(5)+"px"),f.maxtrixAppend=m.invert().translate(-x.x,-x.y)}}});var Vb=function(Z,a){var J=this;J.gv=Z,J.s=function(n){return a.getStyle(n)},J._data=a,J._87I=new fb};ab(Vb,C,{_6I:I,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var $=this,L=$.gv.isSelected($._data);return!L||$.isShadowed()?0:$.gv.getSelectWidth($._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(V){var W=this._data,y=this.gv.getBodyColor(W);return y?y:V?W.getStyle(V):I},_2Q:function(S){return this.s(S)},_1Q:function(u,q,w,A){var E=this.s,o=E("2d.gray"),_=E(q+".dash.color");if(o&&(_=h.toGrayColor(_)),u.strokeStyle=_,u.lineWidth=w,u.stroke(),E(q+".dash.3d")){var C=E(q+".dash.3d.color");Ao(u,_,o?h.toGrayColor(C):C,w,this.gv._zoom,E(q+".dash.3d.accuracy"))}Zc(u,A)},invalidate:function(){this._6I=I},_79o:function(){var a=this;if(!a._6I){var d=a._data,P=a.gv;a.labelInfo=a.label2Info=a.noteInfo=a.note2Info=a._38o=I,a._87I.clear(),a.interactiveInfo=P.isInteractive(d)?{}:I,a._3O(),a._55O=P.isEditable(d)?{_42O:P.isRectEditable(d),_43O:P.isPointEditable(d),_56O:P.isRotationEditable(d)}:I,a._6I=a._81o()}return a._6I},_3O:function(){},getPosition:function(){return jq},_68o:function(W,w){W&&this._87I.add(Eh(W,w))},_81o:function(){var H=this,r=H.s;H._24O(qm,"getLabel"),H._24O(je,"getLabel2"),H._26O(_p,"getNote"),H._26O(hi,"getNote2"),H._15O(),H._55O&&H._48O();var y;if(H._87I.each(function(B){y=Tp(y,B)}),y&&H.isShadowed()){var Q=oc(y);Q.x+=r("shadow.offset.x"),Q.y+=r("shadow.offset.y"),Rd(Q,r("shadow.blur")),y=Tp(y,Q)}return H._87I.clear(),y},_42:function(G){var Q=this,V=Q._data,Y=Q.gv,X=Q.s,c=X("opacity"),l=this.isShadowed();if(l){var y=G.shadowOffsetX,E=G.shadowOffsetY,Z=G.shadowBlur,S=G.shadowColor,m=Y.getZoom();G.shadowOffsetX=X("shadow.offset.x")*m,G.shadowOffsetY=X("shadow.offset.y")*m,G.shadowBlur=X("shadow.blur")*m,G.shadowColor=Q.getSelectColor()}if(c!=I){var t=G.globalAlpha;G.globalAlpha=c}Q._80o(G),Y.isLabelVisible(V)&&((!Y._drawForChecking||X("label.selectable"))&&ip(G,Q.labelInfo),(!Y._drawForChecking||X("label2.selectable"))&&ip(G,Q.label2Info)),Y.isNoteVisible(V)&&(lg(G,Q.noteInfo),lg(G,Q.note2Info)),Q._99O(G),c!=I&&(G.globalAlpha=t),l&&(G.shadowOffsetX=y,G.shadowOffsetY=E,G.shadowBlur=Z,G.shadowColor=S)},_80o:function(){},_47O:function(){},_24O:function(X,U){var O=this,j=O._data,o=O.gv,P=O.s,q=o[U](j);if(q!=I){var F=P(X+".scale"),G=P(X+".max"),K=P(X+".position"),i=O[X+"Info"]={label:q,scale:F,color:o[U+"Color"](j),font:P(X+".font"),opacity:P(X+".opacity"),align:P(X+".align"),rotation:O.getRotation(P(X+".rotation"),!1,K),background:o[U+"Background"](j)},L=yf(i,q);G>0&&G<L.width&&(i.labelWidth=L.width,L.width=G),1!==F&&(L.width*=F,L.height*=F);var V=O.getPosition(K,P(X+".offset.x"),P(X+".offset.y"),L,P(X+".position.fixed"));if(L.x=V.x-L.width/2,L.y=V.y-L.height/2,O._68o(i.rect=L,i.rotation),1!==F){var k=L.width/F,C=L.height/F;i.rect={x:V.x-k/2,y:V.y-C/2,width:k,height:C}}}},_26O:function(f,h){var z=this,K=z.gv,S=z._data,x=z.s,k=K[h](S);if(k!=I){var M,y,w=x(f+".scale"),F=z[f+"Info"]={note:k,scale:w,data:S,view:K,expanded:x(f+".expanded"),font:x(f+".font"),color:x(f+".color"),opacity:x(f+".opacity"),align:x(f+".align"),icon:x(f+".icon"),backgroundImage:x(f+".backgroundImage"),borderWidth:x(f+".border.width"),borderColor:x(f+".border.color"),background:K[h+"Background"](S)},Z=z.getPosition(x(f+".position"),x(f+".offset.x"),x(f+".offset.y")),d=Z.x,C=Z.y;if(F.expanded){var t,D=x(f+".max"),a=x(f+".backgroundImage");a?(a=qp(a),t={width:uf(a,S),height:Xd(a,S)}):t=yf(F,k),t.width+=6,t.height+=2,D>0&&D<t.width&&(F.labelWidth=t.width,t.width=D),M=t.width,y=t.height+8,F.clickRect={x:d-M*w/2,y:C-y*w,width:M*w,height:y*w*t.height/y}}else{var J=x(f+".icon");J?(J=qp(J),M=uf(J,S),y=Xd(J,S)):(M=12,y=18),F.clickRect={x:d-M*w/2,y:C-y*w,width:M*w,height:y*w}}F.rect={x:d-M/2,y:C-y*w/2-y/2,width:M,height:y};var R=c(F.borderWidth/2)*w;z._68o({x:d-M*w/2-R,y:C-y*w-R,width:M*w+2*R,height:y*w+2*R})}},_48O:function(){},_99O:function(z){var L=this,d=L._38o;if(d){var k=L.gv,U=L._data,t=d.icons,Z=L.interactiveInfo;Z&&(Z._38o={});for(var G in t){var T=t[G],S=d.rects[G];if(S){Z&&(Z._38o[G]=[]);var j=oh(T.opacity,U,k),F=oh(T.names,U,k),g=F?F.length:0,K=S.rotation;if(j!=I){var P=z.globalAlpha;z.globalAlpha*=j}for(var v=0;g>v;v++){var s=F[v],l=qp(s),E=S[v];if(K){var C=E.x+E.width/2,q=E.y+E.height/2;z.save(),Kh(z,C,q),Bh(z,K),Kh(z,-C,-q)}Z&&Z._38o[G].push(z.interactiveInfo={compInfos:[],matrix:K?new ng(K,C,q).appendTranslate(-C,-q):new ng}),mg(z,l,oh(T.stretch,U,k),E.x,E.y,E.width,E.height,L._data,L.gv),z.interactiveInfo=I,K&&z.restore()}j!=I&&(z.globalAlpha=P)}}}}});var ae=function(S,M){zp(ae,this,[S,M])};ab(ae,Vb,{_checkEmptyRect:!0,_40O:function(C,F){var S=this,I=S.s,q=C.rect;(C.borderColor=S.gv.getBorderColor(S._data))&&(C.borderType=I("border.type"),C.borderWidth=I("border.width"),C.borderPadding=I("border.padding"),F=o(F,C.borderPadding+C.borderWidth/2));var R=S._data.getScale(),d=o(1,o(J(R.x),J(R.y)));if(C.selectWidth=S.getSelectWidth()){var r=S.gv._zoom;C.selectType=I("select.type"),C._97o=S.getSelectColor(),C.selectPadding=I("select.padding"),F=o(F,(C.selectPadding+C.selectWidth/2/r)/d)}F>0&&(F*=d,q=oc(q),Rd(q,F)),S._68o(q)},_39O:function(x,b){var F,J=this,w=b.rect;if(b.borderWidth>0&&(F=b.borderPadding,x.strokeStyle=b.borderColor,x.lineWidth=b.borderWidth,Pc(x,b.borderType,{x:w.x-F,y:w.y-F,width:w.width+2*F,height:w.height+2*F}),x.stroke()),b.selectWidth>0){var n=J.gv._zoom;if(F=b.selectPadding,x.strokeStyle=b._97o,x.lineWidth=b.selectWidth/n,b.rotation!=I){x.save(),x.translate(b.position.x,b.position.y),x.rotate(b.rotation);var W=J._data,j=W.getWidth(),A=W.getHeight(),X=b.scale,G=b.anchor;w={x:X.x*-j*G.x,y:X.y*-A*G.y,width:X.x*j,height:X.y*A}}Pc(x,b.selectType,{x:w.x-F,y:w.y-F,width:w.width+2*F,height:w.height+2*F}),b.rotation!=I&&x.restore(),x.stroke()}},dispose:function(){var e=this,s=e._htmlView;ae.superClass._3O.call(e),s&&(s.onHTMLRemoved&&s.onHTMLRemoved(),Wb(s))},_3O:function(){var g=this,D=g.s,C=g._data,V=g.gv,X=C.getStyle(Rc),N=g.getBodyColor(),Q=g._83o=X?{shape:X,_53o:g.getBodyColor("shape.background"),_27Q:qp(D("shape.repeat.image"),N),shapeGradientPack:D("shape.gradient.pack"),_54o:D("shape.border.width"),_55o:D("shape.border.color"),_56o:D("shape.border.3d"),_57o:D("shape.border.3d.color"),_58o:D("shape.border.3d.accuracy"),shapeGradient:D("shape.gradient"),_59o:D("shape.gradient.color"),_60o:D("shape.border.pattern"),_61o:D("shape.border.cap"),_62o:D("shape.border.join"),shapeForeground:D("shape.foreground"),bodyColor:N,gray:D("2d.gray")}:{img:qp(V.getImage(C),N),bodyColor:N,gray:D("2d.gray"),stretch:D("image.stretch")};if(T&&!F);else{var x,i=Q.img;i&&i.renderHTML?(g._htmlInfo&&g._htmlInfo.img!==i&&(g._htmlInfo=I),g._htmlInfo||(g._htmlInfo={img:i,cache:{}}),x=i.renderHTML(C,V,g._htmlInfo.cache)):g._htmlInfo=I,g._htmlView&&g._htmlView!==x&&(g._htmlView.onHTMLRemoved&&g._htmlView.onHTMLRemoved(),Wb(g._htmlView.getView?g._htmlView.getView():g._htmlView)),(g._htmlView=x)&&V.appendHTML(x)&&x.onHTMLAdded&&x.onHTMLAdded(),Q.rect=C.getRect(),Q.position=C.p(),Q.scale=C.getScale(),Q.anchor=C.getAnchor(),Q.rotation=C.getRotation(),X===nn&&(Q._63o=D("shape.depth"));var y=0;if(X)y=sc(I,Q._54o/2,Q._62o),g.s("shape.dash")&&(y=o(y,(g.s("shape.dash.width")||Q._54o)/2));else if(i&&i.boundExtend)if(y=oh(i.boundExtend,C,V),i.boundExtendAbsolute){var u=C.getScale();y/=V._zoom*o(1,o(J(u.x),J(u.y)))}else if(!oh(i.fitSize,C,V)){var j=oh(i.width,C,V),_=oh(i.height,C,V);y*=o(C.getWidth()/j,C.getHeight()/_)}g._40O(Q,y);
var U=D("clip.percentage");if(1>U&&(0>U&&(U=0),Q.clipRect=vo(C.getAnchorRect(),D("clip.direction"),U)),X){var $=D("shape.fill.clip.percentage");1>$&&(0>$&&($=0),Q.shapeClipRect=vo(C.getAnchorRect(),D("shape.fill.clip.direction"),$));var m=D("shape.foreground.clip.percentage");1>m&&(0>m&&(m=0),Q.shapeForegroundClipRect=vo(C.getAnchorRect(),D("shape.foreground.clip.direction"),m))}}},getPosition:function(C,B,j,t){var _=Xp(C,this._83o.rect,t);return _.x+=B,_.y+=j,_},_80o:function($){var B=this,o=B.s,z=B.gv,O=B._data,d=B._83o,c=d.rect,S=d.position,G=d.rotation,Q=d.anchor,E=d.scale,F=d.shape,l=d.clipRect;if(!B._checkEmptyRect||c.width>0&&c.height>0){var Y=O.getSize();if(Y.x=-Y.width*Q.x,Y.y=-Y.height*Q.y,$.save(),Kh($,S.x,S.y),Bh($,G),gr($,E.x,E.y),l&&($.beginPath(),$.rect(l.x,l.y,l.width,l.height),$.clip()),z._drawForChecking&&d.img&&oh(d.img.pixelPerfect,O,z)===!1)Yg($,Y.x,Y.y,Y.width,Y.height,"#888888");else if(B.freeDraw)B.freeDraw($,Y,d);else if(F){var T,s,r,U,M=d._60o,t=vs($,M),x=d._27Q,w=d._54o,_=d.shapeGradientPack,e=d.gray,R=$.lineJoin,N=$.lineCap,a=function(R){return e?h.toGrayColor(R):R};"roundRect"===F?T=o("shape.corner.radius"):"polygon"===F?T=o("shape.polygon.side"):"arc"===F&&(T=o("shape.arc.from"),s=o("shape.arc.to"),r=o("shape.arc.close"),U=o("shape.arc.oval")),$.lineJoin=d._62o,$.lineCap=d._61o;var D=a(d._53o);if(D||x||_){var L=d.shapeClipRect;L&&($.save(),$.beginPath(),$.rect(L.x,L.y,L.width,L.height),$.clip()),Pc($,F,Y,T,s,r,U),_?im($,_):x?Ze($,x,a(d.bodyColor),null,O,z):Bb($,D,d.shapeGradient,a(d._59o),Y),$.fill(),L&&$.restore(),_&&$.restore(),$!==t&&Pc(t,F,Y,T,s,r,U)}else Pc(t,F,Y,T,s,r,U);var j=d.shapeForeground;if(j){$.save();var Z=d.shapeForegroundClipRect;Z&&($.beginPath(),$.rect(Z.x,Z.y,Z.width,Z.height),$.clip()),Pc($,F,Y,T,s,r,U),Bb($,j,o("shape.foreground.gradient"),a(o("shape.foreground.gradient.color")),Y),$.fill(),$.restore()}if(w>0){var P=o("shape.border.width.absolute");P&&($.save(),$.setTransform(1,0,0,1,0,0)),$.lineWidth=w;var m=a(d._55o);$.strokeStyle=m,$.stroke(),P&&$.restore(),d._56o&&Ao($,m,a(d._57o),w,z._zoom,d._58o)}if(Zc($,M),o("shape.dash")){var W=o("shape.dash.width")||w;if(W>0){M=o("shape.dash.pattern");var t=vs($,M,B._2Q("shape.dash.offset"));t!==$&&Pc(t,F,Y,T,s,r,U),B._1Q($,"shape",W,M)}}mj($,D,d._63o,Y),$.lineJoin=R,$.lineCap=N}else{var C=B.interactiveInfo;C&&($.interactiveInfo=C.bodyInfo={compInfos:[],matrix:new ng(G,S.x,S.y,E.x,E.y)}),d.gray&&($.compGray=!0),mg($,d.img,d.stretch,Y.x,Y.y,Y.width,Y.height,O,z,d.bodyColor),$.compGray=!1,$.interactiveInfo=I}$.restore()}B._39O($,d)},_48O:function(){},_47O:function(){}});var _c=function(O,Z){zp(_c,this,[O,Z])},Yh=function(o,n,O,r){var K=em(o,n);return O=r?N(O,K):Kk(O,K),K?O/=K:O=0,{x:o.x+(n.x-o.x)*O,y:o.y+(n.y-o.y)*O}};ab(_c,Vb,{_3O:function(){var V,d=this,y=d._data,R=d.gv,P=d.s,z=P(rd),l=y.isLooped(),J=P("edge.width"),F=P("edge.center"),A=P("edge.offset"),q=R.getBorderColor(y),x=q?P("border.width"):0,G=d.getSelectWidth(),n=y._40I,U=y._41I,T=d._78o=n&&U?{looped:l,type:z,width:J,center:F,color:d.getBodyColor("edge.color"),borderColor:q,borderWidth:x,_97o:G?d.getSelectColor():I,selectWidth:G,pattern:P("edge.pattern"),cap:P("edge.cap"),join:P("edge.join"),is3d:P("edge.3d"),_67o:P("edge.3d.color"),_66o:P("edge.3d.accuracy"),gray:P("2d.gray")}:I;if(T){var C=h.getEdgeType(z);if(C){var S=C(y,Do(d,R,y,l,z),R,d._19Q);S.points&&S.points.size()>1?(T.edgeTypeInfo=S,V=no(T.edgeTypeInfo.points)):S[Lf]&&S.rect&&(T.edgeTypeInfo=S,V=S.rect)}else{var f=P("edge.source.anchor.x"),i=P("edge.source.anchor.y"),L=P("edge.target.anchor.x"),c=P("edge.target.anchor.y"),m=Sh(R,n,P("edge.source.position"),P("edge.source.offset.x"),P("edge.source.offset.y"),f,i),s=Sh(R,U,P("edge.target.position"),P("edge.target.offset.x"),P("edge.target.offset.y"),L,c);if(z===iq){var v=T.points=P(Qe)||Qi,O=v.size();T.segments=P("edge.segments");var u=f!==H||i!==H,E=L!==H||c!==H;if(!F)if(A)u||(m=Yh(m,O?v.get(0):s,A,O)),E||(s=Yh(s,O?v.get(O-1):m,A,O));else{var X;u||(X=$b(m,O?v.get(0):s,Rp(R,n)),X&&(m={x:X[0],y:X[1]})),E||(X=$b(O?v.get(O-1):m,s,Rp(R,U)),X&&(s={x:X[0],y:X[1]}))}V=Tp(no(T.points),no(m,s))}else{var M=Do(d,R,y,l,z);if(d._19Q||(M=-M),l)m=oc(m),m.x=R.getNodeRect(n).x,T.radius=M,V={x:m.x-M,y:m.y-M,width:2*M,height:2*M};else{var k=em(m,s),_=Kk(A,k),W={x:_,y:M},N={x:k-_,y:M},b=B(s.y-m.y,s.x-m.x),e=T.mat=new ug(b);if(T.orienAngle=b,T.angle=s.x<m.x?b+g:b,T.rect={x:W.x,y:W.y,width:N.x-W.x,height:0},T.origin=m,W=e.tf(W),W.x+=m.x,W.y+=m.y,N=e.tf(N),N.x+=m.x,N.y+=m.y,F){var w={x:k,y:0};w=e.tf(w),w.x+=m.x,w.y+=m.y,V=no([m,W,N,w]),T.c1=m,T.c2=w}else V=no(W,N);m=W,s=N}}T.sourcePoint=m,T.targetPoint=s,y._lastSourcePoint=m,y._lastTargetPoint=s}var Q=0;P("edge.dash")&&(Q=P("edge.dash.width")||J);var D="square"===T.cap?.71:.5;sc(V,o(Q*D,J*D+x+G),T.join),d._68o(V)}},getRotation:function(J,s,u){J=J||0;var r=this._78o;if(r){var c,F=r.angle,z=r.points,f=r.edgeTypeInfo;if(F!=I)return s?r.orienAngle+J:F+J;if(f&&f[Lf])return f.getRotation?f.getRotation(this,J,s,u):0;if(f&&f.points){var h=f.points;return c=h.size(),as[u]?c&&0===c%2?Gm(h.get(c/2-1),h.get(c/2),s,J):J:Cd[u]?Gm(h.get(0),h.get(1),s,J):Gm(h.get(c-2),h.get(c-1),s,J)}if(z)return c=z.size(),as[u]?c&&0===c%2?Gm(z.get(c/2-1),z.get(c/2),s,J):J:Cd[u]?Gm(r.sourcePoint,c?z.get(0):r.targetPoint,s,J):Gm(c?z.get(c-1):r.sourcePoint,r.targetPoint,s,J)}return J},getPosition:function(y,t,q,n,L){var J=this._78o;if(J){var r,N=J.type,E=J.points,e=J.edgeTypeInfo,b=J.sourcePoint,v=J.targetPoint;if(!N)return J.looped?{x:b.x-J.radius+t,y:b.y+q}:(L&&b&&v&&(b.x>v.x||b.x===v.x&&b.y>v.y)&&(y=qg[y],q=-q),r=Xp(y,J.rect,n),r.x+=t,r.y+=q,r=J.mat.tf(r),r.x+=J.origin.x,r.y+=J.origin.y,r);if(e&&e[Lf])return e.getPosition?e.getPosition(this,y,t,q,n,L):{x:(b.x+v.x)/2,y:(b.y+v.y)/2};if(E){var r,X=E.size();if(as[y]){if(X){var s=X%2;if(0===s)return kh(E.get(X/2-1),E.get(X/2),y,t,q,n,L);r=E.get((X-s)/2)}else r={x:(b.x+v.x)/2,y:(b.y+v.y)/2};return r=Xp(y,{x:r.x,y:r.y,width:0,height:0},n),r.x+=t,r.y+=q,r}return Cd[y]?kh(b,X?E.get(0):v,y,t,q,n,L):kh(X?E.get(X-1):b,v,y,t,q,n,L)}if(e){var c=e.points,X=c.size();if(as[y]){var s=X%2;return 0===s?kh(c.get(X/2-1),c.get(X/2),y,t,q,n,L):(r=c.get((X-s)/2),r=Xp(y,{x:r.x,y:r.y,width:0,height:0},n),r.x+=t,r.y+=q,r)}return Cd[y]?kh(c.get(0),c.get(1),y,t,q,n,L):kh(c.get(X-2),c.get(X-1),y,t,q,n,L)}}return jq},_42:function(v){this._78o&&_c.superClass._42.call(this,v)},drawPath:function(C,$){C.beginPath();var w=$.type,h=$.points,s=$.segments,y=$.edgeTypeInfo;if(!w||h){var G=$.sourcePoint,g=G.x,l=G.y,v=$.targetPoint,o=v.x,Y=v.y;if(w)if(s){var b=new fb({x:g,y:l});b.addAll(h),b.add({x:o,y:Y}),oe(C,b,s)}else C.moveTo(g,l),h.each(function(w){C.lineTo(w.x,w.y)}),C.lineTo(o,Y);else $.looped?C.arc(g,l,$.radius,0,W,!0):$.center?(C.moveTo($.c1.x,$.c1.y),C.lineTo(g,l),C.lineTo(o,Y),C.lineTo($.c2.x,$.c2.y)):(C.moveTo(g,l),C.lineTo(o,Y))}else y&&(y.points?oe(C,y.points,y.segments):y[Lf]&&y[Lf](C,y))},_80o:function(Y){var f=this,p=f.s,I=f._78o,P=I.width,o=I.selectWidth,z=I.borderWidth,e=Y.lineJoin,L=Y.lineCap,$=I.gray,X=I.pattern;Y.lineJoin=I.join,Y.lineCap=I.cap,f.drawPath(vs(Y,X),I);var k=p("edge.width.absolute");k&&(Y.save(),Y.setTransform(1,0,0,1,0,0)),o&&(Y.strokeStyle=I._97o,Y.lineWidth=P+2*(z+o),Y.stroke()),z&&(Y.strokeStyle=$?h.toGrayColor(I.borderColor):I.borderColor,Y.lineWidth=P+2*z,Y.stroke());var j=$?h.toGrayColor(I.color):I.color,g=$?h.toGrayColor(I._67o):I._67o;if(Y.strokeStyle=j,Y.lineWidth=P,Y.stroke(),I.is3d&&Ao(Y,j,g,P,f.gv._zoom,I._66o),k&&Y.restore(),Zc(Y,X),p("edge.dash")){X=p("edge.dash.pattern");var Z=vs(Y,X,f._2Q("edge.dash.offset"));Z!==Y&&f.drawPath(Z,I),f._1Q(Y,"edge",p("edge.dash.width")||P,X)}Y.lineJoin=e,Y.lineCap=L},_48O:function(){},_47O:function(){},_71o:function(M,A){var x=this,W=x._data;if(x._19Q=!0,!W.getEdgeGroup())return M?W.s("edge.gap"):0;var B,C=0,Q=0,f=0;if(W.getEdgeGroup().getSiblings().each(function(L){L.each(function(L){if(x.gv.isVisible(L)&&L.s(rd)==A){var S=L.s("edge.gap");B?(Q+=f/2+S/2,f=S):(B=L,f=S),L===W&&(C=Q)}})}),M)return Q-C+f;var H=C-Q/2;return B&&W._40I!==B._40I&&(x._19Q=!1),H}});var ao=function(A,P){zp(ao,this,[A,P])};ab(ao,ae,{_3O:function(){var R,i,M=this,j=M.s,Y=M._data,c=M.gv;if(M._88I=I,Y.isExpanded()&&Y.eachChild(function(l){var L=c.getBoundsForGroup(l);L&&(i||(i=[]),i.push(L),R=Tp(R,L))}),R){var r=c.getLabel(Y),b=j("group.type");R=tc(b,i,R),ki(R,Y,"group.padding",1);var l=M._88I={type:b,rect:R,_64o:R};if(!b&&r!=I){var h,Q=M.labelInfo={label:r,color:j("group.title.color"),font:j("group.title.font"),align:j("group.title.align")},m=yf(Q,r),z=m.width,T=m.height,g=j("group.title.align"),k=j("group.title.orientation");if((k===yo||k===Fl)&&z>R.width?R.width=z:(k===Mn||k===rj)&&z>R.height&&(R.height=z),Q.rect={y:R.y-T,width:m.width,height:T},h=g===Mn?R.x:g===rj?R.x+R.width-z:R.x+R.width/2-z/2,Q.rect.x=h,k===Fl)l.titleRect={x:R.x,y:R.y+R.height,width:R.width,height:T},l.rect={x:R.x,y:R.y,width:R.width,height:R.height+T},Q.rect={x:h,y:R.y+R.height,width:z,height:T};else if(k===Mn){var w=l.titleRect={x:R.x-T,y:R.y,width:T,height:R.height};l.rect={x:R.x-T,y:R.y,width:R.width+T,height:R.height},Q.rect={x:w.x+T/2-R.height/2,y:w.y+R.height/2-T/2,width:R.height,height:T},Q.rotation=-Math.PI/2}else if(k===rj){var w=l.titleRect={x:R.x+R.width,y:R.y,width:T,height:R.height};l.rect={x:R.x,y:R.y,width:R.width+T,height:R.height},Q.rect={x:w.x+T/2-R.height/2,y:w.y+R.height/2-T/2,width:R.height,height:T},Q.rotation=Math.PI/2}else l.titleRect={x:R.x,y:R.y-T,width:R.width,height:T+1},l.rect={x:R.x,y:R.y-T,width:R.width,height:R.height+T}}M._40O(l,j("group.border.width")/2)}else ao.superClass._3O.call(M)},getPosition:function(v,B,F,j){var $=this._88I;if($){var M=Xp(v,$.rect,j);return M.x+=B,M.y+=F,M}return ao.superClass.getPosition.apply(this,arguments)},_24O:function(M,D){var c=this._88I;(!c||c.type||"label2"===M)&&ao.superClass._24O.call(this,M,D)},_80o:function(M){var J=this,l=J._88I;if(l){var s=J._data,P=J.s,e=J.gv,F=l.type,S=l.rect,h=l._64o,r=l.titleRect,O=J.getBodyColor(),$=qp(P("group.image"),O),T=P("group.image.stretch"),E=J.getBodyColor("group.background"),o=qp(P("group.repeat.image"),O),a=P("group.gradient.pack"),H=P("group.gradient"),y=P("group.gradient.color"),A=P("group.border.width"),G=P("group.border.color"),I=P("group.border.pattern"),_=P("group.title.orientation"),k=P("group.depth");if(F){var V=M.lineJoin,n=M.lineCap;if(M.lineJoin=P("group.border.join"),M.lineCap=P("group.border.cap"),$){if(M.save(),Pc(M,F,S),M.clip(),mg(M,$,T,S.x,S.y,S.width,S.height,s,e,O),M.restore(),A>0){var f=vs(M,I);Pc(f,F,S),M.lineWidth=A,M.strokeStyle=G,M.stroke(),Zc(M,I)}}else{var f=vs(M,I);E||o||a?(Pc(M,F,S),a?im(M,a):o?Ze(M,o,O,null,s,e):Bb(M,E,H,y,S),M.fill(),a&&M.restore(),M!==f&&Pc(f,F,S)):Pc(f,F,S),A>0&&(M.lineWidth=A,M.strokeStyle=P("group.border.color"),M.stroke()),Zc(M,I),F===nn&&mj(M,E,k,S)}M.lineJoin=V,M.lineCap=n}else{var b=P("group.title.background"),m=P("group.border.radius");if($)mg(M,$,T,h.x,h.y,h.width,h.height,s,e,J.getBodyColor());else if(E||o)if(o?Ze(M,o,O,null,s,e):Bb(M,E,H,y,h),0===A)Pc(M,nn,h),M.fill(),mj(M,E,k,h);else{switch(M.beginPath(),_){case Fl:ur(M,h.x,h.y,h.width,h.height,m,m,0,0);break;case Mn:ur(M,h.x,h.y,h.width,h.height,0,m,0,m);break;case rj:ur(M,h.x,h.y,h.width,h.height,m,0,m,0);break;case yo:ur(M,h.x,h.y,h.width,h.height,0,0,m,m)}M.fill()}if(r&&b)if(0===A)Yg(M,r.x,r.y,r.width,r.height,b),mj(M,b,k,r);else{switch(M.beginPath(),M.fillStyle=b,_){case Fl:ur(M,r.x,r.y,r.width,r.height,0,0,m,m);break;case Mn:ur(M,r.x,r.y,r.width,r.height,m,0,m,0);break;case rj:ur(M,r.x,r.y,r.width,r.height,0,m,0,m);break;case yo:ur(M,r.x,r.y,r.width,r.height,m,m,0,0)}M.fill()}if(A>0){var f=vs(M,I);if(Pc(f,"roundRect",S,m),M.lineWidth=A,M.strokeStyle=G,r&&P("group.splitLine")){var i=r.x,g=r.y,K=r.width,q=r.height;_===Fl?(M.moveTo(i,g),M.lineTo(i+K,g)):_===Mn?(M.moveTo(i+K,g),M.lineTo(i+K,g+q)):_===rj?(M.moveTo(i,g),M.lineTo(i,g+q)):(M.moveTo(i,g+q),M.lineTo(i+K,g+q))}M.stroke(),Zc(M,I)}}J._39O(M,l)}else ao.superClass._80o.call(J,M)}});var xp=function(j,G){zp(xp,this,[j,G])};ab(xp,ae,{_80o:function(C){this._39O(C,this._83o)}});var ym=function(o,J){zp(ym,this,[o,J])};ab(ym,ae,{_3O:function(){var A=this,n=A._data,w=A.s,B=A.gv,f=n.getPoints(),N=B.getBorderColor(n),l=N?w("border.width"):0,z=A.getSelectWidth(),Q=w("shape.border.width"),O=n.getRect(),p=B.getBodyColor(n),s=A._99o=f.isEmpty()?I:{rect:O,rotation:n.getRotation(),fillRule:w("shape.fill.rule"),scale:n.getScale(),position:n.p(),points:f,segments:n.getSegments(),bodyColor:p,borderColor:N,borderWidth:l,_94o:w("shape.border.3d"),_95o:w("shape.border.3d.color"),_96o:w("shape.border.3d.accuracy"),_97o:z?A.getSelectColor():I,selectWidth:z,_53o:w("shape.background"),_27Q:qp(w("shape.repeat.image"),p),shapeGradientPack:w("shape.gradient.pack"),_54o:Q,_55o:w("shape.border.color"),shapeGradient:w("shape.gradient"),_59o:w("shape.gradient.color"),_60o:w("shape.border.pattern"),_61o:w("shape.border.cap"),_62o:w("shape.border.join"),shapeForeground:w("shape.foreground"),gray:w("2d.gray")};if(s){var D=n.getScale(),e=o(1,o(J(D.x),J(D.y)));w("shape.dash")&&w("shape.dash.width")>Q&&(Q=w("shape.dash.width"));var Z=Q*("square"===s._61o?.71:.5)+l+z/A.gv._zoom/e;Z&&(Z*=e,O=oc(O),sc(O,Z,s._62o)),A._68o(O);var _=w("clip.percentage");1>_&&(0>_&&(_=0),s.clipRect=vo(n.getAnchorRect(),w("clip.direction"),_));var U=w("shape.fill.clip.percentage");1>U&&(0>U&&(U=0),s.shapeClipRect=vo(n.getAnchorRect(),w("shape.fill.clip.direction"),U));var d=w("shape.foreground.clip.percentage");1>d&&(0>d&&(d=0),s.shapeForegroundClipRect=vo(n.getAnchorRect(),w("shape.foreground.clip.direction"),d))}},getPosition:function(w,W,k,I){var P=this._99o;if(P){var t=Xp(w,P.rect,I);return t.x+=W,t.y+=k,t}return jq},_42:function(p){this._99o&&ym.superClass._42.call(this,p)},_80o:function(Y){var A,r=this,s=r.s,I=r._99o,a=I.position,Z=I.scale,b=I.rotation,d=I.borderWidth,J=I.selectWidth/r.gv._zoom,Q=I._27Q,u=I.shapeGradientPack,l=I._54o,o=I.clipRect,X=I.shapeClipRect,P=I.points,v=I.segments,K=r._data.isClosePath(),g=I.fillRule,E=I.gray,U=function(u){return E?h.toGrayColor(u):u},O=U(I._53o),m=O||Q||u;Y.save(),Kh(Y,a.x,a.y),Bh(Y,b),gr(Y,Z.x,Z.y),o&&(Y.beginPath(),Y.rect(o.x,o.y,o.width,o.height),Y.clip()),m&&X&&(Y.save(),Y.beginPath(),Y.rect(X.x,X.y,X.width,X.height),Y.clip()),Kh(Y,-a.x,-a.y);var p=I._60o,e=vs(Y,p),F=Y.lineJoin,C=Y.lineCap;Y.lineJoin=I._62o,Y.lineCap=I._61o;var M=U(I.bodyColor);m?(oe(Y,P,v,K),u?im(Y,u):Q?Ze(Y,Q,M,null,r._data,r.gv):(A=M?M:O,Bb(Y,A,I.shapeGradient,U(I._59o),I.rect)),Y.fill(g),X&&(Y.restore(),Kh(Y,-a.x,-a.y)),u&&Y.restore(),e!==Y&&oe(e,P,v,K)):oe(e,P,v,K);var H=I.shapeForeground;if(H){Y.save();var L=I.shapeForegroundClipRect;L&&(Kh(Y,a.x,a.y),Y.beginPath(),Y.rect(L.x,L.y,L.width,L.height),Y.clip(),Kh(Y,-a.x,-a.y)),oe(Y,P,v,K),Bb(Y,H,s("shape.foreground.gradient"),U(s("shape.foreground.gradient.color")),I.rect),Y.fill(g),Y.restore()}var n=s("shape.border.width.absolute");if(n&&(Y.save(),Y.setTransform(1,0,0,1,0,0)),J&&(Y.strokeStyle=I._97o,Y.lineWidth=l+2*(d+J),Y.stroke()),d&&(Y.strokeStyle=U(I.borderColor),Y.lineWidth=l+2*d,Y.stroke()),l&&(A=U(I._55o),!O&&M&&(A=M),Y.strokeStyle=A,Y.lineWidth=l,Y.stroke(),I._94o&&Ao(Y,A,U(I._95o),l,r.gv._zoom,I._96o)),n&&Y.restore(),Zc(Y,p),s("shape.dash")){var f=s("shape.dash.width")||l;if(f>0){p=s("shape.dash.pattern");var e=vs(Y,p,r._2Q("shape.dash.offset"));e!==Y&&oe(e,P,v,K),r._1Q(Y,"shape",f,p)}}Y.lineJoin=F,Y.lineCap=C,Y.restore()},_48O:function(){},_47O:function(){}});var Ab=function(G,c){zp(Ab,this,[G,c])};ab(Ab,ym,{getRotation:function(L,t,h){L=L||0;var G=this._data.getPoints(),N=G.size();return N>1?as[h]?N&&0===N%2?Gm(G.get(N/2-1),G.get(N/2),t,L):L:Cd[h]?Gm(G.get(0),G.get(1),t,L):Gm(G.get(N-2),G.get(N-1),t,L):L},getPosition:function(u,t,y,e,A){var c=this._data.getPoints(),k=c.size();if(k>1){if(as[u]){var C=k%2;if(0===C)return kh(c.get(k/2-1),c.get(k/2),u,t,y,e,A);var z=c.get((k-C)/2),$={x:z.x,y:z.y,width:0,height:0};return z=Xp(u,$,e),z.x+=t,z.y+=y,z}return Cd[u]?kh(c.get(0),c.get(1),u,t,y,e,A):kh(c.get(k-2),c.get(k-1),u,t,y,e,A)}return jq}});var Bn=function(n,S){zp(Bn,this,[n,S])};ab(Bn,ae,{_3O:function(){var $=this;Bn.superClass._3O.call($);var K=$.s,Q=$._83o;$._82o=Q.img||Q.shape?I:{background:$.getBodyColor("grid.background"),depth:K("grid.depth"),rect:Q.rect,_88o:K("grid.cell.depth"),cellBorderColor:K("grid.cell.border.color"),_89o:K("grid.row.count"),_90o:K("grid.column.count"),block:K("grid.block"),_91o:K("grid.block.color"),_92o:K("grid.block.padding"),_93o:K("grid.block.width")}},_80o:function(L){var P=this,g=P._82o;if(!g)return Bn.superClass._80o.call(P,L),void 0;var e,F,I=P._data,m=g.background,C=g.rect,G=g.block,s=g._91o,k=g._92o,J=g._93o,u=g._88o,v=g.cellBorderColor,U=g._89o,l=g._90o;if(m)if(Yg(L,C.x,C.y,C.width,C.height,m),mj(L,m,g.depth,C),u)for(e=0;U>e;e++)for(F=0;l>F;F++)C=I.getCellRect(e,F),C&&mj(L,m,u,C);else if(v){for(L.beginPath(),e=0;U>e;e++)for(F=0;l>F;F++)C=I.getCellRect(e,F),C&&L.rect(C.x,C.y,C.width,C.height);L.strokeStyle=v,L.lineWidth=1,L.stroke()}if("h"===G)for(e=0;U>e;e++)C=Tp(I.getCellRect(e,0),I.getCellRect(e,l-1)),Rd(C,k),Wr(L,s,C.x,C.y,C.width,C.height,J);else if("v"===G)for(F=0;l>F;F++)C=Tp(I.getCellRect(0,F),I.getCellRect(U-1,F)),Rd(C,k),Wr(L,s,C.x,C.y,C.width,C.height,J);P._39O(L,P._83o)}});var ns=function(f,z){zp(ns,this,[f,z])};ab(ns,ae,{_checkEmptyRect:!1,_81o:function(){var n=this._data,O=ns.superClass._81o.call(this),E=n.s("text");if(E!=I){var o,z,N=n.s("text.font"),Z=n.s("text.align"),X=n.s("text.vAlign"),e=es(N,E),F=e.width,W=e.height,t=n.getAnchor(),R=n.getWidth(),j=n.getHeight();"left"===Z?o=-R*t.x:"center"===Z?o=-R*t.x+(R-F)/2:"right"===Z&&(o=R*(1-t.x)-e.width),"top"===X?z=-j*t.y:"middle"===X?z=-j*t.y+(j-W)/2:"bottom"===X&&(z=j*(1-t.y)-e.height);var g,D=n.getMatrix();if(g=no([D.tf(o,z),D.tf(o+F,z),D.tf(o+F,z+W),D.tf(o,z+W)]),O=Tp(O,g),O&&n.s("text.shadow")){var Y=oc(O);Y.x+=n.s("text.shadow.offset.x"),Y.y+=n.s("text.shadow.offset.y"),Rd(Y,n.s("text.shadow.blur")),O=Tp(O,Y)}}return O}});var Hh=Ql.Interactor=function(U){this.gv=this._graphView=U};li("Interactor",C,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(e){this.gv.fi(e)},setCursor:function(d){hd||this.gv.setCursor(d)},startDragging:function(E){var q=this;q._lastClientPoint=fm(E),q._lastLogicalPoint=q.gv.lp(E),Ti(q,E)},clearDragging:function(){var r=this;r._lastClientPoint=r._lastLogicalPoint=r._logicalPoint=I},autoScroll:function(g){return this.gv.autoScroll(g,this._lastClientPoint)}});var ad=I,Io=function(R){ad.handleWindowTouchMove(R)},Ej=function(z){ad.handleWindowTouchEnd(z),U.removeEventListener(jn,Io,P),U.removeEventListener(Fq,Ej,P),ad=I},Ve=function(j){ad.handleWindowMouseMove(j)},Uf=function(z){ad.handleWindowMouseUp(z),U.removeEventListener(wo,Ve,P),U.removeEventListener($f,Uf,P),ad=I},Bs=function(B,K){B!==ad&&(ad?hd?ad.handleWindowTouchEnd(K):ad.handleWindowMouseUp(K):hd?(U.addEventListener(jn,Io,P),U.addEventListener(Fq,Ej,P)):(U.addEventListener(wo,Ve,P),U.addEventListener($f,Uf,P)),ad=B)},nl=function(p){var N=this;N.gv=p,N._is2d=p instanceof Ql.GraphView,N._is2d&&(N.filter=function(W){return p.isSelectable(W)&&p.isInteractive(W)}),p.getView(),["mousedown","mousemove","mouseleave","touchstart","touchmove",fc].forEach(function($){N.addListener($)}),N.initImageResource()};ab(nl,Hh,{enableVR:function(e){var p=this;if(!!p._vrEnable!==e)if(p._vrEnable=e,e)p.gv.vr.mp(p.onVRControllerChange,p);else if(p.gv.vr.ump(p.onVRControllerChange,p),p._vrRayPolyline){var T=p.gv.dm();T.remove(p._vrRayPolyline),T.remove(p._vrRayHitPoint),p._vrRayPolyline=H,p._vrRayHitPoint=H}},onVRControllerChange:function(I){var Q=this,O=I.property,s=I.newValue,P=Q.gv.vr.getController(s.id),T=P.getRay();T&&("gamepad.button.trigger"===O?"down"===s._62O?Q.handle_mousedown(T):Q.handleWindowMouseUp(T):"gamepad.pose"===O&&(Q.handle_mousemove(T),Q.handleWindowMouseMove(T)))},drawVRRay:function(I,E,q){var D,B=this,d=B.gv,U=B._vrRayPolyline,N=!1;if(U)D=B._vrRayHitPoint;else{var l=d.dm();B._vrRayPolyline=U=new j.Polyline,B._vrRayHitPoint=D=new j.Node,D.s({shape3d:"billboard","shape3d.transparent":!0,"shape3d.texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),D.setAnchor3d(.5,.5,.499);var O=.2/d.vr.measureOflength;D.s3(O,O,O),U.s("intersect",!1),D.s("intersect",!1),l.add(U),l.add(D),N=!0}if(E){var Z=q.world,F=q.worldNormal,r=Z.x,A=Z.y,Y=Z.z;U.s("shape.border.color","red"),U.setPoints([{x:I.origin.x,y:I.origin.z,e:I.origin.y},{x:r,y:Y,e:A}]),D.s("3d.visible",!0),D.p3(r,A,Y),D.lookAtDirection([F.x,F.y,F.z],"front")}else{U.s("shape.border.color","blue");var f=new j.Math.Vector3;f.copy(I.direction).setLength(1e3/B.gv.vr.measureOflength).add(I.origin),U.setPoints([{x:I.origin.x,y:I.origin.z,e:I.origin.y},{x:f.x,y:f.z,e:f.y}]),D.s("3d.visible",!1)}d.fi({kind:"vrRayIntersect",ray:I,data:E,intersect:q,polyline:U,hitNode:D,begin:N})},addListener:function(d){var Q=this;Q.gv.getView().addEventListener(d,function(y){h.preventDefault(y),Q.disabled||Q["handle_"+d](y)},P)},handleWindowTouchMove:function(r){this.handleWindowMouseMove(r)},handleWindowMouseMove:function(F){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",F):(this.handleDownInfo("onBeginDrag",F),this.isDragging=!0))},handleWindowTouchEnd:function(A){this.handleWindowMouseUp(A)},handleWindowMouseUp:function(Q){if(this.isDragging&&(this.handleDownInfo("onEndDrag",Q),this.isDragging=!1),this.downInfo){var X=this.handle("onUp",Q);X&&X.data===this.downInfo.data?this.handleMissingUp(Q):this.handleDownInfo("onUp",Q),this.downInfo=I}},handle_mouseleave:function(G){var M=this,e=M.gv,Q=M.currentInfo?M.currentInfo.data:I;if(Q){Q.s("onLeave")&&Q.s("onLeave")(G,Q,e),M.fire("data","onLeave",G,Q);var F=M.currentInfo?M.currentInfo.hits:I;if(F)for(var q in F)M.handleLeave(G,q);M.currentInfo=I}},handle_mousewheel:function(d){d.scrollDelta=d.wheelDelta/40,this.handle("onScroll",d)},handle_DOMMouseScroll:function(d){d.scrollDelta=2===d.axis?-d.detail:0,this.handle("onScroll",d)},handle_touchstart:function(E){this.handle_mousedown(E)},handle_touchmove:function(K){this.handle("onMove",K)},handle_mousedown:function(F){this.isDragging&&(this.handleDownInfo("onEndDrag",F),this.isDragging=!1),this.downInfo=this.handle("onDown",F),this.downInfo&&Bs(this,F)},handle_mousemove:function(C){var b=this,G=b.gv;b._hoverTimer&&(r(b._hoverTimer),delete b._hoverTimer);var F,l,S,v=b.handle("onMove",C),E=this.currentInfo?this.currentInfo.data:I,Z=this.currentInfo?this.currentInfo.hits:I;if(v&&(l=v.data,S=v.hits,b._hoverTimer=e(function(){r(b._hoverTimer),delete b._hoverTimer,b.handle("onHover",C,v)},G.getHoverDelay()||h.hoverDelay)),l!==E){if(E&&(E.s("onLeave")&&E.s("onLeave")(C,E,G),this.fire("data","onLeave",C,E)),l&&(l.s("onEnter")&&l.s("onEnter")(C,l,G),this.fire("data","onEnter",C,l)),Z)for(F in Z)this.handleLeave(C,F);if(S)for(F in S){var m=S[F];m.target.onEnter&&m.target.onEnter(C,l,G,m.point,m.width,m.height),this.fire(m.type,"onEnter",m.event,m.data,m.image,m.comp,m.point,m)}}else{if(Z)for(F in Z)S&&S[F]||this.handleLeave(C,F);if(S)for(F in S)if(!Z||!Z[F]){var m=S[F];m.target.onEnter&&m.target.onEnter(C,l,G,m.point,m.width,m.height),this.fire(m.type,"onEnter",m.event,m.data,m.image,m.comp,m.point,m)}}this.currentInfo=v},handle:function(I,e,h){var k,C=this,V=C.gv;if(C._is2d){if(h=h||V.getDataInfoAt(e,this.filter),!h)return;if(k=h.ui.interactiveInfo){var N,n=h.data;if(n.s(I)&&n.s(I)(e,n,V),this.fire("data",I,e,n),"body"===h.part&&k.bodyInfo)N="body",h.hits=this.handleImage(N,V.getImage(n),I,e,n,h.point,k.bodyInfo);else if("icons"===h.part&&k._38o){var U=k._38o[h.name];U&&U[h.index]&&(N="icons|"+h.name+"|"+h.index,h.hits=this.handleImage(N,h.icon,I,e,n,h.point,U[h.index]))}}return h}var n,F;if(!h)if(e&&e instanceof j.Math.Ray){var S=V.vr.intersectWorld(e);if(n=S.data,F=S.intersect,C.drawVRRay(e,n,F),!n)return;var W=V.getData3dUI(n);if(k=W.interactiveInfo,!k)return;h={data:n,part:F.part,ui:W}}else{if(h=V.getDataInfoAt(e),!h)return;h&&(h={data:h.data,part:h.part})}if(!F){n=h.data;var W=V.getData3dUI(n);if(h.ui=W,k=W.interactiveInfo,!k)return h;if(F=V.intersectObject(e,n),!F)return}n.s(I)&&n.s(I)(e,n,V),this.fire("data",I,e,n);var J,B=F.part;return"body"!==B&&(J=n.s(B+".image")||n.s("shape3d."+B+".image")),J||(J=n.s("all.image")||n.s("shape3d.image")),(k=k[J])?(h.part="body",h.interactiveInfo=k,h.point=F.uv.multiply({x:k.bodyInfo.rect.width,y:k.bodyInfo.rect.height}),h.image=J,h.hits=this.handleImage("body",J,I,e,n,h.point,k.bodyInfo),h):void 0},_handleLeaveOrMissing:function(m,T,y){var A="leave"===m?this.currentInfo:this.downInfo;if(A){var X=A.interactiveInfo||A.ui.interactiveInfo;if(X){var p,L,B=A.data;if(this._is2d){if(L=this.gv.lp(T),"body"===A.part&&X.bodyInfo)p="body","leave"===m?this.handleLeaveImage(y,p,this.gv.getImage(B),T,B,L,X.bodyInfo):this.handleMissingUpImage(p,this.gv.getImage(B),T,B,L,X.bodyInfo);else if("icons"===A.part&&X._38o){var J=X._38o[A.name];J&&J[A.index]&&(p="icons|"+A.name+"|"+A.index,"leave"===m?this.handleLeaveImage(y,p,A.icon,T,B,L,J[A.index]):this.handleMissingUpImage(p,A.icon,T,B,L,J[A.index]))}}else{var h=this.gv.intersectObject(T,B);L=h?h.uv.multiply({x:X.bodyInfo.rect.width,y:X.bodyInfo.rect.height}):{x:1/0,y:1/0},"leave"===m?this.handleLeaveImage(y,"body",A.image,T,B,L,X.bodyInfo):this.handleMissingUpImage("body",A.image,T,B,L,X.bodyInfo)}}}},handleDownInfo:function(u,B){if(this.downInfo){var s=this.downInfo,$=this.gv,v=s.interactiveInfo||s.ui.interactiveInfo;if(v){var E,K=s.data;if(K.s(u)&&K.s(u)(B,K,$),this.fire("data",u,B,K),this._is2d){var J=$.lp(B);if("body"===s.part&&v.bodyInfo)E="body",this.handleDownInfoImage(E,$.getImage(K),u,B,K,J,v.bodyInfo);else if("icons"===s.part&&v._38o){var _=v._38o[s.name];_&&_[s.index]&&(E="icons|"+s.name+"|"+s.index,this.handleDownInfoImage(E,s.icon,u,B,K,J,_[s.index]))}}else{var y=$.intersectObject(B,K);if(!y)return;J=y.uv.multiply({x:v.bodyInfo.rect.width,y:v.bodyInfo.rect.height}),this.handleDownInfoImage("body",s.image,u,B,K,J,v.bodyInfo)}}}},fire:function(A,t,$,J,E,Q,z,C){this.gv.fi({kind:t,type:A,event:$,data:J,image:E,comp:Q,view:this.gv,point:z,width:C?C.width:H,height:C?C.height:H})},handleImage:function(N,C,U,q,G,T,y){var b={};if(C&&(C=qp(C))){var B=this.gv,J=y.rect,E=this.convertPoint(T,y);E.inRect&&(C[U]&&C[U](q,G,B,E,J.width,J.height),this.fire("image",U,q,G,C,H,E,J),b[N+"|image"]={target:C,type:"image",image:C,data:G,event:q,point:E,width:J.width,height:J.height});for(var S=y.compInfos,V=C,k=S.length-1;k>=0;k--){var f=S[k],g=f.comp;E=this.convertPoint(T,f,V,g,B,G),E.inRect&&(J=f.rect,g[U]&&g[U](q,G,B,E,J.width,J.height),this.fire("comp",U,q,G,C,g,E,J),(C=J.image)&&(C[U]&&C[U](q,G,B,E,J.width,J.height),this.fire("image",U,q,G,C,H,E,J)),b[N+"|"+k]={target:g,type:"comp",comp:g,image:C,data:G,event:q,point:E,width:J.width,height:J.height},C&&(b[N+"|"+k+"|image"]={target:C,type:"image",image:C,data:G,event:q,point:E,width:J.width,height:J.height}))}}return b},handleLeave:function(Q,M){return this._handleLeaveOrMissing("leave",Q,M)},handleMissingUp:function(m){return this._handleLeaveOrMissing("missing",m)},handleLeaveImage:function(t,M,B,n,W,j,E){if(B&&(B=qp(B))){var Y=this.gv,R=E.rect,L=this.convertPoint(j,E);t===M+"|image"&&(B.onLeave&&B.onLeave(n,W,Y,L,R.width,R.height),this.fire("image","onLeave",n,W,B,H,L,R));for(var q=E.compInfos,D=B,$=q.length-1;$>=0;$--){var _=q[$],v=_.comp;L=this.convertPoint(j,_,D,v,Y,W),R=_.rect,t===M+"|"+$&&(v.onLeave&&v.onLeave(n,W,Y,L,R.width,R.height),this.fire("comp","onLeave",n,W,B,v,L,R)),(B=R.image)&&t===M+"|"+$+"|image"&&(B.onLeave&&B.onLeave(n,W,Y,L,R.width,R.height),this.fire("image","onLeave",n,W,B,H,L,R))}}},handleMissingUpImage:function(m,L,Q,M,E,c){var e="onUp",b=this.downInfo.hits;if(b&&L&&(L=qp(L))){var X=this.gv,N=c.rect,I=this.convertPoint(E,c);!I.inRect&&b[m+"|image"]&&(L[e]&&L[e](Q,M,X,I,N.width,N.height),this.fire("image",e,Q,M,L,H,I,N));for(var q=c.compInfos,J=L,F=q.length-1;F>=0;F--){var n=q[F],T=n.comp;I=this.convertPoint(E,n,J,T,X,M),I.inRect||(N=n.rect,b[m+"|"+F]&&(T[e]&&T[e](Q,M,X,I,N.width,N.height),this.fire("comp",e,Q,M,L,T,I,N)),(L=N.image)&&b[m+"|"+F+"|image"]&&(L[e]&&L[e](Q,M,X,I,N.width,N.height),this.fire("image",e,Q,M,L,H,I,N)))}}},handleDownInfoImage:function(B,s,X,u,b,o,P){var m=this.downInfo.hits;if(m&&s&&(s=qp(s))){var N=this.gv,U=P.rect,S=this.convertPoint(o,P);m[B+"|image"]&&(s[X]&&s[X](u,b,N,S,U.width,U.height),this.fire("image",X,u,b,s,H,S,U));for(var n=P.compInfos,d=s,Y=n.length-1;Y>=0;Y--){var c=n[Y],j=c.comp;S=this.convertPoint(o,c,d,j,N,b),U=c.rect,m[B+"|"+Y]&&(j[X]&&j[X](u,b,N,S,U.width,U.height),this.fire("comp",X,u,b,s,j,S,U)),(s=U.image)&&m[B+"|"+Y+"|image"]&&(s[X]&&s[X](u,b,N,S,U.width,U.height),this.fire("image",X,u,b,s,H,S,U))}}},initImageResource:function(){h.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},convertPoint:function(l,b,$,Q,Y,d){var t=b.rect,B=b.matrix.applyInverse(l).sub(t),x=B.x>=0&&B.y>=0&&B.x<=t.width&&B.y<=t.height;if(!x)return B;if(Q&&oh(Q.pixelPerfect,d,Y)){var t,n=1;this._is2d?(n=Y.getZoom(),t=Xq(l.x,l.y,H,n)):t=Xq(l.x,l.y);var M=!1,c=t.x,s=t.y,F=t.width,g=t.height,r=h.hitMaxArea,C=F*g*n*n;if(C>r){var o=Math.sqrt(r/C);n*=o}F*=n,g*=n,2>F&&(F=2),2>g&&(g=2),c*=n,s*=n;var v=Qp(F,g),u=new ng(0,-c,-s,n,n);u.append(b.matrix),Y._drawForChecking=!0,Q.transform=u;var E=$.comps;$.comps=[Q],_i(v,$,0,0,F,g,d,self),$.comps=E,delete Q.transform,Y._drawForChecking=!1;try{for(var w=0,i=v.getImageData(0,0,F,g).data;w<i.length;w+=4)if(0!==i[w+3]){M=!0;break}v.restore()}catch(S){Kj=I,M=!1}B.inRect=M}else B.inRect=!0;return B}});var Yd=Ql.DefaultInteractor=function(t){zp(Yd,this,[t])};li("DefaultInteractor",Hh,{handle_mousedown:function(j){Oi(j);var l=this,q=l.gv,p=q.getDataAt(j);!q.setFocus(j)||q._editing||q._scrolling||(Ih(j)?q.handleDoubleClick(j,p):q.handleClick(j,p),!ib()&&p&&(q.isMovable(p)||q.isInteractive(p))||!q.isPannable()||!gc(j)||aq(j)||(l._tx=q.tx(),l._ty=q.ty(),l.startDragging(j)))},handleWindowMouseUp:function($){var D=this,f=D.gv;f._panning&&(delete f._panning,f.onPanEnded(),D.fi({kind:"endPan",event:$})),delete D._tx,delete D._ty,D.clearDragging()},handle_mousemove:function(l){var V=this,H=V.gv;V._hoverTimer&&(r(V._hoverTimer),delete V._hoverTimer),V._hoverTimer=e(function(){V.fi({kind:"hover",event:l}),r(V._hoverTimer),delete V._hoverTimer},H.getHoverDelay()||h.hoverDelay)},handle_touchmove:function(i){this.handle_mousemove(i)},handleWindowMouseMove:function(l){var t=this,k=t.gv,I=t._lastClientPoint;t.fi({kind:k._panning?"betweenPan":"beginPan",event:l}),k._panning=1,k.setTranslate(t._tx+l.clientX-I.x,t._ty+l.clientY-I.y)},handle_mousewheel:function(l){this.gv.handleScroll(l,l.wheelDelta)},handle_DOMMouseScroll:function(x){2===x.axis&&this.gv.handleScroll(x,-x.detail)},handle_keydown:function(T){this.gv.handleKeyDown(T)}});var nh=Ql.SelectInteractor=function(X){zp(nh,this,[X])};li("SelectInteractor",Hh,{_42:function(){var I=this,X=I.gv,P=X.getZoom(),W=I.mark,q=I.div;q||(q=I.div=cf(),jr(I.getView(),q));var u={};u.x=W.x*P+X.tx(),u.y=W.y*P+X.ty(),u.width=W.width*P,u.height=W.height*P,Hr(q,u),this.intersects()?(q.style.border="",q.style.background=X.getRectSelectBackground()):(q.style.background="",q.style.border="1px solid "+X.getRectSelectBorderColor())},handle_mousedown:function(M){var j=this,h=j.gv;if(j._57I=I,j.pendingClickThrough=I,!(h._editing||h._scrolling||ib())){var Q=h.getDataAt(M),o=h.sm();Q?aq(M)?o.co(Q)?o.rs(Q):o.as(Q):o.co(Q)?Q instanceof tm&&Q.isClickThroughEnabled()&&(j.pendingClickThrough=fm(M)):o.ss(Q):aq(M)||!h.isPannable()?gc(M)&&(aq(M)||o.cs(),h.isRectSelectable()&&(j.startDragging(M),h._77O=1)):gc(M)&&(j._57I=fm(M))}},handle_mouseup:function(N){var h=this,u=h.gv,A=h._57I;
if(A&&(em(A,fm(N))<=1&&u.sm().cs(),h._57I=I),h.pendingClickThrough){if(em(h.pendingClickThrough,fm(N))<=1){var X=u.getDataAt(N);if(X instanceof tm&&X.isClickThroughEnabled()){var R=u.getDataAt(N,function(H){var o=H.getParent()===X&&u.isSelectable(H,!0);return o});R&&(N.clickThrough=!0,u.sm().ss(R))}}h.pendingClickThrough=I}},handleWindowMouseUp:function(E){this.clear(E)},handleWindowMouseMove:function(P){var Y=this,s=Y.gv;Y._logicalPoint=s.lp(P),Y.mark?(Y.fi({kind:"betweenRectSelect",event:P}),s.isPannable()&&Y.autoScroll(P),Y.redraw()):Y.fi({kind:"beginRectSelect",event:P}),Y.mark=no(Y._lastLogicalPoint,Y._logicalPoint),Y.redraw()},intersects:function(){var Q=this,R=Q._lastLogicalPoint,J=Q._logicalPoint;return R.x>J.x||R.y>J.y},clear:function(R){var Q=this,q=Q.gv,x=Q.mark;if(Q._57I=I,Q.pendingClickThrough=I,Q._lastLogicalPoint){if(x){if(0!==x.width&&0!==x.height){var e=q.getDatasInRect(x,Q.intersects());if(!e.isEmpty()){var W=q.sm(),f=W.toSelection();e.each(function(T){W.co(T)?f.remove(T):f.add(T)}),W.ss(f)}}Wb(Q.div),delete Q.div,delete Q.mark,Q.redraw(),Q.fi({kind:"endRectSelect",event:R}),q.onRectSelectEnded()}Q.clearDragging(),delete q._77O}},redraw:function(){var w=this;w._draw||(w._draw=1,e(function(){w.mark&&w._42(),delete w._draw},16))}});var Ho=Ql.MoveInteractor=function(t){zp(Ho,this,[t])};li("MoveInteractor",Hh,{handle_mousedown:function(b){var a=this,Y=a.gv;if(gc(b)&&!Y._editing&&!Y._scrolling&&!ib()){var K=Y.getSelectedDataAt(b);!K||Y.isInteractive(K)&&!Y.isMovable(K)?Y._focusData=I:(a._data=K,Y.handleMouseDown&&Y.handleMouseDown(b,K),a.startDragging(b),Y.isMovable(K)&&(Y._moving=1))}},handleWindowMouseUp:function(z){var Z=this,$=Z.gv;$.handleMouseUp&&$.handleMouseUp(z,Z._data),Z.clear(z)},handleWindowMouseMove:function(w){var W=this,H=W._data,m=W.gv;if((!m._93O||!m._93O(w,H))&&m._moving){W._logicalPoint||W.fi({kind:"prepareMove",event:w});var z=W._logicalPoint?"betweenMove":"beginMove",x={kind:z,event:w},c=W._logicalPoint=m.lp(w);"beginMove"!==z||W._alreadyBeginTransaction||(W._alreadyBeginTransaction=!0,m.getDataModel().beginTransaction());var N=W._calcShift(z,w),o=N.x,Z=N.y,S=W.gv.getMoveMode(w,H);S&&("x"===S?Z=0:"y"===S?o=0:"xy"!==S&&(o=Z=0)),m.moveSelection(o,Z),W._lastLogicalPoint=c,W.autoScroll(w),W.fi(x)}},_calcShift:function(){var I=this,P=I._logicalPoint,l=I._lastLogicalPoint,J=P.x-l.x,Y=P.y-l.y;return{x:J,y:Y}},clear:function(Z){var o=this,Y=o.gv;o._lastLogicalPoint&&(o._lastLogicalPoint=o._data=Y._moving=I,o._logicalPoint&&(o.fi({kind:"endMove",event:Z}),Y.onMoveEnded()),o.clearDragging()),o._alreadyBeginTransaction&&(o._alreadyBeginTransaction=!1,Y.getDataModel().endTransaction())}});var tl=Ql.ScrollBarInteractor=function(D){zp(tl,this,[D])};li("ScrollBarInteractor",Hh,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(O){var w=this.gv.getViewRect();return this._41o()&&(w.x+w.width-this.gv.lp(O).x)*this.gv.getZoom()<kr},isH:function(M){var u=this.gv.getViewRect();return this._40o()&&(u.y+u.height-this.gv.lp(M).y)*this.gv.getZoom()<kr},handle_mousemove:function(z){this.handle_touchmove(z)},handle_touchmove:function(l){if(!Rm&&gc(l)&&this.gv.isScrollBarVisible()){var T=this,m=T.isV(l),F=T.isH(l);(m||F)&&T.gv.showScrollBar(),T.gv._scrolling=m||F}},handleWindowMouseUp:function(Q){this.handleWindowTouchEnd(Q)},handleWindowTouchEnd:function(P){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=I,this.fi({kind:"endScroll",event:P})},handle_mousedown:function(X){this.handle_touchstart(X)},handle_touchstart:function(Q){var T=this;if(T.gv.setFocus(Q),Oi(Q),T.handle_touchmove(Q),!(Kb(Q)>1)&&T.gv._scrolling&&T.gv.isScrollBarVisible()){T._cp=fm(Q),T._tx=T.gv.tx(),T._ty=T.gv.ty();var Z=T.isV(Q);T._state=Z?"vScroll":"hScroll",Ti(T,Q),T.fi({kind:"beginScroll",event:Q})}},handleWindowMouseMove:function(G){this.handleWindowTouchMove(G)},handleWindowTouchMove:function(X){var U=fm(X),S=this.gv.getViewRect(),I=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-U.y)*I.height/S.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-U.x)*I.width/S.width),this.fi({kind:"betweenScroll",event:X})}});var nf=Ql.TouchInteractor=function(m,Z){Z=Z||{},Z.selectable===H&&(Z.selectable=!0),Z.movable===H&&(Z.movable=!0),Z.pannable===H&&(Z.pannable=!0),Z.pinchable===H&&(Z.pinchable=!0),Z.editable===H&&(Z.editable=!0),this.params=Z,zp(nf,this,[m])};li("TouchInteractor",Hh,{ms_edit:1,setUp:function(){var o=this;nf.superClass.setUp.call(o),hd&&o.params.editable&&o.gv.setEditInteractor(o)},tearDown:function(){var v=this;nf.superClass.tearDown.call(v),hd&&v.params.editable&&v.gv.setEditInteractor(I)},clear:function(J){var e=this,P=e.gv;P._moving&&(e.fi({kind:"endMove",event:J}),delete P._moving,P.onMoveEnded(),P.dm().endTransaction()),P._panning&&(e.fi({kind:"endPan",event:J}),delete P._panning,P.onPanEnded()),P._pinching&&(e.fi({kind:"endPinch",event:J}),delete P._pinching,P.onPinchEnded()),P._editing&&(e._46O(J),e._77I=e._node=e._edge=e._shape=e._rect=e._89I=e._index=P._editing=I),e._moving=e._panning=e._pinching=e._editing=e._57I=e._data=e._beginHistory=I,e.clearDragging()},handle_touchstart:function(c){var A=this;if(!A.gv._editing){Oi(c),A._57I=I;var L=A.params,N=A.gv,K=N.sm(),p=N.getDataAt(c),e=Kb(c);if(1===e){if(Ih(c))return N.handleDoubleClick(c,p),void 0;N.handleClick(c,p),p&&(N.handleMouseDown&&N.handleMouseDown(c,p),A._data=p),L.selectable||(p=I),p?(K.co(p)||K.ss(p),L.editable&&N.isEditable(p)&&A._79I(c,p,!0)?(A._editing=1,A.startDragging(c)):L.movable&&N.isMovable(p)&&(A._moving=1,A.startDragging(c))):(A._57I=fm(c),L.pannable&&N.isPannable()&&(A._panning=1,A.startDragging(c),A._translate={x:N.tx(),y:N.ty()}))}else if(L.pinchable&&2===e){A._pinching=1,A.startDragging(c);var v=N.getView(),q=N.getZoom(),H=v.getBoundingClientRect(),M=c.touches[0],Q=c.touches[1],m={x:(M.clientX+Q.clientX)/2-H.left,y:(M.clientY+Q.clientY)/2-H.top};m.x-=N.tx(),m.y-=N.ty(),m.x/=q,m.y/=q,A._p=m,A._d=rb(c)}}},handle_touchend:function(F){var H=this,J=H.gv,S=H._57I,B=H._data;S&&(em(S,fm(F))<=1&&J.sm().cs(),H._57I=I),B&&J.handleMouseUp&&J.handleMouseUp(F,B)},handleWindowTouchEnd:function(Y){this.clear(Y)},handleWindowTouchMove:function(u){var j=this,z=j.gv,q=Kb(u);if(1===q){if(j._editing&&(j._beginHistory||(j._beginHistory=1,z.dm().beginTransaction()),z._editing=1,j._78I(u)),j._moving)j._beginHistory||(j._beginHistory=1,z.dm().beginTransaction()),j.handleMove(u);else if(j._panning){var H=fm(u);z.setTranslate(j._translate.x+H.x-j._lastClientPoint.x,j._translate.y+H.y-j._lastClientPoint.y),j.fi({kind:z._panning?"betweenPan":"beginPan",event:u}),z._panning=1}}else if(2===q&&j._pinching){var T=rb(u);z.handlePinch(j._p,T,j._d),j._d=T,j.fi({kind:z._pinching?"betweenPinch":"beginPinch",event:u}),z._pinching=1}},handleMove:function(T){var j=this,k=j.gv,X=k.lp(T);k._93O&&k._93O(T,j._data)||(k.moveSelection(X.x-j._lastLogicalPoint.x,X.y-j._lastLogicalPoint.y),j._lastLogicalPoint=X,j.autoScroll(T),j.fi({kind:k._moving?"betweenMove":"beginMove",event:T}),k._moving=1)}});var j=U.ht,Il=j.graph._editor={Math:j.Math,Guide:{}};Il.getStyle=function(O){var q,W=Il.StyleMap;return W&&(q=W[O],q!==H)?q:Il.DefaultStyleMap[O]},Il.setStyle=function(i,V){var F=Il.StyleMap;F||(F=Il.StyleMap={}),F[i]=V},Il.inEdit=function(S){return S._inXEdit===!0},Il.startEdit=function(m){m._inXEdit=!0,Il.Inject.doInject(m)},Il._46O=function(c){c._inXEdit=!1,Il.Inject.undoInject(c)},Il.toScreenPosition=function(T,r){var k=T.tx(),S=T.ty(),P=T._zoom;return new Il.Math.Vector2(r.x*P+k,r.y*P+S)},Il.checkHit=function(H,A,O){return H.distanceTo(A)<O?!0:!1},Il.toWorldPosition=function(y,I){var K=y.tx(),X=y.ty(),V=y._zoom;return{x:(I.x-K)/V,y:(I.y-X)/V}},Il.setAntialias=function(g,i){for(var S,s=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],J=0,M=s.length;M>J&&(S=s[J],!(S in g));J++);g[S],g[S]=i},Il.getTargetCornersOnScreen=function(i,z){if(!z)return null;var $,p=[];if(Ye(z,i)){var G=Rp(i,z);$=[{x:G.x,y:G.y},{x:G.x+G.width,y:G.y},{x:G.x+G.width,y:G.y+G.height},{x:G.x,y:G.y+G.height}]}else{if(!z.getCorners)return null;$=z.getCorners()}return $.forEach(function($){var K=Il.toScreenPosition(i,$);p.push(K.x,K.y)}),p},Il.log=function(){};var ak=Il.Inject={_modules:[]};ak.registAsModule=function(f,K){var G={},h={};for(var S in f){var D=K.prototype[S];G[S]=D}f.getBackup=function(Y){return G[Y]},f.getBackups=function(){return G},h.doInject=function(){for(var i in f)"getBackup"!==i&&(K.prototype[i]=f[i])},h.undoInject=function(){for(var O in f)"getBackup"!==O&&(K.prototype[O]=G[O])},ak._modules.push(h)},ak.doInject=function(b){for(var i,z=ak._modules,$=0,D=z.length;D>$;$++)i=z[$],i.doInject(b)},ak.undoInject=function(L){for(var q,s=ak._modules,R=0,i=s.length;i>R;R++)q=s[R],q.undoInject(L)};var Hh=j.graph.EditInteractor=function(u){var Z=this,J=i.createElement("canvas");J.className="editCanvas",J.style.position="absolute",Z._styleMap={},Z._canvas=J,Z._context=J.getContext("2d"),Hh.superClass.constructor.call(Z,u),Il.setAntialias(Z._context,!1),Z._subModules=[new Il.Anchor(Z),new Il.RotateX(Z),new Il.Rect(Z),new Il.Curve(Z),new Il.MoveHelper(Z)],Z._gridGuide=new Il.Guide.Grid(Z),Z._rectGuide=new Il.Guide.Rect(Z)},zn=Hh;j.Default.def(Hh,j.graph.Interactor,{ms_edit:1,ms_fire:1}),C.defineProperties(Hh.prototype,{editDetail:{get:function(){var x=!!this._editDetail;return x},set:function(r){var k=this,d=k._editDetail;d!==r&&(k._editDetail=r,k.gv._editing=r,k.fp("editDetail",d,r),k.fp("pointsEditingMode",d,r),k.fi({kind:r?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(g){(!this._editDetail||g)&&(this.gv._editing=g,g||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(h){this._editing=h,this.gvEditing=h}},pointsEditingMode:{get:function(){return this.editDetail},set:function(r){var w=this;w.editDetail!==r&&(r?w._tryEnterEditDetailMode():w._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var $=this._gridEnabled;if(!$)return!1;var l=this.gv;return l?!0:!0},set:function(w){w!==this._gridEnabled&&(this._gridEnabled=w,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(Q){Q!==this._agEnabled&&(this._agEnabled=Q,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}}}),Hh.prototype.getSubModule=function(E){var R,S,W,Q=this._subModules;for(S=0,W=Q.length;W>S;S++)if(R=Q[S],R.catalog===E)return R},Hh.prototype.invokeSubModule=function(O,o){var E=this,N=E._subModules;if(N)for(var L,V,w,x=Array.prototype.slice.call(arguments,2),G=0,f=N.length;f>G;G++)if(L=N[G],V=L[O],V&&(w=V.apply(L,x),w!=H&&o))return L},Hh.prototype.invokeSubModuleInverse=function(X,r){var x=this,q=x._subModules;if(q)for(var e,N,M,n=Array.prototype.slice.call(arguments,2),b=q.length-1;b>=0;b--)if(e=q[b],N=e[X],N&&(M=N.apply(e,n),M!=H&&r))return e},Hh.prototype.setUp=function(){Il.log("setUp");var y=this,P=y.gv,g=P.getView(),$=y._canvas;Hh.superClass.setUp.call(y),P.setEditInteractor(y),P._79O?g.insertBefore($,P._79O):g.appendChild($),Il.startEdit(P),y.invokeSubModule("setUp"),P.dm().mm(y._onDataModelChanged,y),P.dm().md(y._onDataPropertyChanged,y)},Hh.prototype.tearDown=function(){Il.log("tearDown");var p=this,v=p.gv,z=v.getView();p._resetCustomCursorStyle(),Hh.superClass.tearDown.call(p),v.dm().umm(p._onDataModelChanged,p),v.dm().umd(p._onDataPropertyChanged,p),v.setEditInteractor(null),z.removeChild(p._canvas),p._drawTimer&&(r(p._drawTimer),p._drawTimer=null),Il._46O(v),p.invokeSubModule("tearDown")},Hh.prototype._onDataModelChanged=function(h){var M=this;("clear"===h.kind||"remove"===h.kind&&M.editDetail&&h.data===M.getSubModule("Curve").target)&&(M.editDetail=!1,M._42())},Hh.prototype._onDataPropertyChanged=function(d){var x=this;if(x.editDetail){var E=x.getSubModule("Curve"),L=d.data;L===E.target&&(L._writing||E._handleDataChanged())}},Hh.prototype.clear=function(){Il.log("clear")},Hh.prototype.redraw=function(){this._42()},Hh.prototype._42=function(){var p=this;p._drawTimer||(p._drawTimer=e(function(){p._drawTimer=null,p.drawImpl()},0))},Hh.prototype.drawImpl=function(){var C;for(C in{_42:!0})break;return function(){var t=this,l=t._canvas,Z=t.gv,$=Z.getWidth(),A=Z.getHeight(),_=t._context,Q=j.Default.getInternal();(l.width!==$||l.height!==A)&&Q.setCanvas(l,$,A),_.clearRect(0,0,l.width,l.height);var n=t._getValidSelection();_.save();var V=j.Default.devicePixelRatio;_.scale(V,V),t._gridGuide._42(),t.invokeSubModuleInverse(C,!1,_,Z,n),t._rectGuide._42(),_.restore()}}(),Hh.prototype._getValidSelection=function(){var R=this,i=R.gv,G=i.sm().getSelection(),T=[];return G.each(function(X){i.isVisible(X)&&i.isEditable(X)&&T.push(X)}),T},Hh.prototype.handle_touchmove=function(v){return this.handle_mousemove(v)},Hh.prototype.handle_mousemove=function(z){if(!j.Default.isDragging()){var n=this;(n.editDetail||!ib())&&(n.gvEditing=!1,n._checkEdit(z)&&(n.gvEditing=!0))}},Hh.prototype.handle_touchstart=function(c){return this.handle_mousedown(c)},Hh.prototype.handle_mousedown=function(S){Oi(S);var k=this;if(k.editDetail||!ib()){if(Ih(S)&&!S.clickThrough){if(k.editDetail){if(k._tryQuitEditDetailMode(S))return}else if(k._tryEnterEditDetailMode())return;k.gv.dm().beginTransaction();var D=k.invokeSubModule("handleDoubleClick",!0,S);if(k.gv.dm().endTransaction(),D)return}var o=k._checkEdit(S);o&&(k._downPosition=k._getLogicalPoint(S),k.gv.dm().beginTransaction(),o.startEdit(k,S),k.editing=!0)}},Hh.prototype._checkEdit=function(V){var o=this,i=o.gv,v=o._getLogicalPoint(V),c=o.invokeSubModule("check",!0,i,V,v)||null;return o._editMod=c,c},Hh.prototype.handleWindowTouchMove=function(i){return this.handleWindowMouseMove(i)},Hh.prototype.handleWindowMouseMove=function(J){var H=this,C=H._downPosition;if(C){var P=H._getLogicalPoint(J);if(P.distanceTo(C)<H.getStyle("moveSensitivity"))return;delete H._downPosition}var G=H._editMod;G&&G.handleEdit(H.gv,J)},Hh.prototype._getLogicalPoint=function(t){var E=this,q=j.Default.getLogicalPoint(t,E._canvas);return new Il.Math.Vector2(q)},Hh.prototype.handleWindowTouchEnd=function(R){return this.handleWindowMouseUp(R)},Hh.prototype.handleWindowMouseUp=function(){var h;for(h in{_46O:!0})break;return function(y){var b=this;b.editing=!1,b.setCursor("default"),b.invokeSubModule(h,!1,y),b._42(),b.gv.dm().endTransaction()}}(),Hh.prototype.handle_mousewheel=function(n){var U=this;Oi(n),U.invokeSubModule("preHandleScroll",!0)||U.gv.handleScroll(n,n.wheelDelta)},Hh.prototype.handleDelete=function(){var t=this;if(!t.editDetail){t.gv.dm().beginTransaction();var q=t.invokeSubModule("handleNormalStateDelete",!0);return t.gv.dm().endTransaction(),q||t.gv.removeSelection(),void 0}t.gv.dm().beginTransaction(),t.invokeSubModule("handleDelete",!0),t.gv.dm().endTransaction(),t._42()},Hh.prototype.handle_keydown=function(I){var m=this;if((I.metaKey||I.ctrlKey)&&m._42(),ib(I)&&!m.editing)return m.gvEditing=!1,m.setCursor("default"),m._42(),void 0;var Q=Rr(I);return m.editDetail?((Q||Cj(I))&&(m.editDetail=!1,m._42()),m.gv.dm().beginTransaction(),m.invokeSubModule("handle_keydown",!0,I),m.gv.dm().endTransaction(),void 0):(m.gv.dm().beginTransaction(),m.invokeSubModule("handleNormalStateKeyDown",!0,I),m.gv.dm().endTransaction(),Q&&m._tryEnterEditDetailMode(),void 0)},Hh.prototype.handle_keyup=function(o){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,o),this.gv.dm().endTransaction()},Hh.prototype._tryEnterEditDetailMode=function(){var G=this;return!G.editDetail&&G.invokeSubModule("canEnterEditDetailMode",!0)&&1===G._getValidSelection().length?(G.editDetail=!0,G._42(),!0):void 0},Hh.prototype._tryQuitEditDetailMode=function(o){var N=this;if(N.editDetail){var C=N.gv,d=N.getSubModule("Curve").target;return o&&C.getDataAt(o)===d?void 0:(N.editDetail=!1,N._42(),!0)}},Hh.prototype.setStyle=function(f,S,P){var x=this;P?Il.setStyle(f,S):x._styleMap[f]=S,x.fp("styleChanged",null,{key:f,value:S,base:P}),x._42()},Hh.prototype.getStyle=function(B){var N=this,W=N._styleMap[B];return W!==H?W:Il.getStyle(B)},Hh.prototype.setCursor=function(b){this._resetCustomCursorStyle(),j.graph.EditInteractor.superClass.setCursor.call(this,b)},Hh.prototype._resetCustomCursorStyle=function(){var n=this;if(n._customStyle){var y=this.gv.getView();y.classList&&y.classList.remove&&y.classList.remove(n._customStyle),n._customStyle=null}},Hh.prototype._setRotateCursor=function(h){var s=this,G=s._cursorFactory;G||(G=s._cursorFactory=new Il.CursorFactory(s));var o=G.getRotateCursor(h),e=s.gv.getView();s._resetCustomCursorStyle(),s._customStyle=o,e.classList&&e.classList.add&&e.classList.add(o)};var ch=Il.Group=function(o){var Y=this;Y._entities=o,Y._64O=0,Y._position={x:0,y:0},Y._scale={x:1,y:1},Y._anchor={x:.5,y:.5},Y._anchor2={x:.5,y:.5}};ch.prototype={},ch.prototype.constructor=ch;var $k=null;ch.findOrCreateGroup=function(d){if($k&&$k.checkIsMe(d))return $k;var h=new Il.Group(d);return h.getKeyOb()?($k=h,h):void 0},ch.prototype.checkIsMe=function(A){var S=this._entities;if(S.length!==A.length)return!1;var X,q={},B=A.length;for(X=0;B>X;X++)q[A[X]._id]=!0;for(X=0;B>X;X++)if(!q[S[X]._id])return!1;return!0},ch.prototype.getRotation=function(){return this._64O},ch.prototype.getPosition=function(){return this._position},ch.prototype.getAnchor=function(){return this._anchor},ch.prototype.getWidth=function(){return this._width},ch.prototype.getScale=function(){return this._scale},ch.prototype.getSize=function(){return{width:this._width,height:this._height}},ch.prototype.getHeight=function(){return this._height},ch.prototype.getKeyOb=function(){for(var M=this._entities,G=M.length-1;G>=0;G--){var o=M[G];if(this.isNode(o))return o}},ch.prototype.getAnchor2=function(){var g=this,E=g.rotateCenter;if(E)return E;var G=g.getKeyOb();if(!G)return g._anchor;var e=g._anchor2,$=G.getMatrix();return $.tf({x:G.getWidth()*(e.x-G.getAnchor().x),y:G.getHeight()*(e.y-G.getAnchor().y)})},ch.prototype.setAnchor2=function(Y,y){var g=this,A=g.getKeyOb();if(A){var Q,o=A.getMatrix();Q="number"==typeof Y?{x:Y,y:y}:Y;var S=o.tfi(Q);g._anchor2={x:A.getAnchor().x+S.x/A.getWidth(),y:A.getAnchor().y+S.y/A.getHeight()}}},ch.prototype.setRotation=function(){},ch.prototype.beginRotate=function(x){this.rotateCenter=x.pos,this.rotateMode=x.groupRotateMode},ch.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},ch.prototype.addRotation=function(D,O){return"batch"===O?this._addRotationInBatchMode(D):"block"===O?this._addRotationInBlockMode(D):void 0},ch.prototype._addRotationInBlockMode=function($){var Y=this,J=Y.rotateCenter||Y.getPosition();Y._entities.forEach(function(M){if(Y.isNode(M)){var D=M.getMatrix();D.translate(-J.x,-J.y),D.rotate($),D.translate(J.x,J.y);var m=Math.sign(M.getScale().x);M.setRotation(B(D.b*m,D.a*m)),M.setPosition(D.tx,D.ty)}})},ch.prototype._addRotationInBatchMode=function(f){var v=this,F=v._anchor2;v._entities.forEach(function(y){if(v.isNode(y)){var d=y.getAnchor(),m=y.getMatrix(),V=m.tf({x:y.getWidth()*(F.x-d.x),y:y.getHeight()*(F.y-d.y)}),I=new Il.Math.Matrix2d;I.set(m.a,m.b,m.c,m.d,m.tx,m.ty),I.translate(-V.x,-V.y),I.rotate(f),I.translate(V.x,V.y);var D=Math.sign(y.getScale().x);y.setRotation(B(I.b*D,I.a*D)),y.setPosition(I.tx,I.ty)}})},ch.prototype.setPosition=function(t){var f,k,N,K,a=this,u=a._position,Q=t.x-u.x,L=t.y-u.y,C=a._entities;for(k=0,N=C.length;N>k;k++)f=C[k],er(f)&&(K=f.getPosition(),f.setPosition(K.x+Q,K.y+L));a._position=t},ch.prototype.setScale=function(g,X){var p=this,Y=g/p._scale.x,b=X/p._scale.y;p._adjustChildScaleOrSize(Y,b,"size"),p._scale={x:g,y:X}},ch.prototype.getRect=function(){var V=this,W=V._position,H=V._width,j=V._height;return{x:W.x-H/2,y:W.y-j/2,width:H,height:j}},ch.prototype.setSize=function(j,e){var P=this,j=Math.max(1,j),e=Math.max(1,e),$=j/P._width,r=e/P._height;P._adjustChildScaleOrSize($,r,"size"),P._width=j,P._height=e},ch.prototype._adjustChildScaleOrSize=function(A,S,P){var $,b,E,Q,O,R,l,m,M,d,j,D,w,T,i=this,Y=i._position,f=i._entities,y=new Il.Math.Matrix2d;for(b=0,E=f.length;E>b;b++)if($=f[b],i.isNode($)){if(Q=$.getPosition(),O=$.getRotation(),R=$.getWidth(),l=$.getHeight(),m=$.getScale(),j=m.x*R,D=m.y*l,y.identity().scale(j,D).rotate(O).translate(Q.x,Q.y).translate(-Y.x,-Y.y).rotate(-i._64O),O=B(y.b*Math.sign(j),y.a*Math.sign(j)),y.scale(A,S),M=Math.cos(O),d=Math.sin(O),Math.abs(M)<.001?(w=y.b/d,T=-y.c/d):(w=y.a/M,T=y.d/M),"scale"===P)$.setScale(w/R,T/l);else if("size"===P){var K=w/m.x,k=T/m.y;$.setScale(sk(w)*Math.abs(m.x),sk(T)*Math.abs(m.y)),$.setSize(Math.max(.1,Math.abs(K)),Math.max(.1,Math.abs(k)))}y.rotate(i._64O).translate(Y.x,Y.y),$.setPosition(y.tx,y.ty)}},ch.prototype.getMatrix=function(){var F=this,e=F._position,M=j.Default.getInternal(),f=F._scale;return new M.Mat(F._64O,e.x,e.y,f.x,f.y)},ch.prototype.toGlobal=function(w){return this.getMatrix().tf(w)},ch.prototype.getCorners=function(){var I=this,p=I._width,s=I._height,R=I._anchor,k=-p*R.x,u=-s*R.y,l=I.getMatrix();return[l.tf(k,u),l.tf(k,u+s),l.tf(k+p,u+s),l.tf(k+p,u)]},ch.prototype.calcInfo=function(){var p,Z,m,o,i,K,z=this,O=[],l=z._entities,V=z._64O;for(o=0,i=l.length;i>o;o++)K=l[o],z.isNode(K)&&K.getCorners&&O.push.apply(O,K.getCorners());if(O.length){var G=Math.cos(-V),g=Math.sin(-V),d=1/0,J=-1/0,q=1/0,c=-1/0;for(o=0,i=O.length;i>o;o++)m=O[o],p=m.x,Z=m.y,m.x=G*p-g*Z,m.y=g*p+G*Z,d=Math.min(d,m.x),J=Math.max(J,m.x),q=Math.min(q,m.y),c=Math.max(c,m.y);z._width=(J-d)/z._scale.x,z._height=(c-q)/z._scale.y,G=Math.cos(V),g=Math.sin(V);var N=z._anchor;p=d+(J-d)*N.x,Z=q+(c-q)*N.y,z._position={x:G*p-g*Z,y:g*p+G*Z}}},ch.prototype.isNode=function(F){return er(F)?Ye(F)?!1:!0:!1},ch.prototype._42=function(E,n,o){var G,v,F,U,w,r,e,d,f=this,z=f._entities,C=f.rotateMode;for("batch"===C&&(d=f.getKeyOb()),G=0,v=z.length;v>G;G++)F=z[G],f.isNode(F)&&(r=F.getRect(),U=Il.toScreenPosition(o,{x:r.x,y:r.y}),w=Il.toScreenPosition(o,{x:r.x+r.width,y:r.y+r.height}),e={min:U,max:w},F===d&&(e.isKeyOb=!0),Il.Icons.DrawIcon(E,n,Il.Icons.GroupSubEntityRect,e))};var dn=Il.CurveActiving=function(V,o){this._curve=V,this._interactor=V._interactor;for(var X in o)this[X]=o[X]};dn.prototype={},dn.prototype.constructor=dn,C.defineProperties(dn.prototype,{point:{get:function(){return this._point},set:function(l){var C=this;C._point=l,C.editingCtrl||C._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(d){var F=this;F._pairs=d,F.editingCtrl&&F._firePointChange()}}}),dn.prototype._firePointChange=function(){var f=this,R=f.getCurrentEditingPoint();if(!R)return c.fi({kind:"selectPoint"}),void 0;var c=f._interactor,Q=this._curve.target;if(Q){var u=Il.getDataMatrix(Q).invert(),F=R.e;R=u.apply(Il.toWorldPosition(c.gv,R)),R.e=F;var C=f._lastFirePoint;C&&Math.abs(R.x-C.x)<1e-5&&Math.abs(R.y-C.y)<1e-5&&(R.e==H&&C.e==H||Math.abs(R.e-C.e)<1e-5)||(f._lastFirePoint=R,c.fi({kind:"selectPoint",x:R.x,y:R.y,e:R.e}))}},dn.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},dn.prototype.getCurrentEditingPoint=function(){var $=this,a=$.editingCtrl;if(a){var u=$.pairs;if(u){var X=u[a.pairId],A=X[a.type];if(A)return A}}return $._point};var hb=Il.CursorFactory=function($){var X=this;X._interactor=$,X._rotateCursorStyles={}};hb.prototype={},hb.prototype.constructor=hb,hb.prototype.getRotateCursor=function(O){var F=this;0>O&&(O+=2*Math.PI);var S=F._interactor,H=S.getStyle("rotateCursorSize"),I=S.getStyle("rotateCursorRound"),a=Math.round(180*(O/Math.PI)/I);a*I>=360&&(a=0);var M=F._rotateCursorStyles,u="htCustomRotateStyle_"+H+"_"+I+"_"+a;return M[u]||(F._produceRotateCursor(u,H,I,a),M[u]=!0),u},hb.prototype._produceRotateCursor=function(p,t,A,T){var L=this;L._interactor;var N=L._canvas;N||(N=L._canvas=i.createElement("canvas")),N.width=N.height=t*devicePixelRatio,N.style.width=N.style.height=t+" px";var h=N.getContext("2d");Il.setAntialias(h,!1),h.scale(devicePixelRatio,devicePixelRatio);var q,R,b,w,W,a=Math.round(t/2),V=""+a+" "+a+",auto !important;";q=Math.PI/180*T*A,h.clearRect(0,0,t,t),h.save(),h.scale(t/32,t/32),h.translate(16,16),h.rotate(q+Math.PI/2),h.beginPath(),h.moveTo(-8,0),h.lineTo(-8,3),h.lineTo(-5,3),h.moveTo(8,0),h.lineTo(8,3),h.lineTo(5,3),h.moveTo(-8,3),h.quadraticCurveTo(0,-6,8,3),h.restore(),h.strokeStyle="white",h.lineWidth=4,h.stroke(),h.strokeStyle="black",h.lineWidth=2,h.stroke(),R=JSON.stringify(N.toDataURL()),w="cursor:url("+R+")"+V,1!==devicePixelRatio&&(b='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+t+'px" height="'+t+'px"><image xlink:href='+R+' width="'+t+'" height="'+t+'"/></svg>',w+="cursor:url(data:image/svg+xml;base64,"+btoa(b)+")"+V,w+="cursor:-webkit-image-set(url("+R+")"+devicePixelRatio+"x,url("+R+")1x)"+V),W=i.createElement("style"),W.textContent="body."+p+" *, ."+p+"{"+w+"}",i.head.appendChild(W)};var pp=Il.Guide.Grid=function(s){var J=this;J._interactor=s,J._alignmentGuideId=0,J._xAlignmentGuide=[],J._yAlignmentGuide=[]};pp.prototype={},pp.prototype.constructor=pp,C.defineProperties(pp.prototype,{gridBlockSize:{get:function(){var N=this;return N._gridBlockSize||N._interactor.getStyle("gridBlockSize")},set:function(Q){this._gridBlockSize=Q,this._interactor._42()}},gridThickLinesEvery:{get:function(){var y=this;return y._gridThickLinesEvery||y._interactor.getStyle("gridThickLinesEvery")},set:function(q){this._gridThickLinesEvery=q,this._interactor._42()}},gridEnabled:{get:function(){var p=this,R=p._interactor;return R.gridEnabled&&p.isValidGrid()}}}),pp.prototype._42=function(){var v=this,b=v._interactor;v.gridEnabled&&v.drawGrid(),b.alignmentGuideEnabled&&v.drawAlignmentGuide()},pp.prototype.makeMatrix=function(){var e=this,J=e._interactor.getStyle("gridAngle"),p=e._interactor.getStyle("gridRotation"),_=new Il.Math.Matrix2d,h=Math.sin(J),Y=Math.cos(J);return _.set(1,0,Y,h,0,0),_.rotate(p),_},pp.prototype.isValidGrid=function(){var k=this,_=Math.PI,F=k._interactor,q=F.gv;if(q._zoom<F.getStyle("gridZoomThreshold"))return!1;var R=F.getStyle("gridAngle"),c=Math.abs(180*(R%_/_)),y=1-1e-8;return y>c||c>180-y?!1:!0},pp.prototype.drawAlignmentGuide=function(){var m=this,V=m._interactor,I=V.gv,d=V._canvas,K=V._context,k=d.width,t=d.height,l=I.tx(),i=I.ty(),P=I._zoom;K.beginPath(),K.strokeStyle=V.getStyle("gridAlignmentGuideColor"),K.lineWidth=1,m._xAlignmentGuide.forEach(function(M){var m=M.p*P+l;K.moveTo(m,0),K.lineTo(m,t)}),m._yAlignmentGuide.forEach(function(M){var m=M.p*P+i;K.moveTo(0,m),K.lineTo(k,m)}),K.stroke()},pp.prototype.drawGrid=function(){function M(x,E,Z,t){var B=Il.toScreenPosition(H,j.apply({x:x,y:E})),V=Il.toScreenPosition(H,j.apply({x:Z,y:t}));o.moveTo(B.x,B.y),o.lineTo(V.x,V.y)}var t=this,q=t._interactor,i=t.gridBlockSize,U=t.gridThickLinesEvery,$=q.getStyle("gridThickColor"),k=q.getStyle("gridLightColor"),H=q.gv,d=q._canvas,o=q._context,f=d.width,s=d.height,j=t.makeMatrix(),g=j.applyInverse(Il.toWorldPosition(H,{x:0,y:0})),p=j.applyInverse(Il.toWorldPosition(H,{x:f,y:0})),l=j.applyInverse(Il.toWorldPosition(H,{x:0,y:s})),n=j.applyInverse(Il.toWorldPosition(H,{x:f,y:s})),K=Math.min(g.x,p.x,l.x,n.x),P=Math.max(g.x,p.x,l.x,n.x),b=Math.min(g.y,p.y,l.y,n.y),m=Math.max(g.y,p.y,l.y,n.y);f=P-K,s=m-b;var S=Math.ceil(K/i),X=Math.floor(P/i),N=Math.ceil(b/i),h=Math.floor(m/i);H.tx(),H.ty(),H._zoom;var B,R,y;for(o.save(),o.lineWidth=1,o.beginPath(),o.strokeStyle=$,y=Math.ceil(S/U)*U;X>=y;y+=U)B=y*i,M(B,b,B,m);for(y=Math.ceil(N/U)*U;h>=y;y+=U)R=y*i,M(K,R,P,R);for(o.stroke(),o.beginPath(),o.strokeStyle=k,y=S;X>=y;y++)0!==y%U&&(B=y*i,M(B,b,B,m));for(y=N;h>=y;y++)0!==y%U&&(R=y*i,M(K,R,P,R));o.stroke(),o.restore()},pp.prototype.getAlignmentGuides=function(){var n=this;return{x:n._xAlignmentGuide,y:n._yAlignmentGuide}},pp.prototype.addAlignmentGuide=function(e,y,E){var Z=this,i="x"===e?Z._xAlignmentGuide:Z._yAlignmentGuide,E=E?E:++Z._alignmentGuideId,A={p:y,id:E};if(i.length){var M=Z._findClosestAlignmentGuide(A.p,i);M.dis<0?i.splice(M.index+1,0,A):i.splice(M.index,0,A)}else i.push(A);return Z._interactor._42(),E},pp.prototype.findClosest=function(V,W,O){var J=this,x=J._interactor,k=x.gv;O&&(V=Il.toWorldPosition(k,V));var G,q,s,Z=1/0,t=1/0,U=V.x,p=V.y;if(J.gridEnabled){var w=J.gridBlockSize,f=J.makeMatrix(),u=f.applyInverse(V);u=f.apply({x:Math.round(u.x/w)*w,y:Math.round(u.y/w)*w}),Z=u.x-U,t=u.y-p,s=!0}if(x.alignmentGuideEnabled&&(G=J._findClosestAlignmentGuide(U,J._xAlignmentGuide).dis,q=J._findClosestAlignmentGuide(p,J._yAlignmentGuide).dis,Math.abs(G)<Math.abs(Z)&&(Z=G,s=!0),Math.abs(q)<Math.abs(t)&&(t=q,s=!0)),s){s=!1;var d=k._zoom,o=x.getStyle("smartGuideSensitivity")/d,l={};if(Math.abs(Z)<o&&"y"!==W&&(l.x=O?Z*d:Z,s=!0),Math.abs(t)<o&&"x"!==W&&(l.y=O?t*d:t,s=!0),s)return l}},pp.prototype._findClosestAlignmentGuide=function(o,Z){if(!Z.length)return{dis:1/0};for(var w,P=0,y=Z.length-1;y-P>1;)w=Math.floor((P+y)/2),Z[w].p<o?P=w:y=w;var l=Z[P].p-o,A=Z[y].p-o;return Math.abs(l)<=Math.abs(A)?{line:Z[P],dis:l,index:P}:{line:Z[y],dis:A,index:y}},pp.prototype.removeAllAlignmentGuide=function(T){var F=this;"y"!==T&&(F._xAlignmentGuide=[]),"x"!==T&&(F._yAlignmentGuide=[]),F._interactor._42()},pp.prototype.removeAlignmentGuide=function(q){for(var V,L,H,x=this,g=x._xAlignmentGuide,Y=0;2>Y;Y++)for(g=0===Y?x._xAlignmentGuide:x._yAlignmentGuide,V=0,L=g.length;L>V;V++)if(H=g[V],H.id===q)return g.splice(V,1),x._interactor._42(),{axis:0===Y?"x":"y",position:H.p};return!1},pp.prototype.adjustAlignmentGuide=function(R,G){var Y=this,i=Y.removeAlignmentGuide(R);return i?(Y.addAlignmentGuide(i.axis,G,R),!0):!1};var Lr=Il.Guide.Rect=function(f){var T=this;T._interactor=f};Lr.prototype={},Lr.prototype.constructor=Lr,Lr.prototype.gatherRects=function(){var m,s,N,H,p=this,A=p._interactor.gv,L=[],o=[],t={x:L,y:o},J={},d=A.getDataModel(),R=d.a("width"),q=d.a("height");R&&q&&(m=0,s=0,N=R,H=q,L.push({node:d,type:0,p:m},{node:d,type:1,p:m+N/2},{node:d,type:2,p:m+N}),o.push({node:d,type:0,p:s},{node:d,type:1,p:s+H/2},{node:d,type:2,p:s+H}),J[d._id||0]={x:m,y:s,width:N,height:H}),d.each(function(i){if(er(i)&&!A.isSelected(i)&&A.isVisible(i)){var V=!1;if(A.sm().getSelection().each(function(R){V||(i.isHostOn(R)?V=!0:i.isDescendantOf(R)&&(V=!0))}),!V){var Z=i.getRect();m=Z.x,s=Z.y,N=Z.width,H=Z.height,L.push({node:i,type:0,p:m},{node:i,type:1,p:m+N/2},{node:i,type:2,p:m+N}),o.push({node:i,type:0,p:s},{node:i,type:1,p:s+H/2},{node:i,type:2,p:s+H}),J[i._id]=Z}}}),L.sort(function(C,T){return C.p-T.p}),o.sort(function(i,r){return i.p-r.p}),p._grid=t,p._87I=J},Lr.prototype.gatherLines=function(R,B,j){var P,K,C,G,s,y,x,w,Z,$,v,M,h=this,H=[h.findClosest({x:R.x,y:R.y},B),h.findClosest({x:R.x+R.w/2,y:R.y+R.h/2},B),h.findClosest({x:R.x+R.w,y:R.y+R.h},B)],d={},Q=h._87I;j=j||255;var l,E;for(h._guideLine=[],P=0;2>P;P++)for(d={},0===P?(G="y",w=R.x,Z=w+R.w):(G="x",w=R.y,Z=w+R.h),K=0;3>K;K++)s=H[K],s&&isFinite(s[G])&&(l=1<<3*P+K,j&l&&(y=s[G+"Line"],x=y.node,E=x._id||0,d[E]||(d[E]=!0,M=Q[E],"y"===G?($=M.x,v=M.x+M.width):($=M.y,v=M.y+M.height),C=y.p,h._guideLine.push({type:G,a:w,b:Z,c:$,d:v,p:C,center:1===y.type}))))},Lr.prototype._binarySearchClosest=function(k,m){if(!m.length)return{dis:1/0};for(var I,W=0,A=m.length-1;A-W>1;)I=Math.floor((W+A)/2),m[I].p<k?W=I:A=I;var r=m[W].p-k,N=m[A].p-k;return Math.abs(r)<=Math.abs(N)?{line:m[W],dis:r}:{line:m[A],dis:N}},Lr.prototype.findClosest=function(Q,F,C){var U=this,v=U._interactor,N=v.gv,e=U._grid;C&&(Q=Il.toWorldPosition(N,Q));var u,n=U._binarySearchClosest(Q.x,e.x),y=U._binarySearchClosest(Q.y,e.y),E=n.dis,W=y.dis,z=N._zoom,b=v.getStyle("smartGuideSensitivity")/z,L={};return Math.abs(E)<b&&"y"!==F&&(L.x=C?E*z:E,L.xLine=n.line,u=!0),Math.abs(W)<b&&"x"!==F&&(L.y=C?W*z:W,L.yLine=y.line,u=!0),u?L:void 0},Lr.prototype._42=function(){var N=this,L=N._guideLine;if(L&&!j.Default.isCtrlDown()){var g,q,d,R,E,T,z,W,l,M,Z,G,O,p,J,I,n,b=N._interactor,B=b.gv,Q=b._context,x=B.tx(),X=B.ty(),K=B._zoom,k=b.getStyle("guideLineTextSpacing");for(g=0,q=L.length;q>g;g++)d=L[g],W=d.type,l=d.p,M=d.a,Z=d.b,G=d.c,O=d.d,p=Math.min(M,G),J=Math.max(Z,O),"x"===W?(R=l*K+x,E=p*K+X,T=R,z=J*K+X):(R=p*K+x,E=l*K+X,T=J*K+x,z=E),Il.Icons.DrawIcon(b,Q,Il.Icons.MoveLineGuide,{rect:[R,E,T,z],center:d.center}),O>=M&&Z>=G||(p=M>O?O:Z,J=M>O?M:G,n=J-p,"x"===W?(d.center2center||(R-=k,T=R),E=p*K+X,z=J*K+X,I=Il.Icons.MoveLineGuideDistanceV):"y"===W&&(d.center2center||(E-=k,z=E),R=p*K+x,T=J*K+x,I=Il.Icons.MoveLineGuideDistanceH),Il.Icons.DrawIcon(b,Q,I,{x0:R,y0:E,x1:T,y1:z,dis:n}))
}},Lr.prototype.clear=function(){this._guideLine=null},Il.DefaultStyleMap={pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideSensitivity:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,guideLineTextSpacing:0,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var Wq=Il.Icons={},uk=1e4,Ni=null,ap="rgb(51,153,255)",Qm="rgb(183,232,135)",Np="rgb(255,204,153)",Ak=6;j.Default.setImage("Icons.RectPoint",{width:Ak,height:Ak,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:ap,rect:[0,0,Ak,Ak]}]});var bq="#e000e0";Wq.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var n=Wq.GroupSubEntityRect.data;if(!n)return[];var k=n.min,N=n.max;return[k.x,k.y,k.x,N.y,N.x,N.y,N.x,k.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Wq.GroupSubEntityRect.data.isKeyOb?bq:"#666666"}}}]},Wq.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Wq.Line.data.P1.x,Wq.Line.data.P1.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Wq.Line.data.P2.x,Wq.Line.data.P2.y],Ak,Ak]}}}]},Wq.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return Wq.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},Wq.Rect={comps:[{type:"shape",points:{func:function(){var L=Wq.Rect.data;if(!L)return[];var D=L.LT,b=L.LB,K=L.RB,e=L.RT;return[D.x,D.y,b.x,b.y,K.x,K.y,e.x,e.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:ap},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},rect:{func:function(){return[[Wq.Rect.data.LT.x,Wq.Rect.data.LT.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},rect:{func:function(){return[[Wq.Rect.data.LB.x,Wq.Rect.data.LB.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},rect:{func:function(){return[[Wq.Rect.data.RB.x,Wq.Rect.data.RB.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},rect:{func:function(){return[[Wq.Rect.data.RT.x,Wq.Rect.data.RT.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},visible:{func:function(){return Wq.Rect.data.L?!0:!1}},rect:{func:function(){return[[Wq.Rect.data.L.x,Wq.Rect.data.L.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},visible:{func:function(){return Wq.Rect.data.R?!0:!1}},rect:{func:function(){return[[Wq.Rect.data.R.x,Wq.Rect.data.R.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},visible:{func:function(){return Wq.Rect.data.T?!0:!1}},rect:{func:function(){return[[Wq.Rect.data.T.x,Wq.Rect.data.T.y],Ak,Ak]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Wq.Rect.data.rotation}},visible:{func:function(){return Wq.Rect.data.B?!0:!1}},rect:{func:function(){return[[Wq.Rect.data.B.x,Wq.Rect.data.B.y],Ak,Ak]}}}]};var Po=16;j.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:ap,borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:ap,shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),Wq.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[Wq.Anchor.data.POS.x,Wq.Anchor.data.POS.y],Po,Po]}}}]},Wq.TipShiftX=12,Wq.TipShiftY=12;var Oo=[8,28];Wq.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[Wq.TipHelper.data.helperPos.x,Wq.TipHelper.data.helperPos.y,Oo[0]*Wq.TipHelper.data.size,Oo[1]]}},background:{func:function(){return Ni.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return Wq.TipHelper.data.text}},rect:{func:function(){return[Wq.TipHelper.data.helperPos.x,Wq.TipHelper.data.helperPos.y,Oo[0]*Wq.TipHelper.data.size,Oo[1]]}},color:{func:function(){return Ni.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var dj=7;Wq.ShapePoint={comps:[{type:"circle",rect:{func:function(){var w=Wq.ShapePoint.data.point;return[w,dj,dj]}},background:{func:function(){var y=Wq.ShapePoint.data.isEnd;return y?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:ap}]},Wq.ShapeBgCurve={comps:[{type:"shape",points:{func:function(){return Wq.ShapeBgCurve.data.P}},segments:{func:function(){return Wq.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:ap}]};var Jd=8;Wq.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var K=Wq.ShapeHighlighPoint.data;return[[K.x,K.y],Jd,Jd]}},background:{func:function(){return Ni.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var ic=10;Wq.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var d=Wq.ShapeHighlighRealPoint.data;return[[d.x,d.y],ic,ic]}},background:"#ffffff",borderWidth:2,borderColor:ap}]};var Pp=8;Wq.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var P=Wq.ShapeHighlighCtrlPoint.data,Z=P.x,x=P.y,T=Pp/2;return[Z-T,x-T,Z-T,x+T,Z+T,x+T,Z+T,x-T]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Ni.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return Ni.getStyle("shapeCtrlPointBorderColor")||ap}}}]};var Iq=3;Wq.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return Wq.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Iq,borderColor:{func:function(){return Ni.getStyle("curveHighlightColor")}}}]},Wq.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return Wq.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},Wq.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return Wq.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return Wq.MoveLineGuide.data.center?Qm:Np}}}]};var wh=5;Wq.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var t=Wq.MoveLineGuideDistanceH.data,T=t.x0,L=t.y0;return[T,L-wh,T,L+wh]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Np},{type:"shape",points:{func:function(){var p=Wq.MoveLineGuideDistanceH.data,b=p.x1,q=p.y1;return[b,q-wh,b,q+wh]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Np},{type:"text",text:{func:function(){return Math.round(Wq.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var P=Wq.MoveLineGuideDistanceH.data;return[[(P.x0+P.x1)/2,P.y0-10],20,20]}},color:Np,font:"12px Arial",align:"center"}]},Wq.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var u=Wq.MoveLineGuideDistanceV.data,$=u.x0,q=u.y0;return[$-wh,q,$+wh,q]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Np},{type:"shape",points:{func:function(){var z=Wq.MoveLineGuideDistanceV.data,n=z.x1,k=z.y1;return[n-wh,k,n+wh,k]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Np},{type:"text",text:{func:function(){return Math.round(Wq.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var Z=Wq.MoveLineGuideDistanceV.data;return[[Z.x0-10,(Z.y0+Z.y1)/2],20,20]}},color:Np,font:"12px Arial",align:"center"}]},j.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),Wq.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var m=Wq.EdgeElevationGuide.data,z=m.x,l=m.y,k=Ni.getStyle("curveElevationIntersectSize"),_=Ni.getStyle("curveElevationGuideShift");return z+=_[0],l+=_[1],[z-k,l-k,2*k,2*k]}}}]},j.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),j.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),Wq.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return Wq.ConnectGuide.data.rotation}},rect:{func:function(){var B=Wq.ConnectGuide.data.connect;B.x,B.y;var g=Ni.getStyle("connectGuideIntersectSize");return[[B.x,B.y],2*g,2*g]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var i=Wq.ConnectGuide.data.cursorPos||Wq.ConnectGuide.data.connect,V=Ni.getStyle("connectGuideIntersectSize");return[[i.x,i.y],2*V-2,2*V-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var j=Wq.ConnectGuide.data.connect,T=Wq.ConnectGuide.data.cursorPos||j;return[j.x,j.y,j.x+.5*(T.x-j.x),j.y,T.x+.5*(j.x-T.x),T.y,T.x,T.y]}}}]},j.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),j.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),Wq.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var o=Wq.ConnectGuideGarbage.data.hover;return o?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var Y=Wq.ConnectGuideGarbage.data,Q=Ni.getStyle("connectGuideGarbageIntersectsize");return Y.hover&&(Q+=5),[[Y.x,Y.y],2*Q,2*Q]}}}]};var Fk=6;Wq.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return Wq.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var j=Wq.ShapeActivingCtrl.data;return[j.point.x,j.point.y,j.c1.x,j.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:ap},{type:"shape",visible:{func:function(){return Wq.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var T=Wq.ShapeActivingCtrl.data;return[T.point.x,T.point.y,T.c2.x,T.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:ap},{type:"shape",visible:{func:function(){return Wq.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var l=Wq.ShapeActivingCtrl.data.c1,v=l.x,w=l.y,c=Fk/2;return"c1"===Wq.ShapeActivingCtrl.data.hl&&(c+=.5),[v-c,w-c,v-c,w+c,v+c,w+c,v+c,w-c]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Ni.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===Wq.ShapeActivingCtrl.data.hl?Ni.getStyle("shapeCtrlPointHighlightBorder")||ap:Ni.getStyle("shapeCtrlPointBorderColor")||ap}}},{type:"shape",visible:{func:function(){return Wq.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var q=Wq.ShapeActivingCtrl.data.c2,p=q.x,r=q.y,K=Fk/2;return"c2"===Wq.ShapeActivingCtrl.data.hl&&(K+=.5),[p-K,r-K,p-K,r+K,p+K,r+K,p+K,r-K]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return Ni.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===Wq.ShapeActivingCtrl.data.hl?Ni.getStyle("shapeCtrlPointHighlightBorder")||ap:Ni.getStyle("shapeCtrlPointBorderColor")||ap}}}]},Wq.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:ap,rect:{func:function(){return[[Wq.RoundPoint.data.x,Wq.RoundPoint.data.y],Ak,Ak]}}}]},Il.Icons.DrawIcon=function(E,g,B,H){B.width=B.height=uk,B.data=H,Ni=E,j.Default.drawImage(g,B,0,0,uk,uk)},Il.Icons.MapPoints=function(U,p){for(var V=0,y=U.length;y>V;V++)U[V]/=p},Il.roundTo=function(P,c,q){var Q=Math.abs(P%c);return q>Q||q>c-Q?c*Math.round(P/c):P},Il.toFixed=function(T){return Math.round(100*T)/100},Il.getDataMatrix=function(K){if(K instanceof j.Shape){var p=new j.Math.Matrix2d,k=K.getPosition();return p.translate(-k.x,-k.y).scale(K.getScale().x,K.getScale().y).rotate(K.getRotation()).translate(k.x,k.y),p}return K.getMatrix?K.getMatrix():new j.Math.Matrix2d};var zh=Il.Math.Curve=function(){this._curves=[]};zh.prototype={},zh.prototype.constructor=zh,zh.prototype.createFromHtShape=function(u,T,M){T instanceof j.List&&(T=T.toArray());var y,t,q,E,N,F,o,l=this,d=null,h=null,U=0,S=Il.Math.Vector2,B=Il.Math.CubicBezier,b=function(A){return new S(u[A],u[A+1],M?M[A/2]:H)};for(t=0,q=T.length;q>t;t++){switch(E=T[t],N=null,E){case 1:h=b(U),d=h,U+=2;break;case 2:y=b(U),U+=2,N=new B(h,h.clone(),y.clone(),y),h=y;break;case 3:F=b(U),y=b(U+2),U+=4,N=new B(h,F.clone().sub(h).multiplyScalar(2/3).add(h),F.clone().sub(y).multiplyScalar(2/3).add(y),y),h=y;break;case 4:F=b(U),o=b(U+2),y=b(U+4),U+=6,N=new B(h,F,o,y),h=y;break;case 5:if(!d)break;N=new B(h,h.clone(),d.clone(),d),h=null,d=null}N&&(N._index=l._curves.length,l._curves.push(N))}},zh.prototype.checkPoint=function(f,u){var h,W,m,c,D,Q=this,A=Q._curves;for(h=0,W=A.length;W>h;h++)if(c=A[h],D=c.intersectRect(f,u,u),D.length)return m=0,D.forEach(function(w){m+=w.t}),m/=D.length,f=c.getPointAt(m),f.t=m,{bezier:c,intersection:f}},zh.prototype.insertKnot=function(L,Q){var s=L.insertKnot(Q),y=this,K=y._curves;K.splice(L._index,1,s[0],s[1])},zh.prototype._isCloseEnough=function(r,m){return Math.abs(r.x-m.x)<1e-6&&Math.abs(r.y-m.y)<1e-6},zh.prototype._isSamePoint=function(D,p){return D===p},zh.prototype.moveRealPoint=function(o,D){var P=this,T=P._curves,i=D.clone().sub(o);T.forEach(function(m){var f=m._p1;m._p2,m._p3;var N=m._p4;P._isSamePoint(f,o)&&(m._p2.add(i),m._p1=D),P._isSamePoint(N,o)&&(m._p3.add(i),m._p4=D)})},zh.prototype.moveCtrlDueToRealPointMovement=function(J,j){var _=this,t=_._curves,k=function(C){C.add(j),C.e&&j.e&&(C.e+=j.e)};t.forEach(function(v){var s=v._p1;v._p2,v._p3;var R=v._p4;_._isSamePoint(s,J)&&k(v._p2),_._isSamePoint(R,J)&&k(v._p3)})},zh.prototype.moveCtrlPoint=function(L,e,Y){var T=L[Y];if(T){T.e!==H&&(e.e=T.e);var P=this,m=P._curves;e.clone().sub(T),m.forEach(function(s){var o;"c2"===Y?o="_p2":"c1"===Y&&(o="_p3"),P._isSamePoint(s[o],T)&&(s[o]=e)}),L[Y]=e}},zh.prototype.deleteRealPoint=function(q,b){var k,i,X,D,J,U,R,f=this,s=f._curves,$={},y=[],t=Il.Math.CubicBezier;for(i=0,X=s.length;X>i;i++)k=s[i],D=k._p1,J=k._p2,U=k._p3,R=k._p4,($[i]||!f._isSamePoint(D,q))&&(f._isSamePoint(R,q)?X>i+1&&f._isSamePoint(s[i+1]._p1,q)&&(b||y.push(new t(D,J,s[i+1]._p3,s[i+1]._p4))):y.push(k));f._curves=y},zh.prototype.findPairs=function(d,a){var k,p,s,V,m,r,i,D,L=this,z=L._curves,Z={},o=[];for(p=0,s=z.length;s>p;p++)k=z[p],V=k._p1,m=k._p2,r=k._p3,i=k._p4,!Z[p]&&L._isSamePoint(V,d)&&(a?o.push({point:V,r2:i}):o.push({point:V,c2:m})),L._isSamePoint(i,d)&&(D=a?{point:i,r1:V}:{point:i,c1:r},s>p+1&&L._isSamePoint(z[p+1]._p1,d)&&(a?D.r2=z[p+1]._p4:D.c2=z[p+1]._p2,Z[p+1]=!0),o.push(D));return o},zh.prototype.toHtShape=function(){var E=this,d=E._curves,t=[],h=[],x={x:1/0,y:1/0};return d.forEach(function(S){var M=S._p1,g=S._p2,K=S._p3,y=S._p4;return E._isCloseEnough(M,x)||(t.push(1),h.push(M.clone())),x=y,E._isCloseEnough(M,g)&&E._isCloseEnough(K,y)?(t.push(2),h.push(y.clone()),void 0):(t.push(4),h.push(g.clone(),K.clone(),y.clone()),void 0)}),{segments:t,points:h}};var Tr=Il.Math.CubicBezier=function(r,D,e,E){var Y=this;Y._id=Il.Math.CubicBezier._globalId++,Y._p1=r,Y._p2=D,Y._p3=e,Y._p4=E};Tr._globalId=1,Tr.prototype={},Tr.prototype.constructor=Tr,Tr.prototype.toString=function(){return this._id},Tr.prototype.intersectRect=function(u,k,_){var M=k/2,D=_/2,C=u.x,I=u.y,W=Il.Math.Vector2,h=new W(-M+C,-D+I),b=new W(M+C,D+I),y=new W(b.x,h.y),Q=new W(h.x,b.y),J=this,K=J.intersectLine(h,y),f=J.intersectLine(y,b),t=J.intersectLine(b,Q),A=J.intersectLine(Q,h),s=K.concat(f).concat(t).concat(A);return s},Tr.prototype.intersectLine=function(_,E){var H,h,I,x,g,A,p,L,k,G,s,d,B,a=this,M=_.clone().min(E),S=_.clone().max(E);x=a._p1,g=a._p2,A=a._p3,p=a._p4,H=x.clone().multiplyScalar(-1),h=g.clone().multiplyScalar(3),I=A.clone().multiplyScalar(-3),s=H.add(h).add(I).add(p),H=x.clone().multiplyScalar(3),h=g.clone().multiplyScalar(-6),I=A.clone().multiplyScalar(3),G=H.add(h).add(I),H=x.clone().multiplyScalar(-3),h=g.clone().multiplyScalar(3),k=H.add(h),L=x.clone(),B=new Il.Math.Vector2(_.y-E.y,E.x-_.x),d=_.x*E.y-E.x*_.y;for(var J=a.getRoots(B.dot(s),B.dot(G),B.dot(k),B.dot(L)+d),$=new Array,i=0,r=J.length;r>i;i++){var F=J[i];if(!(0>F||F>1)){var V=x.clone().lerp(g,F),T=g.clone().lerp(A,F),f=A.clone().lerp(p,F),D=V.lerp(T,F),W=T.lerp(f,F),o=D.lerp(W,F);o.t=F,_.x==E.x?M.y<=o.y&&o.y<=S.y&&$.push(o):_.y==E.y?M.x<=o.x&&o.x<=S.x&&$.push(o):o.x>=M.x&&o.y>=M.y&&o.x<=S.x&&o.y<=S.y&&$.push(o)}}return $},Tr.prototype.solveTForPoint=function(x){var L,e,G,j,T=this;L=T._p1.x-x.x,e=T._p2.x-x.x,G=T._p3.x-x.x,j=T._p4.x-x.x;for(var i=T.getRoots(j-3*G+3*e-L,3*G-6*e+3*L,3*e-3*L,L),u=H,t=1/0,A=0,o=i.length;o>A;A++){var R=i[A];if(!(0>R||R>1)){var Q=T._p1.clone().lerp(T._p2,R),f=T._p2.clone().lerp(T._p3,R),O=T._p3.clone().lerp(T._p4,R),J=Q.lerp(f,R),g=f.lerp(O,R),m=J.lerp(g,R);m.t=R;var S=Math.abs(m.y-x.y);t>S&&(t=S,u=m)}}return u},Tr.prototype.getPointAt=function(x){var I=this,H=I._p1,p=I._p2,q=I._p3,A=I._p4,m=H.clone().lerp(p,x),O=p.clone().lerp(q,x),v=q.clone().lerp(A,x),t=m.lerp(O,x),z=O.lerp(v,x);return t.lerp(z,x)},Tr.prototype.getRoots=function(L,J,H,$){var E,G,p,O,M,c=new Array;if(Math.abs(L)<1e-6){var E=J,G=H/E,p=$/E,O=G*G-4*p;if(O>0){var M=Math.sqrt(O);c.push(.5*(-G+M)),c.push(.5*(-G-M))}else 0==O&&c.push(.5*-G)}J/=L,H/=L,$/=L,E=(3*H-J*J)/3,G=(2*J*J*J-9*H*J+27*$)/27;var l=J/3,f=G*G/4+E*E*E/27,R=G/2;if(Math.abs(f)<=1e-6&&(f=0),f>0){var V,x,M=Math.sqrt(f);V=-R+M,x=V>=0?Math.pow(V,1/3):-Math.pow(-V,1/3),V=-R-M,V>=0?x+=Math.pow(V,1/3):x-=Math.pow(-V,1/3),c.push(x-l)}else if(0>f){var k=Math.sqrt(-E/3),W=Math.atan2(Math.sqrt(-f),-R)/3,y=Math.cos(W),C=Math.sin(W),e=Math.sqrt(3);c.push(2*k*y-l),c.push(-k*(y+e*C)-l),c.push(-k*(y-e*C)-l)}else{var V;V=R>=0?-Math.pow(R,1/3):Math.pow(-R,1/3),c.push(2*V-l),c.push(-V-l)}return c},Tr.prototype._70I=function(){var u=this;return u._p1.distanceToSquared(u._p2)<1e-10&&u._p3.distanceToSquared(u._p4)<1e-10},Tr.prototype.insertKnot=function(v){var h=this,g=h._p1,H=h._p2,Z=h._p3,b=h._p4,l=g.clone().lerp(H,v),u=H.clone().lerp(Z,v),s=Z.clone().lerp(b,v),i=l.clone().lerp(u,v),F=u.clone().lerp(s,v),e=i.clone().lerp(F,v);return h._70I()?(g.clone().lerp(b,v),[new Il.Math.CubicBezier(g,g.clone(),e.clone(),e),new Il.Math.CubicBezier(e,e.clone(),b.clone(),b)]):[new Il.Math.CubicBezier(g,l,i,e),new Il.Math.CubicBezier(e,F,s,b)]};var _c=j.Default.getInternal().ui().EdgeUI,Km={_47O:function(F){var Z=this,d=Km.getBackups()._47O;Il.inEdit(Z.gv)||d.call(Z,F)}};Il.Inject.registAsModule(Km,_c);var ae=j.Default.getInternal().ui().NodeUI,pm={_47O:function(T){var f=this,l=pm.getBackups()._47O;Il.inEdit(f.gv)||l.call(f,T)},getSelectWidth:function(){var B=this,e=B.gv,j=B._data;if(e.isEditable(j)&&Il.inEdit(e))return 0;var L=pm.getBackup("getSelectWidth");return L.call(B)}};Il.Inject.registAsModule(pm,ae);var Xj=j.graph.GraphView,Ui={_editPointSize:function(){var U=j.Default.isTouchable,b=Il.getStyle("pointSize");return b[U?0:1]}(),isPointEditable:function(t){var H=this;if(Il.inEdit(H))return H._pointEditableFunc?H._pointEditableFunc(t):!0;var r=Ui.getBackup("isPointEditable");r.call(H,t)},isEditable:function(N){var T,V=this,W=Ui.getBackup("isEditable");if(T=N instanceof Il.Group?!0:W.call(V,N),!Il.inEdit(V))return T;if(!(N instanceof j.Edge))return T;if(!N.s("2d.editable"))return!1;var $=V.getEditableFunc();return $?$(N):!0},_42:function(v,z){var H=this,d=Ui.getBackups()._42;if(d.call(H,v,z),Il.inEdit(H)){var n=H.getEditInteractor();n.drawImpl()}}};Il.Inject.registAsModule(Ui,Xj);var ym=j.Default.getInternal().ui().ShapeUI,fp={_47O:function(h){var G=this,$=fp.getBackups()._47O;Il.inEdit(G.gv)||$.call(G,h)}};Il.Inject.registAsModule(fp,ym);var Yd=j.graph.DefaultInteractor,sm={handle_mousewheel:function(Y){var n=this,M=sm.getBackup("handle_mousewheel");Il.inEdit(n.gv)||M.call(n,Y)}};Il.Inject.registAsModule(sm,Yd);var Ho=j.graph.MoveInteractor,pb={_calcShift:function(h,U){var n=this,H=pb.getBackup("_calcShift"),p=n.gv;if(!Il.inEdit(p))return H.call(n,h,U);var m=p.getEditInteractor(),_=m.getSubModule("Move").calcShift(h,U,n);return _||H.call(n,h,U)},clear:function(Q){var v=this,k=pb.getBackup("clear");k.call(v,Q);var H=v.gv;if(Il.inEdit(H)){var B=H.getEditInteractor();B.getSubModule("Move").clear(Q)}}};Il.Inject.registAsModule(pb,Ho);var Lr=Il.Rect=function(J){this.catalog="Rect",this._interactor=J};Lr.prototype={},Lr.prototype.constructor=Lr,Lr.prototype.gatherInfo=function(H,m){var V=this;if(1===m.length){var P=m[0];return P instanceof j.Shape&&P._70I()?V.gatherLine(H,P):Ye(P,H)?!1:V.gatherSingleTarget(H,P)}return m.length>1?V.gatherMultiTargets(H,m):!1},Lr.prototype.gatherSingleTarget=function(D,m){if(m.getCorners){var $,c=this,G=c.info;c.target=m,$=c.screenInfo={};var g=m.getCorners();G.LT=new Il.Math.Vector2(g[0]),G.LB=new Il.Math.Vector2(g[1]),G.RB=new Il.Math.Vector2(g[2]),G.RT=new Il.Math.Vector2(g[3]),G.T=G.LT.clone().add(G.RT).divideScalar(2),G.B=G.LB.clone().add(G.RB).divideScalar(2),G.L=G.LT.clone().add(G.LB).divideScalar(2),G.R=G.RT.clone().add(G.RB).divideScalar(2);for(var h in G)$[h]=Il.toScreenPosition(D,G[h]);var d=c._interactor,u=d.getStyle("checkSize"),F=function(E,k,T){var H=k.clone().sub(E).setLength(-u),V=T.clone().sub(E).setLength(-u),y=H.add(V).add(E);return y};return $.rotLT=F($.LT,$.RT,$.LB),$.rotLB=F($.LB,$.LT,$.RB),$.rotRB=F($.RB,$.LB,$.RT),$.rotRT=F($.RT,$.LT,$.RB),$.rotT=$.rotLT.clone().add($.rotRT).divideScalar(2),$.rotB=$.rotLB.clone().add($.rotRB).divideScalar(2),$.rotL=$.rotLT.clone().add($.rotLB).divideScalar(2),$.rotR=$.rotRT.clone().add($.rotRB).divideScalar(2),$.rotation=m.getRotation(),c.gatherConnectInfo(),!0}},Lr.prototype.gatherConnectInfo=function(){var K=this,i=K.target,I=K._interactor,B=K.screenInfo,u=I.gv;if(u.isConnectActionVisible(i)&&I.getStyle("connectGuideVisible")){var x;i.s&&(x=i.s("connectGuideShift")),x||(x=I.getStyle("connectGuideShift"));var $=i.getAnchor(),L=i.getSize(),q=i.toGlobal({x:L.width*(x[0]-$.x),y:L.height*(x[1]-$.y)});q=Il.toScreenPosition(u,q),B.P1?q.add(B.P2.clone().sub(B.P1).setLength(x[2])):(q.add(B.RT.clone().sub(B.LT).setLength(x[2])),q.add(B.LB.clone().sub(B.LT).setLength(x[3]))),B.connect=q}},Lr.prototype.gatherMultiTargets=function(x,L){var g=Il.Group.findOrCreateGroup(L);if(!g)return!1;var m=this;return m.editing&&"rotate"!==m.editing.mode||g.calcInfo(),m.gatherSingleTarget(x,g)},Lr.prototype.gatherLine=function(s,x){this.target=x;var h=this.screenInfo={},X=x.getPoints(),$=Il.getDataMatrix(x);return h.P1=Il.toScreenPosition(s,$.apply(X.get(0))),h.P2=Il.toScreenPosition(s,$.apply(X.get(1))),this.gatherConnectInfo(),!0},Lr.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],Lr.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],Lr.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],Lr.prototype.check=function(E,N,_){if(j.Default.isLeftButton(N)){var T=this;if(T.editing=null,T.tipInfo=null,T.screenInfo){var p=T.target,G=E.isEditable(p),U=T.screenInfo;if(G&&U.connect){var c=T._checkConnect(_);if(c)return c}if(U.P1)return T._checkLine(_);var o,y,H,I=null,i=T._interactor,O=i.getStyle("checkSize");if(G&&E.isRectEditable(p))for(y=0;y<Il.Rect.ResizeKeys.length;y++)if(H=Il.Rect.ResizeKeys[y],Il.checkHit(_,U[H],O)){I=H,o="resize";break}if(!I&&G&&E.isRotationEditable(p)&&!i.getStyle("rotateAsClock")){var n=i.getStyle("rotateCheckSize");for(y=0;y<Il.Rect.RotateKeys.length;y++)if(H=Il.Rect.RotateKeys[y],Il.checkHit(_,U[H],n)){I=H,o="rotate";break}}if(!I)return i.setCursor("default"),void 0;if("rotate"===o){var h,K=E.lp(N);if(p instanceof Il.Group){var t=i.getStyle("groupRotateModeKey");"string"==typeof t&&(t=[t]);for(var Q=!1,l=0,M=t.length;M>l;l++)if(N[t[l]]){Q=!0;break}var D=i.getStyle("groupRotateModeDefault");h=Q?"batch"===D?"block":"batch":D}var g="batch"===h?p.getAnchor2():p.getPosition(),P=Math.atan2(K.y-g.y,K.x-g.x);i._setRotateCursor(P),T.editing={mode:o,key:I,pos:g,flipY:p.getScale().y<0,rotation:p.getRotation(),hitRot:P},h&&(T.editing.groupRotateMode=h)}else{var S=Il.Rect.ResizeKeys.indexOf(I),w=Il.Rect.ResizeDirection[S],L=Math.cos(p.getRotation()),b=Math.sin(p.getRotation()),B=w.x*Math.sign(p.getScale().x),V=w.y*Math.sign(p.getScale().y),k=Math.atan2(-b*B-L*V,L*B-b*V),s=(Math.round(k/(Math.PI/4))+8)%8,X=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][s];this._interactor.setCursor(X);var m=p.getWidth(),u=p.getHeight(),z=p.getAnchor();T.editing={mode:o,key:I,rect:{x:-m*z.x,y:-u*z.y,width:m,height:u},anchor:z,matrix:p.getMatrix()}}return I}}},Lr.prototype._checkLine=function(f){var b=this;b.screenInfo;var E,c=b._interactor.getStyle("checkSize");if(Il.checkHit(f,b.screenInfo.P1,c))E="P1";else{if(!Il.checkHit(f,b.screenInfo.P2,c))return this._interactor.setCursor("default"),void 0;E="P2"}return b.editing={mode:"line",key:E},E},Lr.prototype._checkConnect=function(R){var D=this,q=D.screenInfo,Z=D._interactor,J=Z.getStyle("connectGuideIntersectSize"),m=q.connect,X=R.x,W=m.x;if(W>X&&J>W-X&&Math.abs(m.y-R.y)<J||X>=W&&Il.checkHit(R,m,J)){var u="connect",M=h.getConnectAction(Z.gv);if(D.editing={mode:u},M&&M.delete)if(D.target instanceof Il.Group){var _=!0;Z.gv.sm().getSelection().each(function(p){M.delete.visible.call(null,Z.gv,p)||(_=!1)}),D.editing.hasDeleteAction=_}else M.delete.visible.call(null,Z.gv,D.target)&&(D.editing.hasDeleteAction=!0);return Z.setCursor("default"),u}},Lr.prototype._fireEditEvent=function(T,C){var u=this._interactor,S=this.editing;if(S){var x=S.mode;x="rotate"===x?"Rotation":"connect"===x?"Connection":x[0].toUpperCase()+x.slice(1),u.fi({kind:T+"Edit"+x,event:C})}},Lr.prototype.startEdit=function(k,V){k.startDragging(V);var w=this;w._interactor.fi({kind:"prepareEdit",event:V});var u=w.editing,F=w.target;if(u){if(w._fireEditEvent("begin",V),"rotate"===u.mode)return u.groupRotateMode&&F.beginRotate(u),void 0;if("connect"!==u.mode)("line"===u.mode||F&&0===F.getRotation())&&(w._inSmartGuide=!0,w._interactor.rectGuide.gatherRects());else if(u.hasDeleteAction){var R=k.gv,h=w._interactor.getStyle("connectGuideGarbageShift");u.garbageInfo={x:R.getWidth()*h[0]+h[2],y:R.getHeight()*h[1]+h[3],size:w._interactor.getStyle("connectGuideGarbageIntersectsize")},k._42()}}},Lr.prototype._46O=function(z){var _,m,K=this,O=K.editing,l=K.target;if(O){if("connect"===O.mode&&!O.canceled&&!O.deleted)try{O.garbageInfo&&O.garbageInfo.hover?h.doDeleteConnectionAction(K._interactor.gv,l):h.doConnectAction(K._interactor.gv,l,O.target)}catch(e){console.error(e)}m=O.freezeFlag,_=K.editing.groupRotateMode,K._fireEditEvent("end",z),K.editing=null}K.tipInfo=null,K._inSmartGuide&&(K._interactor.rectGuide.clear(),K._inSmartGuide=!1),_&&l&&l.endRotate(),l instanceof j.Block&&(m===H?delete l._freezeSyncFromChildren:l._freezeSyncFromChildren=m,l.updateFromChildren())},Lr.prototype.handleNormalStateDelete=function(){var P=this,C=P.editing;if(C&&"connect"===C.mode&&!C.canceled&&!C.deleted){if(C.garbageInfo){try{h.doDeleteConnectionAction(P._interactor.gv,P.target)}catch(s){console.error(s)}C.garbageInfo=null}return C.cursorPos=null,C.targetCorners=null,C.deleted=!0,P._interactor._42(),!0}},Lr.prototype.handleNormalStateKeyDown=function(Q){var $=this,H=$.editing;return!H||"connect"!==H.mode||H.canceled||H.deleted?void 0:j.Default.isEsc(Q)?(H.cursorPos=null,H.targetCorners=null,H.canceled=!0,$._interactor._42(),!0):void 0},Lr.prototype.handleEdit=function(U,T){var g=this,k=g.editing;if(k){var Y,$,P,H,p,a=g.target,V=k.key,r=k.mode,J=U.lp(T),z=g._interactor;if("connect"===r){if(k.canceled)return;if(k.deleted)return;k.cursorPos=z._getLogicalPoint(T);var E=k.garbageInfo;return E&&Il.checkHit(k.cursorPos,E,E.size)?(E.hover=!0,k.target=null,k.targetCorners=null):(E&&(E.hover=!1),k.target=U.getDataAt(J,function(P){return U.isSelectable(P)?er(P)?!0:!1:!1})||null,k.targetCorners=Il.getTargetCornersOnScreen(U,k.target)),z._42(),void 0}if("rotate"===r){var n,v,o=k.pos,i=Math.atan2(J.y-o.y,J.x-o.x);if(k.groupRotateMode?v=i-k.hitRot:(n=i-k.hitRot,v=k.rotation+n),v%=2*Math.PI,0>v&&(v+=2*Math.PI),!j.Default.isCtrlDown(T)){var d,q;Ah(T)?(d=z.getStyle("shiftRotateRound"),q=d/2):(d=z.getStyle("rotateRound"),q=z.getStyle("rotateSensitivity")),v=Il.roundTo(v,d,q)}k.groupRotateMode?(n=v-(k.lastRotation||0),0!==n&&(a.addRotation(n,k.groupRotateMode),k.lastRotation=v)):a.setRotation(v),z._setRotateCursor(i),v>Math.PI&&(v-=2*Math.PI);var I=180*(v/Math.PI);I=I.toFixed(2),Y=""+I+""}else if("resize"===r){var t=k.rect;P=t.x,H=t.y;var M,y=t.width,h=t.height,S=k.anchor,D=k.matrix,B=a.s&&a.s("keepAspectRatio")||z.getStyle("keepAspectRatio");Ah(T)&&(B=!B);var l=g._unionPointMode1,Q=g._unionPointMode2;if(g._inSmartGuide&&!j.Default.isCtrlDown(T)&&!B){var C;"L"===V||"R"===V?C="x":("T"===V||"B"===V)&&(C="y"),g._adsorbedToClosest(J,C),p=!0}M=D.tfi(J);var N;"LT"===V?(t=l(M,{x:P+y,y:H+h},y,h,B),N=9):"T"===V?(t=Q({x:P,y:M.y},{x:P+y,y:H+h},y,h,B,"v"),N=1):"RT"===V?(t=l(M,{x:P,y:H+h},y,h,B),N=33):"L"===V?(t=Q({x:M.x,y:H},{x:P+y,y:H+h},y,h,B,"h"),N=8):"R"===V?(t=Q({x:P,y:H},{x:M.x,y:H+h},y,h,B,"h"),N=32):"LB"===V?(t=l(M,{x:P+y,y:H},y,h,B),N=12):"B"===V?(t=Q({x:P,y:H},{x:P+y,y:M.y},y,h,B,"v"),N=4):"RB"===V&&(t=l(M,{x:P,y:H},y,h,B),N=36);
var u=D.tf(t.x+t.width*S.x,t.y+t.height*S.y);a instanceof j.Block&&(k.hasOwnProperty("freezeFlag")||(k.freezeFlag=a._freezeSyncFromChildren,a._freezeSyncFromChildren=!0)),a.setPosition(u),a.setSize(t.width,t.height),p&&($=a.getRect(),z.rectGuide.gatherLines({node:a,x:$.x,y:$.y,w:$.width,h:$.height},C,N)),Y=""+Math.round(t.width)+" * "+Math.round(t.height)}else if("line"===r){if(Ah(T)){var A=a.getPoints(),e="P1"===V?A.get(1):A.get(0),c={x:J.x-e.x,y:J.y-e.y},m=z.getStyle("shiftLineRotateRound"),G=g._shiftDirList;if(!G||g._shiftRotateRound!==m){g._shiftRotateRound=m,g._shiftDirList=G=[];for(var K=0;K<Math.PI;K+=m)G.push({x:f(K),y:O(K)})}for(var X,w=0,Z=0,b=G.length;b>Z;Z++){var L=G[Z],W=L.x*c.x+L.y*c.y;Math.abs(W)>Math.abs(w)&&(w=W,X=L)}J={x:e.x+X.x*w,y:e.y+X.y*w},z.rectGuide.clear()}else g._inSmartGuide&&!j.Default.isCtrlDown(T)&&(g._adsorbedToClosest(J),p=!0);var R=Il.getDataMatrix(a).applyInverse(J);a.setPoint("P1"===V?0:1,R,!0);var x=a.getPoints(),F=x.get(0),_=x.get(1);P=F.x-_.x,H=F.y-_.y,Y=" "+Math.round(Math.sqrt(P*P+H*H))+" ",p&&($=a.getRect(),z.rectGuide.gatherLines({node:a,x:$.x,y:$.y,w:$.width,h:$.height}))}if(Y){var s=j.Default.getLogicalPoint(T,z._canvas);s.x+=Il.Icons.TipShiftX,s.y+=Il.Icons.TipShiftY,g.tipInfo={helperPos:s,text:Y,size:Y.length}}g._fireEditEvent("between",T)}},Lr.prototype._unionPointMode1=function(A,v,W,q,C){if(C&&W&&q){var R=A.x-v.x,b=A.y-v.y;Math.abs(R*q)<Math.abs(b*W)?(b=Math.sign(b)*Math.abs(R*q/W),A.y=v.y+b):(R=Math.sign(R)*Math.abs(b*W/q),A.x=v.x+R)}return j.Default.unionPoint(A,v)},Lr.prototype._unionPointMode2=function(D,h,b,$,o,G){var p=j.Default.unionPoint(D,h);if(o&&b&&$){var L;"v"===G?(L=p.x+p.width/2,p.width=b*p.height/$,p.x=L-p.width/2):(L=p.y+p.height/2,p.height=$*p.width/b,p.y=L-p.height/2)}return p},Lr.prototype._adsorbedToClosest=function(E,D){var U=this,f=U._interactor,T=f.rectGuide.findClosest(E,D),J=f.gridGuide.findClosest(E,D),O=1/0,j=1/0;T&&(isFinite(T.x)&&(O=T.x),isFinite(T.y)&&(j=T.y)),J&&(isFinite(J.x)&&Math.abs(J.x)<Math.abs(O)&&(O=J.x),isFinite(J.y)&&Math.abs(J.y)<Math.abs(j)&&(j=J.y)),isFinite(O)&&(E.x+=O),isFinite(j)&&(E.y+=j)},Lr.prototype._42=function(f,y,Q){var k=this;k.info={},k.screenInfo=null;var j=k._interactor;if(!j.editDetail&&k.gatherInfo(y,Q)){var v=k.editing,i=v?v.groupRotateMode:null,s=k.screenInfo;"block"!==i&&(s.P1?Il.Icons.DrawIcon(j,f,Il.Icons.Line,s):Il.Icons.DrawIcon(j,f,Il.Icons.Rect,s),s.connect&&(Il.Icons.DrawIcon(j,f,Il.Icons.ConnectGuide,{rotation:s.rotation,connect:s.connect,cursorPos:v?v.cursorPos:null}),v&&(v.targetCorners&&Il.Icons.DrawIcon(j,f,Il.Icons.NodeHoverGuide,v.targetCorners),v.garbageInfo&&Il.Icons.DrawIcon(j,f,Il.Icons.ConnectGuideGarbage,v.garbageInfo))),k.tipInfo&&Il.Icons.DrawIcon(j,f,Il.Icons.TipHelper,k.tipInfo)),k.target instanceof Il.Group&&k.target._42(j,f,y)}};var ih=Il.Anchor=function(U){this.catalog="Anchor",this._interactor=U};ih.prototype={},ih.prototype.constructor=ih,ih.prototype.gatherInfo=function($,L){var c=this;if(1===L.length){var U=L[0];if(!U.getAnchor)return;if(U instanceof j.Shape&&U._70I())return;if(Ye(U,$))return;return c.gatherSingleTarget($,L[0])}return L.length>1?c.gatherMultiTargets($,L):!1},ih.prototype.gatherSingleTarget=function(K,q){var $=this;return $.info.POS=q.getPosition(),$.screenInfo.POS=Il.toScreenPosition(K,$.info.POS),$.target=q,!0},ih.prototype.gatherMultiTargets=function(w,Z){var Q=this,G=Il.Group.findOrCreateGroup(Z);return G?(Q.screenInfo.POS=Il.toScreenPosition(w,G.getAnchor2()),Q.target=G,!0):!1},ih.prototype.isVisible=function(){var M=this,A=M._interactor;if(A.getStyle("anchorVisible")===!1)return!1;var c=M.target;if(c){if(this.editing)return!0;var G=c.getAnchor(),T=A.getStyle("anchorOutsideVisibleThreshold");if(G.x<-T||G.x>1+T||G.y<-T||G.y>1+T)return!0;var r=c.getSize(),$=c.getScale(),P=Math.min(Math.abs(r.width*$.x),Math.abs(r.height*$.y));if(P*A.gv._zoom<A.getStyle("anchorHideThreshold"))return!1}return!0},ih.prototype.check=function(c,u,e){if(j.Default.isLeftButton(u)){var C=this,n=C._interactor;if(C.isVisible()&&n.getStyle("anchorMovable")!==!1){C.editing=null,C.tipInfo=null;var $=C.target;if($&&c.isAnchorEditable($)&&c.isEditable($)){var m;if(C.screenInfo&&(m=C.screenInfo.POS)&&Il.checkHit(e,new Il.Math.Vector2(m),n.getStyle("checkSize"))){if($ instanceof Il.Group)return C.editing={},!0;var o=$.getWidth(),b=$.getHeight(),h=$.getAnchor();return C.editing={rect:{x:-o*h.x,y:-b*h.y,width:o,height:b},anchor:h,matrix:$.getMatrix()},!0}}}}},ih.prototype.startEdit=function(P,R){P.startDragging(R),P.fi({kind:"beginEditAnchor",event:R})},ih.prototype._46O=function(W){var B=this;B.editing&&(B.editing=null,B._interactor.fi({kind:"endEditAnchor",event:W})),B.tipInfo=null},ih.prototype.handleEdit=function(w,H){var y=this,S=y.target;if(S){var J=y.editing;if(J){var Q=w.lp(H),Z=y._interactor;if(S instanceof Il.Group)return S.setAnchor2(Q),Z._42(),void 0;var q=J.matrix,F=q.tfi(Q),T=J.rect,r=(F.x-T.x)/T.width,V=(F.y-T.y)/T.height;if(!j.Default.isCtrlDown(H)){var p=Z.getStyle("anchorRound"),L=Z.getStyle("anchorSensitivity");r=Il.roundTo(r,p,L),V=Il.roundTo(V,p,L)}S.setAnchor(r,V,!0);var v=j.Default.getLogicalPoint(H,Z._canvas);v.x+=Il.Icons.TipShiftX,v.y+=Il.Icons.TipShiftY;var Y=""+r.toFixed(2)+", "+V.toFixed(2);y.tipInfo={helperPos:v,text:Y,size:Y.length},Z.fi({kind:"betweenEditAnchor",event:H})}}},ih.prototype._42=function(h,Y,i){var O=this;O.info={},O.screenInfo={};var K=O._interactor;K.editDetail||O.gatherInfo(Y,i)&&O.isVisible()&&(Il.Icons.DrawIcon(K,h,Il.Icons.Anchor,O.screenInfo),O.tipInfo&&Il.Icons.DrawIcon(K,h,Il.Icons.TipHelper,O.tipInfo))};var Ep=Il.RotateX=function(e){this.catalog="RotateX",this._interactor=e};Ep.prototype={},Ep.prototype.constructor=Ep,Ep.prototype.gatherInfo=function(k,v){var r=this;if(1===v.length){var f=v[0];return f instanceof j.Shape&&f._70I()||Ye(f,k)?!1:r.gatherSingleTarget(k,f)}return v.length>1?r.gatherMultiTargets(k,v):!1},Ep.prototype.gatherSingleTarget=function(){var O=new j.Math.Vector2,B=new j.Math.Vector2,$=new j.Math.Vector2,G=new j.Math.Vector2,f=function(A,g){var B=A.x-g.x,v=A.y-g.y;return B*B+v*v};return function(L,A){if(A.getCorners){var C=this,K=A.getCorners(),D=15,U=A.getPosition();O.copy(K[0]),$.copy(K[1]),G.copy(K[3]),B.copy(O).add(G).divideScalar(2).add(O.sub($).setLength(D/L.getZoom()));var e=Math.max(f(U,K[0]),f(U,K[1]),f(U,K[2]),f(U,K[3]));return C.info.POS=B.clone(),C.screenInfo.POS=Il.toScreenPosition(L,C.info.POS),C.screenInfo.LEN=Math.sqrt(e)*L.getZoom()+D,C.screenInfo.CENTER=Il.toScreenPosition(L,U),C.target=A,!0}}}(),Ep.prototype.gatherMultiTargets=function(o,i){var Y=this,z=Il.Group.findOrCreateGroup(i);if(!z)return!1;var Y=this;return Y.gatherSingleTarget(o,z)},Ep.prototype.isVisible=function(){var V=this._interactor;if(!V.getStyle("rotateAsClock"))return!1;var g=this.target;if(!g)return!0;var X=V.gv;return X.isEditable(g)&&X.isRotationEditable(g)?!0:!1},Ep.prototype.check=function(r,c,S){var I=this,C=I._checkImpl(r,c,S);return(C||I._clockPainted)&&I._interactor._42(),C},Ep.prototype._checkImpl=function(t,v,Z){if(j.Default.isLeftButton(v)){var Y=this;Y.editing=null,Y.tipInfo=null;var $;if(Y.screenInfo&&($=Y.screenInfo.POS)&&Y.isVisible()){var y=Y._interactor;if(Il.checkHit(Z,$,y.getStyle("checkSize"))){var J=Y.target,d=t.lp(v),i=J.getPosition(),F=Math.atan2(d.y-i.y,d.x-i.x);return y._setRotateCursor(F),Y.editing={pos:i,rotation:J.getRotation(),hitRot:F,groupRotateMode:"block",screenInfo:{CENTER:Y.screenInfo.CENTER,LEN:Y.screenInfo.LEN}},!0}}}},Ep.prototype.startEdit=function(i,q){i.startDragging(q),i.fi({kind:"beginEditRotation",event:q}),this.target instanceof Il.Group&&this.target.beginRotate(this.editing)},Ep.prototype._46O=function(z){var S=this;S.editing&&(S.editing=null,S._interactor.fi({kind:"endEditRotation",event:z})),S.target instanceof Il.Group&&S.target.endRotate(),S.tipInfo=null},Ep.prototype.handleEdit=function(S,O){var l=this,b=l.editing;if(b){var s,g,L=l.target,i=S.lp(O),D=l._interactor,u=b.pos,P=Math.atan2(i.y-u.y,i.x-u.x),n=L instanceof Il.Group;if(n?g=P-b.hitRot:(s=P-b.hitRot,g=b.rotation+s),g%=2*Math.PI,0>g&&(g+=2*Math.PI),!j.Default.isCtrlDown(O)){var Z,R;Ah(O)?(Z=D.getStyle("shiftRotateRound"),R=Z/2):(Z=D.getStyle("rotateRound"),R=D.getStyle("rotateSensitivity")),g=Il.roundTo(g,Z,R)}n?(s=g-(b.lastRotation||0),0!==s&&(L.addRotation(s,b.groupRotateMode),b.lastRotation=g)):L.setRotation(g),D._setRotateCursor(P),g>Math.PI&&(g-=2*Math.PI);var w=180*(g/Math.PI),A=""+w.toFixed(2)+"",N=j.Default.getLogicalPoint(O,D._canvas);N.x+=Il.Icons.TipShiftX,N.y+=Il.Icons.TipShiftY,l.tipInfo={helperPos:N,text:A,size:A.length},D.fi({kind:"betweenEditRotation",event:O})}},Ep.prototype._42=function(O,s,x){var W=this;W._clockPainted=!1,W.info={},W.screenInfo={};var N=W._interactor;N.editDetail||W.gatherInfo(s,x)&&W.isVisible()&&(Il.Icons.DrawIcon(N,O,Il.Icons.RoundPoint,W.screenInfo.POS),W.tipInfo&&Il.Icons.DrawIcon(N,O,Il.Icons.TipHelper,W.tipInfo),W.editing&&W.drawClock(O))},Ep.prototype.drawClock=function(T){T.save();var L=this;L._clockPainted=!0;var Q=L.editing||{},x=Q.screenInfo||L.screenInfo,u=x.LEN,v=u+8,l=u+18;T.save(),T.translate(x.CENTER.x,x.CENTER.y),T.beginPath(),T.strokeStyle="rgb(150, 150, 150)";for(var c,k,r,o,Z,P=0;360>P;P++)c=P*Math.PI/180,0===P%5&&(k=O(c)*u,r=f(c)*u,o=O(c)*v,Z=f(c)*v,T.moveTo(k,r),T.lineTo(o,Z)),0===P%45&&(k=O(c)*u,r=f(c)*u,o=O(c)*l,Z=f(c)*l,T.moveTo(k,r),T.lineTo(o,Z));T.stroke(),T.rotate(-S);var B=Q.lastRotation||L.target.getRotation();T.beginPath(),T.fillStyle="rgba(255, 0, 0, 0.1)",T.strokeStyle="rgb(157, 157, 157)",T.moveTo(0,0),T.arc(0,0,l,0,B,!1),T.fill(),T.beginPath(),T.moveTo(0+l,0),T.arc(0,0,l,0,B,!1),T.stroke(),T.restore()};var zh=Il.Curve=function(S){this.catalog="Curve",this._interactor=S};zh.prototype={},zh.prototype.constructor=zh,C.defineProperties(zh.prototype,{activing:{get:function(){return this._activing},set:function(W){var S=this;if(W)S._activing=new Il.CurveActiving(this,W);else{var L=S._activing;L&&L.dispose(),S._activing=null}}}}),zh.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},zh.prototype.setUp=function(){var y=this,w=y._interactor;w&&w.gv.mp(y._onGraphviewPropertyChanged,y)},zh.prototype._onGraphviewPropertyChanged=function(c){("zoom"===c.property||"translateX"===c.property||"translateY"===c.property)&&this._handleDataChanged()},zh.prototype.tearDown=function(){var x=this,w=x._interactor;w&&w.gv.ump(x._onGraphviewPropertyChanged,x)},zh.prototype.canEnterEditDetailMode=function(){var A=this,g=A._interactor,y=g._getValidSelection();if(1===y.length){var G=y[0],k=G instanceof j.Edge;if(G instanceof j.Shape||k){if(k){var L=G.s("edge.type");if(L&&"points"!==L)return}var o=g.gv;if(o.isPointEditable(G)&&o.isEditable(G))return A.target=G,!0}}},zh.prototype.preHandleScroll=function(){var H=this.editing;return H&&H.inEdit?!0:void 0},zh.prototype.getCurrentSelectintStatus=function(){var G=this;if(G.activing&&!G.activing.selections){if(G.activing.status!=H)return G.activing.status;var g=function(B){var S=G.activing.status;G.activing.status=B,G._interactor.fp("shapePointStatus",S,B)},V=Il.Curve.PointType,r=G.activing.point,C=G.activing.pairs;if(!C||1!==C.length)return g(V.Mirrored);var E=C[0],$=E.c1&&E.c1.isNearEnough(r),k=E.c2&&E.c2.isNearEnough(r);if(!E.c1||!E.c2)return $||k?g(V.Straight):g(V.Disconnected);if($&&k)return g(V.Straight);if($||k)return g(V.Asymmetric);var P=E.c1.clone().sub(r),h=E.c2.clone().sub(r);return Math.abs(P.x*h.y-P.y*h.x)>1e-5||P.x*h.x>0?g(V.Disconnected):Math.abs(P.length()-h.length())>1e-5?g(V.Asymmetric):g(V.Mirrored)}},zh.prototype.handle_keydown=function(p){var x=this;if(x._interactor.editDetail){var o=Il.Curve.PointType;"1"===p.key?x._setCurrentSelectionStatus(o.Straight):"2"===p.key?x._setCurrentSelectionStatus(o.Mirrored):"3"===p.key?x._setCurrentSelectionStatus(o.Disconnected):"4"===p.key&&x._setCurrentSelectionStatus(o.Asymmetric)}},zh.prototype.setCurrentSelectionStatus=function(Y){var H=this,L=H._interactor;if(L){var r=L.gv;r.dm().beginTransaction(),this._setCurrentSelectionStatus(Y),r.dm().endTransaction()}},zh.prototype._setCurrentSelectionStatus=function(s){var x=this,K=x.activing;if(K){var A=x.getCurrentSelectintStatus();if(null!==A&&A!==s){K.status=s;var Z=x.activing.point,W=x.activing.pairs;if(W&&1===W.length){var V=W[0],L=x.screenInfo.curve,N=Il.Curve.PointType,Q=function(){x._writeToHt(),x._interactor.fp("shapePointStatus",A,s)};if(s===N.Straight)return L.moveCtrlPoint(V,Z,"c1"),L.moveCtrlPoint(V,Z,"c2"),Q(),void 0;if(A===N.Straight){var i=L.findPairs(Z,!0),T=i[0],l=T.r1||Z,r=T.r2||Z,R=r.clone().sub(l).multiplyScalar(.25);return L.moveCtrlPoint(V,Z.clone().sub(R),"c1"),L.moveCtrlPoint(V,Z.clone().add(R),"c2"),Q(),void 0}var Y=V.c1,F=V.c2;if(Y&&F){if(s===N.Mirrored)return L.moveCtrlPoint(V,Z.clone().multiplyScalar(2).sub(F),"c1"),Q(),void 0;if(s===N.Asymmetric&&A===N.Disconnected){var h=Y.clone().sub(Z).length(),R=Z.clone().sub(F).setLength(h).add(Z);return L.moveCtrlPoint(V,R,"c1"),Q(),void 0}}K._firePointChange(),x._interactor.fp("shapePointStatus",A,s)}}}},zh.prototype._handleDataChanged=function(u){var Z=this;if(Z.screenInfo&&Z.target){var $=Z._interactor;Z.gatherSingleTarget($.gv,Z.target,!0),Z.check($.gv,null,u?$._getLogicalPoint(u):new Il.Math.Vector2($._lastClientPoint)),$._42()}},zh.prototype.gatherSingleTarget=function(P,e,q){var c,v,f=this;f.screenInfo&&f.screenInfo.curve&&(v=f.screenInfo.curve._curves);var A=f.editing;c=A?f.screenInfo:f.screenInfo={};var u,W,C=e instanceof j.Edge;C?(u=e.s("edge.segments"),W=e.s("edge.points")||new j.List):(u=e._58O,W=e._59O),c.S=u;var b,x=c.P=[],M=Il.getDataMatrix(e);if(e instanceof j.Polyline&&(b=e.getElevation()||0,c.E=[]),W.each(function(B){c.E&&c.E.push(B.e||b),B=M.apply(B);var K=Il.toScreenPosition(P,B);x.push(K.x,K.y)}),C){var l=Il.toScreenPosition(P,e._lastSourcePoint),G=Il.toScreenPosition(P,e._lastTargetPoint);x.splice(0,0,l.x,l.y),x.push(G.x,G.y)}if(!c.S||!c.S.size()){c.S=new j.List,c.S.add(1);for(var F=0;F<x.length/2-1;F++)c.S.add(2)}if((!A||q)&&f.convertToCubicBezier(v),f.activing&&(q||!f.editing||"realPoint"===f.editing.type)){var N=c.curve.findPairs(f.activing.point);f.activing.pairs=N}C&&"points"!==e.s("edge.type")&&f._writeToHt()},zh.prototype._convertToNewPoint=function(q,k,O){var n,v,P;for(n=0,v=k.length;v>n;n++){if(P=k[n],P._p1.isNearEnough(q))return P._p1;if(P._p4.isNearEnough(q))return P._p4}if(O)for(n=0,v=Math.min(O.length,v);v>n;n++){if(P=O[n],P._p1===q)return k[n]._p1;if(P._p4===q)return k[n]._p4}},zh.prototype.convertToCubicBezier=function(g){var N,D,b=this,z=new Il.Math.Curve,r=b.screenInfo;if(z.createFromHtShape(r.P,r.S,r.E),r.curve=z,b.activing){var U=z._curves;if(N=b.activing.point,D=b._convertToNewPoint(N,U,g),D&&(b.activing.point=D),b.activing.selections){var P=-1,c=b.activing.selections;c.forEach(function(u){P++,D=b._convertToNewPoint(u,U,g),D&&(c[P]=D)})}}},zh.prototype.check=function(v,F,r){if(!F||j.Default.isLeftButton(F)){var e=this;if(e._interactor.setCursor("default"),e.editing=null,e.highlight=null,e.tipInfo=null,e.screenInfo){if(ib())return e._interactor._42(),!0;if(e._checkEditCtrlPoint(r))return e._interactor._42(),!0;if(e._checkEditRealPoint(r))return e._interactor._42(),!0;if(e._checkEditElevation(r))return e._interactor._42(),!0;var P=e.screenInfo.curve,d=P.checkPoint(r,e._interactor.getStyle("curveIntersectSize"));if(d){var R=e.highlight={};R.type="insertKnot",R.bezier=d.bezier,R.point=d.intersection}return e._interactor._42(),!0}}},zh.prototype._checkEditRealPoint=function(E){var o,h,A,v,N,W,D=this,Q=D.screenInfo.curve._curves,i=D._interactor.getStyle("curvePointIntersectSize"),f=1/0;for(i*=i,A=0,v=Q.length;v>A;A++)o=Q[A],N=o._p1,W=E.distanceToSquared(N),f>W&&(f=W,h=N),N=o._p4,W=E.distanceToSquared(N),f>W&&(f=W,h=N);if(f>i)return!1;var s=D.highlight={};return s.type="changeRealPoint",s.point=h,D.editing={type:"realPoint",point:h,shiftGuide:{point:h.clone(),dir:"x",limit:0}},D._interactor.setCursor("crosshair"),!0},zh.prototype._checkEditElevation=function(m){var L=this;if(!L._interactor.getStyle("curveElevationVisible"))return!1;var r=L.activing;if(!r)return!1;var P=r.getCurrentEditingPoint();if(!P)return!1;var C=L._interactor,y=C.getStyle("curveElevationGuideShift"),Q=C.getStyle("curveElevationIntersectSize"),A=m.distanceToSquared({x:P.x+y[0],y:P.y+y[1]});if(!(A>Q*Q)){var x=L.highlight={};x.type="elevation";var v=new Il.Math.Vector2(m.x,m.y,P.e);return L.editing={type:"elevation",startPoint:v},L._interactor.setCursor("crosshair"),!0}},zh.prototype._checkEditCtrlPoint=function(z){var W=this;if(W.activing&&!W.activing.selections){var S=W.getCurrentSelectintStatus();if(S!==Il.Curve.PointType.Straight){var N=W.activing.pairs;if(N){var G=W._interactor.getStyle("curvePointIntersectSize");G*=G;var B,n,Y,o,Z,V,$,C,q,v=1/0;for($=0,q=N.length;q>$;$++)for(o=N[$],C=0;2>C;C++)Z=0===C?"c1":"c2",o[Z]&&(V=z.distanceToSquared(o[Z]),v>V&&(v=V,B=o,n=$,Y=Z));if(v>G)return!1;W.activing.hlpair=B,W.activing.hltype=Y;var w=W.highlight={};return w.type="changeCtrlPoint",w.point=B[Y],W.editing={type:"ctrlPoint",pair:B,pairId:n,ctrlType:Y,direction:B[Y].clone().sub(W.activing.point).normalize()},W._interactor.setCursor("crosshair"),!0}}}},zh.prototype.startEdit=function(T,m){T.startDragging(m);var X=this;X.highlight&&"insertKnot"===X.highlight.type&&(X.insertKnot(),X.gatherSingleTarget(X._interactor.gv,X.target),X.activing=null,X._checkEditRealPoint(X._interactor._getLogicalPoint(m)));var M=X._activing;if(M){var _=X.editing?X.editing.type:null;"ctrlPoint"===_?M.editingCtrl={pairId:X.editing.pairId,type:M.hltype}:"realPoint"===_&&(M.editingCtrl=!1)}var P=X.highlight,Z=j.Default.isCtrlDown(m);if(!P||ib()){var z=X._interactor.gv;if(!z.setFocus(m)||z._scrolling)return;return z.isPannable()&&gc(m)&&!Z&&(X._pan={tx:z.tx(),ty:z.ty()},T.fi({kind:"beginPan",event:m})),void 0}if("changeRealPoint"===P.type){var v,Y=X.activing?X.activing.point:null,W=X.activing?X.activing.selections:null;if(Z&&X.activing)Y===P.point?(W?(X.activing={point:W[0]},W.length>1&&(W.splice(0,1),X.activing.selections=W)):X.activing=null,X.editing=null):W&&(v=W.indexOf(P.point))>=0?(W.length>1?W.splice(v,1):delete X.activing.selections,X.editing=null):W?(W.push(Y),X.activing={point:P.point,selections:W}):X.activing={point:P.point,selections:[Y]};else if(W)Y===P.point||((v=W.indexOf(P.point))>=0?(W.splice(v,1,Y),X.activing={point:P.point,selections:W}):X.activing={point:P.point});else{var r;Y===P.point&&(r=X.activing.status),X.activing={point:P.point},r&&(X.activing.status=r)}T.fi({kind:"beginEditPoint",event:m})}},zh.prototype.insertKnot=function(){var g=this,o=g.highlight,G=g.screenInfo.curve;G.insertKnot(o.bezier,o.point.t),g._writeToHt()},zh.prototype._writeToHt=function(){var Q,Y,X,z,l=this,B=l.screenInfo.curve,S=B.toHtShape(),p=S.points,I=[],g=S.segments,D=l._interactor.gv,O=l.target,W=O instanceof j.Edge,s=Il.getDataMatrix(O).invert();z=O instanceof j.Polyline,z&&(X=O.getElevation());for(var Z=0,P=p.length;P>Z;Z++)Q=p[Z],Y=Il.toWorldPosition(D,Q),Y=s.apply(Y),Q.e!=H&&Q.e!==X&&(Y.e=Q.e),I.push(Y);if(O._writing=!0,W){O.s("edge.type","points"),O.setStyle("edge.segments",g),O.setStyle("edge.points",I.slice(1,I.length-1)),O.setStyle("edge.source.offset.x",0),O.setStyle("edge.source.offset.y",0),O.setStyle("edge.target.offset.x",0),O.setStyle("edge.target.offset.y",0);var T=l._nextChangeEdgeHost;delete l._nextChangeEdgeHost,T&&("source"===T.type?O.setSource(T.host):O.setTarget(T.host)),l._writeEdgeHostAnchor("source",I[0]),l._writeEdgeHostAnchor("target",I[I.length-1])}else I.length?(O.setSegments(g),O.setPoints(I,!0)):O.removeFromDataModel();delete O._writing},zh.prototype._writeEdgeHostAnchor=function(K,Q){var f=this,r=f.target,k=f._calcHostAnchor(r,K,Q);r.s("edge."+K+".anchor.x",k.x),r.s("edge."+K+".anchor.y",k.y)},zh.prototype._calcHostAnchor=function(X,j,y,K){K||(K="source"===j?X.getSource():X.getTarget());var T=K.getRotation(),F=K.getAnchor(),W=this._interactor.gv;if(Ye(K,W)&&(T=0),T){var Y=K.getMatrix(),_=Y.tfi(y),k=K.getSize();return{x:_.x/k.width+F.x,y:_.y/k.height+F.y}}var Z=Rp(W,K),r={x:(y.x-Z.x)/Z.width,y:(y.y-Z.y)/Z.height};return r},zh.prototype._handlePanning=function(k){var H=this,D=H._pan;if(D){D.started=!0;var V=H._interactor,h=V.gv,q=V._lastClientPoint,K=fm(k);h.setTranslate(D.tx+K.x-q.x,D.ty+K.y-q.y),H.gatherSingleTarget(V.gv,H.target),V._42(),V.fi({kind:"betweenPan",event:k})}},zh.prototype.handleEdit=function(B,G){var Y=this,f=Y.editing;if(Y._pan)return Y._handlePanning(G),void 0;if(f){f.inEdit=!0;var K,z,O,W=Y._interactor._getLogicalPoint(G),w=j.Default.isCtrlDown(G),V=j.Default.isShiftDown(G),i=f.type,y=Y.activing;if(Y._guideInfo=null,"ctrlPoint"===i&&V){var r=Y.editing.direction.clone();K=y.point;var a=r.dot(W.clone().sub(K));W=r.setLength(a).add(K)}else if("ctrlPoint"===i||"realPoint"===i){var r;if("realPoint"===i&&V){var Z=Y.editing.shiftGuide;z=Z.point;var n=Math.abs(W.x-z.x),s=Math.abs(W.y-z.y);n>s&&n>Z.limit&&"y"===Z.dir&&(Z.dir="x"),s>n&&s>Z.limit&&"x"===Z.dir&&(Z.dir="y"),r=Z.dir,"x"===r?(W.y=z.y,Z.limit=Math.max(Z.limit,n)):"y"===r&&(W.x=z.x,Z.limit=Math.max(Z.limit,s))}var D=Y._isEditEdgeSourceTarget();if(D){var l=Y._editEdgeSourceTarget(D,W,w);l&&(O=l.tipText)}else if(!w){var P=Y._guidingToEdit(W,r),M="realPoint"===i?Y._interactor.gridGuide.findClosest(W,r,!0):null,u=1/0,m=1/0;M&&(M.x&&(u=M.x),M.y&&(m=M.y));var $=!1;P&&(P.xList&&(Math.abs(P.x)<=Math.abs(u)?($=!0,u=P.x):delete P.xList),P.yList&&(Math.abs(P.y)<=Math.abs(m)?($=!0,m=P.y):delete P.yList),$&&(Y._guideInfo=P)),isFinite(u)&&(W.x+=u),isFinite(m)&&(W.y+=m),$&&(P.v=W)}}var h=Y.screenInfo.curve;if("realPoint"===f.type){K=f.point,K.e!==H&&(W.e=K.e),h.moveRealPoint(K,W),f.point=W,Y.highlight.point=W;var R=y.status,o=y.selections;if(Y.activing={point:W,status:R},o){var g=W.clone().sub(K),v=0;o.forEach(function(i){var W=i.clone().add(g);h.moveRealPoint(i,W),o[v++]=W}),Y.activing.selections=o}}else if("ctrlPoint"===f.type){var F=y.pairs,c=F[f.pairId];h.moveCtrlPoint(c,W,f.ctrlType);var d=y.status,J=Il.Curve.PointType;if((d===J.Mirrored||d===J.Asymmetric)&&c.c1&&c.c2){var K=new Il.Math.Vector2(y.point),b="c1"===f.ctrlType?"c2":"c1";if(d===Il.Curve.PointType.Mirrored)h.moveCtrlPoint(c,K.clone().multiplyScalar(2).sub(W),b);else if(d===J.Asymmetric){var a=c[b].clone().sub(K).length(),E=K.clone().sub(c[f.ctrlType]).setLength(a).add(K);isNaN(E.x)||h.moveCtrlPoint(c,E,b)}}y._firePointChange()}else if("elevation"===f.type){z=f.startPoint;var Q=z.e+(z.y-W.y)/B._zoom;Y._setCurrentPointImpl("e",Q),y._firePointChange(),O="E: "+Il.toFixed(Q)}var _=j.Default.getLogicalPoint(G,Y._interactor._canvas);if(_.x+=Il.Icons.TipShiftX,_.y+=Il.Icons.TipShiftY,!O){var A=Il.toWorldPosition(B,W);O=""+Il.toFixed(A.x)+", "+Il.toFixed(A.y)}Y.tipInfo={helperPos:_,text:O,size:O.length},Y._writeToHt(),Y._interactor.fi({kind:"betweenEditPoint",event:G})}},zh.prototype._setCurrentPointImpl=function(v,o){var q=this,b=q._activing;if(!b)return!1;var X=q.target;if(!X)return!1;var Q=b.getCurrentEditingPoint();if(!Q)return!1;var r=b.editingCtrl;if(!r)var U=Q.clone();if("e"===v)Q.e=o;else{var z;if("x"===v||"y"===v){var K=b._lastFirePoint;z="x"===v?{x:o,y:K?K.y:0}:{x:K?K.x:0,y:o}}else"object"==typeof v?(z=v,v.e!==H&&(Q.e=v.e)):(z={x:arguments[0],y:arguments[1]},arguments[2]!==H&&(Q.e=arguments[2]));var A=Il.getDataMatrix(X);z=Il.toScreenPosition(q._interactor.gv,A.apply(z)),Q.x=z.x,Q.y=z.y}if(!r){var F=U.multiplyScalar(-1).add(Q);Q.e&&U.e&&(F.e=Q.e-U.e),q.screenInfo.curve.moveCtrlDueToRealPointMovement(Q,F)}return!0},zh.prototype.setCurrentPoint=function(z,E){return this._setCurrentPointImpl(z,E)?(this._writeToHt(),!0):!1},zh.prototype._isEditEdgeSourceTarget=function(){var g=this,Q=g.target;if(!(Q instanceof j.Edge))return!1;var M=g.editing.point,N=g.screenInfo.curve._curves;return M===N[0]._p1?"source":M===N[N.length-1]._p4?"target":!1},zh.prototype._editEdgeSourceTarget=function(Q,U,z){var X,e=this,n=e.target;if(X="source"===Q?n.getSource():n.getTarget()){var s=e._interactor.gv,c=Il.toWorldPosition(s,U),y=e._calcHostAnchor(n,Q,c,X);if(!z){var d=e._interactor.getStyle("anchorRound"),J=e._interactor.getStyle("anchorSensitivity");y.x=Il.roundTo(y.x,d,J),y.y=Il.roundTo(y.y,d,J)}if(e._interactor.getStyle("edgeHostDetectPerFrame")||y.x<0||y.x>1||y.y<0||y.y>1){var u=s.getDataAt(c,function(R){return s.isSelectable(R)?er(R)?!0:!1:!1});if(u){var I=e._calcHostAnchor(n,Q,c,u);X=u,e._nextChangeEdgeHost={type:Q,host:u},y=I,z||(y.x=Il.roundTo(y.x,d,J),y.y=Il.roundTo(y.y,d,J))}}if(!z){var L=Sh(s,X,0,0,0,y.x,y.y),D=Il.toScreenPosition(s,L);U.x=D.x,U.y=D.y}return e._edgeHostGuideInfo=Il.getTargetCornersOnScreen(s,X),{host:X,anchor:y,tipText:""+y.x.toFixed(2)+", "+y.y.toFixed(2)}}},zh.prototype._guidingToEdit=function(V,I){var R,K,x=this;if(R=x.screenInfo.curve){K=R._curves;var W,g,P,i,S,y,q,h,D=1/0,t=1/0,A=[];for(x.editing&&"realPoint"===x.editing.type&&(h=x.editing.point),S=0,y=2*K.length;y>S;S++)q=K[Math.floor(S/2)][S%2?"_p4":"_p1"],A.indexOf(q)>=0||(A.push(q),h&&h===q||(P=q.x-V.x,i=q.y-V.y,Math.abs(P)<Math.abs(D)?(D=P,W=[q]):P===D&&W.push(q),Math.abs(i)<Math.abs(t)?(t=i,g=[q]):i===t&&g.push(q)));var e=x._interactor.getStyle("smartGuideSensitivity");if((Math.abs(D)>e||"y"===I)&&(W=null),(Math.abs(t)>e||"x"===I)&&(g=null),W||g){var H=!1,U={};if(W&&(H=!0,U.xList=W,U.x=D),g&&(H=!0,U.yList=g,U.y=t),H)return U}}},zh.prototype._46O=function(o){var j=this;j.editing&&(j.editing=null,j._interactor.fi({kind:"endEditPoint",event:o})),j._guideInfo=null,j._edgeHostGuideInfo=null,j._pan&&(j._pan=null,j._interactor.fi({kind:"endPan",event:o})),j.tipInfo=null},zh.prototype._canDeletePoint=function(_,$){var U=this.target;if(!(U instanceof j.Edge))return!0;var C=_._curves[0],g=_._curves[_._curves.length-1];return C._p1===$||g._p4===$?!1:!0},zh.prototype.handleDelete=function(){var L=this;if(L.activing&&L.screenInfo){var B=j.Default.isShiftDown(),h=L.screenInfo.curve;L._canDeletePoint(h,L.activing.point)&&h.deleteRealPoint(L.activing.point,B),L.activing.selections&&L.activing.selections.forEach(function(v){L._canDeletePoint(h,v)&&h.deleteRealPoint(v,B)}),L.activing=null,delete L.editing,delete L.tipInfo,delete L._pan,L._writeToHt(),L._interactor.fp("deleteShapePoint",!1,!0)}},zh.prototype.handleDoubleClick=function(q){var N=this,t=N._interactor._getLogicalPoint(q);if(N.screenInfo&&N._checkEditRealPoint(t)){var f=N.getCurrentSelectintStatus(),X=Il.Curve.PointType;return f=f===X.Mirrored?X.Straight:X.Mirrored,N._setCurrentSelectionStatus(f),N._interactor._42(),!0}},zh.prototype._drawHighlight=function(w){var y=this,b=y.highlight;if(b){var E=b.bezier,S=y._interactor;E&&Il.Icons.DrawIcon(S,w,Il.Icons.ShapeHighlightCurve,[E._p1.x,E._p1.y,E._p2.x,E._p2.y,E._p3.x,E._p3.y,E._p4.x,E._p4.y]);var Q=b.point;Q&&"insertKnot"===b.type&&Il.Icons.DrawIcon(S,w,Il.Icons.ShapeHighlighPoint,Q)}},zh.prototype._drawGuide=function(B){var H=this,e=H._guideInfo;if(e){var s,T,W,Q,O=e.v;for(s=0;2>s;s++)if(Q=0===s?e.xList:e.yList)for(T=0,W=Q.length;W>T;T++)Il.Icons.DrawIcon(H._interactor,B,Il.Icons.ShapeGuideLine,[O.x,O.y,Q[T].x,Q[T].y])}},zh.prototype._drawCurrentPoint=function(v){var Q=this;if(Q.activing){var D=Q.activing,s=Q.getCurrentSelectintStatus(),o=Q._interactor;if(s!==Il.Curve.PointType.Straight){var W=D.pairs;D.hlpair,D.hltype;var F=D.selections,q=D.editingCtrl;if(W&&!F){var X,f,L;for(f=0,L=W.length;L>f;f++)X=W[f],q&&f===q.pairId&&X[q.type]?Il.Icons.DrawIcon(o,v,Il.Icons.ShapeActivingCtrl,{point:X.point,c1:X.c1,c2:X.c2,hl:q.type}):Il.Icons.DrawIcon(o,v,Il.Icons.ShapeActivingCtrl,X)}}Il.Icons.DrawIcon(o,v,Il.Icons.ShapeHighlighRealPoint,Q.activing.point),F&&F.forEach(function(f){Il.Icons.DrawIcon(o,v,Il.Icons.ShapeHighlighRealPoint,f)})}},zh.prototype.clear=function(){var e=this;e.editing=null,e._guideInfo=null,e.activing=null,e.highlight=null},zh.prototype._42=function(L){var b=this;b.info={},b.editing||(b.screenInfo=null);var z=b._interactor;if(!z.editDetail)return b.clear(),void 0;if(!b.target||!b._interactor.gv.isSelected(b.target)||!b._interactor.gv.isVisible(b.target))return z.editDetail=!1,b.clear(),void 0;if(b.gatherSingleTarget(z.gv,b.target),Il.Icons.DrawIcon(z,L,Il.Icons.ShapeBgCurve,b.screenInfo),b._drawHighlight(L),b._drawCurrentPoint(L),b._getRealPoint().forEach(function(c){Il.Icons.DrawIcon(z,L,Il.Icons.ShapePoint,c)}),b._drawGuide(L),b.tipInfo&&Il.Icons.DrawIcon(z,L,Il.Icons.TipHelper,b.tipInfo),b._edgeHostGuideInfo&&Il.Icons.DrawIcon(z,L,Il.Icons.NodeHoverGuide,b._edgeHostGuideInfo),b._interactor.getStyle("curveElevationVisible")&&b.target instanceof j.Polyline&&b.activing){var Y=b.activing.getCurrentEditingPoint();Y&&Il.Icons.DrawIcon(z,L,Il.Icons.EdgeElevationGuide,Y)}},zh.prototype._getRealPoint=function(){var O,d=this.screenInfo,k=d.P,W=d.S,I=-1,Y=[],Q=-1,V=W.length;return W.each(function(a){Q++;var u=1;if(3===a)u=2;else if(4===a)u=3;else if(5===a)return;I+=u,O=Q+1>=V?!0:1===W.get(Q+1)?!0:!1,Y.push({point:{x:k[2*I],y:k[2*I+1]},isEnd:O})}),Y};var ye=Il.MoveHelper=function(W){var $=this;$.catalog="Move",$._interactor=W};ye.prototype={},ye.prototype.constructor=ye,ye.prototype.calcShift=function(D,H,l){var B,y,z=this,S=z._interactor.gv,k=S.lp(H);if("beginMove"===D&&z._gatherGridInfo(l._lastLogicalPoint||k),B=z._target){var s=B.downPosition;if(s){var b=z._interactor.getStyle("moveSensitivity")/S._zoom;if(s.distanceTo(k)<b)return{x:0,y:0};delete B.downPosition}var i;y=j.Default.isShiftDown(H),y&&(k=z._dealShiftDown(k),i=B.shiftGuide.dir);var M,A=B.rawPos={x:B.pos.x+k.x-B.lp.x,y:B.pos.y+k.y-B.lp.y};if(j.Default.isCtrlDown(H)){if(M=z._calcShiftByAddon(),z._target.node instanceof Il.Group){var f=z._target.node;f._position.x+=M.x,f._position.y+=M.y}return M}for(var X,I=B.x+A.x,O=B.y+A.y,K={x:I,y:O},J={x:I+B.w/2,y:O+B.h/2},N={x:I+B.w,y:O+B.h},w=z._interactor.rectGuide,x=z._interactor.gridGuide,g=[w.findClosest(K,i),w.findClosest(J,i),w.findClosest(N,i),x.findClosest(K,i),x.findClosest(J,i),x.findClosest(N,i)],o=1/0,a=1/0,F=0,u=g.length;u>F;F++)X=g[F],X&&(I=X.x,O=X.y,isFinite(I)&&Math.abs(I)<Math.abs(o)&&(o=I),isFinite(O)&&Math.abs(O)<Math.abs(a)&&(a=O));if(isFinite(o)||(o=0),isFinite(a)||(a=0),M=z._calcShiftByAddon(o,a),z._target.node instanceof Il.Group){var f=z._target.node;f._position.x+=M.x,f._position.y+=M.y}var V=B.node;if(!Ye(V,S)){var n=A.x+o,T=A.y+a;z._interactor.rectGuide.gatherLines({node:V,x:B.x+n,y:B.y+T,w:B.w,h:B.h},i)}return M}},ye.prototype._calcShiftByAddon=function(y,s){var L=this._target,E=L.rawPos,b=L.node.getPosition();return y=y||0,s=s||0,{x:E.x-b.x+y,y:E.y-b.y+s}},ye.prototype._dealShiftDown=function(F){var V=this,P=V._target.shiftGuide,c=V._target.lp,_=Math.abs(F.x-c.x),p=Math.abs(F.y-c.y);_>p&&_>P.limit&&"y"===P.dir&&(P.dir="x"),p>_&&p>P.limit&&"x"===P.dir&&(P.dir="y");var m=P.dir;return"x"===m?(F.y=c.y,P.limit=Math.max(P.limit,_)):"y"===m&&(F.x=c.x,P.limit=Math.max(P.limit,p)),F},ye.prototype._gatherGridInfo=function(Y){var I,Q=this,w=Q._interactor,N=w._getValidSelection();if(1===N.length){if(I=N[0],!I.getRect)return Q._target=null,void 0}else if(I=Il.Group.findOrCreateGroup(N),!I)return Q._target=null,void 0;var b=I.getPosition(),M=I.getRect();Q._target={node:I,x:M.x-b.x,y:M.y-b.y,w:M.width,h:M.height,lp:{x:Y.x,y:Y.y},pos:{x:b.x,y:b.y},shiftGuide:{dir:"x",limit:0},downPosition:new Il.Math.Vector2(Y)},w.rectGuide.gatherRects()},ye.prototype.clear=function(){var $=this;$._interactor.rectGuide.clear(),$._interactor._42()};var qn="directional",Hi="point",ee="spot",ql="light.color",ig=function(M,O){_e(O)&&up.test(O)?qq(M,O):Lg(O)&&O.modelType?th(M,O):gd[M]=O},Un=function(K){if(Lg(K))return K;var g=gd[K];return K&&g===H&&up.test(K)&&($g&&$g[K]||qq(K,K)),g};Of(h,{graph3dViewAttributes:I,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:g/60,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:zk,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:g/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,setShape3dModel:ig,getShape3dModel:Un,createMatrix:function(C,a){Ck(C)||(C=[C]);
for(var p=C.length-1;p>=0;p--){var J=C[p];a=Dq(J.mat,J.s3,J.r3,J.rotationMode,J.t3,a)}return a},transformVec:function(l,u){return Ph(l,u)},createBoxModel:function(){return{vs:nr,ns:mc,uv:qi,is:mq}},createRoundRectModel:function(Z,y){return Nn.roundRect(Z,y)},createStarModel:function(X,l){return Nn.star(X,l)},createRectModel:function(N,I){return Nn.rect(N,I)},createTriangleModel:function(_,a){return Nn.triangle(_,a)},createRightTriangleModel:function(P,_){return Nn.rightTriangle(P,_)},createParallelogramModel:function(c,K){return Nn.parallelogram(c,K)},createTrapezoidModel:function(X,I){return Nn.trapezoid(X,I)},createSmoothSphereModel:function(e,R,h,l,W,Q,x){return Sd(new sh(e,R,h,l,W,Q,x))},createSphereModel:function(X,V,R,F,u,m){return X?Qb(X,V,R,F,u,m):h.createSmoothSphereModel()},createSmoothConeModel:function(W,k,U,K,q){return Aq(W,k,U,K,q)},createConeModel:function(W,S,z,Q,i,D){return W?yl(W,S,z,Q,i,D):Aq(D)},createSmoothCylinderModel:function(Q,F,y,p,m,j,l,B){return Sd(new fr(Q,F,y,p,m,j,l,B))},createCylinderModel:function(X,O,T,h,S,g,P){return X?Pq(X,O,T,h,S,g,P):io(g,P)},createSmoothTorusModel:function(h,P,I,o,f,K){return Sd(new Yi(h,P,I,o,f,K))},createTorusModel:function(x,P,l,R,W,t,J){return x?Or(x,P,l,R,W,t,J):So(t,J)},createExtrusionModel:function(N,w,W,z,x,A,M,G){return xr(N,w,W,z,x,A,M,G)},createSmoothRingModel:function(K,D,M,$,h,E){for(var z=[],j=0;j<K.length-1;j+=2)z.push({x:K[j],y:K[j+1]});for(K=bf(z,D,M)[0],z=[],j=0;j<K.length;j++){var U=K[j];z.push(new nm(U.x,0,U.y))}return Sd(new Nr(z,E,$,h))},createTextGeometry:function(M,l){return Sd(new Lh(M,l))},loadFontFace:function(s,u){h.xhrLoad(s,function(o){if(!o)return u();var X;try{X=JSON.parse(o)}catch(l){X=JSON.parse(o.substring(65,o.length-2))}Sb.loadFace(X),u&&u(X.familyName.toLowerCase())},u?null:{sync:!0})},createRingModel:function(X,i,j,L,U,Y,S,E,R,W){for(var t=[],o=0;o<X.length-1;o+=2)t.push({x:X[o],y:X[o+1]});Y=Y||h.shapeSide,S=S||0,E=E||Y;var r,H,V,z,l,a,T,J,w,s,o,p,G,P,v,q,F,K,B=[],Q=[],_=R?[]:I,c=R?[]:I,e=W?[]:I,M=W?[]:I,N=L?[]:I,u=L?[]:I,y=U?[]:I,Z=U?[]:I,X=bf(t,i,j),A=Ib(X),$=0,k=2*Math.PI/Y;return X.forEach(function(D){if(V=D.length,V>1){if(z=D[0],L)for(a=z.x,J=z.y,o=S;E>o;o++)p=o+1,G=o*k,P=p*k,v=O(G),q=f(G),F=O(P),K=f(P),N.push(v*a,J,-q*a,F*a,J,-K*a,0,J,0),u.push(.5-.5*v,.5-.5*q,.5-.5*F,.5-.5*K,.5,.5);for(s=0;V>s;s++){for(l=D[s],a=z.x,T=l.x,J=z.y,w=l.y,r=$/A,$+=em(z,l),H=$/A,o=S;E>o;o++)p=o+1,G=o*k,P=p*k,v=O(G),q=f(G),F=O(P),K=f(P),B.push(v*T,w,-q*T,F*T,w,-K*T,v*a,J,-q*a,F*T,w,-K*T,F*a,J,-K*a,v*a,J,-q*a),Q.push(o/Y,H,p/Y,H,o/Y,r,p/Y,H,p/Y,r,o/Y,r),R&&o===S&&(_.push(0,J,0,0,w,0,v*T,w,-q*T,v*T,w,-q*T,v*a,J,-q*a,0,J,0),c.push(0,.5-J,0,.5-w,2*T,.5-w,2*T,.5-w,2*a,.5-J,0,.5-J)),W&&p===E&&(e.push(0,J,0,F*T,w,-K*T,0,w,0,F*T,w,-K*T,0,J,0,F*a,J,-K*a),M.push(1,.5-J,1-2*T,.5-w,1,.5-w,1-2*T,.5-w,1,.5-J,1-2*a,.5-J));z=l}if(U)for(a=z.x,J=z.y,o=S;E>o;o++)p=o+1,G=o*k,P=p*k,v=O(G),q=f(G),F=O(P),K=f(P),y.push(F*a,J,-K*a,v*a,J,-q*a,0,J,0),Z.push(.5-.5*F,.5+.5*K,.5-.5*v,.5+.5*q,.5,.5)}}),{vs:B,uv:Q,bottom_vs:y,bottom_uv:Z,top_vs:N,top_uv:u,from_vs:_,from_uv:c,to_vs:e,to_uv:M}}},!0),Of(v,{"3d.move.mode":H,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"shape.border.gradient.color":H,"edge.gradient.color":H,"edge.source.t3":H,"edge.target.t3":H,"light.type":Hi,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":g/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":wi,"wf.short":!1,"wf.mat":H,"wf.geometry":!1,batch:H,"transparent.mask":!1,brightness:H,"select.brightness":.7,"repeat.uv.length":H,alphaTest:.4,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","shape3d.vector.dynamic.maxsize":2048,"label.face":uq,"label.t3":H,"label.r3":H,"label.texture.scale":2,"label.rotationMode":bs,"label.light":!1,"label.blend":H,"label.reverse.flip":!1,"label.reverse.color":fs,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":uq,"label2.t3":H,"label2.r3":H,"label2.texture.scale":2,"label2.rotationMode":bs,"label2.light":!1,"label2.blend":H,"label2.reverse.flip":!1,"label2.reverse.color":fs,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":uq,"note.t3":H,"note.r3":H,"note.texture.scale":2,"note.rotationMode":bs,"note.light":!1,"note.blend":H,"note.reverse.flip":!1,"note.reverse.color":fs,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":uq,"note2.t3":H,"note2.r3":H,"note2.texture.scale":2,"note2.rotationMode":bs,"note2.light":!1,"note2.blend":H,"note2.reverse.flip":!1,"note2.reverse.color":fs,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:H,"shape3d.color":Zm,"shape3d.top.color":H,"shape3d.bottom.color":H,"shape3d.from.color":H,"shape3d.to.color":H,"shape3d.image":H,"shape3d.top.image":H,"shape3d.bottom.image":H,"shape3d.from.image":H,"shape3d.to.image":H,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":H,"shape3d.side.to":H,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":H,"shape3d.opacity":H,"shape3d.reverse.flip":!1,"shape3d.reverse.color":fs,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":H,"shape3d.uv.scale":H,"shape3d.top.uv.offset":H,"shape3d.top.uv.scale":H,"shape3d.bottom.uv.offset":H,"shape3d.bottom.uv.scale":H,"shape3d.from.uv.offset":H,"shape3d.from.uv.scale":H,"shape3d.to.uv.offset":H,"shape3d.to.uv.scale":H,"shape3d.top.cap":H,"shape3d.bottom.cap":H,"shape3d.start.angle":0,"shape3d.sweep.angle":W,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":H,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"all.light":!0,"all.visible":!0,"all.color":Zm,"all.image":H,"all.blend":H,"all.opacity":H,"all.reverse.flip":!1,"all.reverse.color":fs,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":H,"all.uv.offset":H,"all.uv.scale":H,"all.discard.selectable":!0,mat:H,"left.mat":H,"right.mat":H,"top.mat":H,"bottom.mat":H,"front.mat":H,"back.mat":H},!0);var Ki,rr=!1,On=[0,0,0,0],Im={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:Mn,2:rj,3:yo,4:Fl,5:uq,6:gh}},Up=function(f,c,w,C){if(c.getFaceVisible(f,w)){ir(c,gq(f,c.getFaceMat(f,w)||c.getMat(f)));var o=c._26I;c.getFaceReverseCull(f,w)?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),ti(o,c._prg.uFixPickReverseColor,Im[w]),mk(o),Jk(o,C,6),gg(o),xi(c)}},Tg=function(l){return l instanceof fe},po=function(N){return[N.x,N.e||0,N.y]},lr=function(a,U,T){for(var U=nb(U),n=U[0],i=U[1],Y=U[2];T--;)a.push(n,i,Y)},Wl=function(Q,s,u){for(var s=nb(s),X=s[0],t=s[1],H=s[2],y=s[3];u--;)Q.push(X,t,H,y)},dk=function(U,C,d){if(C)for(var I,K,s,E=C[0],Y=C[1],o=C[2],r=C[4],k=C[5],L=C[6],p=C[8],D=C[9],e=C[10],g=C[12],m=C[13],t=C[14],u=d.length,w=0,w=0;u>w;w+=3)I=d[w],K=d[w+1],s=d[w+2],U.push(E*I+r*K+p*s+g,Y*I+k*K+D*s+m,o*I+L*K+e*s+t);else Vc(U,d)},To=function(x,W){var B=W.s("light.intensity"),r=nb(W.s(ql)),G=r[0],n=r[1],u=r[2];1!==B&&(G*=B,n*=B,u*=B),x.push(G,n,u,W.s("light.disabled")?1:0)},Hc=function(B,z,c){ti(z,c.uHeadlightRange,B._headlightRange);var C=B._headlightIntensity,l=nb(B._headlightColor);1!==C&&(l=[l[0]*C,l[1]*C,l[2]*C]),ti(z,c.uHeadlightColor,[l[0],l[1],l[2],B._headlightDisabled?1:0]);var N=B._59O,E=B._spots,D=B._dirs;if(N.length){var s=[],X=[],v=[];N.forEach(function(T){To(s,T),Vc(X,B._transformPointToViewSpace(T.p3())),v.push(T.s("light.range"))}),z.uniform4fv(c.uPointColor,s),z.uniform1fv(c.uPointRange,v),z.uniform3fv(c.uPointPosition,X)}if(E.length){var m=[],Q=[],e=[],u=[],T=[],k=[];E.forEach(function(Y){To(m,Y),Vc(Q,B._transformPointToViewSpace(Y.p3())),Vc(T,B._transformDirectionToViewSpace(Y.p3(),Y.s("light.center"))),e.push(Y.s("light.range")),u.push(O(Y.s("light.angle")/2)),k.push(Y.s("light.exponent"))}),z.uniform4fv(c.uSpotColor,m),z.uniform1fv(c.uSpotRange,e),z.uniform1fv(c.uSpotAngle,u),z.uniform1fv(c.uSpotExponent,k),z.uniform3fv(c.uSpotPosition,Q),z.uniform3fv(c.uSpotDirection,T)}if(D.length){var J=[],$=[];D.forEach(function(i){To(J,i),Vc($,B._transformDirectionToViewSpace(i.p3()))}),z.uniform4fv(c.uDirColor,J),z.uniform3fv(c.uDirDirection,$)}},gl=function(l){return l>0&&0===(l-1&l)},Tk=function(f){return f=o(0,N(g,f)),f=o(An,N(g-An,f))},Ur=function(){return.05+l()/2},Bi=function(H,Q,u,N){var G,Z=H.getEye();return H.isOrtho()?(G=Ip(H.getCenter(),Z),G[0]+=N[0],G[1]+=N[1],G[2]+=N[2]):G=Z,_l(Q,u,N,G)},_l=function(i,z,Q,v){var O=Xh(i,z),n=Ip(v,Q,!0),S=Xh(n,z);if(J(S)<An)return I;var f=(O-Xh(Q,z))/S;return[Q[0]+n[0]*f,Q[1]+n[1]*f,Q[2]+n[2]*f]},Fh=function(q,G){return{x:2*q.x-G.x,y:2*q.y-G.y}},ui=function(v,g,d,x){var T,h;if(!v)return T=B(g.y-d.y,d.x-g.x),{x:g.x+x*f(T),y:g.y+x*O(T)};if(!d)return T=B(v.y-g.y,g.x-v.x),{x:g.x+x*f(T),y:g.y+x*O(T)};var L=Ip([v.x,v.y,0],[g.x,g.y,0],!0),G=Ip([d.x,d.y,0],[g.x,g.y,0],!0),s=-(L[0]+G[0])/2,q=-(L[1]+G[1])/2,j=p(s*s+q*q);if(An>j)return T=B(v.y-g.y,g.x-v.x),{x:g.x+x*f(T),y:g.y+x*O(T)};var M=v.x-g.x,H=v.y-g.y,V=d.x-g.x,F=d.y-g.y,e=p(M*M+H*H),W=p(V*V+F*F);T=a(Xh(L,G))/2,h=L[1]*G[0]-L[0]*G[1]>0?-1:1,s/=j,q/=j;var r=x/f(T),b=o(e,W)/O(T);j=Math.min(r,b);var D={x:g.x+h*j*s,y:g.y+h*j*q};return d.b&&r>W/O(T)&&(D.adjust=!0),D},Gi=function(x){var p=x[1],Z=x[2],L=x[3],D=x[6],r=x[7],h=x[11];x[1]=x[4],x[2]=x[8],x[3]=x[12],x[4]=p,x[6]=x[9],x[7]=x[13],x[8]=Z,x[9]=D,x[11]=x[14],x[12]=L,x[13]=r,x[14]=h},Nc=function(u){var j=u[0],F=u[1],R=u[2],k=u[3],e=u[4],w=u[5],A=u[6],V=u[7],y=u[8],N=u[9],c=u[10],f=u[11],J=u[12],g=u[13],K=u[14],h=u[15],U=j*w-F*e,d=j*A-R*e,H=j*V-k*e,x=F*A-R*w,Z=F*V-k*w,m=R*V-k*A,T=y*g-N*J,q=y*K-c*J,t=y*h-f*J,X=N*K-c*g,D=N*h-f*g,_=c*h-f*K,Y=U*_-d*D+H*X+x*t-Z*q+m*T;return Y?(Y=1/Y,u[0]=(w*_-A*D+V*X)*Y,u[1]=(R*D-F*_-k*X)*Y,u[2]=(g*m-K*Z+h*x)*Y,u[3]=(c*Z-N*m-f*x)*Y,u[4]=(A*t-e*_-V*q)*Y,u[5]=(j*_-R*t+k*q)*Y,u[6]=(K*H-J*m-h*d)*Y,u[7]=(y*m-c*H+f*d)*Y,u[8]=(e*D-w*t+V*T)*Y,u[9]=(F*t-j*D-k*T)*Y,u[10]=(J*Z-g*H+h*U)*Y,u[11]=(N*H-y*Z-f*U)*Y,u[12]=(w*q-e*X-A*T)*Y,u[13]=(j*X-F*q+R*T)*Y,u[14]=(g*d-J*x-K*U)*Y,u[15]=(y*x-N*d+c*U)*Y,void 0):I},Le=function(L,R){if(R){var S=R[0],g=R[1],u=R[2];L[12]=L[0]*S+L[4]*g+L[8]*u+L[12],L[13]=L[1]*S+L[5]*g+L[9]*u+L[13],L[14]=L[2]*S+L[6]*g+L[10]*u+L[14],L[15]=L[3]*S+L[7]*g+L[11]*u+L[15]}},In=function(R,b){if(b){var i=b[0],m=b[1],n=b[2];R[0]=R[0]*i,R[1]=R[1]*i,R[2]=R[2]*i,R[3]=R[3]*i,R[4]=R[4]*m,R[5]=R[5]*m,R[6]=R[6]*m,R[7]=R[7]*m,R[8]=R[8]*n,R[9]=R[9]*n,R[10]=R[10]*n,R[11]=R[11]*n}},Fc=function(o,L,M){var p=L[0],r=L[1],s=L[2],v=L[3],a=L[4],d=L[5],O=L[6],n=L[7],R=L[8],Y=L[9],h=L[10],A=L[11],w=L[12],$=L[13],U=L[14],x=L[15],i=M[0],f=M[1],y=M[2],B=M[3];return o[0]=i*p+f*a+y*R+B*w,o[1]=i*r+f*d+y*Y+B*$,o[2]=i*s+f*O+y*h+B*U,o[3]=i*v+f*n+y*A+B*x,i=M[4],f=M[5],y=M[6],B=M[7],o[4]=i*p+f*a+y*R+B*w,o[5]=i*r+f*d+y*Y+B*$,o[6]=i*s+f*O+y*h+B*U,o[7]=i*v+f*n+y*A+B*x,i=M[8],f=M[9],y=M[10],B=M[11],o[8]=i*p+f*a+y*R+B*w,o[9]=i*r+f*d+y*Y+B*$,o[10]=i*s+f*O+y*h+B*U,o[11]=i*v+f*n+y*A+B*x,i=M[12],f=M[13],y=M[14],B=M[15],o[12]=i*p+f*a+y*R+B*w,o[13]=i*r+f*d+y*Y+B*$,o[14]=i*s+f*O+y*h+B*U,o[15]=i*v+f*n+y*A+B*x,o},ck=function(b,X,F,g){var i,T,_,c,K,s,R,Q,x,r,f=X[0],n=X[1],L=X[2],U=g[0],N=g[1],d=g[2],l=F[0],v=F[1],P=F[2];return J(f-l)<An&&J(n-v)<An&&J(L-P)<An?wp(b):(R=f-l,Q=n-v,x=L-P,r=1/p(R*R+Q*Q+x*x),R*=r,Q*=r,x*=r,i=N*x-d*Q,T=d*R-U*x,_=U*Q-N*R,r=p(i*i+T*T+_*_),r?(r=1/r,i*=r,T*=r,_*=r):(i=0,T=0,_=0),c=Q*_-x*T,K=x*i-R*_,s=R*T-Q*i,r=p(c*c+K*K+s*s),r?(r=1/r,c*=r,K*=r,s*=r):(c=0,K=0,s=0),b[0]=i,b[1]=c,b[2]=R,b[3]=0,b[4]=T,b[5]=K,b[6]=Q,b[7]=0,b[8]=_,b[9]=s,b[10]=x,b[11]=0,b[12]=-(i*f+T*n+_*L),b[13]=-(c*f+K*n+s*L),b[14]=-(R*f+Q*n+x*L),b[15]=1,b)},Eb=function(K,R,y,U,J){var g=1/V(R/2),q=1/(U-J);return K[0]=g/y,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=g,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=(J+U)*q,K[11]=-1,K[12]=0,K[13]=0,K[14]=2*J*U*q,K[15]=0,K},Mg=function(A,F,h,W,w,j,k){var T=1/(F-h),$=1/(W-w),Y=1/(j-k);return A[0]=-2*T,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*$,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*Y,A[11]=0,A[12]=(F+h)*T,A[13]=(w+W)*$,A[14]=(k+j)*Y,A[15]=1,A},bm=function(C,j){var I=j[0],J=j[1],T=j[2],K=j[3],x=I*I+J*J+T*T+K*K,e=x?1/x:0;return C[0]=-I*e,C[1]=-J*e,C[2]=-T*e,C[3]=K*e,C},mp=function(h,Q){var G=Q[0]+Q[5]+Q[10],H=0;return G>0?(H=2*Math.sqrt(G+1),h[3]=.25*H,h[0]=(Q[6]-Q[9])/H,h[1]=(Q[8]-Q[2])/H,h[2]=(Q[1]-Q[4])/H):Q[0]>Q[5]&Q[0]>Q[10]?(H=2*Math.sqrt(1+Q[0]-Q[5]-Q[10]),h[3]=(Q[6]-Q[9])/H,h[0]=.25*H,h[1]=(Q[1]+Q[4])/H,h[2]=(Q[8]+Q[2])/H):Q[5]>Q[10]?(H=2*Math.sqrt(1+Q[5]-Q[0]-Q[10]),h[3]=(Q[8]-Q[2])/H,h[0]=(Q[1]+Q[4])/H,h[1]=.25*H,h[2]=(Q[6]+Q[9])/H):(H=2*Math.sqrt(1+Q[10]-Q[0]-Q[5]),h[3]=(Q[1]-Q[4])/H,h[0]=(Q[8]+Q[2])/H,h[1]=(Q[6]+Q[9])/H,h[2]=.25*H),h},ve=function(y,H,T){var i=H[0],R=H[1],v=H[2],t=H[3],c=i+i,Z=R+R,F=v+v,V=i*c,I=i*Z,M=i*F,g=R*Z,Y=R*F,J=v*F,S=t*c,O=t*Z,p=t*F;return y[0]=1-(g+J),y[1]=I+p,y[2]=M-O,y[3]=0,y[4]=I-p,y[5]=1-(V+J),y[6]=Y+S,y[7]=0,y[8]=M+O,y[9]=Y-S,y[10]=1-(V+g),y[11]=0,y[12]=T[0],y[13]=T[1],y[14]=T[2],y[15]=1,y},Hf=function(){var w=[0,0,0],$=[0,0,0],m=[0,0,0],L=function(u,J,T){u[0]=J[1]*T[2]-J[2]*T[1],u[1]=J[2]*T[0]-J[0]*T[2],u[2]=J[0]*T[1]-J[1]*T[0]},B=function(S){return S[0]*S[0]+S[1]*S[1]+S[2]*S[2]},O=function(Q){var g=Math.sqrt(B(Q));Q[0]/=g,Q[1]/=g,Q[2]/=g},y=function(N,n,k){N[0]=n[0]-k[0],N[1]=n[1]-k[1],N[2]=n[2]-k[2]};return function(r,k,o){var l=Fn();return y(m,r,k),0===B(m)&&(m[2]=1),O(m),L(w,o,m),0===B(w)&&(1===Math.abs(o[2])?m[0]+=1e-4:m[2]+=1e-4,O(m),L(w,o,m)),O(w),L($,m,w),l[0]=w[0],l[4]=$[0],l[8]=m[0],l[1]=w[1],l[5]=$[1],l[9]=m[1],l[2]=w[2],l[6]=$[2],l[10]=m[2],l}}(),tr=function(N,S){if(N.vr.enable){var u=N.vr.getViewMatrix(S);if(u)return u}return ck(S?S:Fn(),N._eye,N._center,N._up)},Br=function(b){if(b.vr.enable){var $=b.vr.getProjectMatrix();if($)return $}var f=b.getAspect(),W=b._near,Z=b._far,e=Fn();if(b._ortho){var S=b._orthoWidth/2,Y=S/f;Mg(e,-S,S,-Y,Y,W,Z)}else Eb(e,b._fovy,f,W,Z);return e},Ug=function(N,r){if(!N)return I;var C=0,T=1,J=2,Y=[],V=0,O=N.length,b=O/3;if(r){for(;O>V;V++)Y[V]=0;for(V=0;V<r.length;V+=3){var G=[],H=[],P=[];G[C]=N[3*r[V+1]+C]-N[3*r[V]+C],G[T]=N[3*r[V+1]+T]-N[3*r[V]+T],G[J]=N[3*r[V+1]+J]-N[3*r[V]+J],H[C]=N[3*r[V+2]+C]-N[3*r[V+1]+C],H[T]=N[3*r[V+2]+T]-N[3*r[V+1]+T],H[J]=N[3*r[V+2]+J]-N[3*r[V+1]+J],P[C]=G[T]*H[J]-G[J]*H[T],P[T]=G[J]*H[C]-G[C]*H[J],P[J]=G[C]*H[T]-G[T]*H[C];for(var t=0;3>t;t++)Y[3*r[V+t]+C]+=P[C],Y[3*r[V+t]+T]+=P[T],Y[3*r[V+t]+J]+=P[J]}}else for(V=0;b>V;V+=3){var G=[],H=[],P=[];G[C]=N[3*(V+1)+C]-N[3*V+C],G[T]=N[3*(V+1)+T]-N[3*V+T],G[J]=N[3*(V+1)+J]-N[3*V+J],H[C]=N[3*(V+2)+C]-N[3*(V+1)+C],H[T]=N[3*(V+2)+T]-N[3*(V+1)+T],H[J]=N[3*(V+2)+J]-N[3*(V+1)+J],P[C]=G[T]*H[J]-G[J]*H[T],P[T]=G[J]*H[C]-G[C]*H[J],P[J]=G[C]*H[T]-G[T]*H[C];for(var t=0;3>t;t++)Y[3*(V+t)+C]=P[C],Y[3*(V+t)+T]=P[T],Y[3*(V+t)+J]=P[J]}for(V=0;O>V;V+=3){var q=[];q[C]=Y[V+C],q[T]=Y[V+T],q[J]=Y[V+J];var n=p(q[C]*q[C]+q[T]*q[T]+q[J]*q[J]);0===n&&(n=An),q[C]=q[C]/n,q[T]=q[T]/n,q[J]=q[J]/n,Y[V+C]=q[C],Y[V+T]=q[T],Y[V+J]=q[J]}return new kj(Y)},jg=function(E,D,w,x){if(w||(w=E.createTexture()),D){var p=E.TEXTURE_2D,b=E.REPEAT,e=E.CLAMP_TO_EDGE,a=E.TEXTURE_MIN_FILTER;x!==E.NEAREST&&(x=E.LINEAR),xk(E,w),E.texImage2D(p,0,E.RGBA,E.RGBA,E.UNSIGNED_BYTE,D),cd(E,E.TEXTURE_MAG_FILTER,x);var O=D.naturalWidth||D.width,Q=D.naturalHeight||D.height;gl(O)&&gl(Q)&&!D.clampToEdge?(cd(E,E.TEXTURE_WRAP_S,b),cd(E,E.TEXTURE_WRAP_T,b),cd(E,a,E.LINEAR_MIPMAP_LINEAR),E.generateMipmap(p)):(cd(E,E.TEXTURE_WRAP_S,e),cd(E,E.TEXTURE_WRAP_T,e),cd(E,a,x)),xk(E,I)}return w},ie=function(C,q){var Q=new Uint8Array(3);return q=q||C.createTexture(),xk(C,q),cd(C,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texImage2D(C.TEXTURE_2D,0,C.RGB,1,1,0,C.RGB,C.UNSIGNED_BYTE,Q),q},Ar=function(Z){Z._26I&&Z._prg&&(Z._26I.deleteProgram(Z._prg),Z._prg=I)},Te=function(h,H,Y,p){var W=h.createShader(Y);return h.shaderSource(W,p),h.compileShader(W),h.attachShader(H,W),W},de=function(P){return P.createBuffer()},xk=function(Y,q){Y.bindTexture(Y.TEXTURE_2D,q)},is=function(m,V){m.bindFramebuffer(m.FRAMEBUFFER,V)},cd=function(B,T,$){B.texParameteri(B.TEXTURE_2D,T,$)},_r=function(C,R){C.enable(C.POLYGON_OFFSET_FILL),C.polygonOffset(R[0],R[1])},Hl=function(m){m.disable(m.POLYGON_OFFSET_FILL)},_f=function(h,I){if(I){var I=nb(I);h.clearColor(I[0],I[1],I[2],I[3])}},Ij=function(P,N){ti(P,N.uFix,!0),lq(P,N.aNormal)},Xg=function(s,v){ti(s,v.uFix,!1),fo(s,v.aNormal)},Jm=function(z,R,Z,A,D,v,T,M){z._picking||(Z?(ti(z,R.uBlend,!0),ti(z,R.uBlendColor,Z)):ti(z,R.uBlend,!1),ti(z,R.uLight,A==I?!0:A),df(D)&&1!==D&&ti(z,R.uPartOpacity,D),ti(z,R.uReverseFlip,v==I?!1:v),ti(z,R.uFixPickReverseColor,T||fs)),M?z.enable(z.CULL_FACE):z.disable(z.CULL_FACE)},hl=function(M,I){M._picking||ti(M,I.uPartOpacity,1)},mk=function(k,D,C,p,h,G,W,Q,q){if(!C)return k.activeTexture(k.TEXTURE0),xk(k,k._emptyTexture),k.activeTexture(k.TEXTURE1),xk(k,k._emptyBlendTexture),void 0;ti(k,D.uTexture,!0),ti(k,D.uDiscardSelectable,Ro(p)?p:!0),fo(k,D.aUv),Bm(k,h,G,D.aUv,2),q?(ti(k,D.uBlendTexture,!0),k.activeTexture(k.TEXTURE1),xk(k,q),k.uniform1i(D.uBlendSampler,1)):(ti(k,D.uBlendTexture,!1),k.activeTexture(k.TEXTURE1),xk(k,k._emptyBlendTexture)),k.activeTexture(k.TEXTURE0),xk(k,C),k.uniform1i(D.uSampler,0);var t=[0,0,1,1];W&&(t[0]=W[0],t[1]=W[1]),Q&&(t[2]=Q[0],t[3]=Q[1]),ti(k,D.uOffsetScale,t)},gg=function(t,f,l){t.activeTexture(t.TEXTURE0),xk(t,I),t.activeTexture(t.TEXTURE1),xk(t,I),l&&(lq(t,f.aUv),ti(t,f.uTexture,!1),ti(t,f.uBlendTexture,!1))},hg=function(B,R,i,P,Z,u){!i||E||Hm||B.lineWidth(i),P&&!B._picking&&ti(B,R.uFixPickReverseColor,P),Z&&Bm(B,Z,u,R.aPosition)},cr=function(z,Q,e,V){Ki&&(V=z[Ki]),z.drawArrays(V==I?z.TRIANGLES:V,Q,e);var U=z._renderInfo;U&&(U.calls++,U.vertices+=e,(V==I||V===z.TRIANGLES)&&(U.faces+=e/3),V===z.LINES&&(U.lines+=e/2))},Jk=function(H,w,A,v){Ki&&(v=H[Ki]),H.drawElements(v==I?H.TRIANGLES:v,A,H.UNSIGNED_SHORT,w==I?0:2*w);var V=H._renderInfo;V&&(V.calls++,V.vertices+=A,(v==I||v===H.TRIANGLES)&&(V.faces+=A/3),v===H.LINES&&(V.lines+=A/2))},Cl=function(B,l,b,Q,s){var o=B.ARRAY_BUFFER;B.bindBuffer(o,l),b&&B.bufferData(o,b,B.STATIC_DRAW),Q!=I&&B.vertexAttribPointer(Q,s?s:3,B.FLOAT,!1,0,0)},Bm=function(T,t,_,l,u){return _?(Vn(T,T.ARRAY_BUFFER,t,_),l!=I&&T.vertexAttribPointer(l,u?u:3,T.FLOAT,!1,0,0),void 0):Cl(T,t,_,l,u)},dl=function(C,p,g){var s=C.ELEMENT_ARRAY_BUFFER;C.bindBuffer(s,p),g&&C.bufferData(s,g,C.STATIC_DRAW)},dd=function(i,y,T){Vn(i,i.ELEMENT_ARRAY_BUFFER,y,T)},Vn=function(F,B,W,w){var P=w._bufId;P||(P=w._bufId=j.Math.generateIncreasingID());var W,z=F._bufPool;(W=z[P])&&W._buf?F.bindBuffer(B,W._buf):(W=z[P]={_buf:de(F)},F.bindBuffer(B,W._buf),F.bufferData(B,w,F.STATIC_DRAW)),W._fid=F._renderInfo.frame},ti=function(B,f,K){if(K!=I&&f!=I){K=nb(K);var g=K.length;3===g?B.uniform3fv(f,K):4===g?B.uniform4fv(f,K):16===g?B.uniformMatrix4fv(f,!1,K):Ro(K)?B.uniform1i(f,K?1:0):2===g?B.uniform2fv(f,K):B.uniform1f(f,K)}},fo=function(H,j){j!=I&&j>=0&&H.enableVertexAttribArray(j)},lq=function(F,i){i!=I&&i>=0&&F.disableVertexAttribArray(i)},xi=function(z,M){var t=z.getGL(),N=z._prg;z._7O=z._8O.pop(),M&&(ti(t,N.uMVMatrix,z._7O),z._6O=M,ti(t,N.uNMatrix,M))},Ob=function(F,i){return i||(i=Fn()),$q(i,F),Nc(i),Gi(i),i},ir=function(K,m){var B=K.getGL(),$=K._prg,s=K._7O;m&&(K._8O.push(Lc(s)),ti(B,$.uMMatrix,m),Fc(s,s,m),K._7O=s),ti(B,$.uMVMatrix,s),ti(B,$.uNMatrix,Ob(s,K._6O))},tq=function(h,s,F,t,J,S){if(F){if(t){var j=F.value++,o=2147483648|j,N=[(255&o>>16)/255,(255&o>>8)/255,(255&o)/255,(255&o>>24)/255];F[j]={data:J,part:S}}else N=On;return ti(h,s.uFixPickReverseColor,N),N}},Rj=function(){var w={center:function(G,x,D,j,E){var K=-x[1]/2,z={x:-x[0]/2,y:K,width:x[0],height:x[1]},k=Xp(G,z,D);return[k.x+j,-k.y-E,Ur()]},front:function(V,S,L,P,E){var I=-S[1]/2,W={x:-S[0]/2,y:I,width:S[0],height:S[1]},D=Xp(V,W,L);return[D.x+P,-D.y-E,S[2]/2+Ur()]},back:function(I,b,d,C,H){var $=-b[0]/2,j=-b[1]/2,z={x:$,y:j,width:b[0],height:b[1]},v=Xp(I,z,d);return[-v.x-C,-v.y-H,-b[2]/2-Ur()]},left:function(W,Z,t,g,y){var R=-Z[1]/2,v={x:-Z[2]/2,y:R,width:Z[2],height:Z[1]},q=Xp(W,v,t);return[-Z[0]/2-Ur(),-q.y-y,q.x+g]},right:function(L,a,u,p,I){var z=-a[2]/2,$=-a[1]/2,U={x:z,y:$,width:a[2],height:a[1]},d=Xp(L,U,u);return[a[0]/2+Ur(),-d.y-I,-d.x-p]},top:function(J,V,x,K,l){var M={x:-V[0]/2,y:-V[2]/2,width:V[0],height:V[2]},k=Xp(J,M,x);return[k.x+K,V[1]/2+Ur(),k.y+l]},bottom:function(P,B,f,H,M){var Y=-B[2]/2,h={x:-B[0]/2,y:Y,width:B[0],height:B[2]},X=Xp(P,h,f);return[X.x+H,-B[1]/2-Ur(),-X.y-M]}};return function(L,z,i,J,H,Z){return w[J](L,z,i,H||0,Z||0)}}(),Aj=function(T,M,z,n,o,U,D,X,Z,O){if(o&&(M[0]+=o[0],M[1]+=o[1],M[2]+=o[2]),Le(T,z),X){var w=Fn();if(us(w,Z,O),Ph(M,w),Le(T,M),T.auto=X,T.pos=Ph([0,0,0],T),U){var h=T.mat2=Fn();us(h,U,D)}}else us(T,Z,O),Le(T,M),n===Mn?Oq(T,-S):n===rj?Oq(T,S):n===yo?Zi(T,-S):n===Fl?Zi(T,S):n===gh&&Oq(T,g),us(T,U,D);return T},Tb=function(d,O){var F=O.auto,j=O.mat2,R=d.gv;if(F){var B,C=Fn(),S=[0,0,0,0];B="string"==typeof F?[F.indexOf("x")<0?R._eye[0]:R._center[0],F.indexOf("y")<0?R._eye[1]:R._center[1],F.indexOf("z")<0?R._eye[2]:R._center[2]]:R._eye,mp(S,ck(Fn(),B,R._center,R._up)),ve(C,bm(S,S),O.pos),j&&Fc(C,C,j),ir(R,C)}else ir(R,O)},Mr=function(S,P,H,e,F){var x=S.s,B=S.gv,C=B.getGL(),i=B._prg,m=B._buffer,G=B._1O;jg(C,Kj,G),Tb(S,H),Jm(C,i,x(P+".blend"),x(P+".light"),x(P+".opacity"),x(P+".reverse.flip"),x(P+".reverse.color"),x(P+".reverse.cull")),mk(C,i,G,F,m.uv,Jj),Bm(C,m.vs,e,i.aPosition),Bm(C,m.ns,Xm,i.aNormal),dd(C,m.is,Rh),Jk(C,0,Rh.length),gg(C,i,G),hl(C,i),xi(B)},fj=function(M,T,P){var F=M.gv,h=M.data,$=M[T]={blend:F.getBodyColor(h)||F.getFaceBlend(h,T),light:F.getFaceLight(h,T),color:F.getFaceColor(h,T),opacity:F.getFaceOpacity(h,T),transparent:F.getFaceTransparent(h,T),reverseFlip:F.getFaceReverseFlip(h,T),reverseColor:F.getFaceReverseColor(h,T),reverseCull:F.getFaceReverseCull(h,T),texture:F.getFaceImage(h,T),blendTexture:F.getFaceBlendImage(h,T),discardSelectable:F.getFaceDiscardSelectable(h,T)};if("csg"!==T){$.uv=F.getFaceUv(h,T)||P&&P[T+"Uv"],$.uvScale=F.getFaceUvScale(h,T)||P&&P[T+"UvScale"],$.uvOffset=F.getFaceUvOffset(h,T)||P&&P[T+"UvOffset"];var S=F.getFaceMat(h,T);S&&($.mat=gq(h,S))}return $},No=function(Q,Z,z,B,Y){if(B){if(!Y(B.transparent))return;var T=Q.data,I=Q.gv,d=I._buffer,p=I.getTexture(B.texture,T),O=I.getTexture(B.blendTexture,T);mk(Z,z,p,B.discardSelectable,d.uv,B.tuv,B.uvOffset,B.uvScale,O),Jm(Z,z,B.blend,B.light,B.opacity,B.reverseFlip,B.reverseColor,B.reverseCull),ti(Z,z.uDiffuse,B.color),Bm(Z,d.vs,B.vs,z.aPosition),Bm(Z,d.ns,B.ns,z.aNormal),cr(Z,0,B.vs.length/3),hl(Z,z),gg(Z,z,p)}},Ff=function(u,L,l,I,D,U){var f,t,Y,$,J,i,m,A,z,k,E,w=[I-L,D-l],V=u?u.length:0;for(Y=0;V>Y;Y++){for($=2,f=u[Y],J=f[0],i=f[1];$+1<f.length;){if(m=f[$],A=f[$+1],t=Uc(L,l,I,D,J,i,m,A,!0)){z=[m-J,A-i],k=em(z),z[0]/=k,z[1]/=k,k=Xh(w,z),k=k>0?U:-U,E=[z[0]*k,z[1]*k];break}J=m,i=A,$+=2}if(E)break}if(E)for(I=L+E[0],D=l+E[1],Y=0;V>Y;Y++)for($=2,f=u[Y],J=f[0],i=f[1];$+1<f.length;){if(m=f[$],A=f[$+1],t=Uc(L,l,I,D,J,i,m,A,!0))return[0,0];J=m,i=A,$+=2}return E?E:[I-L,D-l]},Uq=j.graph3d={},so=function(b,H,p){ab(t+".graph3d."+b,H,p)},Mk="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",Ig="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-6/1!,!6/1!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~<spmpd!>!eJ|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw<*yfusfWw.)f{jmbnspo!>!F!4dfw<*mbnspOw)f{jmbnspo!>!O!4dfw!gjeof$!<ftvggjEv!>!spmpd!ftmf$!~<ftvggjEv!>!spmpd|ftmf~<spmpDidubCw!>!spmpd|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!<spmpd!5dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";Of(h,{setBatchInfo:function(W,g){Vj[W]=g},getBatchInfo:function(m){return Vj[m]}},!0);var If=[1,1,1],Kd=[1,0,0,0,0,1,0,1,1,1,1,0],_b=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],Hg=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],Jo=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],dg=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],Fd=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],of=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],bn=function(R,v){qo(R,v,"_batchModelMap","_batchIndexMap"),eo(R,v,"_wireframeModelMap","_wireframeIndexMap"),eo(R,v,"_polylineModelMap","_polylineIndexMap"),eo(R,v,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),eo(R,v,"_polylineModelMapSwap","_polylineIndexMapSwap")},qo=function(k,h,x,f){if(!h)return k[x]={},k[f]={},void 0;var V=h._id,M=k[f],S=M[V];if(S){var C=k[x],r=S.batch,w=C[r],X=w.ds,W=S.index;if(w.invalidate=!0,delete M[V],X.splice(W,1),il(X))return delete C[r],void 0;for(var o=S.begin,i=S.size,p=3*o,l=3*i,E=4*o,m=4*i,A=w.vs,c=w.ps,D=w.uv,v=w.cs,O=w.bs,_=w.rs,g=w.ns,q=w.ls;W<X.length;W++)S=M[X[W]._id],S.index--,S.begin-=i;A.splice(p,l),c.splice(E,m),D&&D.splice(2*o,2*i),v&&v.splice(E,m),O&&O.splice(p,l),_&&_.splice(o,i),g&&g.splice(p,l),q&&q.splice(o,i)
}},eo=qo,Zo=function(j,C,g,e){if(!e)return I;var p=C[e];if(!p){var W=Vj[e]||Cf,U=W.image?[]:I;p=C[e]={vs:[],ns:[],uv:U,cs:U?I:W.color?I:[],bs:W.blend?[]:I,ps:[],rs:W.brightness?[]:I,ds:[]}}return p.invalidate=!0,j[g._id]={index:p.ds.length,begin:p.vs.length/3,batch:e},p.ds.push(g),p},Hj=function(U,m){return m!=I&&1!==m?[U[0]*m,U[1]*m,U[2]*m,U[3]]:U},pn=function(v,u,Z){var p=v.getBrightness(u),c=nb(Z.color||"white"),l=c[3]<1,i=Math.ceil(Z.width)||1,Y=(l?"T":"O")+i,O=v._wireframeIndexMap,$=v._wireframeModelMap,f=$[Y];f||(f=$[Y]={vs:[],cs:[],ps:[],ds:[],T:l,W:i});var k,T=v.getData3dUI(u),C=ed(T);if(Z.geometry){if(!C)return;if(k=hq(C),!k)return}else k=Z.short?Jh:og;f.invalidate=!0;var j=f.vs,G=f.cs,A=f.ds,X=O[u._id]={index:A.length,begin:j.length/3,batch:Y};A.push(u);var r=gq(u,Z.mat),y=T._calcAnchorMat(u);y&&Fc(r,r,y),dk(j,r,k);var g=X.size=j.length/3-X.begin;Wl(G,Hj(c,p),g)},qb=function(U,x,o,V,d,p,A,w,c){var P=U.getBrightness(x);P==I&&(P=1);var b=Hj(nb(V),P),T=b[3]<1;p=Math.ceil(p)||1;var Q=(T?"T":"O")+p;if(A){var z=A[0],E=(A[1]||z)+z;Q+="-"+z+"-"+E,c&&(Q+="-"+Rg(c)+"-"+P,c=Hj(nb(c),P))}var j=U._polylineIndexMap,e=U._polylineModelMap,B=e[Q];B||(B=e[Q]={vs:[],cs:[],ps:[],ds:[],ls:A?[]:I,T:T,W:p},A&&(B.D=z,B.G=E,B.A=c)),B.invalidate=!0;var O,S=B.vs,n=B.cs,q=B.ds,K=B.ls,f=j[x._id]={index:q.length,begin:S.length/3,batch:Q};q.push(x),Vc(S,o);var y,N=f.size=S.length/3-f.begin,u=o.length,F=0,H=[];if(A||d)for(O=0;u>O;O+=6)y=em([o[O],o[O+1],o[O+2]],[o[O+3],o[O+4],o[O+5]]),H.push(y),F+=y;if(F&&d){var G,Z=Hj(nb(d),P),s=[Z[0]-b[0],Z[1]-b[1],Z[2]-b[2],Z[3]-b[3]],$=0;for(O=0;u>O;O+=6)G=$/F,Wl(n,[b[0]+s[0]*G,b[1]+s[1]*G,b[2]+s[2]*G,b[3]+s[3]*G],1),$+=H[O/6],G=$/F,Wl(n,[b[0]+s[0]*G,b[1]+s[1]*G,b[2]+s[2]*G,b[3]+s[3]*G],1)}else Wl(n,b,N);if(A)for($=w||0,O=0;u>O;O+=6)K.push($),$+=H[O/6],K.push($)},zi=function(w,k,b){if(k)for(var e=4*k.begin,Q=b[k.batch].ps,V=0;V<k.size;V++)Q[e++]=w[0],Q[e++]=w[1],Q[e++]=w[2],Q[e++]=w[3]},Yn=function(z,s){var n=s+["32"],M=z[s],K=z[n];M?K&&K.length===M.length?(K.set(M),K._bufId=null):z[n]=new kj(M):delete z[n]},Fe=function(J,s,v,Z,t,k,Q,y,l){if(Ck(v))v.forEach(function($){Fe(J,s,$,Z,t,k,Q,y,l)});else if(_e(v))Fe(J,s,ed(Z,v),Z,t,k,Q,y,l);else if(Lg(v)){var C,c=oh(v.mat,s,J),b=oh(v.s3,s,J),O=oh(v.t3,s,J),p=oh(v.r3,s,J);if((b||p||O||c)&&(C=Dq(c,b,p,oh(v.rotationMode,s,J),O),k.push(C)),v.shape3d)Fe(J,s,v.shape3d,Z,t,k,Q,y,v);else{var o=Z.s;l=l||Cf;var W=k[0],R=k.length,d=o("shape3d.color",v.color,l.color);if(t||(t=o("shape3d.blend",v.blend,l.blend)),R>1){W=Lc(W);for(var N=1;R>N;N++)Fc(W,W,k[N])}v.vs&&o(Li,v.visible,l.visible)&&Ng(W,Q,y,v.vs,v.uv,v.is,t,d),v.top_vs&&o(js,v.topVisible,l.topVisible)&&Ng(W,Q,y,v.top_vs,v.top_uv,v.top_is,t,o("shape3d.top.color",v.topColor,l.topColor)||d),v.bottom_vs&&o(kd,v.bottomVisible,l.bottomVisible)&&Ng(W,Q,y,v.bottom_vs,v.bottom_uv,v.bottom_is,t,o("shape3d.bottom.color",v.bottomColor,l.bottomColor)||d),v.from_vs&&o(Bl,v.fromVisible,l.fromVisible)&&Ng(W,Q,y,v.from_vs,v.from_uv,v.from_is,t,o("shape3d.from.color",v.fromColor,l.fromColor)||d),v.to_vs&&o(Hk,v.toVisible,l.toVisible)&&Ng(W,Q,y,v.to_vs,v.to_uv,v.to_is,t,o("shape3d.to.color",v.toColor,l.toColor)||d)}C&&k.pop()}},Ng=function(I,y,R,P,x,D,e,$){var g,T=y.cs,o=y.uv,Z=y.bs;if(D){g=D.length;for(var G=0;g>G;G++){var X=D[G];dk(R,I,[P[3*X],P[3*X+1],P[3*X+2]]),o&&Vc(o,[x[2*X],x[2*X+1]])}}else g=P.length/3,dk(R,I,P),o&&Vc(o,x);T&&Wl(T,$,g),Z&&(e?lr(Z,e,g):Vc(Z,If,g))},Gp=function(E,W,F,w){var n=[];w?Fe(E.gv,E.data,w,E,E.getBodyColor(),[W],F,n):(mn(E,Mn,W,F,n),mn(E,rj,W,F,n),mn(E,uq,W,F,n),mn(E,gh,W,F,n),mn(E,yo,W,F,n),mn(E,Fl,W,F,n),mn(E,"csg",W,F,n)),n.length&&(Vc(F.vs,n),Vc(F.ns,Ug(n)))},mn=function(k,V,w,Y,T){var t=k[V];if(t){var o=t.tuv;if(o){var P,E,R,j,J=t.uvScale,f=t.uvOffset;if(J)for(P=o.length,E=J[0],R=J[1],j=0;P>j;j+=2)o[j]*=E,o[j+1]*=R;if(f)for(P=o.length,E=f[0],R=f[1],j=0;P>j;j+=2)o[j]+=E,o[j+1]+=R}Ng(w,Y,T,t.vs,o,I,t.blend,t.color)}},Jf=function(o,P,p,y,O,a,F,G){var C,A=p.cs,n=p.uv,I=p.bs;if(o.getFaceVisible(P,a)){var M=o.getFaceMat(P,a);if(M&&(O=gq(P,M)),dk(F,O,G),A&&Wl(A,o.getFaceColor(P,a),6),n){var t=o.getFaceUv(P,a)||y[a+"Uv"],Z=o.getFaceUvScale(P,a)||y[a+"UvScale"],f=o.getFaceUvOffset(P,a)||y[a+"UvOffset"];t=t?[t[6],t[7],t[0],t[1],t[2],t[3],t[2],t[3],t[4],t[5],t[6],t[7]]:Kd;var R=t[0],L=t[1],l=t[2],U=t[3],x=t[4],i=t[5],u=t[6],Y=t[7],N=t[8],V=t[9],H=t[10],J=t[11];if(Z){var m=Z[0],Q=Z[1];R*=m,L*=Q,l*=m,U*=Q,x*=m,i*=Q,u*=m,Y*=Q,N*=m,V*=Q,H*=m,J*=Q}if(f){var e=f[0],d=f[1];R+=e,L+=d,l+=e,U+=d,x+=e,i+=d,u+=e,Y+=d,N+=e,V+=d,H+=e,J+=d}n.push(R,L,l,U,x,i,u,Y,N,V,H,J)}I&&(C=o.getBodyColor(P)||o.getFaceBlend(P,a),C?lr(I,C,6):Vc(I,If,6))}},_o=function(F,p,W,t){var e=F.getGL(),g=F._prg,w=F._buffer;if(!F.drawFilter&&!fh(p)){ir(F),Ij(e,g);for(var E in p){var z=p[E];if(!(t&&!z.T||!t&&z.T)){z.invalidate?(z.invalidate=!1,Yn(z,"vs"),Yn(z,"cs"),Yn(z,"ls"),Yn(z,"ps")):W&&Yn(z,"ps");var Q=z.vs32,Y=W?z.ps32:z.cs32;hg(e,g,z.W,I,w.vs,Q);var k=z.D,C=!F._dashDisabled&&k;ti(e,g.uAlphaTest,v.alphaTest),C&&(ti(e,g.uDash,!0),ti(e,g.uDashDistance,k),ti(e,g.uDashGapDistance,z.G),fo(e,g.aLineDistance),Bm(e,w.lineDistance,z.ls32,g.aLineDistance,1),ti(e,g.uDiffuse,z.A||Lk));var $=!F._batchColorDisabled;$&&(ti(e,g.uBatchColor,!0),fo(e,g.aBatchColor),Bm(e,w.batchColor,Y,g.aBatchColor,4)),mk(e),cr(e,0,Q.length/3,e.LINES),gg(e),$&&(ti(e,g.uBatchColor,!1),lq(e,g.aBatchColor)),C&&(ti(e,g.uDash,!1),lq(e,g.aLineDistance))}}Xg(e,g)}},Fi=function(C,k,O){var X,G,t,_,A,B,h,R,J,f,r,n=C.getGL(),i=C._prg,F=C._buffer,p=C._batchModelMap;if(!fh(p)){ir(C);for(X in p)if(G=Vj[X]||Cf,!(O&&!G.transparent||!O&&G.transparent)&&(t=p[X],k||!G.transparentMask)){var N=O&&G.autoSort!==!1&&(C._33Q||t.invalidate);if(t.invalidate?(t.invalidate=!1,Yn(t,"vs"),Yn(t,"ns"),Yn(t,"cs"),Yn(t,"rs"),Yn(t,"ps"),Yn(t,"bs"),Yn(t,"uv")):k&&Yn(t,"ps"),A=t.vs32,B=k?t.ps32:t.cs32,J=t.uv32,h=t.bs32,R=t.rs32,r=A.length/3,N&&(t.is=Qf(A,C.getEye())),r){_=G.light,f=C.getTexture(G.image),Jm(n,i,I,G.light,G.opacity,G.reverseFlip,G.reverseColor,G.reverseCull),B?C._batchColorDisabled||(ti(n,i.uBatchColor,!0),fo(n,i.aBatchColor),Bm(n,F.batchColor,B,i.aBatchColor,4)):ti(n,i.uDiffuse,G.color||Lk);var W=G.alphaTest;ti(n,i.uAlphaTest,W===H?v.alphaTest:W);var e=h&&!C._batchBlendDisabled;e&&(ti(n,i.uBatchBlend,!0),fo(n,i.aBatchBlend),Bm(n,F.batchBlend,h,i.aBatchBlend));var P=R&&!C._batchBrightnessDisabled;P&&(ti(n,i.uBatchBrightness,!0),fo(n,i.aBatchBrightness),Bm(n,F.batchBrightness,R,i.aBatchBrightness,1)),J?mk(n,i,f,G.discardSelectable,F.uv,J,G.uvOffset,G.uvScale):mk(n),Bm(n,F.vs,A,i.aPosition),Bm(n,F.ns,t.ns32,i.aNormal),t.is?(dl(n,F.is,t.is),Jk(n,0,r)):cr(n,0,r),J?gg(n,i,f):gg(n),B&&!C._batchColorDisabled&&(ti(n,i.uBatchColor,!1),lq(n,i.aBatchColor)),e&&(ti(n,i.uBatchBlend,!1),lq(n,i.aBatchBlend)),P&&(ti(n,i.uBatchBrightness,!1),lq(n,i.aBatchBrightness)),hl(n,i)}}}},Qf=function(Z,j){for(var N=Z.length/3,x=new Array(N),n=N/3,D=new Array(n),k=0;n>k;k++)D[k]=k;D.sort(function(X,v){var T=9*X,$=[(Z[T]+Z[T+3]+2*Z[T+6])/4,(Z[T+1]+Z[T+4]+2*Z[T+7])/4,(Z[T+2]+Z[T+5]+2*Z[T+8])/4];T=9*v;var F=[(Z[T]+Z[T+3]+2*Z[T+6])/4,(Z[T+1]+Z[T+4]+2*Z[T+7])/4,(Z[T+2]+Z[T+5]+2*Z[T+8])/4],U=em(j,$)-em(j,F);return U>0?-1:0>U?1:0});for(var k=0;n>k;k++){var w=3*k,d=3*D[k];x[w]=d,x[w+1]=d+1,x[w+2]=d+2}return new qr(x)},_m={obj:function(p,X){var W={mat:p.mat,s3:p.s3,r3:p.r3,rotationMode:p.rotationMode,t3:p.t3,cube:p.cube==I?!0:p.cube,center:p.center==I?!0:p.center,ignoreMtls:p.ignoreMtls,ignoreTransparent:p.ignoreTransparent,ignoreColor:p.ignoreColor,ignoreImage:p.ignoreImage,ignoreNormal:p.ignoreNormal,prefix:p.prefix,flipY:p.flipY,flipFace:p.flipFace,reverseFlipMtls:p.reverseFlipMtls,finishFunc:function(W,B){if(W){var B=[];for(var I in W){var L=W[I];B.rawS3=L.rawS3,B.push(L),p.eachModel&&p.eachModel(I,L)}B.json=p,X(B)}else X()}};h.loadObj(p.obj,p.mtl,W)}};h.getModelTypeHandlers=function(){return _m},h.setModelTypeHandler=function(n,S){_m[n]=S},h.getModelTypeHandler=function(L){return _m[L]},h.handleModelLoaded=function(){},h.handleUnfoundModel=function(){};var $g=I,Qh=I,Qr=function(Z){$g&&!Z._loadingModelView_&&(Qh||(Qh={}),Qh[Z._loadingModelView_=sl()]=Z)},qq=function(H,b){$g||($g={});var A=$g[H];if(A){if(A.url===b)return;A.request.onload=Mo,A.request.onerror=Mo}var l=new Ml;if($g[H]={request:l,url:b},b=h.beforeLoadURL(b),b.data){var Y=h.parse(b.data);th(H,Y,b)}else{l.onload=function(N){if(200===this.status||0===this.status){var l=h.parse(N.target.response||N.target.responseText);th(H,l,b)}else uj(H,h.handleUnfoundModel(H,b)||I)},l.onerror=function(){uj(H,h.handleUnfoundModel(H,b)||I)};var P={};P.url=encodeURI(b),P.sync=!1,l.send(P)}},th=function(l,r,D){var A=r.modelType;if(!A)return uj(l,r),h.handleModelLoaded(l,r),void 0;var e=h.getModelTypeHandler(A);if(e){var q=function(y){y?(uj(l,y),h.handleModelLoaded(l,y)):uj(l,h.handleUnfoundModel(l,D)||I)};e(r,q)}else uj(l,h.handleUnfoundModel(l,D)||I)},uj=function(G,h){if(gd[G]=h,delete $g[G],fh($g)&&($g=I,Qh)){for(var _ in Qh){var N=Qh[_];N._2O&&(N._2O={}),N.invalidateAll&&N.invalidateAll(H,"modelLoaded",G),N.redraw&&N.redraw(),N.iv(),delete N._loadingModelView_}Qh=I}if(h&&Qh)for(var _ in Qh){var N=Qh[_];N.invalidateAll&&N.invalidateAll(H,"modelLoading",G),N.redraw&&N.redraw(),N.iv()}},Jj=new kj([0,0,0,1,1,1,1,0]),Xm=new kj([0,0,1,0,0,1,0,0,1,0,0,1]),Rh=new qr([0,1,2,2,3,0]),nr=new kj([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),mq=new qr([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),qi=new kj([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),mc=Ug(nr,mq),Zg=(new kj([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new qr([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[Mn,uq,rj,gh,yo,Fl]),og=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],Jh=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Qb=function(u,x,U,L,N,h){h=h||16,u=u||16,x=x||0,U=U||u;var $,D,n,e,A,p,q,t,y=.5,r=[],k=[],B=W/u,z=g/h;for($=0;h>$;$++)for(A=$+1,e=$*z,t=A*z,D=x;U>D;D++)p=D+1,n=D*B,q=p*B,r.push(y*f(e)*O(n),y*O(e),-y*f(e)*f(n),y*f(t)*O(q),y*O(t),-y*f(t)*f(q),y*f(e)*O(q),y*O(e),-y*f(e)*f(q),y*f(e)*O(n),y*O(e),-y*f(e)*f(n),y*f(t)*O(n),y*O(t),-y*f(t)*f(n),y*f(t)*O(q),y*O(t),-y*f(t)*f(q)),k.push(D/u,$/h,p/u,A/h,p/u,$/h,D/u,$/h,D/u,A/h,p/u,A/h);if(L){var w=[],I=[];for(n=x*B,$=0;h>$;$++)A=$+1,e=$*z,t=A*z,w.push(0,0,0,y*f(t)*O(n),y*O(t),-y*f(t)*f(n),y*f(e)*O(n),y*O(e),-y*f(e)*f(n)),I.push(0,.5,x/u,A/h,x/u,$/h)}if(N){var J=[],F=[];for(n=U*B,$=0;h>$;$++)A=$+1,e=$*z,t=A*z,J.push(0,0,0,y*f(e)*O(n),y*O(e),-y*f(e)*f(n),y*f(t)*O(n),y*O(t),-y*f(t)*f(n)),F.push(1,.5,U/u,$/h,U/u,A/h)}return{vs:r,uv:k,from_vs:w,from_uv:I,to_vs:J,to_uv:F}},So=function(S,F,n){S=S||.17,F=F||12,n=n||18,0>S?S=0:S>.25&&(S=.25);var Y,x,e,q,D,Z,I,p=.5,V=[],a=[],h=[],G=W/n,y=W/F,u=p-S;for(x=0;F>=x;x++)for(q=-g+x*y,Z=O(q),D=f(q),Y=0;n>=Y;Y++)e=Y*G,I=u+S*Z,V.push(O(e)*I,D*S,-f(e)*I),a.push(Y/n,1-x/F);for(x=0;F>x;x++){var M=x*(n+1),X=(x+1)*(n+1);for(Y=0;n>Y;Y++)h.push(M+Y,X+Y+1,X+Y,M+Y,M+Y+1,X+Y+1)}return{vs:V,uv:a,is:h}},Or=function(s,_,T,V,o,m,w){w=w||12,s=s||18,_=_||0,T=T||s,m=m||.17,0>m?m=0:m>.25&&(m=.25);var Y,U,j,K,R,q,$,M,c,r,G=.5,y=[],E=[],F=W/s,i=W/w,k=G-m;for(j=0;w>j;j++)for(K=j+1,$=-g+j*i,M=-g+K*i,Y=_;T>Y;Y++)U=Y+1,R=Y*F,q=U*F,c=k+m*O($),r=k+m*O(M),y.push(O(R)*c,f($)*m,-f(R)*c,O(q)*c,f($)*m,-f(q)*c,O(q)*r,f(M)*m,-f(q)*r,O(R)*c,f($)*m,-f(R)*c,O(q)*r,f(M)*m,-f(q)*r,O(R)*r,f(M)*m,-f(R)*r),E.push(Y/s,1-j/w,U/s,1-j/w,U/s,1-K/w,Y/s,1-j/w,U/s,1-K/w,Y/s,1-K/w);if(V){var h=[],C=[];for(j=0;w>j;j++)K=j+1,$=-g+j*i,M=-g+K*i,R=_*F,c=k+m*O($),r=k+m*O(M),h.push(O(R)*c,f($)*m,-f(R)*c,O(R)*r,f(M)*m,-f(R)*r,O(R)*k,0,-f(R)*k),C.push(.5+.5*O($),.5-.5*f($),.5+.5*O(M),.5-.5*f(M),.5,.5)}if(o){var D=[],J=[];for(j=0;w>j;j++)K=j+1,$=-g+j*i,M=-g+K*i,R=T*F,c=k+m*O($),r=k+m*O(M),D.push(O(R)*c,f($)*m,-f(R)*c,O(R)*k,0,-f(R)*k,O(R)*r,f(M)*m,-f(R)*r),J.push(.5-.5*O($),.5-.5*f($),.5,.5,.5-.5*O(M),.5-.5*f(M))}return{vs:y,uv:E,from_vs:h,from_uv:C,to_vs:D,to_uv:J}},io=function(X,d){for(var V,v,E,b=.5,j=16,G=[],Y=[],Q=[],m=W/j,B=0;j>=B;B++)V=B*m,v=O(V)*b,E=f(V)*b,G.push(v,-b,E,v,b,E),Y.push(1-B/j,1,1-B/j,0);for(B=0;j>B;B++)Q.push(2*B,2*B+1,2*B+3,2*B,2*B+3,2*B+2);if(d){var s=[],_=[],J=[];for(s.push(0,-b,0),_.push(.5,.5),B=0;j>=B;B++)V=B*m,v=O(V),E=f(V),s.push(v*b,-b,-E*b),_.push(.5+.5*v,.5+.5*E);for(B=0;j>B;B++)J.push(0,B+2,B+1)}if(X){var o=[],k=[],n=[];for(o.push(0,b,0),k.push(.5,.5),B=0;j>=B;B++)V=B*m,v=O(V),E=f(V),o.push(v*b,b,-E*b),k.push(.5+.5*v,.5-.5*E);for(B=0;j>B;B++)n.push(0,B+1,B+2)}return{vs:G,uv:Y,is:Q,bottom_vs:s,bottom_uv:_,bottom_is:J,top_vs:o,top_uv:k,top_is:n}},Pq=function(Y,D,q,X,L,b,K){Y=Y||12,D=D||0,q=q||Y;for(var Z,g,l,U,p,V,F,r,J=.5,t=[],T=[],Q=W/Y,N=D;q>N;N++)Z=N+1,g=N*Q,l=Z*Q,U=O(g)*J,p=f(g)*J,V=O(l)*J,F=f(l)*J,t.push(U,-J,-p,V,-J,-F,U,J,-p,V,-J,-F,V,J,-F,U,J,-p),T.push(N/Y,1,Z/Y,1,N/Y,0,Z/Y,1,Z/Y,0,N/Y,0);if(K){var $=[],M=[];for(N=D;q>N;N++)g=Q*N,l=Q*(N+1),U=O(g),p=f(g),V=O(l),F=f(l),$.push(U*J,-J,-p*J,0,-J,0,V*J,-J,-F*J),M.push(.5+.5*U,.5+.5*p,.5,.5,.5+.5*V,.5+.5*F)}if(b){var S=[],j=[];for(N=D;q>N;N++)g=Q*N,l=Q*(N+1),U=O(g),p=f(g),V=O(l),F=f(l),S.push(U*J,J,-p*J,V*J,J,-F*J,0,J,0),j.push(.5+.5*U,.5-.5*p,.5+.5*V,.5-.5*F,.5,.5)}if(X){var k=[],B=[];g=Q*D,U=O(g)*J,p=f(g)*J,r=D/Y,k.push(0,J,0,0,-J,0,U,-J,-p,U,-J,-p,U,J,-p,0,J,0),B.push(0,0,0,1,r,1,r,1,r,0,0,0)}if(L){var H=[],o=[];g=Q*q,U=O(g)*J,p=f(g)*J,r=q/Y,H.push(0,-J,0,0,J,0,U,J,-p,U,J,-p,U,-J,-p,0,-J,0),o.push(1,1,1,0,r,0,r,0,r,1,1,1)}return{vs:t,uv:T,bottom_vs:$,bottom_uv:M,top_vs:S,top_uv:j,from_vs:k,from_uv:B,to_vs:H,to_uv:o}},Aq=function(k,S,V,G,v){S=S||18,V=V||0,G=G==I?W:G,v=v==I?.5:v;for(var J,X,M,h,o,d,p=[0,.5,.75,.875,.9375],R=[],H=[],u=[],w=G/S,B=0;B<p.length;B++){var K=0===B%2?0:.5;for(J=0;S>=J;J++)X=(J+K)*w+V,M=1-p[B],R.push(O(X)*v*M,-v+2*p[B]*v,-f(X)*v*M),H.push((J+K)/S,M)}for(B=0;B<p.length-1;B++){var y=B*(S+1),s=(B+1)*(S+1);for(J=0;S>J;J++)u.push(y+J,s+J+1,s+J,y+J,y+J+1,s+J+1)}for(d=R.length/3-(S+1),J=0;S>J;J++)R.push(0,v,0),H.push((J+.5)/S,0);for(J=0;S>J;J++)u.push(d+J,d+J+1,d+(S+1)+J);if(k){var _=[],z=[],F=[];for(_.push(0,-v,0),z.push(.5,.5),J=0;S>=J;J++)X=J*w+V,h=O(X),o=f(X),_.push(h*v,-v,-o*v),z.push(.5+.5*h,.5+.5*o);for(J=0;S>J;J++)F.push(0,J+2,J+1)}return{vs:R,uv:H,is:u,bottom_vs:_,bottom_uv:z,bottom_is:F}},yl=function(p,d,A,q,K,b){p=p||16,d=d||0,A=A||p;for(var J=.5,Q=[],z=[],s=W/p,N=d;A>N;N++){var o=N+1,G=s*N,C=s*o;Q.push(O(G)*J,-J,-f(G)*J,O(C)*J,-J,-f(C)*J,0,J,0),z.push(N/p,1,o/p,1,(N+o)/2/p,0)}if(b){var k=[],y=[];for(N=d;A>N;N++){G=s*N,C=s*(N+1);var U=O(G),L=f(G),P=O(C),I=f(C);k.push(U*J,-J,-L*J,0,-J,0,P*J,-J,-I*J),y.push(.5+.5*U,.5+.5*L,.5,.5,.5+.5*P,.5+.5*I)}}if(q){var D=[],v=[];G=s*d,D.push(0,J,0,0,-J,0,O(G)*J,-J,-f(G)*J),v.push(0,0,0,1,d/p,1)}if(K){var T=[],R=[];G=s*A,T.push(0,-J,0,0,J,0,O(G)*J,-J,-f(G)*J),R.push(1,1,1,0,A/p,1)}return{vs:Q,uv:z,bottom_vs:k,bottom_uv:y,from_vs:D,from_uv:v,to_vs:T,to_uv:R}},xr=function(e,v,N,T,y,n,M,l){for(var w=[],P=0;P<e.length-1;P+=2)w.push({x:e[P],y:e[P+1]});return Ef(w,v,N,T,y,n,M,l,!1)},Nn={roundRect:function(r,L){return xr([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],r,L,3)},star:function(v,q){return xr([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],v,q)},rect:function(X,N){return xr([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],X,N)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(w,c){return xr([0,-.5,.5,.5,-.5,.5],[1,2,2,5],w,c)},rightTriangle:function(d,f){return xr([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],d,f)},parallelogram:function(y,q){return xr([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],y,q)},trapezoid:function(J,N){return xr([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],J,N)}},tn={sphere:1,cylinder:1,cone:1,torus:1},Hp={torus:1,sphere:1},Dc=Of(oc(Nn),{cylinder:1}),lm=Of(oc(Nn),{cylinder:1,cone:1}),uh=function(k,M,Y){var c,y=oh(k.anchor3d,Y,M),z=oh(k.mat,Y,M),_=oh(k.s3,Y,M),i=oh(k.t3,Y,M),P=oh(k.r3,Y,M),D=_||P||i||z;if(y||D){c=Lc(M._6O);var q=D?Dq(z,_,P,oh(k.rotationMode,Y,M),i):Fn();y&&Le(q,[.5-y[0],.5-y[1],.5-y[2]]),ir(M,q)}return c},cj=function(C,L,b,W,y,D,m){if(Ck(b))b.forEach(function(J){cj(C,L,J,W,y,D,m)});else if(_e(b))cj(C,L,ed(W,b),W,y,D,m);else if(Lg(b))if(b.shape3d){var n=uh(b,C,L);cj(C,L,b.shape3d,W,y,D,b),n&&xi(C,n)}else Ko(C,L,b,W.s,y,D,m)},Ko=function(T,W,U,d,z,v,M){if(M=M||Cf,!v||v(d("shape3d.transparent",U.transparent,M.transparent))){var q=uh(U,T,W);Pb(U);var _=T._26I,o=T._prg,J=T._buffer,Y=d("shape3d.color",U.color,M.color);z||(z=d("shape3d.blend",U.blend,M.blend));var C,c=U.opacity==I?M.opacity:U.opacity,D=d("shape3d.opacity");C=D!=I&&c!=I?c*D:c!=I?c:D,Jm(_,o,z,d("shape3d.light",U.light,M.light),C,d("shape3d.reverse.flip",U.reverseFlip,M.reverseFlip),d("shape3d.reverse.color",U.reverseColor,M.reverseColor),d("shape3d.reverse.cull",U.reverseCull,M.reverseCull)),U.vs&&d(Li,U.visible,M.visible)&&Eo(_,o,J,Y,T.getTexture(d("shape3d.image",U.image,M.image),W),d("shape3d.discard.selectable",U.discardSelectable,M.discardSelectable),U.vs,U.uv,U.ns,U.is,d("shape3d.uv.offset",U.uvOffset,M.uvOffset),d("shape3d.uv.scale",U.uvScale,M.uvScale),d("shape3d.polygonOffset",U.polygonOffset,M.polygonOffset)),U.top_vs&&d(js,U.topVisible,M.topVisible)&&Eo(_,o,J,d("shape3d.top.color",U.topColor,M.topColor)||Y,T.getTexture(d("shape3d.top.image",U.topImage,M.topImage),W),d("shape3d.top.discard.selectable",U.topDiscardSelectable,M.topDiscardSelectable),U.top_vs,U.top_uv,U.top_ns,U.top_is,d("shape3d.top.uv.offset",U.topUvOffset,M.topUvOffset),d("shape3d.top.uv.scale",U.topUvScale,M.topUvScale),d("shape3d.top.polygonOffset",U.topPolygonOffset,M.topPolygonOffset)),U.bottom_vs&&d(kd,U.bottomVisible,M.bottomVisible)&&Eo(_,o,J,d("shape3d.bottom.color",U.bottomColor,M.bottomColor)||Y,T.getTexture(d("shape3d.bottom.image",U.bottomImage,M.bottomImage),W),d("shape3d.bottom.discard.selectable",U.bottomDiscardSelectable,M.bottomDiscardSelectable),U.bottom_vs,U.bottom_uv,U.bottom_ns,U.bottom_is,d("shape3d.bottom.uv.offset",U.bottomUvOffset,M.bottomUvOffset),d("shape3d.bottom.uv.scale",U.bottomUvScale,M.bottomUvScale),d("shape3d.bottom.polygonOffset",U.bottomPolygonOffset,M.bottomPolygonOffset)),U.from_vs&&d(Bl,U.fromVisible,M.fromVisible)&&Eo(_,o,J,d("shape3d.from.color",U.fromColor,M.fromColor)||Y,T.getTexture(d("shape3d.from.image",U.fromImage,M.fromImage),W),d("shape3d.from.discard.selectable",U.fromDiscardSelectable,M.fromDiscardSelectable),U.from_vs,U.from_uv,U.from_ns,U.from_is,d("shape3d.from.uv.offset",U.fromUvOffset,M.fromUvOffset),d("shape3d.from.uv.scale",U.fromUvScale,M.fromUvScale),d("shape3d.from.polygonOffset",U.fromPolygonOffset,M.fromPolygonOffset)),U.to_vs&&d(Hk,U.toVisible,M.toVisible)&&Eo(_,o,J,d("shape3d.to.color",U.toColor,M.toColor)||Y,T.getTexture(d("shape3d.to.image",U.toImage,M.toImage),W),d("shape3d.to.discard.selectable",U.toDiscardSelectable,M.toDiscardSelectable),U.to_vs,U.to_uv,U.to_ns,U.to_is,d("shape3d.to.uv.offset",U.toUvOffset,M.toUvOffset),d("shape3d.to.uv.scale",U.toUvScale,M.toUvScale),d("shape3d.to.polygonOffset",U.toPolygonOffset,M.toPolygonOffset)),hl(_,o),q&&xi(T,q)}},Eo=function(g,f,d,b,c,P,q,e,N,r,s,K,z){q&&(z&&_r(g,z),ti(g,f.uDiffuse,b),e?mk(g,f,c,P,d.uv,e,s,K):mk(g),Bm(g,d.vs,q,f.aPosition),Bm(g,d.ns,N,f.aNormal),r?(dd(g,d.is,r),Jk(g,0,r.length)):cr(g,0,q.length/3),e?gg(g,f,c):gg(g),z&&Hl(g))},ed=function(d,G){var w=d.s;if(G||(G=w(Qd)),!G)return I;var n=Un(G);if(n)return n;if("text"===G){var s={amount:w("shape3d.text.amount"),size:w("shape3d.text.size"),font:w("shape3d.text.font"),style:w("shape3d.text.style"),weight:w("shape3d.text.weight"),fill:w("shape3d.text.fill"),curveSegments:w("shape3d.text.curveSegments"),spacing:w("shape3d.text.spacing")},C=d.gv.getShape3dText(d.data),Q=C;for(var o in s)Q+="_"+(s[o]===H?"U":s[o]);return d._cachedTextKey===Q?d._cachedTextGeometry:(d._cachedTextKey=Q,d._cachedTextGeometry=h.createTextGeometry(C,s))}var o=G;if(tn[G]){var c=w("shape3d.side"),Y=w("shape3d.side.from"),g=w("shape3d.side.to"),p=w(Bl),$=w(Hk);3>c?(c=0,Y=0,g=0,p=!1,$=!1):((Y==I||0>Y)&&(Y=0),(g==I||g>c)&&(g=c),0===Y&&g===c&&(p=!1,$=!1)),o+="-"+c+"-"+Y+"-"+g+"-"+p+"-"+$}if(Dc[G]){var L=w(js);o+="-"+L}if(lm[G]){var T=w(kd);o+="-"+T}if("torus"===G){var W=w("shape3d.torus.radius");0>W?W=0:W>.25&&(W=.25),o+="-"+W}if(Hp[G]){var b=w(ln);o+="-"+b}return n=am[o],n||("box"===G?n=h.createBoxModel():Nn[G]?n=Nn[G](L,T):"sphere"===G?n=h.createSphereModel(c,Y,g,p,$,b):G===Zq?n=h.createCylinderModel(c,Y,g,p,$,L,T):"cone"===G?n=h.createConeModel(c,Y,g,p,$,T):"torus"===G&&(n=h.createTorusModel(c,Y,g,p,$,W,b)),am[o]=n),n},Pb=function(){var C=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],F=["is","top_is","bottom_is","from_is","to_is"];return x=eg(Mk.substr(Mk.indexOf("^#")+2)),Sr(h[ys(yd+C[15]+"n"+C[16])]())&&Ie()?function(o){o&&!o._complete_&&(o._complete_=!0,o.vs&&il(o.ns)&&(o.ns=Ug(o.vs,o.is)),o.top_vs&&il(o.top_ns)&&(o.top_ns=Ug(o.top_vs,o.top_is)),o.bottom_vs&&il(o.bottom_ns)&&(o.bottom_ns=Ug(o.bottom_vs,o.bottom_is)),o.from_vs&&il(o.from_ns)&&(o.from_ns=Ug(o.from_vs,o.from_is)),o.to_vs&&il(o.to_ns)&&(o.to_ns=Ug(o.to_vs,o.to_is)),C.forEach(function(m){var k=o[m];Ck(k)&&(o[m]=new kj(k))}),F.forEach(function(l){var O=o[l];Ck(O)&&(o[l]=new qr(O))}))}:void 0}(),gf=function(r,F){var i=r[F];Ck(i)&&(r[F]=new kj(i))};Of(Tm,{_25Q:function(T){T._16O=function(k,H,D,U,L,X,l,f,w){var V=this.info;if(V){var J,N,O,G,A,t,c=Fn();if(as[H]?(J=V.p3,N=V.c1,O=V.c2):Cd[H]?(N=V.s1||V.c1,O=V.s2||V.c2):(N=V.t1||V.c1,O=V.t2||V.c2),J)t=Rj(H,we,D,U,f,w);else{var R=Ip(O,N),i=em(N,O);G=[0,-B(R[2],R[0]),u(R[1]/i)],A="zyx",J=[(N[0]+O[0])/2,(N[1]+O[1])/2,(N[2]+O[2])/2],t=Rj(H,[i,0,0],D,U,f,w)}return Aj(c,t,J,U,L,X,l,k,G,A)}return wn},T._80o=function(X,W,s){var I=this,d=I.shapeModel;if(d){var t=I.gv;ir(t),cj(t,I.data,d,I,I.getBodyColor(),s)}},T.createLineModel=function(L,x,C,w,P){for(var g=this,r=g.s,F=Oh(L,x,r(ln)),V=[],N=0;N<F.length;N++){var Z=F[N],T=Z.length;if(T>1){var l=Z[0];V.push(l.x,l.y,l.z);for(var y=1;T-1>y;y++)l=Z[y],V.push(l.x,l.y,l.z),V.push(l.x,l.y,l.z);l=Z[T-1],V.push(l.x,l.y,l.z)}}var Y,c,h,S=r(w+".color"),m=r(P),B=0;return m&&(c=r(P+".color"),Y=r(P+".pattern"),B=r(P+".offset"),h=S),qb(g.gv,g.data,V,c||S,h?I:r(w+".gradient.color"),C,Y||r(w+".pattern"),B,h),F},T.createTubeModel=function(J,n,Z,m){for(var K=this,p=K.s,x=p("shape3d.side")||Qj,Q=p("shape3d.start.angle"),T=p("shape3d.sweep.angle"),Y=p(js)?p("shape3d.top.cap"):I,R=p(kd)?p("shape3d.bottom.cap"):I,y="flat"===Y,h="flat"===R,w=y&&(m?m.uv:p("shape3d.top.image")),F=h&&(m?m.uv:p("shape3d.bottom.image")),N=m?m.uv:p("shape3d.image"),r={vs:[],uv:N?[]:I,top_vs:y?[]:I,top_uv:w?[]:I,bottom_vs:h?[]:I,bottom_uv:F?[]:I},f=Oh(J,n,p(ln),Z),u=0,W=f.length;W>u;u++)vl(r,f[u],p(hf),Z,x,Q,T,Y,R);if(m){var t=[];Fe(K.gv,K.data,r,K,K.getBodyColor(),[],m,t),t.length&&(Vc(m.vs,t),Vc(m.ns,Ug(t)))}else K.shapeModel=r;return f},T.getCache=function(){var g=this.info;if(g){var Q=g.list;if(Q){var d=g.cache;return d||(d=g.cache=Tn(Q)),d}}return I}}});var kc=function(O,a){for(var F,P=0,V=O.length,d=0,H=V-1;H>=d;)if(P=$(d+(H-d)/2),F=O[P].length-a,0>F)d=P+1;else{if(!(F>0)){H=P;break}H=P-1}P=H;var o=O[P],X=o.point;return P===V-1||o.length===a||(X=(new nm).subVectors(O[P+1].point,X).normalize().multiplyScalar(a-o.length).add(X)),{point:X,tangent:o.tangent}},Tn=function(X){for(var k,v,Z=[],s=0,P=0;P<X.length;P++){for(var o=X[P],l=0;l<o.length;l++){k=o[l],v&&(s+=v.distanceTo(k));var W=new nm,S=o[l+1];S?W.subVectors(S,k):v?W.subVectors(k,v):W.x=1,W.normalize(),Z.push({point:k,length:s,tangent:W}),v=k}v=null}return Z},Oh=function(Y,w,u,p){u=u||ds;for(var S=[],r=0,P=Y.size();P>r;r++){var x=Y.get(r);S.push(new nm(x.x,x.e||0,x.y))}w&&(Am(w)&&(w=w._as),w.length||(w=null));for(var j,q,c,y,i,V=[],C=0,s=0,o=w?w.length:P;o>s;s++)if(i=w?w[s]:0===s?1:2,1===i)V.push(c=[]),c.push(S[C++]);else if(2===i||5===i)if(y=2===i?S[C++]:c[0],p){var n=w?w[s+1]:o>s+1?2:I;if(2===n||5===n){var G=c[c.length-1],A=2===n?S[C]:c[0],W=(new nm).subVectors(G,y),O=(new nm).subVectors(A,y),F=W.length(),U=O.length();if(F&&U)if(p>F/2&&p>U/2)c.push(y);else for(W.multiplyScalar(N(p,F/2)/F).add(y),O.multiplyScalar(N(p,U/2)/U).add(y),j=new zr(W,y,O).getPoints(u),q=0;u>=q;q++)c.push(j[q])}else c.push(y)}else c.push(y);else if(3===i)for(j=new zr(c[c.length-1],S[C++],S[C++]).getPoints(u),q=1;u>=q;q++)c.push(j[q]);else if(4===i)for(j=new Pk(c[c.length-1],S[C++],S[C++],S[C++]).getPoints(u),q=1;u>=q;q++)c.push(j[q]);return V},Mf=function(n){for(var X,O,c=new nm,r=[],u=[],W=[],y=0,S=n.length;S>y;y++)X=n[y],O=n[y+1],O?c.subVectors(O,X):c.subVectors(X,n[y-1]),r.push(c.normalize().clone());var A,V,D,B,K=new nm,M=new nm,R=new Ln,P=1e-4,k=Number.MAX_VALUE,_=r[0],e=u[0]=new nm,v=W[0]=new nm;for(V=J(_.x),D=J(_.y),B=J(_.z),k>=V&&(k=V,K.set(1,0,0)),k>=D&&(k=D,K.set(0,1,0)),k>=B&&K.set(0,0,1),M.crossVectors(_,K).normalize(),e.crossVectors(_,M),v.crossVectors(_,e),y=1;S>y;y++)u[y]=u[y-1].clone(),W[y]=W[y-1].clone(),M.crossVectors(r[y-1],r[y]),M.length()>P&&(M.normalize(),A=a(id(r[y-1].dot(r[y]),-1,1)),u[y].applyMatrix4(R.makeRotationAxis(M,A))),W[y].crossVectors(r[y],u[y]);return{B:W,T:r,N:u}},vl=function(){var a=function(E){for(var $=1;$<arguments.length;$++){var z=arguments[$];E.push(z.x,z.y,z.z)}},x=function(V){for(var o=1;o<arguments.length;o++){var Y=arguments[o].uv;V.push(Y[0],Y[1])}},j=function(k,m,Q,l,w){var j=-l*O(w),U=l*f(w);return new nm(k.x+j*Q.x+U*m.x,k.y+j*Q.y+U*m.y,k.z+j*Q.z+U*m.z)},n=function(X,V,A,q,B,s,C,P){C=C||W;for(var M=[],f=C/B,Y=0;B>=Y;Y++){var z=j(X,V,A,q,Y*f+s);M.push(z),P!=I&&(z.uv=[P,Y/B])}return M},V=function(Z,w,A,V,B,X,N,o,k){k=k||W;var C=w?Z.top_vs:Z.bottom_vs;if(C)for(var D=w?Z.top_uv:Z.bottom_uv,K=k/N,L=0;N>L;L++){var v,F;w?(v=L*K+o,F=(L+1)*K+o):(F=L*K+o,v=(L+1)*K+o),a(C,j(A,V,B,X,v),j(A,V,B,X,F),A),D&&D.push(.5-.5*O(v),.5-.5*f(v),.5-.5*O(F),.5-.5*f(F),.5,.5)}};return function($,m,P,D,O,l,C,X,t){var J=m.length;if(J>1){var e,K,U,g,E,T,F,L=Mf(m),w=L.T,_=L.N,A=L.B;"flat"===X&&V($,!0,m[0],A[0],_[0],D,O,l,C),"flat"===t&&V($,!1,m[J-1],A[J-1],_[J-1],D,O,l,C);var Q,k,f=[],d=c(O/2),M="round"===X,N="round"===t,u=m[0],r=w[0],q=A[0],S=_[0],W=m[J-1],B=w[J-1],z=A[J-1],Y=_[J-1];if(M){for(U=1;d>=U;U++)_.splice(0,0,S),A.splice(0,0,q),w.splice(0,0,r),k=-U/d*D,m.splice(0,0,r.clone().multiplyScalar(k).add(u)),f[d-U]=p(D*D-k*k);J+=d}if(N){for(U=1;d>=U;U++)_.push(Y),A.push(z),w.push(B),k=U/d*D,m.push(B.clone().multiplyScalar(k).add(W)),f[m.length-1]=p(D*D-k*k);J+=d}if($.uv){var R=0,h=0,j=[];for(P&&(R=P),E=m[0],j[0]=0,U=1;J>U;U++)g=m[U],j[U]=E.distanceTo(g),E=g,P||(R+=j[U]);for(Q=[],U=0;J>U;U++)h+=j[U],Q[U]=R?h/R:0}for(U=0;J>U;U++){if(g=m[U],T=A[U],F=_[U],e=n(g,T,F,f[U]===H?D:f[U],O,l,C,Q?Q[U]:I),K)for(var s=0;O>s;s++){var G=K[s],o=K[s+1]||K[0],i=e[s],v=e[s+1]||e[0];a($.vs,o,G,i,i,v,o),$.uv&&x($.uv,o,G,i,i,v,o)}K=e}}}}();Of(h,{getLineLength:function(g){return g[g.length-1].length},getLineOffset:function(G,d){return kc(G,d)},getLineCacheInfo:function(z,j,P,u){return Tn(Oh(z,j,P,u))}});var pc={},Qc=new ArrayBuffer(0),mo=pc.Buffer=function(D,r,l,p){this.gl=D,this.buffer=D.createBuffer(),this.type=r||D.ARRAY_BUFFER,this.drawType=p||D.STATIC_DRAW,this.data=Qc,l&&this.upload(l)};mo.prototype.upload=function(Q,n,J){J||this.bind();var B=this.gl;Q=Q||this.data,n=n||0,this.data.byteLength>=Q.byteLength?B.bufferSubData(this.type,n,Q):B.bufferData(this.type,Q,this.drawType),this.data=Q},mo.prototype.bind=function(){var j=this.gl;j.bindBuffer(this.type,this.buffer)},mo.createVertexBuffer=function(K,$,o){return new mo(K,K.ARRAY_BUFFER,$,o)},mo.createIndexBuffer=function(p,G,A){return new mo(p,p.ELEMENT_ARRAY_BUFFER,G,A)},mo.create=function(L,P,g,z){return new mo(L,P,z)},mo.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var me=pc.Shader=function(Q,d,S){this.gl=Q,this.program=wm(Q,d,S),this.attributes=cm(Q,this.program);var y=ks(Q,this.program);this.uniforms=Mp(Q,y)};me.prototype.bind=function(){this.gl.useProgram(this.program)},me.prototype.destroy=function(){this.gl};var wm=function(f,U,Q){var j=vq(f,f.VERTEX_SHADER,U),m=vq(f,f.FRAGMENT_SHADER,Q);f.getShaderParameter(m,f.COMPILE_STATUS)||console.error(f.getError());var l=f.createProgram();return f.attachShader(l,j),f.attachShader(l,m),f.linkProgram(l),f.getProgramParameter(l,f.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",f.getProgramParameter(l,f.VALIDATE_STATUS)),console.error("gl.getError()",f.getError()),""!==f.getProgramInfoLog(l)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",f.getProgramInfoLog(l)),f.deleteProgram(l),l=null),f.deleteShader(j),f.deleteShader(m),l},vq=function(A,P,c){var D=A.createShader(P);return A.shaderSource(D,c),A.compileShader(D),A.getShaderParameter(D,A.COMPILE_STATUS)?D:(console.log(A.getShaderInfoLog(D)),null)},ks=function(e,Z){for(var $={},p=e.getProgramParameter(Z,e.ACTIVE_UNIFORMS),J=0;p>J;J++){var h=e.getActiveUniform(Z,J),R=h.name.replace(/\[.*?\]/,""),o=bj(e,h.type);$[R]={type:o,size:h.size,location:e.getUniformLocation(Z,R),value:Rb(o,h.size)}}return $},cm=function(Y,P){for(var v={},d=Y.getProgramParameter(P,Y.ACTIVE_ATTRIBUTES),b=0;d>b;b++){var O=Y.getActiveAttrib(P,b),r=bj(Y,O.type);v[O.name]={type:r,size:sf(r),gl:Y,location:Y.getAttribLocation(P,O.name),pointer:Jq}}return v},Jq=function(o,R,X,v,j){var B=this.gl;B.enableVertexAttribArray(this.location),B.bindBuffer(o.type,o.buffer),B.vertexAttribPointer(this.location,this.size,R||B.FLOAT,X||!1,v||0,j||0)},sf=function(p){return qc[p]},qc={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},bj=function(r,z){if(!he){var R=C.keys(cp);he={};for(var x=0;x<R.length;++x){var X=R[x];he[r[X]]=cp[X]}}return he[z]},he=null,cp={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Rb=function(F,R){switch(F){case"float":return 0;case"vec2":return new Float32Array(2*R);case"vec3":return new Float32Array(3*R);case"vec4":return new Float32Array(4*R);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*R);case"ivec3":return new Int32Array(3*R);case"ivec4":return new Int32Array(4*R);case"bool":return!1;case"bvec2":return wq(2*R);case"bvec3":return wq(3*R);case"bvec4":return wq(4*R);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},wq=function(e){for(var D=new Array(e),L=0;L<D.length;L++)D[L]=!1;return D},Mp=function(g,m){var G={data:{}};G.gl=g;for(var L=C.keys(m),W=0;W<L.length;W++){var n=L[W],r=n.split("."),j=r[r.length-1],p=Xn(r,G),M=m[n];
p.data[j]=M,p.gl=g,C.defineProperty(p,j,{get:He(j),set:Lb(j,M)})}return G},He=function(F){var O=ag.replace("%%",F);return new Function(O)},Lb=function(Q,i){var R,U=zo.replace(/%%/g,Q);return R=1===i.size?Ke[i.type]:Bf[i.type],R&&(U+="\nthis.gl."+R+";"),new Function("value",U)},Xn=function(M,w){for(var Z=w,l=0;l<M.length-1;l++){var L=Z[M[l]]||{data:{}};Z[M[l]]=L,Z=L}return Z},ag=["return this.data.%%.value;"].join("\n"),zo=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Ke={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},Bf={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},fe=j.Light=function(){zp(fe,this),this.s(ql,v[ql]),this.s(Qd,"sphere"),this.s3(20,20,20)};yp("Light",yq,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(F,z,i){fe.superClass.onStyleChanged.apply(this,arguments),F===ql&&this.s("shape3d.color",i)}});var Gk=Uq.Graph3dView=function(e,V){var T=this;T._attributes=V||h.graph3dViewAttributes,T._25I={},T._view=Di(1,T);var k=T._canvas=Ue(T._view);k.addEventListener("webglcontextlost",function(p){p.preventDefault(),Ar(T),T._26I&&T._doBufferGC(T._26I,!0),T._26I=I,T._1o.texture=I,T._35O=!0},P),k.addEventListener("webglcontextrestored",function(){T._35O=!1,T.iv()},P),T._batchIndexMap={},T._batchModelMap={},T._wireframeIndexMap={},T._wireframeModelMap={},T._wireframeIndexMapSwap={},T._wireframeModelMapSwap={},T._polylineIndexMap={},T._polylineIndexMap={},T._polylineIndexMapSwap={},T._polylineIndexMapSwap={},T._8O=[],T._7O=Fn(),T._6O=Fn(),T._1o=new yc(T),T._30O=new vh(T),T._31O=new xj(T),T._32O=new td(T),T._raycaster=new wg(T),T._highlightHelper=new pl(T),T._postProcessing=new xq(T),T.vr=new As(T),T._33Q=!0,T._eye=oc(h.graph3dViewEye),T._center=oc(h.graph3dViewCenter),T._up=oc(h.graph3dViewUp),T._lightChanged=!1,T._59O=[],T._spots=[],T._dirs=[],T._frameId=0,T.overlappingBox=new wc(T),T.dm(e?e:new pd),T._coreInteractor=new nl(this),T.setInteractors([new tp(T)])},Ge={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1},Ac=0;so("Graph3dView",C,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable",_d,Wc,"firstPersonMode",Dr,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",Lm,Ai,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:h.graph3dViewEditHelperDisabled,_devicePixelRatio:H,_boundaries:H,_moveStep:h.graph3dViewMoveStep,_rotateStep:h.graph3dViewRotateStep,_pannable:h.graph3dViewPannable,_rotatable:h.graph3dViewRotatable,_walkable:h.graph3dViewWalkable,_resettable:h.graph3dViewResettable,_zoomable:h.graph3dViewZoomable,_firstPersonMode:h.graph3dViewFirstPersonMode,_mouseRoamable:h.graph3dViewMouseRoamable,_gridVisible:h.graph3dViewGridVisible,_gridSize:h.graph3dViewGridSize,_gridGap:h.graph3dViewGridGap,_gridColor:h.graph3dViewGridColor,_originAxisVisible:h.graph3dViewOriginAxisVisible,_centerAxisVisible:h.graph3dViewCenterAxisVisible,_axisXColor:h.graph3dViewAxisXColor,_axisYColor:h.graph3dViewAxisYColor,_axisZColor:h.graph3dViewAxisZColor,_ortho:h.graph3dViewOrtho,_orthoWidth:h.graph3dViewOrthoWidth,_fovy:h.graph3dViewFovy,_near:h.graph3dViewNear,_far:h.graph3dViewFar,_headlightColor:h.graph3dViewHeadlightColor,_headlightIntensity:h.graph3dViewHeadlightIntensity,_headlightRange:h.graph3dViewHeadlightRange,_headlightDisabled:h.graph3dViewHeadlightDisabled,_rectSelectable:h.graph3dViewRectSelectable,_rectSelectBackground:h.graph3dViewRectSelectBackground,_editSizeColor:h.graph3dViewEditSizeColor,_autoMakeVisible:pq,_fogDisabled:h.graph3dViewFogDisabled,_fogColor:h.graph3dViewFogColor,_fogNear:h.graph3dViewFogNear,_fogFar:h.graph3dViewFogFar,_dashDisabled:h.graph3dViewDashDisabled,_batchColorDisabled:h.graph3dViewBatchColorDisabled,_batchBlendDisabled:h.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:h.graph3dViewBatchBrightnessDisabled,setEye:function(m,Q,N){1===arguments.length&&(Q=m[1],N=m[2],m=m[0]);var o=this._eye;o[0]=m,o[1]=Q,o[2]=N,this.fp(Lm,I,o)},setCenter:function(j,U,u){1===arguments.length&&(U=j[1],u=j[2],j=j[0]);var o=this._center;o[0]=j,o[1]=U,o[2]=u,this.fp(Ai,I,o)},setUp:function(S,q,s){1===arguments.length&&(q=S[1],s=S[2],S=S[0]);var p=this._up;p[0]=S,p[1]=q,p[2]=s,this.fp("up",I,p)},getDevicePixelRatio:function(){return this._devicePixelRatio||Ed},isTransparentMask:function(G){return G.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var I=this,x=I._aspect;return x?x:(x=I.getWidth()/I.getHeight(),x||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(P){var m=this,J=m._dataModel,y=m._selectionModel;J!==P&&(J&&(J.ump(m.handleDataModelPropertyChange,m),J.umm(m.handleDataModelChange,m),J.umd(m.handleDataPropertyChange,m),y||J.sm().ums(m.handleSelectionChange,m)),m._dataModel=P,P.mp(m.handleDataModelPropertyChange,m),P.mm(m.handleDataModelChange,m),P.md(m.handleDataPropertyChange,m),y?y._21I(P):P.sm().ms(m.handleSelectionChange,m),m._postProcessing.handleDataModleChange(J,P),m.invalidateAll(!0),m.invalidateLight(),m.fp(ik,J,P),m._canvas.style.background=P.getBackground()||"")},handleDataModelPropertyChange:function(M){if("background"===M.property){var R=this._canvas.style.background,L=M.newValue||"";this._canvas.style.background=L,this.fp("canvasBackground",R,L)}else"envmap"===M.property&&this.iv()},handleDataPropertyChange:function(b){var y=b.data;this.invalidateData(y),Tg(y)&&"s:light.type"===b.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(l){var m=this,j=l.property;m.iv(),m._18Q=I,"eye"===j?m._33Q=!0:"devicePixelRatio"===j?m._42(I,m.getDevicePixelRatio()):Ge[j]&&Ar(m)},_5O:function(Z){var T=Z._22Q();return T?new T(this,Z):I},getData3dUI:function(a){var P=this._25I[a._id];return P===H&&(P=this._5O(a),this._25I[a._id]=P),P},invalidateAll:function(s){var t=this;if(s){for(var q in t._25I){var c=t._25I[q];c&&c.dispose()}t._25I={},t.iv(),bn(t)}else bn(t),t.dm().each(function(Q){t.invalidateData(Q)})},invalidateSelection:function(){var u=this;u.sm().each(function(C){u.invalidateData(C)})},invalidateData:function(V){var o=this,G=o.getData3dUI(V);G&&(G.iv(),o.iv()),bn(o,V)},getShape3dText:function(J){return J.getStyle("shape3d.text")||this.getLabel(J)},invalidateBatch:function(m){var P=this,A=P._batchModelMap,l=A[m],k=[],R={};if(l){l.ds.forEach(function(V){var e=P.getData3dUI(V);e&&e.iv(),delete P._batchIndexMap[V._id],k.push(V._id)}),delete A[m];for(var d,Y,n,$,S,D,j,W,x,p=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],s=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],g=0;g<p.length;g++){var E=P[p[g]],b=P[s[g]];for(R={},W=0;W<k.length;W++){var U=b[k[W]];if(U){delete b[k[W]],x=U.batch,d=E[x];var T=U.begin,C=U.size,X=3*T,y=3*C,o=4*T,e=4*C;for(Y=d.ds,n=d.vs,$=d.cs,S=d.ps,D=d.ls,j=U.index,d.invalidate=!0,Y[j]=H,j=X;X+y>j;j++)n[j]=H;for(j=o;o+e>j;j++)$[j]=H;for(j=o;o+e>j;j++)S[j]=H;if(D)for(j=X;X+y>j;j++)D[j]=H;R[x]=!0}}for(x in R){d=E[x],Y=d.ds,n=d.vs,$=d.cs,S=d.ps,D=d.ls;var f=[];for(j=0;j<Y.length;j++)Y[j]!==H&&f.push(Y[j]);if(0===f.length)delete E[x];else{for(d.ds=f,f=[],j=0;j<n.length;j++)n[j]!==H&&f.push(n[j]);for(d.vs=f,f=[],j=0;j<$.length;j++)$[j]!==H&&f.push($[j]);for(d.cs=f,f=[],j=0;j<S.length;j++)S[j]!==H&&f.push(S[j]);if(d.ps=f,D){for(f=[],j=0;j<D.length;j++)D[j]!==H&&f.push(D[j]);d.ls=f}}}}P.iv()}},handleDataModelChange:function(B){var r=this,n=B.kind,S=B.data;if("add"===n)r.invalidateData(S),Sg(S)&&S.getEdgeGroup()&&S.getEdgeGroup().eachSiblingEdge(r.invalidateData,r),Tg(S)&&r.invalidateLight();else if(n===Rf){var X=S._id,W=r._25I[X];W&&(W.dispose(),delete r._25I[X],r.iv()),S===r._currentSubGraph&&r.setCurrentSubGraph(I),bn(r,S),Tg(S)&&r.invalidateLight()}else n===Zd&&(r.invalidateAll(!0),r.setCurrentSubGraph(I),bn(r),r.invalidateLight())},toCanvas:function(i,x,C){var Y=this,n=Y.getGL();if(Y.validate(),i){var G=n.getParameter(n.COLOR_CLEAR_VALUE);_f(n,i)}Y._42(I,1);var p=Y.getWidth(),Q=Y.getHeight(),d=new Uint8Array(4*p*Q),F=Ue(),L=F.getContext("2d");n.readPixels(0,0,p,Q,n.RGBA,n.UNSIGNED_BYTE,d),op(F,p,Q,1);for(var N=L.getImageData(0,0,p,Q),X=N.data,_=0;_<X.length;_+=4){var w=_/4,o=$(w/p),D=w-o*p;w=4*((Q-1-o)*p+D),X[w]=d[_],X[w+1]=d[_+1],X[w+2]=d[_+2],X[w+3]=d[_+3]}if(L.putImageData(N,0,0),i&&_f(n,G),Y._42(I,Y.getDevicePixelRatio()),x&&C){var M=Ue(),s=M.getContext("2d");return x=x,C=C,op(M,x,C,1),h.drawImage(s,F,0,0,x,C),M}return F},toDataURL:function(F,l){var f=this,V=f.getGL();if(f.validate(),F){var C=V.getParameter(V.COLOR_CLEAR_VALUE);_f(V,F)}f._42(I,1);var A=f._canvas.toDataURL(l||"image/png",1);return F&&_f(V,C),f._42(I,f.getDevicePixelRatio()),A},getGL:function(){var m=this,p=m._26I;if(m._prg,!p)try{m._2O={},p=m._26I=m._canvas.getContext("webgl",m._attributes)||m._canvas.getContext("experimental-webgl",m._attributes),p._emptyTexture=ie(p),p._emptyBlendTexture=ie(p),p._bufPool={},p._id=++Ac,m._buffer={vs:de(p),ns:de(p),is:de(p),uv:de(p),batchColor:de(p),batchBlend:de(p),batchBrightness:de(p),lineDistance:de(p)},m._1O=jg(p);var y=m._cube={vs:de(p),ns:de(p),is:de(p),uv:de(p)};Cl(p,y.vs,nr),Cl(p,y.ns,mc),Cl(p,y.uv,qi),dl(p,y.is,mq)}catch(o){}return m.acquireProgram(),p},acquireProgram:function(){var Z=this,U=Z._26I;if(U){var A=j.Default.getImage(Z.dm().getEnvmap())?!0:!1,K=Z._prg&&Z._prg.envMapFlag?!0:!1;if(!Z._prg||A!==K){var q=Z._prg=U.createProgram();if(!q)return I;q.envMapFlag=A;var z=Z._dirs.length,_=Z._spots.length,O=Z._59O.length,J=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightColor","uFogColor","uFogNear","uFogFar"];z&&J.push("uDirColor","uDirDirection"),_&&J.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),O&&J.push("uPointColor","uPointRange","uPointPosition"),_f(U,[0,0,0,0]),U.clearDepth(1),U.enable(U.DEPTH_TEST),U.depthFunc(U.LEQUAL),U.enable(U.BLEND),U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA),rr||(Mk=eg(Mk.substring(0,Mk.indexOf("^#"))),Ig=eg(Ig),rr=!0);var n=["#define MAX_DIR "+z,"#define MAX_SPOT "+_,"#define MAX_POINT "+O,Z._fogDisabled?"":"#define FOG",Z._dashDisabled?"":"#define DASH",A?"#define USE_ENVMAP":"",Z._batchColorDisabled?"":"#define BATCHCOLOR",Z._batchBlendDisabled?"":"#define BATCHBLEND",Z._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),r=Te(U,q,U.VERTEX_SHADER,Mk.replace("PREFIX",n));U.getShaderParameter(r,U.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",U.getShaderInfoLog(r));var H=Te(U,q,U.FRAGMENT_SHADER,Ig.replace("PREFIX",n));U.getShaderParameter(H,U.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",U.getShaderInfoLog(H)),E?J.push("aPosition"):(q.aPosition=0,U.bindAttribLocation(q,0,"aPosition")),U.linkProgram(q),J.forEach(function(y){q[y]=/^u/.test(y)?U.getUniformLocation(q,y):U.getAttribLocation(q,y)}),U.useProgram(q),U.deleteShader(r),U.deleteShader(H)}}},getBrightness:function(r){var Z=r.s("brightness"),U=this.isSelected(r)?r.s("select.brightness"):I;return Z==I?U:U==I?Z:Z*U},bindEnvMap:function(I){var N=this,h=N._prg,D=5,H=N.dm().getEnvmap(),l=j.Default.getImage(H);if(l){if(H!==N._lastEnvMap){N._envMapTexture&&I.deleteTexture(N._envMapTexture);var v=N._envMapTexture=I.createTexture();I.bindTexture(I.TEXTURE_CUBE_MAP,v),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_CUBE_MAP,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,l),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,l),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,l),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,l),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,l),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,l),I.bindTexture(I.TEXTURE_CUBE_MAP,null),N._lastEnvMap=H}I.activeTexture(I.TEXTURE0+D),I.bindTexture(I.TEXTURE_CUBE_MAP,N._envMapTexture),I.uniform1i(h.uEnvMap,D)}},getWireframe:function(Y){var y=Y.s("wf.visible"),t=Y.s("wf.width");return y===!0||t>0&&"selected"===y&&this.isSelected(Y)?{color:Y.s("wf.color"),width:t,"short":Y.s("wf.short"),mat:Y.s("wf.mat")}:void 0},_transformPointToViewSpace:function(p){var d=[p[0],p[1],p[2]];return Ph(d,this._viewMatrix),d},_transformDirectionToViewSpace:function(r,C){var b=[r[0],r[1],r[2]];Ph(b,this._viewMatrix);var T=C?[C[0],C[1],C[2]]:[0,0,0];Ph(T,this._viewMatrix);var E=T[0]-b[0],e=T[1]-b[1],g=T[2]-b[2],P=Math.sqrt(E*E+e*e+g*g);return P?[E/P,e/P,g/P]:[E,e,g]},getWireframeGeometry:function(k){return k.s("wf.geometry")?{color:k.s("wf.color"),width:k.s("wf.width"),mat:k.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(j){return j.s("body.color")},getMat:function(R){return R.getMat?R.getMat():R.s("mat")},getFaceMat:function(A,x){return A.getFaceMat?A.getFaceMat(x):A.s(x+".mat")},getFaceBlend:function(i,K){return i.s(K+".blend")||i.s("all.blend")},getFaceColor:function(p,w){return p.s(w+".color")||p.s("all.color")},getFaceImage:function(Y,X){return Y.s(X+".image")||Y.s("all.image")},getFaceBlendImage:function(t,$){return t.s($+".blend.image")||t.s("all.blend.image")},getFaceDiscardSelectable:function(T,Q){var x=T.s(Q+".discard.selectable");return x==I?T.s("all.discard.selectable"):x},getFaceUv:function(a,V){return a.s(V+".uv")||a.s("all.uv")},getFaceUvOffset:function(G,X){return G.s(X+".uv.offset")||G.s("all.uv.offset")},getFaceUvScale:function(J,i){return J.s(i+".uv.scale")||J.s("all.uv.scale")},getFaceLight:function(d,W){var i=d.s(W+".light");return i==I?d.s("all.light"):i},getFaceVisible:function(U,C){var f=U.s(C+".visible");return f==I?U.s("all.visible"):f},getFaceOpacity:function(D,M){var A=D.s(M+".opacity");return A==I?D.s("all.opacity"):A},getFaceTransparent:function(r,b){var e=r.s(b+".transparent");return e==I?r.s("all.transparent"):e},getFaceReverseColor:function(C,r){return C.s(r+".reverse.color")||C.s("all.reverse.color")},getFaceReverseFlip:function(L,H){var V=L.s(H+".reverse.flip");return V==I?L.s("all.reverse.flip"):V},getFaceReverseCull:function(c,v){var x=c.s(v+".reverse.cull");return x==I?c.s("all.reverse.cull"):x},getTextureMap:function(){return this._2O},deleteTexture:function(k){var j=this,z=j._2O[k];z&&(delete j._2O[k],j.getGL().deleteTexture(z))},invalidateShape3dCachedImage:function(c){var l=this.getData3dUI(c);l.invalidateCachedTexture(this.getGL())},isInteractive:function(q){return q.s("interactive")},getTexture:function(O,s){if(!O)return I;var q=this,R=q.getGL(),X=q._2O[O];if(!X){var l=qp(O);if(l)if(l.tagName){if(l.dynamic)return jg(R,l,q._1O);X=q._2O[O]=jg(R,l)}else{var W,b=s&&s.s("shape3d.image.cache")&&!q.isInteractive(s),T=q.vr.isPresenting();T&&(s._textureUpdateFrame===R._renderInfo.frame?b=!0:s._textureUpdateFrame=R._renderInfo.frame),b&&(W=q.getData3dUI(s),X=W.getCachedTexture());var V;if(!X){var Q=s&&s.s("shape3d.fixSizeOnScreen"),F=Q?R.NEAREST:R.LINEAR;Q||s&&s.s("shape3d.vector.dynamic")&&(W||(W=q.getData3dUI(s)),Q=W.getVectorDynamicSize(),Q&&(V=q.getDevicePixelRatio(),Q[0]*=V,Q[1]*=V));var P,L,t=s&&s.s("shape3d.texture.scale")||1;if(Q?(V||(V=q.getDevicePixelRatio()),P=Q[0]>0?Q[0]:t*uf(l,s)*V,L=Q[1]>0?Q[1]:t*Xd(l,s)*V):(P=t*uf(l,s),L=t*Xd(l,s)),P>=1&&L>=1){var p=Qp(P,L);if(!W&&s&&(W=q.getData3dUI(s)),W&&W.interactiveInfo){var h=W.interactiveInfo[O]={};p.interactiveInfo=h.bodyInfo={compInfos:[],matrix:new ng,rect:{x:0,y:0,width:P,height:L}}}_i(p,l,0,0,P,L,s,q),p.interactiveInfo&&(p.interactiveInfo=null),p.restore(),(b||T)&&fl(l,s)?(X=jg(R,Kj,null,F),W.setCachedTexture(X),Kj=null):X=jg(R,Kj,q._1O,F)}}}}return X},redraw:function(){this.iv()},validateImpl:function(){var X=this;if(X._lightChanged){X._lightChanged=!1;var b=[],c=[],_=[];X.dm().each(function(N){if(Tg(N)){var g=N.s("light.type");g===Hi?b.push(N):g===ee?c.push(N):g===qn&&_.push(N)}}),(b.length!==X._59O.length||c.length!==X._spots.length||_.length!==X._dirs.length)&&Ar(X),X._59O=b,X._spots=c,X._dirs=_}X._42(),X._1o.iv()},getRenderInfo:function(){var J=this.getGL();return J?J._renderInfo:void 0},showDebugTip:function(){var n=this,h=n._debugDiv;if(!h){h=n._debugDiv=i.createElement("div"),h.style.position="absolute",h.style.overflow="hidden",h.style.backgroundColor="white",h.style.color="black";var y=n.getView();n._79O?y.insertBefore(h,n._79O):y.appendChild(h),n._debugTipTimerId=setInterval(function(){var u=n.getRenderInfo();if(u){var N=n.getGL()._validBufCount||0,D="Draw Calls: "+u.calls+"<br/>"+"Vertices: "+u.vertices+"<br/>"+"Faces: "+u.faces+"<br/>"+"Lines: "+u.lines+"<br/>"+"Buffer Count: "+N;n.vr.isPresenting()&&(D+="<br/>VR fps: "+n.vr.getFps()),h.innerHTML=D}},10)}},hideDebugTip:function(){var i=this,y=i._debugDiv;y&&(delete i._debugDiv,cancelAnimationFrame(i._debugTipTimerId),delete i._debugTipTimerId,i.getView().removeChild(y))},_42:function(P,C){var a=this;if(!a._35O&&(!tf||xm(tf))){var z,n;P&&(P instanceof yq?n=P:z=P);var H=a._canvas,y=a.getGL(),e=a._prg;if(y){var p=a.getWidth(),l=a.getHeight();C?P||op(H,p,l,C):(C=a.getDevicePixelRatio(),P||p===H.clientWidth&&l===H.clientHeight||op(H,p,l,C)),y.clear(y.COLOR_BUFFER_BIT),y._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:P?a._frameId:++a._frameId};var G=function(){if(a.overlappingBox.clear(),a._81O=I,y.clear(y.DEPTH_BUFFER_BIT),ti(y,e.uBrightness,1),ti(y,e.uOpacity,1),ti(y,e.uPartOpacity,1),y._picking=!!P,ti(y,e.uPick,!!P),ti(y,e.uTexture,!1),ti(y,e.uBlendTexture,!1),ti(y,e.uAlphaTest,v.alphaTest),ti(y,e.uTransparent,!1),ti(y,e.uFix,!1),ti(y,e.uBatchColor,!1),ti(y,e.uBatchBlend,!1),ti(y,e.uBatchBrightness,!1),ti(y,e.uReflectivity,a._envmapReflectivity||.5),ti(y,e.uCameraPosition,a.getEye()),ti(y,e.uPMatrix,a._projectMatrix=Br(a)),ti(y,e.uViewMatrix,tr(a,a._7O)),a.bindEnvMap(y),a._viewMatrix=Lc(a._7O),P||(Hc(a,y,e),a._fogDisabled||(ti(y,e.uFogColor,a._fogColor),ti(y,e.uFogNear,a._fogNear),ti(y,e.uFogFar,a._fogFar))),fo(y,e.aPosition),fo(y,e.aNormal),lq(y,e.aUv),lq(y,e.aBatchColor),lq(y,e.aBatchBlend),lq(y,e.aBatchBrightness),lq(y,e.aLineDistance),n){var f=y.getParameter(y.COLOR_CLEAR_VALUE);y.clearColor(0,0,0,0),y.disable(y.BLEND),lq(y,e.aNormal),Cl(y,a._cube.vs,I,e.aPosition),dl(y,a._cube.is),Up(n,a,Mn,0),Up(n,a,uq,6),Up(n,a,rj,12),Up(n,a,gh,18),Up(n,a,yo,24),Up(n,a,Fl,30),fo(y,e.aNormal),_f(y,f)}else if(z){z.value=2;var f=y.getParameter(y.COLOR_CLEAR_VALUE);y.clearColor(0,0,0,0),y.disable(y.BLEND),a._95I(y,e,z),Fi(a,z),_o(a,a._polylineModelMap,z),_o(a,a._wireframeModelMap,z),ti(y,e.uTransparent,!0),a._95I(y,e,z,!0),Fi(a,z,!0),_o(a,a._polylineModelMap,z,!0),_o(a,a._wireframeModelMap,z,!0),ti(y,e.uTransparent,!1),y.clear(y.DEPTH_BUFFER_BIT),a._swapLineMap(),a._95I(y,e,z,!1,!0),_o(a,a._polylineModelMap,z),_o(a,a._wireframeModelMap,z),a._swapLineMap(),a._swapLineMap(),a._95I(y,e,z,!1,!0),_o(a,a._polylineModelMap,z),_o(a,a._wireframeModelMap,z),ti(y,e.uTransparent,!0),a._95I(y,e,z,!0,!0),_o(a,a._polylineModelMap,z,!0),_o(a,a._wireframeModelMap,z,!0),ti(y,e.uTransparent,!1),a._swapLineMap(),y.disable(y.DEPTH_TEST),a.drawFilter||a._30O._42(y,e,z),y.enable(y.DEPTH_TEST),_f(y,f)}else y.disable(y.BLEND),a.drawSky(y,e),a._31O._42(y,e),a._95I(y,e),Fi(a),_o(a,a._polylineModelMap),_o(a,a._wireframeModelMap),y.enable(y.BLEND),ti(y,e.uTransparent,!0),y.depthMask(!1),a._95I(y,e,I,!0),Fi(a,I,!0),_o(a,a._polylineModelMap,I,!0),_o(a,a._wireframeModelMap,I,!0),y.depthMask(!0),ti(y,e.uTransparent,!1),y.clear(y.DEPTH_BUFFER_BIT),a._swapLineMap(),y.disable(y.BLEND),a._95I(y,e,I,!1,!0),_o(a,a._polylineModelMap),_o(a,a._wireframeModelMap),y.enable(y.BLEND),ti(y,e.uTransparent,!0),y.depthMask(!1),a._95I(y,e,I,!0,!0),_o(a,a._polylineModelMap,I,!0),_o(a,a._wireframeModelMap,I,!0),y.depthMask(!0),ti(y,e.uTransparent,!1),a._swapLineMap(),y.disable(y.DEPTH_TEST),y.disable(y.BLEND),a._32O._42(y,e),a._30O._42(y,e),a._highlightHelper._42(y,e),y.enable(y.DEPTH_TEST);Cl(y,I),dl(y,I)},c=!1,h=p*C,u=l*C,E=a.vr;E.enable&&E._42(y,h,u,G)&&(c=!0);var k=a.envRenderer;k&&k.enable&&k._42(y,h,u,G)&&(c=!0);var R=a._postProcessing;R._42(y,h,u,G,P)&&(c=!0),c||(a.setViewport(y,0,0,p*C,l*C),G()),a._33Q=!1,a._doBufferGC(y)}}},enablePostProcessing:function(o,f){return this._postProcessing.enableModule(o,f)},getPostProcessingModule:function(q){return this._postProcessing.getModule(q)},setViewport:function(W,K,u,I,a){this._viewport=[K,u,I,a],W.viewport(K,u,I,a)},getViewport:function(){return this._viewport},setBufferGCInterval:function(w){this._bufferGCInterval=w},_doBufferGC:function(r,G){var T,g,Y=r._bufPool,C=0,A=0,i=r._renderInfo.frame,H=this._bufferGCInterval||10;for(T in Y)C++,g=Y[T],g&&(G||i-g._fid>H?(r.deleteBuffer(g._buf),g._buf=null,Y[T]=null):A++);if(C/2>A&&C>128){var D={};for(T in Y)Y[T]&&(D[T]=Y[T]);r._bufPool=D}r._validBufCount=A},_swapLineMap:function(){var A=this;Z=A._polylineModelMap,A._polylineModelMap=A._polylineModelMapSwap,A._polylineModelMapSwap=Z,Z=A._wireframeModelMap,A._wireframeModelMap=A._wireframeModelMapSwap,A._wireframeModelMapSwap=Z,Z=A._polylineIndexMap,A._polylineIndexMap=A._polylineIndexMapSwap,A._polylineIndexMapSwap=Z,Z=A._wireframeIndexMap,A._wireframeIndexMap=A._wireframeIndexMapSwap,A._wireframeIndexMapSwap=Z},_updateSkyBoxPosition:function(t){if(this._skyBox&&t&&"eye"===t.property){var C=t.newValue;this._skyBox.p3(C[0],C[1],C[2]),this.invalidateData(this._skyBox)}},setSkyBox:function(W){var a=this._skyBox;a&&this._skyBoxStyleMap&&(a.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null),this._skyBox=W,this.ump(this._updateSkyBoxPosition,this),W&&(W.dm()&&W.dm().remove(W),this._skyBoxStyleMap=j.Default.clone(W.getStyleMap()),W.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBoxPosition,this),this._updateSkyBoxPosition({property:"eye",newValue:this.getEye()})),this.fp("skyBox",a,W)},drawSky:function(G,e,b){var K=this,d=K._skyBox;if(d){var i=K._headlightIntensity,L=nb(K._headlightColor),e=K._prg;1!==i&&(L=[L[0]*i,L[1]*i,L[2]*i]),ti(G,e.uHeadlightColor,[L[0],L[1],L[2],1]);var Z=K.getData3dUI(d);Z&&Z._42(G,e,b,function(){return!0}),G.clear(G.DEPTH_BUFFER_BIT),ti(G,e.uHeadlightColor,[L[0],L[1],L[2],K._headlightDisabled?1:0])}},_95I:function($,d,l,K,G){function Y(M){if(!!M.s("shape3d.alwaysOnTop")==!!G&&a.isVisible(M)&&(!T||F)){if(!l&&a.isTransparentMask(M))return;var r=a.getData3dUI(M);r&&r._42($,d,l,H)}}var a=this,H=function(b){return K?b:!b};a.sky&&$.clear($.DEPTH_BUFFER_BIT);var V=a.drawFilter;V?a.dm().each(function(_){V(_)||Y(_)}):a.dm().each(function(Z){Y(Z)})},getLogicalPoint:function(f){return ro(f,this._canvas)},isRectOverlapping:function(W){var g=this.getData3dUI(W);return g._rectOverlapping},getHitFaceInfo:function(L){L.target&&(L=this.lp(L));var t=this.getDataInfoAt(L);if(t){var H=this._1o.face(t.data,Xq(L.x,L.y));if(H)return{data:t.data,face:H}}return I},unproject:function(d,h){var Q=this,$=Q.getWidth(),r=Q.getHeight(),p=d.target?Q.lp(d):d,f=p.x-$/2,E=p.y-r/2,X=2*(f/$),N=2*(-1*E/r);h=h||0;var i=Fn(),L=Br(Q),J=tr(Q);Fc(i,L,J),Nc(i);var U=Hn([X,N,h,1],i);return[U[0]/U[3],U[1]/U[3],U[2]/U[3]]},getDataAt:function(o){var B=this.getDataInfoAt(o);return B?B.data:I},getDataInfoAt:function(m,V){return m.target&&(m=this.lp(m)),this._1o.get(Xq(m.x,m.y,V),!0)},getDatasInRect:function(u){return this._1o.get(u)},setEditable:function(N){var A=this,O=A._editable;A._editable=N,this.fp(hm,O,N)},isEditable:function(X){var J=this;return J._editable?er(X)?X.s("3d.editable")?J._editableFunc?J._editableFunc(X):!0:!1:!1:!1},isSelectable:function(P){return P.s("3d.selectable")&&this.sm().isSelectable(P)},isMovable:function(C){var T=this;return Sg(C)&&C.getStyle(rd)!==iq?!1:C.s("3d.movable")?T._movableFunc?T._movableFunc(C):!0:!1},isSizeEditable:function(G){return er(G)?this._sizeEditableFunc?this._sizeEditableFunc(G):!0:!1},isRotationEditable:function(b){return er(b)&&b.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(b):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(U){this.setZoom(yj,U)},zoomOut:function(V){this.setZoom(1/yj,V)},setZoom:function(u,H){if(1!==u){var A=this;if(A._ortho)return A.setOrthoZoom(u,H),void 0;A._14o&&A._14o.stop(!0);var B=1/u,S=A._eye,e=A._center,R=e[0]+(S[0]-e[0])*B-S[0],z=e[1]+(S[1]-e[1])*B-S[1],l=e[2]+(S[2]-e[2])*B-S[2];if(!(em(S,e)<A._moveStep&&1>B)){if(H=fq(H)){var T=oc(S);return H.action=function(s){A.fi({kind:A._zooming?"betweenZoom":"beginZoom"}),A._zooming=1,S[0]=T[0]+R*s,S[1]=T[1]+z*s,S[2]=T[2]+l*s,A.fp(Lm,I,S)},H._37o=function(){delete A._14o,delete A._zooming,A.fi({kind:"endZoom"}),A.onZoomEnded()},A._14o=Vi(H)}S[0]+=R,S[1]+=z,S[2]+=l,A.fp(Lm,I,S)}}},setOrthoZoom:function(V,X){if(1!==V){var n=this;n._14o&&n._14o.stop(!0);var N=n._orthoWidth,y=N/V-N;if(!(N<n._moveStep&&V>1))return(X=fq(X))?(X.action=function(K){n.fi({kind:n._zooming?"betweenZoom":"beginZoom"}),n._zooming=1,n.setOrthoWidth(N+y*K)},X._37o=function(){delete n._14o,delete n._zooming,n.fi({kind:"endZoom"}),n.onZoomEnded()},n._14o=Vi(X)):(n.setOrthoWidth(N/V),void 0)}},getPositionInfo:function(B){var l=this,y=l._eye,q=l._center,o=l.getAspect(),G=B?Xh(Ip(q,y,!0),Ip(B,y)):em(y,q);if(l._ortho){var C=l._orthoWidth;return{length:G,height:C/o,width:C}}var A=2*V(l._fovy/2)*G;return{length:G,height:A,width:A*o}},getCenterInfo:function(){var F=this;return F._81O||(F._81O=F.getPositionInfo()),oc(F._81O)},rotate:function(d,K,$,J){var v=this;if(d||K){J==I&&(J=v._firstPersonMode),v._88O&&v._88O.stop(!0);var r=v._center,M=v._eye,x=v.getCenterInfo().length,R=J?r:M,m=J?M:r,Z=Ip(R,m),b=B(Z[0],Z[2]),_=B(p(Z[0]*Z[0]+Z[2]*Z[2]),Z[1]),G=J?Ai:Lm;return J&&(K=-K),($=fq($))?($.action=function(o){v.fi({kind:v._rotating?"betweenRotate":"beginRotate"}),v._rotating=1;var M=b+d*o,j=_+K*o;j=Tk(j),Z[0]=x*f(j)*f(M),Z[1]=x*O(j),Z[2]=x*f(j)*O(M),R[0]=m[0]+Z[0],R[1]=m[1]+Z[1],R[2]=m[2]+Z[2],v.fp(G,I,R)},$._37o=function(){delete v._88O,delete v._rotating,v.fi({kind:"endRotate"}),v.onRotateEnded()},v._88O=Vi($)):(b+=d,_+=K,_=Tk(_),Z[0]=x*f(_)*f(b),Z[1]=x*O(_),Z[2]=x*f(_)*O(b),R[0]=m[0]+Z[0],R[1]=m[1]+Z[1],R[2]=m[2]+Z[2],v.fp(G,I,R),void 0)}},pan:function(G,x,u,l){if(G||x){var s=this;l==I&&(l=s._firstPersonMode),s._89O&&s._89O.stop(!0);var X=tr(s),Z=[X[0]*G,X[4]*G,X[8]*G],h=[X[1]*x,X[5]*x,X[9]*x],$=Z[0]+h[0],r=Z[1]+h[1],n=Z[2]+h[2],q=s._center,K=s._eye;if(l){var m=Ff(s.getBoundaries(),K[0],K[2],K[0]+$,K[2]+n,p($*$+n*n));$=m[0],n=m[1]}if(u=fq(u)){var j=oc(K),N=oc(q);return u.action=function(v){s.fi({kind:s._panning?"betweenPan":"beginPan"}),s._panning=1,q[0]=N[0]+$*v,q[1]=N[1]+r*v,q[2]=N[2]+n*v,K[0]=j[0]+$*v,K[1]=j[1]+r*v,K[2]=j[2]+n*v,s.fp(Lm,I,K),s.fp(Ai,I,q)},u._37o=function(){delete s._89O,delete s._panning,s.fi({kind:"endPan"}),s.onPanEnded()},s._89O=Vi(u)}q[0]+=$,q[1]+=r,q[2]+=n,K[0]+=$,K[1]+=r,K[2]+=n,s.fp(Lm,I,K),s.fp(Ai,I,q)}},walk:function(D,u,Q){if(D){var B=this;Q==I&&(Q=B._firstPersonMode),B._90O&&B._90O.stop(!0);var i=B._center,w=B._eye,G=Ip(i,w,!0);if(Q){var r=Ff(B.getBoundaries(),w[0],w[2],w[0]+G[0]*D,w[2]+G[2]*D,J(D));if(D=em(r),!D)return;G=[r[0]/D,0,r[1]/D]}if(u=fq(u)){var e=oc(w),k=oc(i);return u.action=function(X){B.fi({kind:B._walking?"betweenWalk":"beginWalk"}),B._walking=1;var g=D*X;w[0]=e[0]+G[0]*g,w[1]=e[1]+G[1]*g,w[2]=e[2]+G[2]*g,i[0]=k[0]+G[0]*g,i[1]=k[1]+G[1]*g,i[2]=k[2]+G[2]*g,B.fp(Lm,I,w),B.fp(Ai,I,i)},u._37o=function(){delete B._90O,delete B._walking,B.fi({kind:"endWalk"}),B.onWalkEnded()},B._90O=Vi(u)}w[0]+=G[0]*D,w[1]+=G[1]*D,w[2]+=G[2]*D,i[0]+=G[0]*D,i[1]+=G[1]*D,i[2]+=G[2]*D,B.fp(Lm,I,w),B.fp(Ai,I,i)}},handleScroll:function(J,m){J.preventDefault();var P=this,r=P._moveStep;P.isFirstPersonMode()?P.isPannable()&&P.pan(0,m>0?r:-r):P.isZoomable()&&P.setZoom(0>m?1/Wd:Wd)},handlePinch:function(V,I){this.isZoomable()&&this.setZoom(I>V?1/zl:zl)},reset:function(){this.setCenter(h.graph3dViewCenter),this.setEye(h.graph3dViewEye),this.setUp(h.graph3dViewUp)},moveSelection:function(O,Z,X){var v=this;v.dm().beginTransaction(),Cs(this.sm().toSelection(this.isMovable,this),O,Z,X),v.dm().endTransaction()},getMoveMode:function(C,l){var w=l.s("3d.move.mode");if(w)return w;var e="88",I="89",n="90";return Ah(C)||ij[e]&&ij[I]&&ij[n]?"xyz":ij[e]&&ij[I]?"xy":ij[e]&&ij[n]?"xz":ij[I]&&ij[n]?"yz":ij[e]?"x":ij[I]?"y":ij[n]?"z":"xz"},handleTick:function(){var K=this,V=!1,$=K._moveStep,J=$,b=!1,C=!0,l=K._rotateStep*(C?-1:1);if(K.isWalkable()||(J=0),K.isPannable()||($=0),K.isRotatable()||(l=0),K._32Q){var H=(Xi()-K._32Q)/50;J*=H,$*=H,l*=H}K._31Q&&(ne(K._31Q),delete K._31Q,delete K._32Q),ec()&&(V=!0,K.pan(-$,0,b,C)),mr()&&(V=!0,K.pan($,0,b,C)),oo()&&(V=!0,Ah()?K.pan(0,$,b,C):K.walk(J,b,C)),Mm()&&(V=!0,Ah()?K.pan(0,-$,b,C):K.walk(-J,b,C)),Od()&&(V=!0,K.rotate(-l,0,b,C)),Id()&&(V=!0,K.rotate(l,0,b,C)),Nl()&&(V=!0,K.rotate(0,-l/2,b,C)),Ik()&&(V=!0,K.rotate(0,l/2,b,C)),V&&(K._32Q=Xi(),K._31Q=Cr(K.handleTick,K))},handleKeyDown:function(y){var S=this;!aq(y)&&vg[y.keyCode]?S.handleTick():Ic(y)?S.selectAll():Ce(y)?S.handleDelete(y):ib(y)&&this.isResettable()&&S.reset()},checkDoubleClickOnNote:function(E,f,H){var U=this;if(H===_p){if(f.s("note.toggleable"))return f.s(xb,!f.s(xb)),U.fi({kind:"toggleNote",event:E,data:f,part:H}),!0}else if(H===hi&&f.s("note2.toggleable"))return f.s(Ub,!f.s(Ub)),U.fi({kind:"toggleNote2",event:E,data:f,part:H}),!0;return!1},checkDoubleClickOnRotation:function(j,V,i){return i===pk?(V.setRotationX(0),!0):i===Cp?(V.setRotationY(0),!0):i===yi?(V.setRotationZ(0),!0):!1
},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(c){var Z=this;if(Z.isOrtho())return Z.getWidth()/Z.getOrthoWidth();var b=Z.getCenter(),D=Z.getHeight(),j=Z.getEye(),z=[b[0]-j[0],b[1]-j[1],b[2]-j[2]],E=[c[0]-j[0],c[1]-j[1],c[2]-j[2]],C=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),l=1/Math.tan(Z.getFovy()/2);return D*C*l/(E[0]*z[0]+E[1]*z[1]+E[2]*z[2])},inViewSpace:function(L){var y,Q=this,b=Q._transformPointToViewSpace(L),i=Q.getAspect(),e=Q.getNear(),l=Q.getFar();return-b[2]<e||-b[2]>l?!1:Q.isOrtho()?(y=Q.getOrthoWidth()/2,Math.abs(b[0])<=y&&Math.abs(b[1]*i)<=y):(y=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])*Math.tan(Q.getFovy()/2),Math.abs(b[1]<=y)&&Math.abs(b[0])<=y*i)},toViewPosition:function(C){var E=this,O=E.getWidth()/2,o=E.getHeight()/2,Q=E._18Q;return Q&&Q._wh===O/o||(Q=Br(E),E._18Q=Fc(Q,Q,tr(E)),E._18Q._wh=O/o),C=Hn([C[0],C[1],C[2],1],Q),{x:O+O*C[0]/C[3],y:o-o*C[1]/C[3]}},getHitPosition:function(E,w,I){var h=this,t=h.getWidth(),m=h.getHeight(),p=E.target?h.lp(E):E,y=p.x-t/2,u=p.y-m/2,T=h.getCenterInfo(),A=tr(h);w=w?w:[0,0,0],I=I?I:[0,1,0],y=y/t*T.width,u=-1*u/m*T.height;var n=[A[0]*y,A[4]*y,A[8]*y],Y=[A[1]*u,A[5]*u,A[9]*u],H=[n[0]+Y[0],n[1]+Y[1],n[2]+Y[2]],z=h.getCenter(),F=Bi(h,w,I,[H[0]+z[0],H[1]+z[1],H[2]+z[2]]);return F?F:[0,0,0]},intersectObject:function(T,I){return this._raycaster.intersectObject(T,I)},intersectObjects:function(s,X,v){return this._raycaster.intersectObjects(s,X,v)},getLineLength:function(v){this.validate();var M=this.getData3dUI(v);if(M&&M.getCache){var R=M.getCache();if(R)return R[R.length-1].length}return 0},getLineOffset:function(p,H){var r=this.getData3dUI(p);if(r&&r.getCache){var x=r.getCache();if(x)return kc(x,H)}return I},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},flyTo:function(){function K(t,C,E){if(E instanceof j.Node){f.fromArray(gq(E,C.getMat(E)));var H=E.getAnchor3d();t.push((new Wi).set(0-H.x,0-H.y,0-H.z).applyMatrix4(f)),t.push((new Wi).set(0-H.x,0-H.y,1-H.z).applyMatrix4(f)),t.push((new Wi).set(0-H.x,1-H.y,0-H.z).applyMatrix4(f)),t.push((new Wi).set(0-H.x,1-H.y,1-H.z).applyMatrix4(f)),t.push((new Wi).set(1-H.x,0-H.y,0-H.z).applyMatrix4(f)),t.push((new Wi).set(1-H.x,0-H.y,1-H.z).applyMatrix4(f)),t.push((new Wi).set(1-H.x,1-H.y,0-H.z).applyMatrix4(f)),t.push((new Wi).set(1-H.x,1-H.y,1-H.z).applyMatrix4(f))}}var X=new Wi,P=new Wi,p=new Wi,y=new Wi,f=new vn,$=new j.Math.Quaternion,E=new Rn;return function(C,u,S){var g=this;if(S!==H)u={animation:u,ratio:S};else{var x=typeof u;("boolean"===x||"object"===x&&u.duration)&&(u={animation:u})}u=u||{},X.fromArray(g.getEye()),P.fromArray(g.getCenter());var m,N,R=[],b=u.center,L=u.distance===H;if(b&&p.fromArray(b),C instanceof j.Node)b||p.fromArray(C.p3()),L&&(K(R,g,C),m=R.length);else{if(C||(C=g.dm().getDatas()),!C.length)return;if((L||!b)&&(R=[],C.forEach(function(D){K(R,g,D)}),m=R.length),!m)return;if(!b){for(p.set(0,0,0),N=0;m>N;N++)p.add(R[N]);p.multiplyScalar(1/m)}}if(g.setCenter(p.x,p.y,p.z),y.subVectors(X,P),u.direction||u.worldDirection){!u.worldDirection&&C instanceof j.Node?$.setFromEuler(E.set(C.r3(),C.getRotationMode(),!0)):$.set(0,0,0,1);var D=y.length();y.fromArray(u.worldDirection||u.direction).applyQuaternion($).setLength(D)}if(L){for(var n,r,O,A,d,M=g.getNear(),t=10,S=u.ratio||.8;t--;){for(g._eye[0]=y.x+p.x,g._eye[1]=y.y+p.y,g._eye[2]=y.z+p.z,n=Br(g),Fc(n,n,tr(g)),A=!0,d=-1/0,N=0;m>N;N++){if(O=R[N],r=Hn([O.x,O.y,O.z,1],n),r[3]<M&&t){y.multiplyScalar(2),A=!1;break}d=Math.max(d,Math.max(Math.abs(r[0]),Math.abs(r[1]))/S-r[3])}if(A)break}y.setLength(d+y.length()).add(p)}else y.setLength(u.distance).add(p);g._flyAnim&&g._flyAnim.stop(!0);var c=fq(u.animation);if(c){g.setEye(X.x,X.y,X.z),g.setCenter(P.x,P.y,P.z);var I=(new Wi).subVectors(y,X),s=(new Wi).subVectors(p,P),U=new Wi,F=new Wi;return c.action=function(T){U.copy(X).addScaledVector(I,T),F.copy(P).addScaledVector(s,T),g.setCenter(F.x,F.y,F.z),g.setEye(U.x,U.y,U.z)},c._37o=function(){delete g._flyAnim},{lastEye:X,lastCenter:P,eye:y,center:p,animation:g._flyAnim=Vi(c)}}return g.setEye(y.x,y.y,y.z),{lastEye:X,lastCenter:P,eye:y,center:p}}}(),getBoundingBox:function(){function e(m,l,k){R.fromArray(gq(k,l.getMat(k)));var i=k.getAnchor3d();m.push((new Wi).set(0-i.x,0-i.y,0-i.z).applyMatrix4(R)),m.push((new Wi).set(0-i.x,0-i.y,1-i.z).applyMatrix4(R)),m.push((new Wi).set(0-i.x,1-i.y,0-i.z).applyMatrix4(R)),m.push((new Wi).set(0-i.x,1-i.y,1-i.z).applyMatrix4(R)),m.push((new Wi).set(1-i.x,0-i.y,0-i.z).applyMatrix4(R)),m.push((new Wi).set(1-i.x,0-i.y,1-i.z).applyMatrix4(R)),m.push((new Wi).set(1-i.x,1-i.y,0-i.z).applyMatrix4(R)),m.push((new Wi).set(1-i.x,1-i.y,1-i.z).applyMatrix4(R))}var R=new vn;return function(R){if(R=R||this.sm().getSelection(),R instanceof j.Node&&(R=[R]),0===R.length)return I;var c=[];R.forEach(function(f){e(c,this,f)},this);var K=[1/0,1/0,1/0],m=[-1/0,-1/0,-1/0];return c.forEach(function(F){K[0]=Math.min(F.x,K[0]),K[1]=Math.min(F.y,K[1]),K[2]=Math.min(F.z,K[2]),m[0]=Math.max(F.x,m[0]),m[1]=Math.max(F.y,m[1]),m[2]=Math.max(F.z,m[2])}),{min:K,max:m}}}()}),Uq.RenderEnv=function(U){this.gv=U,this.enable=!1},C.defineProperties(Uq.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(b){this._debugOn=b,this.capture&&this.capture()}}}),C.assign(Uq.RenderEnv.prototype,{renderEnvToCube:function(o,v,F,k){var H=this,m=H.gv;if(!o||!v||!F)return H.enable=!1,H._42=null,void 0;H.enable=!0;var N=Math.floor(k/o*v),g=m.getGL(),z=H._renderTargets;z?z.length<F&&(z=H._renderTargets=z.concat(new Array(F-z.length))):z=H._renderTargets=new Array(F);for(var j=0;F>j;j++)z[j]?z[j].setSize(g,k,N):z[j]=new Uq.RenderTarget(m,g,k,N);var h=!1;H.capture=function(){h=!0,m._42(),h=!1};var Z=new Wi,q=new Wi,d=new Wi,K=new Wi,_=(new Wi).setY(0),t=2*Math.PI/F,w=o/2/Math.tan(Math.PI/F),e=2*Math.atan2(v/2,w),l=o/v;H._42=function(p,V,C,f){var k=H._debugOn;if(!h&&!k)return!1;Z.copy(m.getEye()),K.copy(m.getCenter()).sub(Z);var D=Math.atan2(K.z,K.x),B=m.getNear(),U=m.getFovy(),O=m.getAspect();q.copy(m.getCenter());for(var j,x=0;F>x;x++)if(j=z[x],_.setZ(Math.cos(D)).setX(Math.sin(D)).multiplyScalar(w),D-=t,d.addVectors(Z,_),m.setNear(w),m.setCenter([d.x,d.y,d.z]),m.setFovy(e),m.setAspect(l),k){var T=Math.round(V/F);p.viewport(T*x,0,T,C),f()}else is(p,j.frame),p.viewport(0,0,j.width,j.height),p.clear(p.COLOR_BUFFER_BIT),f(),is(p,I),j.assureTexture();return m.setNear(B),m.setCenter([q.x,q.y,q.z]),m.setFovy(U),m.setAspect(O),!0},H.capture()},getTextureInfo:function(P){var Q=this._renderTargets;if(!Q)return null;var J=this._renderTargets[P];return J?{index:P,texture:J.texture,textureName:J.uuid}:null}}),C.assign(Uq.Graph3dView.prototype,{renderEnvToCube:function(i,e,f,w){var o=this;o.envRenderer||(o.envRenderer=new Uq.RenderEnv(o)),o.envRenderer.renderEnvToCube(i,e,f,w)}}),Uq.RenderTarget=function(O,L,Y,m,H){var S=this;H=H||{},S.uuid=j.Math.generateUUID(),S.gv=O,S.init(O,L,H),S.setSize(L,Y,m)},C.assign(Uq.RenderTarget.prototype,{init:function(j,n,P){var o=this,A=o.texture=n.createTexture();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,A),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,P.minFilter||n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,P.magFilter||n.LINEAR),n.bindTexture(n.TEXTURE_2D,null),o.render=n.createRenderbuffer(),o.frame=n.createFramebuffer(),j._2O[o.uuid]=A},assureTexture:function(){var i=this,t=i.uuid,I=i.gv._2O;I[t]||(I[t]=i.texture)},setSize:function(h,i,k){var H=this;if(H.width!==i||H.height!==k){var z=h.RGBA,c=h.TEXTURE_2D,$=h.RENDERBUFFER,g=h.FRAMEBUFFER;xk(h,H.texture),h.texImage2D(c,0,z,i,k,0,z,h.UNSIGNED_BYTE,I),h.bindRenderbuffer($,H.render),h.renderbufferStorage($,h.DEPTH_COMPONENT16,i,k),is(h,H.frame),h.framebufferTexture2D(g,h.COLOR_ATTACHMENT0,c,H.texture,0),h.framebufferRenderbuffer(g,h.DEPTH_ATTACHMENT,$,H.render),xk(h,I),h.bindRenderbuffer($,I),is(h,I),H.width=i,H.height=k}},toCanvas:function(){var Z=this,d=Z.gv.getGL();d.bindFramebuffer(d.FRAMEBUFFER,Z.frame);var Q=Z.width,z=Z.height,q=new Uint8Array(4*Q*z);d.readPixels(0,0,Q,z,d.RGBA,d.UNSIGNED_BYTE,q),d.bindFramebuffer(d.FRAMEBUFFER,null);var D=i.createElement("canvas");D.width=Q,D.height=z;var E=D.getContext("2d"),n=E.createImageData(Q,z);return n.data.set(q),E.putImageData(n,0,0),D}});var Wm=Uq.Interactor=function(n){this.gv=n};so("Interactor",C,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var tp=Uq.DefaultInteractor=function(x){zp(tp,this,[x])};so("DefaultInteractor",Wm,{handle_contextmenu:function(d){Oi(d)},handle_mousewheel:function(E){this.gv.handleScroll(E,E.wheelDelta/40)},handle_DOMMouseScroll:function(d){2===d.axis&&this.gv.handleScroll(d,-d.detail)},handle_keydown:function(a){this.gv.handleKeyDown(a)},handle_mousedown:function(p){this.handle_touchstart(p)},handle_touchstart:function(S){Oi(S);var t=this,X=t.gv,H=gc(S),y=X.getDataInfoAt(S),K=y?y.data:I,j=y?y.part:I,e=X.sm(),Q=Pe(S),Y=Kb(S);X.setFocus(S)&&(t._62O=I,t._57I=I,K?aq(S)?e.co(K)?e.rs(K):e.as(K):e.co(K)||e.ss(K):H&&(aq(S)?X.isRectSelectable()&&(t._62O=yg):t._57I=fm(S)),t._31Q&&(ne(t._31Q),delete t._31Q,delete t._32Q),t._62O||(X.isFirstPersonMode()&&(Ah(S)||Y>2?t._62O="pan":X.isMouseRoamable()||hd?(t._62O="roaming",t.foward=Q&&gc(S),t._32Q=Xi(),t._31Q=Cr(t.tick,t)):H||(t._62O="roaming")),t._62O||(H&&Q&&xh[j]?(t._62O=j,t.p3=K.p3()):H&&Q&&er(K)&&X.isSelected(K)?X.isMovable(K)?(t._62O="move",t.p3=K.p3(),t.movedata=K):X.isInteractive(K)&&(t._62O="none"):hd&&(Y>2?t._62O="pan":2===Y&&(t.dist=rb(S),t._62O="pinch")))),t.point=X.lp(S),Ti(t,S),Ih(S)?X.handleDoubleClick(S,K,j):X.handleClick(S,K,j))},tick:function(){var v=this,C=v.gv,s=C._moveStep;v.point&&C.isWalkable()&&(v._32Q&&(s*=(Xi()-v._32Q)/50),C.walk(v.foward?s:-s),v._32Q=Xi(),v._31Q=Cr(v.tick,v))},handle_mouseup:function(f){this.handle_touchend(f)},handle_touchend:function(J){var M=this._57I;M&&(em(M,fm(J))<=1&&this.gv.sm().cs(),this._57I=I)},handleWindowMouseMove:function(H){this.handleWindowTouchMove(H)},handleWindowTouchMove:function(T){var b,A,j=this,P=j.gv,r=j._62O,F=j.point,z=P.dm(),E=P.lp(T),e=E.x-F.x,Y=E.y-F.y,R=P.getWidth(),f=P.getHeight();if(R&&f){var V=-W*e/R,c=-W*Y/f;if("roaming"===r)j.rotate(T,V/2,c/2);else if(r===pk||r===Cp||r===yi)P._86O||z.beginTransaction(),P.fi({kind:P._86O?"betweenEditRotation":"beginEditRotation",event:T}),P._86O=1,P.sm().each(function(S){if(er(S)&&P.isRotationEditable(S)){var I=J(V)>J(c)?V:c;r===pk?S.setRotationX(S.getRotationX()+I):r===Cp?S.setRotationY(S.getRotationY()+I):r===yi&&S.setRotationZ(S.getRotationZ()+I)}});else if("move"===r||xh[r]){r===Tq||r===sp||r===Be?(P._87O||z.beginTransaction(),P.fi({kind:P._87O?"betweenEditScale":"beginEditScale",event:T}),P._87O=1):(P._moving||z.beginTransaction(),P.fi({kind:P._moving?"betweenMove":"beginMove",event:T}),P._moving=1);var I,p=j.p3,D=P.getPositionInfo(p),X=tr(P);I=r===yn?"x":r===ph?"y":r===Pd?"z":r===Tq?"sx":r===sp?"sy":r===Be?"sz":P.getMoveMode(T,j.movedata),e=e/R*D.width,Y=-1*Y/f*D.height;var G,B,d=[X[0]*e,X[4]*e,X[8]*e],H=[X[1]*Y,X[5]*Y,X[9]*Y],K=d[0]+H[0],t=d[1]+H[1],Q=d[2]+H[2],U=[p[0]+K,p[1]+t,p[2]+Q],x=Ip(P.getEye(),U,!0);if("xyz"===I?(G=U,P.moveSelection(K,t,Q)):"xz"===I?(G=Bi(P,p,[0,1,0],U),G&&P.moveSelection(G[0]-p[0],0,G[2]-p[2])):"xy"===I?(G=Bi(P,p,[0,0,1],U),G&&P.moveSelection(G[0]-p[0],G[1]-p[1],0)):"yz"===I?(G=Bi(P,p,[1,0,0],U),G&&P.moveSelection(0,G[1]-p[1],G[2]-p[2])):"x"===I||"sx"===I?(x[0]=0,G=Bi(P,p,x,U),G&&(B=G[0]-p[0],"x"===I?P.moveSelection(B,0,0):P.sm().each(function(c){er(c)&&P.isSizeEditable(c)&&(b=c.getScaleX()+B/100,A=b/c.getScaleX(),c.setScaleX(b),Ah(T)&&(c.setScaleY(c.getScaleY()*A),c.setScaleTall(c.getScaleTall()*A)))}))):"y"===I||"sy"===I?(x[1]=0,G=Bi(P,p,x,U),G&&(B=G[1]-p[1],"y"===I?P.moveSelection(0,B,0):P.sm().each(function(a){er(a)&&P.isSizeEditable(a)&&(b=a.getScaleTall()+B/100,A=b/a.getScaleTall(),a.setScaleTall(b),Ah(T)&&(a.setScaleY(a.getScaleY()*A),a.setScaleX(a.getScaleX()*A)))}))):("z"===I||"sz"===I)&&(x[2]=0,G=Bi(P,p,x,U),G&&(B=G[2]-p[2],"z"===I?P.moveSelection(0,0,B):P.sm().each(function(Y){er(Y)&&P.isSizeEditable(Y)&&(b=Y.getScaleY()+B/100,A=b/Y.getScaleY(),Y.setScaleY(b),Ah(T)&&(Y.setScaleX(Y.getScaleX()*A),Y.setScaleTall(Y.getScaleTall()*A)))}))),!G)return;j.p3=G}else if(r===yg){var _=j.div;_||(_=j.div=cf(),jr(j.getView(),_),_.op=F,_.style.background=P.getRectSelectBackground()),P.fi({kind:P._rectSelecting?"betweenRectSelect":"beginRectSelect",event:T}),P._rectSelecting=1,_.rect=no(_.op,E),Hr(_,_.rect)}else if("pinch"===r&&2===Kb(T)){P.fi({kind:P._pinching?"betweenPinch":"beginPinch",event:T}),P._pinching=1;var B=rb(T);P.handlePinch(B,j.dist),j.dist=B}else"pan"===r||Ah(T)?j.pan(T,e,Y):"none"===r||P.isFirstPersonMode()||(gc(T)?j.rotate(T,V,c):(j.pan(T,e,0),P.isWalkable()&&(P.fi({kind:P._walking?"betweenWalk":"beginWalk",event:T}),P._walking=1,P.walk(Y/P.getHeight()*P.getCenterInfo().height))));j.point=E}},pan:function(n,P,D){var d=this.gv;if(d.isPannable()){var M=d.getWidth(),U=d.getHeight();if(!M||!U)return;var w=d.getCenterInfo(),b=P/M*w.width,F=-1*D/U*w.height;d.fi({kind:d._panning?"betweenPan":"beginPan",event:n}),d._panning=1,d.pan(-b,-F)}},rotate:function(z,A,o){var f=this.gv;f.isRotatable()&&(f.fi({kind:f._rotating?"betweenRotate":"beginRotate",event:z}),f._rotating=1,f.rotate(A,o))},handleWindowMouseUp:function(o){this.handleWindowTouchEnd(o)},handleWindowTouchEnd:function(D){var l=this,F=l.gv,Q=F.dm(),R=l.div;if(R){var d=F.getDatasInRect(R.rect);if(!d.isEmpty()){var i=F.sm(),g=i.toSelection();d.each(function(W){i.co(W)?g.remove(W):g.add(W)}),i.ss(g)}Wb(R)}F._moving&&(delete F._moving,F.fi({kind:"endMove",event:D}),F.onMoveEnded(),Q.endTransaction()),F._panning&&(delete F._panning,F.fi({kind:"endPan",event:D}),F.onPanEnded()),F._rotating&&(delete F._rotating,F.fi({kind:"endRotate",event:D}),F.onRotateEnded()),F._86O&&(delete F._86O,F.fi({kind:"endEditRotation",event:D}),Q.endTransaction()),F._87O&&(delete F._87O,F.fi({kind:"endEditScale",event:D}),Q.endTransaction()),F._pinching&&(delete F._pinching,F.fi({kind:"endPinch",event:D}),F.onPinchEnded()),F._rectSelecting&&(delete F._rectSelecting,F.fi({kind:"endRectSelect",event:D}),F.onRectSelectEnded()),F._walking&&(delete F._walking,F.fi({kind:"endWalk",event:D}),F.onWalkEnded()),l.dist=l.point=l._62O=l.p3=l.movedata=l.div=l._57I=l._32Q=l._31Q=l.foward=I}});var Pl=Uq.MapInteractor=function(h){zp(Pl,this,[h]),this._minPhi=0,this._maxPhi=5*g/12,this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01};so("MapInteractor",Wm,{handle_contextmenu:function(h){Oi(h)},handle_mousewheel:function(M){this.gv.handleScroll(M,M.wheelDelta/40)},handle_DOMMouseScroll:function(B){2===B.axis&&this.gv.handleScroll(B,-B.detail)},handle_keydown:function(o){this.gv.handleKeyDown(o)},handle_mousedown:function(_){this.handle_touchstart(_)},handle_touchstart:function(y){Oi(y);var b=this,N=b.gv;if(N.setFocus(y)){N.lp(y);var P=N.getDataInfoAt(y),k=P?P.data:I,H=P?P.part:I;if(!k||!N.isInteractive(k)){var c=b.editing={point:N.lp(y)};hd?c.touch=!0:(c.touch=!1,c.pan=gc(y)),Ti(b,y)}Ih(y)?N.handleDoubleClick(y,k,H):N.handleClick(y,k,H)}},handle_mouseup:function(O){this.handle_touchend(O)},handle_touchend:function(){},handleWindowMouseMove:function(B){this.handleWindowTouchMove(B)},handleWindowTouchMove:function(V){var S=this,$=S.gv,a=S.editing;if(a){var l=$.lp(V),p=a.point,k=l.x-p.x,h=l.y-p.y;if(!a.moved){if(Math.abs(k)<S.threshold&&Math.abs(h)<S.threshold&&!(V.touches&&V.touches.length>1))return;a.moved=!0}if(a.point=l,a.touch){var Z=V.touches.length;if(2!==Z)S.pan(V,k,h);else{if(1>=Z)return;var d=V.touches,s={x:d[0].clientX,y:d[0].clientY},f={x:d[1].clientX,y:d[1].clientY},J={x:f.x-s.x,y:f.y-s.y},y=a.lastCenter,O=Math.atan2(J.y,J.x),C=a.theta,T=0;C==I?C=a.theta=O:(T=O-C,a.thetaStarted||Math.abs(T)>S.touchRotateThreshold?(a.thetaStarted=!0,a.theta=O):T=0);var R=g*(s.y+f.y)/2/$.getHeight(),N=a.phi,F=0;N==I?N=a.phi=R:(F=R-N,a.phiStarted||Math.abs(F)>S.touchRotateThreshold?(a.phiStarted=!0,a.phi=R):F=0);var q,M=Math.sqrt(J.x*J.x+J.y*J.y),u=a.vlen;if(u){var B=s.x-y.x,A=s.y-y.y,i=f.x-y.x,K=f.y-y.y,z=Math.sqrt(B*B+A*A),x=Math.sqrt(i*i+K*K),t=u/2,o=S._sign2(z-t),Q=S._sign2(x-t);0>o*Q||0===o&&0===Q?(q=1,a.vlen=M):(q||(q=M/u),a.scaleStarted||Math.abs(q-1)>S.touchScaleThreshold?(a.vlen=M,a.scaleStarted=!0):q=1)}else u=a.vlen=M,q=1;1!==q&&$.setZoom(q),(F||T)&&S.rotate(V,T,-F),a.lastCenter={x:(f.x+s.x)/2,y:(f.y+s.y)/2}}}else if(a.pan)S.pan(V,k,h);else{var E=$.getWidth(),Y=$.getHeight();if(!E||!Y)return;var j=-W*k/E,P=-W*h/Y;S.rotate(V,j,P)}}},_sign2:function(N){return Math.abs(N)<this._touchScaleCheckAccuracy?0:N>0?1:-1},handleWindowMouseUp:function(P){this.handleWindowTouchEnd(P)},handleWindowTouchEnd:function(e){var Y=this,g=Y.editing;if(Y.editing=null,g){var A=Y.gv;if(!g.moved&&g.pan){var C=A.getDataAt(e);C?A.sm().setSelection([C]):A.sm().clearSelection()}else A._panning=null,A._rotating=null,A.fi({kind:g.pan?"endPan":"endRotate",event:e})}},pan:function(X,t,G){var B=this,U=B.gv;if(U.isPannable()){var j=U.getWidth(),b=U.getHeight();if(j&&b){var i=U.getCenterInfo(),v=-t/j*i.width,q=1*G/b*i.height;U.fi({kind:U._panning?"betweenPan":"beginPan",event:X}),U._panning=1;var a=B.keepHorizon,$=B.editing.touch;if(($&&X.touches&&X.touches.length>1||!$&&Ah(X))&&(a=!a),!a)return U.pan(v,q);if(v||q){var J=tr(U),u=[J[0]*v,J[4]*v,J[8]*v],N=[J[1],0,J[9]],k=Math.sqrt(N[0]*N[0]+N[2]*N[2]);k&&(N=[N[0]/k*q,0,N[2]/k*q]);var f=u[0]+N[0],W=u[1]+N[1],P=u[2]+N[2],o=U._center,y=U._eye;o[0]+=f,o[1]+=W,o[2]+=P,y[0]+=f,y[1]+=W,y[2]+=P,U.fp(Lm,I,y),U.fp(Ai,I,o)}}}},rotate:function(b,F,q){var G=this,A=G.gv;if(A.isRotatable()){var I=A._center,H=A._eye,P=Ip(H,I),E=B(p(P[0]*P[0]+P[2]*P[2]),P[1]),d=E+q;d=Math.max(G.minPhi,Math.min(G.maxPhi,d)),q=d-E,A.fi({kind:A._rotating?"betweenRotate":"beginRotate",event:b}),A._rotating=1,A.rotate(F,q)}}}),C.defineProperties(Pl.prototype,{minPhi:{get:function(){return this._minPhi},set:function(X){this._minPhi=X}},maxPhi:{get:function(){return this._maxPhi},set:function(b){this._maxPhi=b}},keepHorizon:{get:function(){return this._keepHorizon},set:function($){this._keepHorizon=$}},threshold:{get:function(){return this._threshold},set:function(W){this._threshold=W}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(h){this._touchScaleThreshold=h}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(x){this._touchRotateThreshold=x}}});var yc=function(R){this.gv=R};ab(yc,C,{_iv:!0,iv:function(){this._iv=!0},face:function(G,n){var i=this,d=i.gv.getGL();if(!d||!er(G))return I;var M=n.x,Y=n.width,k=n.height,D=i.height-n.y-k,l=$(Y/2),m=new Uint8Array(4*Y*k),x=0;for(i.iv(),i.validate(G),is(d,i.frame),d.readPixels(M,D,Y,k,d.RGBA,d.UNSIGNED_BYTE,m),is(d,I),i.iv();l>=x;x++)for(var h=l-x,b=l+x,F=h;b>=F;F++)for(var R=h;b>=R;R++)if(F===h||F===b||R===h||R===b){var Z=Im.m[m[4*(F*Y+R)]];if(Z)return Z}},get:function(V,m){this.validate();var n=this,A=n.gv.getGL();if(!A)return I;var j,q,S=V.x,e=V.width,P=V.height,G=n.height-V.y-P,k=$(e/2),D=new Uint8Array(4*e*P),T=0,Y=D.length,X=m?I:new fb,J=m?I:{};if(is(A,n.frame),A.readPixels(S,G,e,P,A.RGBA,A.UNSIGNED_BYTE,D),is(A,I),m){for(;k>=T;T++)for(var b=k-T,p=k+T,E=b;p>=E;E++)for(var g=b;p>=g;g++)if((E===b||E===p||g===b||g===p)&&(j=n.info(D,4*(E*e+g))))return j}else for(;Y>T;T+=4)j=n.info(D,T),j&&(q=j.data,J[q._id]||(X.add(q),J[q._id]=q));return X},info:function(F,E){return this.colorMap[(F[E]<<16)+(F[E+1]<<8)+F[E+2]+((127&F[E+3])<<24)]},validate:function(A){var u=this,N=u.gv,D=N.getGL();if(D){var P=N.getWidth(),b=N.getHeight(),M=D.RGBA,V=D.TEXTURE_2D,r=D.RENDERBUFFER,R=D.FRAMEBUFFER;u.texture||(u.texture=jg(D),u.render=D.createRenderbuffer(),u.frame=D.createFramebuffer()),(u.width!==P||u.height!==b)&&(xk(D,u.texture),D.texImage2D(V,0,M,P,b,0,M,D.UNSIGNED_BYTE,I),cd(D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.bindRenderbuffer(r,u.render),D.renderbufferStorage(r,D.DEPTH_COMPONENT16,P,b),is(D,u.frame),D.framebufferTexture2D(R,D.COLOR_ATTACHMENT0,V,u.texture,0),D.framebufferRenderbuffer(R,D.DEPTH_ATTACHMENT,r,u.render),xk(D,I),D.bindRenderbuffer(r,I),is(D,I),u.width=P,u.height=b),u._iv&&(u._iv=!1,is(D,u.frame),N._42(A||(u.colorMap={}),1),is(D,I))}}});var xj=function(_){this.gv=_};ab(xj,C,{gap:0,size:0,_42:function(c,C){var h=this,f=h.gv,P=f._gridGap,o=f._gridSize;if(f._gridVisible){if(h.gap!==P||h.size!==o){for(var J=[],B=f._gridSize/2,Z=P*B,s=0;2*B+1>s;s++){var A=6*s,D=6*(2*B+1)+A;J[A]=-Z,J[A+1]=0,J[A+2]=-Z+s*P,J[A+3]=Z,J[A+4]=0,J[A+5]=-Z+s*P,J[D]=-Z+s*P,J[D+1]=0,J[D+2]=-Z,J[D+3]=-Z+s*P,J[D+4]=0,J[D+5]=Z}h.vs=new kj(J),h.gap=P,h.size=o}ir(f),Ij(c,C),mk(c),hg(c,C,1,f._gridColor,f._buffer.vs,h.vs),cr(c,0,h.vs.length/3,c.LINES),gg(c),Xg(c,C)}else h.vs=h.gap=h.size=I}});var td=function(V){this.gv=V};ab(td,C,{_42:function(J,k){var b=this.gv,W=b._buffer.vs,h=b._axisXColor,o=b._axisYColor,Z=b._axisZColor,A=b._originAxisVisible,z=b._centerAxisVisible;if(A||z){var j=E?J.TRIANGLES:J.TRIANGLE_FAN,v=J.LINES;if(ir(b),Ij(J,k),mk(J),A){var F=b.getCenterInfo(),S=N(F.width,F.height)/5,y=.8*S,C=.05*S;hg(J,k,1.5,h,W,new kj([0,0,0,S,0,0,y,C,0,y,0,C,y,-C,0,y,0,-C,y,C,0,0,0,0,0,S,0,C,y,0,0,y,C,-C,y,0,0,y,-C,C,y,0,0,0,0,0,0,S,C,0,y,0,C,y,-C,0,y,0,-C,y,C,0,y])),cr(J,0,2,v),cr(J,1,6,j),hg(J,k,I,o),cr(J,7,2,v),cr(J,8,6,j),hg(J,k,I,Z),cr(J,14,2,v),cr(J,15,6,j)}if(z){var P=b._center,U=P[0],B=P[1],M=P[2],F=b.getPositionInfo(P);S=N(F.width,F.height)/20,hg(J,k,1.5,h,W,new kj([U,B,M,U+S,B,M,U,B,M,U,B+S,M,U,B,M,U,B,M+S])),cr(J,0,2,v),hg(J,k,I,o),cr(J,2,2,v),hg(J,k,I,Z),cr(J,4,2,v)}gg(J),Xg(J,k)}}});var pl=function(n){this.gv=n,this.onMouseOver=this.onMouseOver.bind(this),this.mode=2};pl.Mode={Disable:0,Selection:1,MouseOver:2},ab(pl,C,{onMouseOver:function(_){h.preventDefault(_);var l=this.gv.getDataAt(_);l!==this.mouseOverData&&(this.mouseOverData=l,this.gv.iv())},setFetchTargetFunc:function(l){this.fetchTargetFunc=l},_42:function(M,J){var u,L=this,N=L._mode;if(N!==pl.Mode.Disable&&(N===pl.Mode.Selection?u=L.gv.sm().getSelection().toArray():N===pl.Mode.MouseOver&&L.mouseOverData&&(u=[L.mouseOverData]),L.fetchTargetFunc&&(u=L.fetchTargetFunc(u)),u&&u.length)){var c=L.gv,w=c.vr.isPresenting(),l=c.getWidth();if(w){var q=c.getWidth;l/=2,c.getWidth=function(){return l};var C=c.getViewport()}var x,Y=c.getDevicePixelRatio(),S=l*Y,Z=c.getHeight()*Y;(x=L._renderTarget)?x.setSize(M,S,Z):L._renderTarget=x=new Uq.RenderTarget(c,M,S,Z),is(M,x.frame),c.drawFilter=function(f){return u.indexOf(f)<0?!0:void 0},c._42({}),c.drawFilter=null,is(M,I),w&&(c.getWidth=q,c.setViewport(M,C[0],C[1],C[2],C[3])),L.shader||(L.shader=new pc.Shader(M,al.vs,al.fs));var i=L.shader;if(L.shader.bind(),M.enable(M.BLEND),M.activeTexture(M.TEXTURE0+0),M.bindTexture(M.TEXTURE_2D,x.texture),i.uniforms.image=0,i.uniforms.textureSize=[S,Z],i.uniforms.edgeWidth=v["highlight.width"],L.highlightColor!==v["highlight.color"]){var y=Rg(L.highlightColor=v["highlight.color"]);L.highlightColorData=[y[0]/255,y[1]/255,y[2]/255,y[3]/255]}i.uniforms.edgeColor=L.highlightColorData,L.ibuffer?(L.ibuffer.upload(),L.vbuffer.upload()):(L.ibuffer=pc.Buffer.createIndexBuffer(M,new Uint16Array([0,2,1,1,2,3])),L.vbuffer=pc.Buffer.createVertexBuffer(M,new Float32Array([0,0,1,0,0,1,1,1]))),i.attributes.pos.pointer(L.vbuffer),M.drawElements(M.TRIANGLES,6,M.UNSIGNED_SHORT,0),M.disable(M.BLEND),M.bindTexture(M.TEXTURE_2D,null),M.useProgram(J)}}}),C.defineProperties(pl.prototype,{mode:{get:function(){return this._mode},set:function(Y){var h=this._mode;Y!==h&&(this._mode=Y,Y===pl.Mode.MouseOver?this.gv.getView().addEventListener("mousemove",this.onMouseOver,!1):h===pl.Mode.MouseOver&&this.gv.getView().removeEventListener("mousemove",this.onMouseOver))}}});var al={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},vh=function(f){this.gv=f},yn="edit_tx",ph="edit_ty",Pd="edit_tz",pk="edit_rx",Cp="edit_ry",yi="edit_rz",Tq="edit_sx",sp="edit_sy",Be="edit_sz",xh={};xh[yn]=1,xh[ph]=1,xh[Pd]=1,xh[pk]=1,xh[Cp]=1,xh[yi]=1,xh[Tq]=1,xh[sp]=1,xh[Be]=1,ab(vh,C,{_42:function(M,c,w){var _=this,y=_.gv,D=y.sm().ld();if(D&&y.isEditable(D)&&!y.isEditHelperDisabled()&&er(D)&&(!y.isFirstPersonMode()||!y.isMouseRoamable()&&!hd)){ir(y);var $,d,W=y.isMovable(D),h=y.isRotationEditable(D),g=y.isSizeEditable(D),H=y._axisXColor,U=y._axisYColor,s=y._axisZColor,t=y._editSizeColor,J=D.p3(),Q=em(y.getEye(),J)/10,r=Q/(w?5:10),q=.7*Q,u=.4*q,X=J[0],z=J[1],Y=J[2];$=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],W&&_._17O(M,c,D,w,yn,H,$,[X,z-r,Y,X+q,z-r,Y,X+q,z,Y,X+q,z,Y,X,z,Y,X,z-r,Y,X,z-r,Y+r,X+q,z-r,Y+r,X+q,z-r,Y,X+q,z-r,Y,X,z-r,Y,X,z-r,Y+r]),d=X+q,g&&_._17O(M,c,D,w,Tq,t,$,[d,z-r,Y,d+u,z-r,Y,d+u,z,Y,d+u,z,Y,d,z,Y,d,z-r,Y,d,z-r,Y+r,d+u,z-r,Y+r,d+u,z-r,Y,d+u,z-r,Y,d,z-r,Y,d,z-r,Y+r]),d+=u,h&&_._17O(M,c,D,w,pk,H,$,[d,z-r,Y,d+u,z-r,Y,d+u,z,Y,d+u,z,Y,d,z,Y,d,z-r,Y,d,z-r,Y+r,d+u,z-r,Y+r,d+u,z-r,Y,d+u,z-r,Y,d,z-r,Y,d,z-r,Y+r]),$=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],W&&_._17O(M,c,D,w,ph,U,$,[X,z,Y,X,z+q,Y,X-r,z+q,Y,X-r,z+q,Y,X-r,z,Y,X,z,Y,X,z,Y,X,z,Y-r,X,z+q,Y-r,X,z+q,Y-r,X,z+q,Y,X,z,Y]),d=z+q,g&&_._17O(M,c,D,w,sp,t,$,[X,d,Y,X,d+u,Y,X-r,d+u,Y,X-r,d+u,Y,X-r,d,Y,X,d,Y,X,d,Y,X,d,Y-r,X,d+u,Y-r,X,d+u,Y-r,X,d+u,Y,X,d,Y]),d+=u,h&&_._17O(M,c,D,w,Cp,U,$,[X,d,Y,X,d+u,Y,X-r,d+u,Y,X-r,d+u,Y,X-r,d,Y,X,d,Y,X,d,Y,X,d,Y-r,X,d+u,Y-r,X,d+u,Y-r,X,d+u,Y,X,d,Y]),$=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],W&&_._17O(M,c,D,w,Pd,s,$,[X,z,Y,X,z,Y+q,X,z-r,Y+q,X,z-r,Y+q,X,z-r,Y,X,z,Y,X,z-r,Y,X-r,z-r,Y,X-r,z-r,Y+q,X-r,z-r,Y+q,X,z-r,Y+q,X,z-r,Y]),d=Y+q,g&&_._17O(M,c,D,w,Be,t,$,[X,z,d,X,z,d+u,X,z-r,d+u,X,z-r,d+u,X,z-r,d,X,z,d,X,z-r,d,X-r,z-r,d,X-r,z-r,d+u,X-r,z-r,d+u,X,z-r,d+u,X,z-r,d]),d+=u,h&&_._17O(M,c,D,w,yi,s,$,[X,z,d,X,z,d+u,X,z-r,d+u,X,z-r,d+u,X,z-r,d,X,z,d,X,z-r,d,X-r,z-r,d,X-r,z-r,d+u,X-r,z-r,d+u,X,z-r,d+u,X,z-r,d])}},_17O:function(h,$,F,Z,M,B,s,y){var _=this.gv._buffer;tq(h,$,Z,!0,F,M),Jm(h,$,I,!0,I,!0,I,!1),ti(h,$.uDiffuse,B),Cl(h,_.vs,new kj(y),$.aPosition),Cl(h,_.ns,new kj(s),$.aNormal),mk(h),cr(h,0,12),gg(h),hl(h,$)}});var wg=j.Raycaster=function(C){this.gv=C,this.maxTriangleTest=1/0};yp("Raycaster",C,{intersect:function(W){var s=this,B=s.gv,c=B.getDataAt(W);return c?s.intersectObject(W,c):null},intersectObjects:function(M,r,v){var D,o,F,t,G=this,C=1/0,k=M.origin||(new Wi).fromArray(G.gv.getEye()),S=G.maxTriangleTest,q=[];return r.forEach(function(y){v&&v(y)===!1||y.s("intersect")!==!1&&q.push(y)}),q.sort(function(z,$){return k.distanceToSquared2(z.p3())-k.distanceToSquared2($.p3())}),G.countTriangles=0,q.forEach(function(U){G.countTriangles>S||(D=G.intersectObject(M,U),D&&(o=k.distanceToSquared(D.world),C>o&&(F=U,t=D,C=o)))}),G.countTriangles=0,{data:F,intersect:t}},intersectObject:function(V,n){if(V instanceof Fr)return this._intersectObjectImpl(V,n);var N,D,B=this,I=B.gv;D=I.unproject(V);var Z=I.getEye();I.isOrtho()?(N=Ip(I.getCenter(),Z),N[0]+=N[0],N[1]+=N[1],N[2]+=N[2]):N=Z,N=new Wi(N);var r=new Wi(D).sub(N).normalize(),m=new j.Math.Ray(N,r);return B._intersectObjectImpl(m,n)},_intersectObjectImpl:function(){function o(){var e=new Wi;return e.subVectors(D,P),J.subVectors(N,P),e.cross(J).normalize(),e}function I(z,O,v,m,X,K,V){return qh.barycoordFromPoint(z,O,v,m,A),X.multiplyScalar(A.x),K.multiplyScalar(A.y),V.multiplyScalar(A.z),X.add(K).add(V),X.clone()}var e=new vn,u=new vn,v=new Fr,B=new Wi,G=new Wi,$=new Wi,p=new Wi,K=new Wi,N=new Wi,P=new Wi,D=new Wi,n=new Mj,S=new Mj,R=new Mj,J=new Wi,g={vs:nr,is:mq,uv:qi},A=new Wi;return function(l,w){var U=this.gv.getData3dUI(w),Z=w.mat||U.mat;if(Z){e.fromArray(Z),u.getInverse(e),v.copy(l).applyMatrix4(u);var y,F,r="body",W=U.shapeModel;if(W||(W=ed(U)),W||(w instanceof j.Node&&!(w instanceof j.Shape)?(y=!0,W=g):(F=!0,W=[U.left,U.front,U.right,U.back,U.top,U.bottom])),!W)return console.log("Can not find shape model."),null;Ck(W)||(W=[W]);var O,L,Y,i,M,E,h,c,m,J,_,f,z,T,d,V,Q=1/0,A=["","top_","bottom_"],b=!1;for(O=0,L=W.length;L>O;O++)if(z=W[O])for(Y=0,i=A.length;i>Y;Y++)if(T=A[Y],h=z[T+"vs"],c=z[T+"is"],m=z[T+"uv"]||z[T+"tuv"],h){if(d=z[T+"boundingBox"]){var _=v.intersectBox(d);if(!_)continue;if(v.origin.distanceTo(_)>Q)continue;V=!1}else z[T+"boundingBox"]=d=new j.Math.Box3,V=!0;for(M=0,E=c?c.length:h.length/3;E>M;M+=3)this.countTriangles++,c?(G.fromArray(h,3*c[M]),$.fromArray(h,3*c[M+1]),p.fromArray(h,3*c[M+2])):(G.fromArray(h,3*M),$.fromArray(h,3*(M+1)),p.fromArray(h,3*(M+2))),V&&(d.expandByPoint(G),d.expandByPoint($),d.expandByPoint(p)),J=v.intersectTriangle(G,$,p,!0,B),J&&(f=v.origin.distanceTo(J),Q>f&&(Q=f,K.copy(J),N.copy(G),P.copy($),D.copy(p),""!==T?r=T.slice(0,-1):y?r=Zg[Math.floor(M/6)]:F&&(r=Zg[O]),m&&(b=!0,c?(n.fromArray(m,2*c[M]),S.fromArray(m,2*c[M+1]),R.fromArray(m,2*c[M+2])):(n.fromArray(m,2*M),S.fromArray(m,2*(M+1)),R.fromArray(m,2*(M+2))))))}if(!isFinite(Q))return null;var X,H=K.clone().applyMatrix4(e);b&&(X=I(K,N,P,D,n,S,R));var C=o(N,P,D),x=o(N.applyMatrix4(e),P.applyMatrix4(e),D.applyMatrix4(e)),q=v.direction.dot(C);return q>0&&(C.multiplyScalar(-1),x.multiplyScalar(-1)),{world:H,local:K.clone(),worldNormal:x,normal:C,uv:X,part:r}}}}()});var ri=function(k,t){this.gv=k,this.s=function(O,n,m){return n==I&&(n=m),n==I?t.getStyle(O):oh(n,t,k)},this.data=t};ab(ri,C,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(p,Q,R,u){var c=this,d=c.data;if(!(d instanceof tm)){var O,A,v,z,W,n,B,X=c.gv,b=d._id,h=c.s("shape3d.alwaysOnTop")?null:c.s("batch"),o=X._batchIndexMap,$=X._batchModelMap,Z=X.isSelectable(d),H=X.getBrightness(d),D=H!=I&&1!==H;if(c.needValidate(p)){if(v=Zo(o,$,d,h),c.validate(v,h?Vj[h]||Cf:I),v&&(z=o[b],W=z.size=v.vs.length/3-z.begin,B=v.rs))for(H=D?H:1,n=0;W>n;n++)B.push(H);if(er(d)){var y=X.getWireframeGeometry(d);if(y)pn(X,d,y);else{var K=X.getWireframe(d);K&&pn(X,d,K)}}c.labelInfo=c.label2Info=c.noteInfo=c.note2Info=c._38o=I,c._24O(qm,"getLabel"),c._24O(je,"getLabel2"),c._26O(_p,"getNote"),c._26O(hi,"getNote2"),c._15O(),c.interactiveInfo=X.isInteractive(d)?{}:I,c._iv=!1}D&&ti(p,Q.uBrightness,H),ti(p,Q.uAlphaTest,c.s("alphaTest")),ti(p,Q.uUseEnvMap,d.s("envmap")?!0:!1),ti(p,Q.uReflectivity,d.s("envmap")||.01),A=tq(p,Q,R,Z,d,wf),A&&(zi(A,o[b],$),zi(A,X._polylineIndexMap[b],X._polylineModelMap),zi(A,X._wireframeIndexMap[b],X._wireframeModelMap)),o[b]||c._80o(p,Q,u),X.isLabelVisible(d)&&((O=c.labelInfo)&&(tq(p,Q,R,Z,d,qm),c._28O(O,qm,u)),(O=c.label2Info)&&(tq(p,Q,R,Z,d,je),c._28O(O,je,u))),X.isNoteVisible(d)&&((O=c.noteInfo)&&(tq(p,Q,R,Z,d,_p),c._29O(O,_p,u)),(O=c.note2Info)&&(tq(p,Q,R,Z,d,hi),c._29O(O,hi,u))),(O=c._38o)&&c._99O(p,Q,O,R,Z,u),D&&ti(p,Q.uBrightness,1)}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return wn},_80o:function(){},dispose:function(){},_calcAnchorMat:function(_){if(_.hasOwnProperty("_anchor")||_.hasOwnProperty("_anchorElevation")){var I=_.getAnchor3d(),l={x:I.x-.5,y:I.y-.5,z:I.z-.5},Z=Fn();
return Le(Z,[-l.x,-l.y,-l.z]),Z}},getBodyColor:function(V){var B=this.data,i=this.gv.getBodyColor(B);return i?i:V?B.getStyle(V):I},_24O:function(S,K){var j=this,r=j.data,l=j.gv,D=j.s,$=l[K](r);if($!=I){var Q=D(S+".scale"),p=D(S+".max"),v=j[S+"Info"]={label:$,textureScale:D(S+".texture.scale"),color:l[K+"Color"](r),font:D(S+".font"),align:D(S+".align"),background:l[K+"Background"](r)},W=v.rect=yf(v,$);p>0&&p<W.width&&(v.labelWidth=W.width,W.width=p),W.x=W.y=0,W.width*=Q,W.height*=Q,v.mat=j._16O(D(S+".autorotate"),D(S+".position"),W,D(S+".face"),D(S+".t3"),D(S+".r3"),D(S+".rotationMode"));var A=W.width/2,B=W.height/2;v.vs=new kj([-A,B,0,-A,-B,0,A,-B,0,A,B,0]),W.width/=Q,W.height/=Q}},_26O:function(t,K){var S=this,U=S.data,N=S.gv,W=S.s,D=N[K](U);if(D!=I){var w=W(t+".scale"),s=this[t+"Info"]={note:D,textureScale:W(t+".texture.scale"),expanded:W(t+".expanded"),font:W(t+".font"),color:W(t+".color"),align:W(t+".align"),borderWidth:W(t+".border.width"),borderColor:W(t+".border.color"),background:N[K+"Background"](U)};if(s.expanded){var g=W(t+".max"),O=yf(s,D);O.width+=6,O.height+=2,g>0&&g<O.width&&(s.labelWidth=O.width,O.width=g);var k={x:-O.width/2,y:-8-O.height,width:O.width,height:O.height+8}}else k={x:-6,y:-18,width:12,height:18};s.mat=S._16O(W(t+".autorotate"),W(t+".position"),I,W(t+".face"),W(t+".t3"),W(t+".r3"),W(t+".rotationMode")),s.rect=k,1!==w&&(k=oc(k),k.x*=w,k.height*=w,k.y=-k.height,k.width*=w);var M=k.x,p=k.y,i=k.width,_=k.height;s.vs=new kj([M,-p,0,M,-p-_,0,M+i,-p-_,0,M+i,-p,0])}},_28O:function(l,O,J){if(J(this.s(O+".transparent"))){var a=l.rect,w=l.textureScale,$=a.width*w,K=a.height*w;if($>=1&&K>=1){var n=Qp($,K);1!==w&&(n.translate(n,a.x,a.y),n.scale(w,w),n.translate(n,-a.x,-a.y)),ip(n,l),n.restore(),Mr(this,O,l.mat,l.vs,!0)}}},_29O:function(H,d,l){if(l(this.s(d+".transparent"))){var t=H.rect,O=H.textureScale,b=t.x,R=t.y,J=t.width*O,N=t.height*O;if(J>=1&&N>=1){t.x=t.y=0;var h=Qp(J,N);1!==O&&h.scale(O,O),lg(h,H),h.restore(),t.x=b,t.y=R,Mr(this,d,H.mat,H.vs,!1)}}},_99O:function(Q,j,G,y,V,g){if(G){var c=this,F=c.gv,r=c.data,C=F._buffer,X=F._1O,p=G.icons;for(var A in p){var W=p[A],o=G.rects[A];if(o&&g(oh(W.transparent,r,F))){tq(Q,j,y,V,r,A);var Y=oh(W.shape3d,r,F),O=Y?[Y]:oh(W.names,r,F),a=O?O.length:0,v=oh(W.textureScale,r,F)||1,n=oh(W.light,r,F);n==I&&(n=Y?!0:!1),Jm(Q,j,oh(W.blend,r,F),n,oh(W.opacity,r,F),oh(W.reverseFlip,r,F),oh(W.reverseColor,r,F),oh(W.reverseCull,r,F));for(var D=0;a>D;D++){var e=O[D],R=o[D];if(Tb(c,R.mat),Y)cj(F,r,ed(c,Y),c);else{var k=qp(e);if(k){var q=R.width*v,N=R.height*v;if(q>=1&&N>=1){var x=Qp(q,N);mg(x,k,oh(W.stretch,r,F),0,0,q,N,r,F),x.restore(),jg(Q,Kj,X),mk(Q,j,X,oh(W.discardSelectable,r,F),C.uv,Jj),Cl(Q,C.vs,R.vs,j.aPosition),Bm(Q,C.ns,Xm,j.aNormal),dd(Q,C.is,Rh),Jk(Q,0,Rh.length),gg(Q,j,X)}}}xi(F)}hl(Q,j)}}}}});var Vo=function(i,e){zp(Vo,this,[i,e])};ab(Vo,ri,{_16O:function(C,c,z,t,I,w,K,h,v){var Q=this.data,b=Q.getFinalScale3d(),E=Rj(c,b,z,t,h,v);if(Q.hasOwnProperty("_anchor")||Q.hasOwnProperty("_anchorElevation")){var Z=Q.getAnchor3d();E[0]-=(Z.x-.5)*b[0],E[1]-=(Z.y-.5)*b[1],E[2]-=(Z.z-.5)*b[2]}return Aj(Fn(),E,Q.p3(),t,I,w,K,C,Q.getFinalRotation3d(),Q.getRotationMode())},clear:function(){var c=this;c.faceMat=c.mat=c.shapeModel=c.left=c.right=c.front=c.back=c.top=c.bottom=c.csg=I},needValidate:function(w){if(this._iv)return this._validateFrameId=w._renderInfo.frame,!0;if(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var Z=w._renderInfo.frame;if(this._validateFrameId!==Z)return this._validateFrameId=Z,!0}return!1},validate:function(L,w){var Q=this,j=Q.gv,J=Q.data,x=ed(Q);Q._updateAutoRotation(),Q._updateFixSize2d(),Q._updateOverlapping(),(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen"))&&(eo(j,J,"_wireframeModelMap","_wireframeIndexMap"),eo(j,J,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var e=gq(J,j.getMat(J),x?Q.s("shape3d.scaleable"):!0),a=Q._calcAnchorMat(J);if(a&&Fc(e,e,a),J.mat=e,Q.clear(),L){var i=[];x?Fe(j,J,x,Q,Q.getBodyColor(),[e],L,i):(Jf(j,J,L,w,e,Mn,i,_b),Jf(j,J,L,w,e,rj,i,Hg),Jf(j,J,L,w,e,yo,i,Jo),Jf(j,J,L,w,e,Fl,i,dg),Jf(j,J,L,w,e,uq,i,Fd),Jf(j,J,L,w,e,gh,i,of)),i.length&&(Vc(L.vs,i),Vc(L.ns,Ug(i)))}else Q.mat=e,(Q.shapeModel=x)||(Q._cubeUvs=null,Q.vf(Mn,0),Q.vf(rj,16),Q.vf(uq,8),Q.vf(gh,24),Q.vf(yo,32),Q.vf(Fl,40))},_updateAutoRotation:function(){var q=new Rn;return function(){var K=this,F=K.data,e=K.s("shape3d.autorotate");if(!e)return F._dynamicRotation&&delete F._dynamicRotation,void 0;var l,W=K.gv;l="string"==typeof e?[e.indexOf("x")<0?W._eye[0]:W._center[0],e.indexOf("y")<0?W._eye[1]:W._center[1],e.indexOf("z")<0?W._eye[2]:W._center[2]]:W._eye;var c=W._center,U=F.p3(),H=Hf([U[0]+l[0]-c[0],U[1]+l[1]-c[1],U[2]+l[2]-c[2]],U,W._up),n=F.r3();q.set(0,0,0,F.getRotationMode(),!0).setFromRotationMatrix(H),Math.abs(n[0]-q.x)<1e-5&&Math.abs(n[1]-q.y)<1e-5&&Math.abs(n[2]-q.z)<1e-5||(F._dynamicRotation=[q.x,q.y,q.z])}}(),_updateFixSize2d:function(){var k=this,H=k.data,S=k.s("shape3d.fixSizeOnScreen");if(!S)return H._dynamicScale3d&&delete H._dynamicScale3d,void 0;var y=k.gv;H.getFinalScale3d();var O=gq(H,y.getMat(H)),o=Ph([0,0,0],O),t=y.toViewPosition(o);if(!isNaN(t.x)&&!isNaN(t.y)){var d=Ph([1,0,0],O),Z=y.toViewPosition(d),v=Ph([0,1,0],O),n=y.toViewPosition(v),B=Z.x-t.x,i=n.y-t.y,Y=H._dynamicScale3d||[1,1,1],C=qp(H.s("shape3d.image")),X=S[0]>0?S[0]:C?uf(C,k):20,I=S[1]>0?S[1]:C?Xd(C,k):20,c=Math.abs(B/X),x=Math.abs(i/I);Math.abs(c-1)<.001&&Math.abs(x-1)<.001||(H._dynamicScale3d=[Y[0]/c,Y[1]/x,Y[2]])}},_updateOverlapping:function(){var e=this,W=e.s("hide.overlapping.group");if(!W)return e._rectOverlapping&&(e._rectOverlapping=H),void 0;var R,V,P,D=e.gv,x=e.data,Q=gq(x,D.getMat(x)),F=1/0,L=1/0,r=-1/0,G=-1/0,n=x.getAnchor3d(),q=n.x,S=n.y,$=n.z;for(R=0;8>R;R++){if(V=Ph([(R>>2)-q,(1&R>>1)-S,(1&R)-$],Q),P=D.toViewPosition(V),isNaN(P.x)||isNaN(P.y))return;F=Math.min(F,P.x),r=Math.max(r,P.x),L=Math.min(L,P.y),G=Math.max(G,P.y)}var p={x:F,y:L,w:r-F,h:G-L};e._rectOverlapping=D.overlappingBox.isOverlapping(W,p)},getVectorDynamicSize:function(){var f,i=this,j=i.s("shape3d"),B=i.data;if("billboard"===j||"plane"===j||(f=B._currentCubeElementId)!=I){var r,P,E=i.gv,H=gq(B,E.getMat(B)),A=B.getAnchor3d(),U=.5-A.x,z=.5-A.y,t=.5-A.z,o=i.s("shape3d.vector.dynamic.maxsize"),b=function(L,q){L[0]+=U,L[1]+=z,L[2]+=t,q[0]+=U,q[1]+=z,q[2]+=t;var l=E.toViewPosition(Ph(L,H)),n=E.toViewPosition(Ph(q,H)),Z=l.x-n.x,w=l.y-n.y;return Math.min(o,Math.sqrt(Z*Z+w*w))};if("billboard"===j)r=b([-.5,0,0],[.5,0,0]),P=b([0,-.5,0],[0,.5,0]);else if("plane"===j)r=b([-.5,0,0],[.5,0,0]),P=b([0,0,-.5],[0,0,.5]);else if(B._currentCubeElementId!=I){var Z=3*mq[f+1],c=3*mq[f],J=3*mq[f+2];r=b([nr[Z],nr[Z+1],nr[Z+2]],[nr[J],nr[J+1],nr[J+2]]),P=b([nr[Z],nr[Z+1],nr[Z+2]],[nr[c],nr[c+1],nr[c+2]])}return[r,P]}},getCachedTexture:function(){var J=this,t=J.data,L=t._currentCubeElementId;return L!=I?J._cubeCachedImage?J._cubeCachedImage[L]:null:J._shape3dCachedImage},setCachedTexture:function(n){var r=this,u=r.data,D=u._currentCubeElementId;if(D!=I){if(!r._cubeCachedImage)return r._cubeCachedImage={};r._cubeCachedImage[D]=n}else r._shape3dCachedImage=n},invalidateCachedTexture:function(o){var O,L,E,z=this;if((E=z._shape3dCachedImage)&&(o.deleteTexture(E),z._shape3dCachedImage=null),L=z._cubeCachedImage){for(O in L)o.deleteTexture(L[O]);z._cubeCachedImage=null}},vf:function(D,B){var H=this;if(H.gv.getFaceVisible(H.data,D)){var n=fj(H,D);n.mat&&(H.faceMat=!0);var o=n.uv;if(o){var q=H._cubeUvs;q||(q=H._cubeUvs=new kj([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var W=0;8>W;W++)q[B+W]=o[W]}return n}},_80o:function(D,t,M){var Q=this;if(Q._rectOverlapping)return!0;var X=Q.gv,R=Q.data,c=X._cube,S=Q.shapeModel;ir(X,Q.mat),S?cj(X,R,S,Q,Q.getBodyColor(),M):(Cl(D,c.vs,I,t.aPosition),Cl(D,c.ns,I,t.aNormal),dl(D,c.is),Q._18O(D,t,Q.left,0,M),Q._18O(D,t,Q.front,6,M),Q._18O(D,t,Q.right,12,M),Q._18O(D,t,Q.back,18,M),Q._18O(D,t,Q.top,24,M),Q._18O(D,t,Q.bottom,30,M)),xi(X),Q.faceMat&&(Q._18O(D,t,Q.left,0,M,!0),Q._18O(D,t,Q.front,6,M,!0),Q._18O(D,t,Q.right,12,M,!0),Q._18O(D,t,Q.back,18,M,!0),Q._18O(D,t,Q.top,24,M,!0),Q._18O(D,t,Q.bottom,30,M,!0))},_18O:function(D,h,A,t,q,S){if(A){if(!q(A.transparent))return;if(S&&!A.mat||!S&&A.mat)return;S&&ir(this.gv,A.mat);var n=this,f=n.data;f._currentCubeElementId=t;var j=n.gv,x=j.getTexture(A.texture,f),v=A.uv,B=A.uvScale,l=A.uvOffset,R=A.discardSelectable;x?v?mk(D,h,x,R,j._buffer.uv,n._cubeUvs,l,B):mk(D,h,x,R,j._cube.uv,I,l,B):mk(D),Jm(D,h,A.blend,A.light,A.opacity,A.reverseFlip,A.reverseColor,A.reverseCull),ti(D,h.uDiffuse,A.color),Jk(D,t,6),hl(D,h),gg(D,h,x),S&&xi(j),f._currentCubeElementId=null}}});var ss=function(H,D){zp(ss,this,[H,D])};ab(ss,ri,{_25Q:1,validate:function(R){var a=this,A=a.gv,u=a.data,m=a.s,C=m("edge.width"),D=u._40I,f=u._41I;if(a.shapeModel=a.info=I,D&&f){var E,G,w,l,W,X,z,F,r,J,Y=u.isLooped(),T=m(rd),j=h.getEdgeType(T);if(j){var _=j(u,Do(a,A,u,Y,T),A,a._19Q);if(!_.points||_.points.isEmpty())return;X=a.info={},z=_.segments,W=_.points,F=W.size();for(var o=D.getElevation(),y=f.getElevation(),c=0;F>c;c++){var M=W.get(c);M.e==I&&(M.e=o+(y-o)*c/(F-1))}r=po(W.get(0)),J=po(W.get(F-1));var K=F%2;0===K?(X.c1=po(W.get(F/2-1)),X.c2=po(W.get(F/2))):X.p3=po(W.get((F-K)/2)),X.s1=r,X.s2=po(W.get(1)),X.t1=po(W.get(F-2)),X.t2=J}else{W=new fb,X=a.info={};var i=m("edge.offset"),L=m("edge.center"),t=m("edge.source.t3"),P=m("edge.target.t3"),b=D.p3(),k=f.p3();if(t&&(b[0]+=t[0],b[1]+=t[1],b[2]+=t[2]),P&&(k[0]+=P[0],k[1]+=P[1],k[2]+=P[2]),T===iq){z=m("edge.segments");var V=X.points=m(Qe)||Qi;if(F=V.size()){r=po(V.get(0)),J=po(V.get(F-1)),!L&&i&&(w=Ip(r,b,!0),i=N(i,em(b,r)),b=[b[0]+w[0]*i,b[1]+w[1]*i,b[2]+w[2]*i],w=Ip(k,J,!0),i=N(i,em(J,k)),k=[k[0]-w[0]*i,k[1]-w[1]*i,k[2]-w[2]*i]);var K=F%2;0===K?(E=po(V.get(F/2-1)),G=po(V.get(F/2))):X.p3=po(V.get((F-K)/2)),X.s1=b,X.s2=r,X.t1=J,X.t2=k}else!L&&i&&(w=Ip(k,b,!0),l=em(b,k),i=Kk(i,l),b=[b[0]+w[0]*i,b[1]+w[1]*i,b[2]+w[2]*i],k=[k[0]-w[0]*i,k[1]-w[1]*i,k[2]-w[2]*i]),E=b,G=k;W.add({x:b[0],y:b[2],e:b[1]}),W.addAll(V),W.add({x:k[0],y:k[2],e:k[1]})}else{var g=Do(a,A,u,Y,T);if(a._19Q||(g=-g),Y){var e=b[0],q=b[1],O=b[2],p=D.getTall()/2+g;E=[e-g,q+p,O],G=[e+g,q+p,O],W.add({x:e-g,y:O,e:q}),W.add({x:e-g,y:O,e:q+p}),W.add({x:e+g,y:O,e:q+p}),W.add({x:e+g,y:O,e:q})}else{w=Ip(k,b,!0),l=em(b,k);var s={x:b[0],y:b[2]},v={x:k[0],y:k[2]},H=ui(I,s,v,g),Q=H.x-s.x,x=H.y-s.y;i=Kk(i,l),w[0]*=i,w[1]*=i,w[2]*=i,E=[b[0]+w[0]+Q,b[1]+w[1],b[2]+w[2]+x],G=[k[0]-w[0]+Q,k[1]-w[1],k[2]-w[2]+x],L?(W.add({x:b[0],y:b[2],e:b[1]}),W.add({x:E[0],y:E[2],e:E[1]}),W.add({x:G[0],y:G[2],e:G[1]}),W.add({x:k[0],y:k[2],e:k[1]})):(W.add({x:E[0],y:E[2],e:E[1]}),W.add({x:G[0],y:G[2],e:G[1]}))}}X.c1=E,X.c2=G}X.list=m(Qd)===Zq?a.createTubeModel(W,z,C/2,R):a.createLineModel(W,z,C,"edge","edge.dash")}}});var ai=function(T,v){zp(ai,this,[T,v])};ab(ai,Vo,{_80o:function(R,k,Y){var Z=this,j=Z.gv,f=Z.shapeModel;ir(j,Z.mat),f?cj(j,Z.data,f,Z,Z.getBodyColor(),Y):(No(Z,R,k,Z.left,Y),No(Z,R,k,Z.front,Y),No(Z,R,k,Z.right,Y),No(Z,R,k,Z.back,Y),No(Z,R,k,Z.top,Y),No(Z,R,k,Z.bottom,Y)),xi(j)},validate:function(X,R){var A,E,f=this,s=f.s,L=f.data,C=L.p3(),O=L._thickness/2,w=L.isClosePath(),T=L.getPoints(),V=L.getSegments(),$=s(ln),e=X&&X.uv;if(f.clear(),0>O)E=f.shapeModel=Ef(T,V,s(js),s(kd),$,s(hf),L.getTall(),L.getShapeElevation(),w),s(Li)?s("shape3d.image")||delete E.uv:(delete E.vs,delete E.ns,delete E.uv),s("shape3d.top.image")||delete E.top_uv,s("shape3d.bottom.image")||delete E.bottom_uv;else if(s(Qd)===Zq)A=bf(T,V,$,w),E=f.shapeModel={vs:[]},s("shape3d.image")&&(E.uv=[],E.sum=s(hf)||Ib(A)||1,E.len=0),s(js)&&!w&&(E.top_vs=[],s("shape3d.top.image")&&(E.top_uv=[])),s(kd)&&!w&&(E.bottom_vs=[],s("shape3d.bottom.image")&&(E.bottom_uv=[])),f._12O(A,O);else{var k,D,J,t,g,z,U,b,x,p;if(A=bf(T,V,$,w),g=f.vf(uq,e,!1,R),O&&(z=f.vf(gh,e,!1,R),U=w?I:f.vf(Mn,e,!1,R),b=w?I:f.vf(rj,e,!1,R),x=f.vf(yo,e,!1,R),p=f.vf(Fl,e,!1,R)),O){for(var M=0,l=A.length;l>M;M++)A[M]=f._tryRemoveBezierPoints(A[M],O);f._12O(A,O)}else g&&A.forEach(function($){if(t=$.length,t>0)for(k=$[0],J=1;t>J;J++)D=$[J],f.addV(g.vs,k,D),k=D});f._20Q(A),X||(g&&(g.ns=Ug(g.vs),gf(g,"vs"),gf(g,Ap)),O&&(z&&(z.ns=Ug(z.vs),gf(z,"vs"),gf(z,Ap)),U&&(U.ns=Ug(U.vs),gf(U,"vs"),gf(U,Ap)),b&&(b.ns=Ug(b.vs),gf(b,"vs"),gf(b,Ap)),x&&(x.ns=Ug(x.vs),gf(x,"vs"),gf(x,Ap)),p&&(p.ns=Ug(p.vs),gf(p,"vs"),gf(p,Ap))))}var u=f.mat=Fn();Le(u,C),us(u,L.getFinalRotation3d(),L.getRotationMode());var N=L.getScale3d(),K=L._dynamicScale3d;K&&(N[0]*=K[0],N[1]*=K[1],N[2]*=K[2]),In(u,N),Le(u,Kr(C)),X&&(Gp(f,u,X,E),f.clear())},_20Q:function(Z){var k,C,g,l,x,N,j,u=this,n=u.front,U=u.back,A=u.top,h=u.bottom,s=n?n.tuv:I,S=U?U.tuv:I,e=A?A.tuv:I,X=h?h.tuv:I,F=0;(s||S||e||X)&&(k=u.s(hf)||Ib(Z)||1,Z.forEach(function(I){if(C=I.length,C>0)for(N=I[0],g=1;C>g;g++)j=I[g],l=F/k,F+=em(N,j),x=F/k,u._14O(n,l,x),u._14O(U,1-x,1-l),u._14O(A,l,x),u._14O(h,l,x),N=j}))},_14O:function(v,W,H){if(v){var T=v.uv,D=v.tuv;if(D){if(T)var $=T[0]+(T[6]-T[0])*W,o=T[1]+(T[7]-T[1])*W,a=T[2]+(T[4]-T[2])*W,q=T[3]+(T[5]-T[3])*W,c=T[2]+(T[4]-T[2])*H,z=T[3]+(T[5]-T[3])*H,Q=T[0]+(T[6]-T[0])*H,J=T[1]+(T[7]-T[1])*H;else $=W,o=0,a=W,q=1,c=H,z=1,Q=H,J=0;D.push(a,q,c,z,Q,J,Q,J,$,o,a,q)}}},_13O:function(T){var S=T.uv,i=T.tuv;i&&(S?i.push(S[2],S[3],S[4],S[5],S[6],S[7],S[6],S[7],S[0],S[1],S[2],S[3]):i.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(r,t){var O=r.length;if(4>O)return r;var F,V,$,s,v,q,J=!1,X=function(K){return r[K]},T=function(j){return r[O-1-j]};for(v=0;1>=v;v++)for(q=v?T:X,V=q(0),$=q(1),F=2;O-1>F;F++)if(s=q(F),!s.remove)if(s.b){var R=ui(V,$,s,t);R.adjust?(s.remove=!0,J=!0):(V=$,$=s)}else V=$,$=s;if(!J)return r;var K=[];for(F=0;O>F;F++)r[F].remove||K.push(r[F]);return K},_12O:function(O,N){var n,z,M,v,c,$=this;O.forEach(function(C){if(c=C.length,c>0)for(n={p:C[0],n:!0},v=1;c>v;v++)z=C[v],M=c-1>v?C[v+1]:I,$.addPoint(n,z,M,N,C)})},addPoint:function(f,C,J,E,X){var T,P,_,R,V,e,d,A,y,v=this,m=f.p,r=f.f,b=f.b,n=v.s("shape3d.side")||Qj,t=v.s("shape3d.start.angle"),a=v.s("shape3d.sweep.angle"),N=v.shapeModel,l=v.data.isClosePath();if(f.n&&(f.n=!1,r=l&&X.length>2?ui(X[X.length-2],m,C,E):ui(I,m,C,E),b=Fh(m,r),N?N.top_vs&&v._10O(b,r,n,t,a,N.top_vs,N.top_uv):(T=v.left)&&(v.addV(T.vs,b,r),v._13O(T))),P=J?ui(m,C,J,E):l&&X.length>2?ui(m,C,X[1],E):ui(m,C,I,E),_=Fh(C,P),N){var O,g,S=N.vs,F=N.uv,K=N.sum;for(F&&(O=N.len/K,N.len+=em(m,C),g=N.len/K),e=v._9O(b,r,n,t,a),d=v._9O(_,P,n,t,a),A=0;n>A;A++)y=A+1,Vc(S,e[y]),Vc(S,d[A]),Vc(S,e[A]),Vc(S,d[A]),Vc(S,e[y]),Vc(S,d[y]),F&&(R=A/n,V=y/n,F.push(O,V,g,R,O,R,g,R,O,V,g,V));!J&&N.bottom_vs&&v._10O(_,P,n,t,a,N.bottom_vs,N.bottom_uv,!0)}else!J&&(T=v.right)&&(v.addV(T.vs,P,_),v._13O(T)),(T=v.front)&&v.addV(T.vs,r,P),(T=v.back)&&v.addV(T.vs,_,b),(T=v.top)&&v.addH(T.vs,r,P,_,b,!0),(T=v.bottom)&&v.addH(T.vs,b,_,P,r);f.p=C,f.f=P,f.b=_},_10O:function(a,X,B,$,s,g,Y,d){var S,C,z=this,o=z.data,R=z._9O(a,X,B,$,s),e=(a.x+X.x)/2,H=(a.y+X.y)/2,q=o.getShapeElevation(),x=0;for(x=0;B>x;x++)d?(Vc(g,R[x]),Vc(g,R[x+1])):(Vc(g,R[x+1]),Vc(g,R[x])),Vc(g,[e,q,H]),Y&&(d?(S=W*(x+1)/B+$,C=W*x/B+$):(S=W*x/B+$,C=W*(x+1)/B+$),Y.push(.5-.5*O(C),.5-.5*f(C),.5-.5*O(S),.5-.5*f(S),.5,.5))},_9O:function(g,v,r,l,y){var R,X,T=this,M=T.data,$=[],G=(g.x+v.x)/2,Z=(g.y+v.y)/2,A=M.getTall()/2,u=M.getShapeElevation(),S=0;for(y=y||W;r>=S;S++)R=y*S/r+l,X=O(R),$.push([G+(g.x-G)*X,u+A*f(R),Z+(g.y-Z)*X]);return $},addV:function(N,b,o){var c=b.x,f=b.y,_=o.x,I=o.y,t=this.data,P=t.getShapeElevation(),V=t.getTall()/2;N.push(c,P-V,f,_,P-V,I,_,P+V,I,_,P+V,I,c,P+V,f,c,P-V,f)},addH:function(Z,j,M,d,e,f){var l=this.data,F=l.getTall()/2,t=l.getShapeElevation()+(f?F:-F);Z.push(j.x,t,j.y,M.x,t,M.y,d.x,t,d.y,d.x,t,d.y,e.x,t,e.y,j.x,t,j.y)},vf:function(o,C,w,S){var Q,E=this,J=E.gv.getFaceVisible(E.data,o);return(w||J)&&(Q=fj(E,o,S),Q.vs=[],Q.tuv=J&&(Q.texture||C)?[]:I,Q.visible=J),Q}});var $l=function(A,V){zp($l,this,[A,V])};ab($l,ri,{_25Q:1,validate:function(C){var w=this,f=w.data,Q=w.s,E=f.getPoints(),R=E.size();if(w.shapeModel=w.info=I,R>1){var O=w.info={},L=f.getSegments(),e=f.getThickness(),o=po(E.get(0)),d=po(E.get(R-1)),T=R%2;0===T?(O.c1=po(E.get(R/2-1)),O.c2=po(E.get(R/2))):O.p3=po(E.get((R-T)/2)),O.s1=o,O.s2=po(E.get(1)),O.t1=po(E.get(R-2)),O.t2=d,O.list=Q(Qd)===Zq?w.createTubeModel(E,L,e/2,C):w.createLineModel(E,L,e,"shape.border","shape.dash")}var M=f.p3(),y=w.mat=Fn();Le(y,M),us(y,f.getFinalRotation3d(),f.getRotationMode());var D=f.getScale3d(),j=f._dynamicScale3d;j&&(D[0]*=j[0],D[1]*=j[1],D[2]*=j[2]),In(y,D),Le(y,Kr(M))},_80o:function(g,I,Q){var A=this,L=A.shapeModel;if(L){var F=A.gv;ir(F,A.mat),cj(F,A.data,L,A,A.getBodyColor(),Q),xi(F)}}});var As=j.graph3d.VR=function(y){var A=this;A.gv=y,A._controllers=[],A.switch=new mb(A),A._enable=!1,A._defaultCallLater=j.Default.callLater,A._defaultCancelLater=ne,"undefined"!=typeof U&&"VRFrameData"in U&&(A._frameData=new U.VRFrameData),A.measureOflength=1,A.eyesOffset=[0,0,0],A._orientation=new j.Math.Quaternion,A._lastHeadPose=[0,0,0],A._offsetToBeAdd=[0,0,0],A._fpsInfo={time:0,fps:0,frames:0}};ab(As,C,{ms_fire:!0,_42:function(w,T,p,u){var A=this,q=A.gv;if(!q.drawFilter&&A._deviceInAction){var h=A._device;if(h){var S=A._measureOflength;h.depthNear=q.getNear()*S,h.depthFar=q.getFar()*S;var B=A._offsetToBeAdd;if(A.eyesOffset[0]+=B[0],A.eyesOffset[1]+=B[1],A.eyesOffset[2]+=B[2],B[0]=0,B[1]=0,B[2]=0,h.isPresenting===!1)return A._controllers.forEach(function(V){V&&V.update()}),q.iv(),!1;var E=A._frameData;h.getFrameData(E);var K=E.pose.position;if(K){var v=A.toViewPosition(K);q.setEye(v),A._orientation.fromArray(E.pose.orientation);var c=new j.Math.Vector3(0,0,-10*A._scaleFactor);c.applyQuaternion(A._orientation),q.setCenter([v[0]+c.x,v[1]+c.y,v[2]+c.z])}A._controllers.forEach(function(T){T&&T.update()}),q.setViewport(w,0,0,T/2,p),A._viewMatrix=A._copyViewMatrix(E.leftViewMatrix),A._projectMatrix=A._copyProjectMatrix(E.leftProjectionMatrix),u(),q.setViewport(w,T/2,0,T/2,p),A._viewMatrix=A._copyViewMatrix(E.rightViewMatrix),A._projectMatrix=A._copyProjectMatrix(E.rightProjectionMatrix),u(),A._lastViewMatrix=A._viewMatrix,A._lastProjectMatrix=A._projectMatrix,A._viewMatrix=null,A._projectMatrix=null,A.submitFrame();var U=Date.now(),M=A._fpsInfo;return U-M.time>1e3?(M.fps=Math.round(1e3*(M.frames+1)/(U-M.time)),M.time=U,M.frames=0):M.frames++,!0}}},onVRDisplayPresentChange:function(){var R=this.isPresenting();this._injectGraphView(R),this.fp("present",!R,R)},getOrientation:function(){return this._orientation},addController:function(K){K=K||0;var D=this,J=D.getController(K);return J?J:(J=new jm(D,K),D._controllers.push(J),J)},getController:function(b){b=b||0;for(var D=this._controllers,h=0,V=D.length;V>h;h++)if(D[h]&&D[h].id===b)return D[h];return null},removeController:function(Y){Y=Y||0;for(var r=this._controllers,f=0,L=r.length;L>f;f++)if(r[f]&&r[f].id===Y)return r.splice(f,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(B,Z){var Y=this,b=Y._scaleFactor,E=Y._eyesOffset,h=Y._lastHeadPose;return h[0]=B[0]*b,h[1]=B[1]*b,h[2]=B[2]*b,Z?(Z[0]=h[0]+E[0],Z[1]=h[1]+E[1],Z[2]=h[2]+E[2],Z):[h[0]+E[0],h[1]+E[1],h[2]+E[2]]},addEyesOffset:function($,T,d){var H=this._offsetToBeAdd;H[0]+=$,H[1]+=T,H[2]+=d},_copyViewMatrix:function(d){var r=this.dup(d),F=this._scaleFactor;r[12]*=F,r[13]*=F,r[14]*=F;var L=this._eyesOffset;if(L&&(L[0]||L[1]||L[2])){var t=L[0],g=L[1],C=L[2];r[12]-=r[0]*t+r[4]*g+r[8]*C,r[13]-=r[1]*t+r[5]*g+r[9]*C,r[14]-=r[2]*t+r[6]*g+r[10]*C}return r},shutdown:function(){var i=this._device;i&&i.isPresenting&&i.exitPresent()},isPresenting:function(){var z=this._device;return z&&z.isPresenting},_copyProjectMatrix:function(D){var h=this.dup(D),k=this._scaleFactor;return h[14]*=k,h},dup:function(Q,K){for(var J=Q.length,z=K||new Array(J);J--;)z[J]=Q[J];return z},getViewMatrix:function(M){var E=this._viewMatrix;return E?this.dup(E,M):void 0},getProjectMatrix:function(){var Q=this._projectMatrix;return Q?this.dup(Q):void 0},submitFrame:function(){var j=this;if(j._enable&&j._deviceInAction){var V=j._device;V&&V.isPresenting&&(V.submitFrame(),j.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(L){var N=this.gv;return N.intersectObjects(L,N.dm().getDatas())},setDevice:function(g){var U=this;U._device=g},_injectGraphView:function(){var x,$,V;return function(z){var U=this.gv;if(!z)return x&&(U.getWidth=x,U.getHeight=$,U.getDevicePixelRatio=V),void 0;var A=this._device,l=A.getEyeParameters("left"),d=l.renderWidth,y=l.renderHeight;x=U.getWidth,$=U.getHeight,V=U.getDevicePixelRatio,U.getWidth=function(){return 2*d},U.getHeight=function(){return y},U.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function(f){var m=this;if(!f)return Cr=j.Default.callLater=m._defaultCallLater,ne=j.Default.cancelLater=m._defaultCancelLater,void 0;var m=this;Cr=j.Default.callLater=function(I,t,Y,x){var y=m._device;return y&&y.isPresenting?x?e(function(){Cr(I,t,Y)},x):y.requestAnimationFrame(function(){m._deviceInAction=!0,I.apply(t,Y),m._deviceInAction=!1}):m._defaultCallLater(I,t,Y,x)},ne=j.Default.cancelLater=function(F,n){var P=m._device;return P&&P.isPresenting?n?r(F):P.cancelAnimationFrame(F):m._defaultCancelLater(F,n)}}}),C.defineProperties(As.prototype,{enable:{get:function(){return this._enable},set:function(M){var l=this;l._enable!==M&&(l._enable=M,M?(l.switch.showButton(),l._injectCallLaterFunc(!0)):(l.shutdown(),l.switch.hideButton(),l._injectCallLaterFunc(!1)),l.fp("enable",!M,M))}},measureOflength:{get:function(){return this._measureOflength},set:function(x){this._measureOflength=x;var G=this._scaleFactor=1/x;this._controllers.forEach(function(B){B&&B._setScaleFactor(G)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(S){this._eyesOffset=S}},controllerModel:{get:function(){return this._controllerModel},set:function(n){var a;"object"==typeof n?(a=n.mtl,n=n.obj):(a=n+".mtl",n+=".obj");var N=this,m=N._controllerModel;m&&m.obj===n&&m.mtl===a||(m=N._controllerModel={obj:n,mtl:a},h.loadObj(n,a,{finishFunc:function(S,Z){N._controllerModel===m&&h.setShape3dModel("vrControllerModel",Z)}}))}},interactive:{get:function(){return!!this._interactive},set:function(N){!!N!=!!this._interactive&&(this._interactive=N,N&&this.addController(0),this.gv.getCoreInteractor().enableVR(N))}}});var jm=function(F,E){function j(i){var u=navigator.getGamepads&&navigator.getGamepads();if(u)for(var I=0,w=0,n=u.length;n>I;I++){var W=u[I];if(W){var X=W.id;if("OpenVR Gamepad"===X||"OpenVR Controller"===X||0===X.indexOf("Oculus Touch")||0===X.indexOf("Spatial Controller")){if(w===i)return W;w++}}}}function l(_,U,E){return Math.abs(_[0]-U[0])<E&&Math.abs(_[1]-U[1])<E&&Math.abs(_[2]-U[2])<E?!0:!1}var $=this;$.vr=F,$.id=E;var O,S,X=[0,0],U=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],_=new yq;_.s("shape3d","vrControllerModel"),_.isController=!0,_.s("intersect",!1),$.getGamepad=function(){return S},$.isButtonPressed=function(t){for(var N,L=0,s=U.length;s>L;L++)if(N=U[L],N.id===t)return N.pressed;return!1},$.getNode=function(){return _};var f=.003;$.setRotationEpsilon=function(Y){f=Y};var B=5e-4,c=B;$.setPositionEpsilon=function(m){B=m,c=m*$.vr._scaleFactor},$._setScaleFactor=function(J){_.s3(J,J,J),c=B*J},$._setScaleFactor($.vr._scaleFactor);var v,Q=new xg,L=new vn,k=[0,0,0],A=[0,0,0],W=new Rn,P=new Wi,p=new Fr;$.getRay=function(){return v?(p.origin.fromArray(k),p.direction.copy(P),v=!1,p):p},$.update=function(){if(O=S,S=j(E),O!=S&&console.log("gamepad changed",S),!S||S.pose===H)return S=null,_.s("3d.visible",!1),void 0;if(h.getShape3dModel("vrControllerModel")){_.dm()||F.gv.dm().add(_),_.s("3d.visible",!0);var B=S.pose;if(null!==B){B.position&&($.vr.toViewPosition(B.position,k),l(_.p3(),k,c)||(v=!0,_.p3(k))),B.orientation&&(Q.fromArray(B.orientation),P.set(0,0,-1).applyQuaternion(Q).normalize(),L.makeRotationFromQuaternion(Q),W.set(0,0,0,_.getRotationMode(),!0).setFromRotationMatrix(L),A[0]=W.x,A[1]=W.y,A[2]=W.z,l(_.r3(),A,f)||(v=!0,_.r3(A))),v&&F.fp("gamepad.pose",null,{position:k,rotation:A,id:E});var V=S.axes;(X[0]!==V[0]||X[1]!==V[1])&&(X=[V[0],V[1]],F.fp("gamepad.axes",null,{id:E,axes:X}));var i,D,C,I,N=S.buttons;for(i=0,D=N.length;D>i;i++)if(C=N[i],I=C.pressed,I!==U[i].pressed){U[i].pressed=I;var q={id:E},m="state";q[m]=q._62O=I?"down":"up",F.fp("gamepad.button."+U[i].id,null,q)}}}}},mb=function(p){this.vr=p,this._button=null};ab(mb,C,{showButton:function(){var c=this.assureButton();if(!c.parentNode){var n=this.vr.gv,p=n.getView();n._79O?p.insertBefore(c,n._79O):p.appendChild(c)}},hideButton:function(){var F=this._button;F&&F.parentNode&&F.parentNode.removeChild(F)},assureButton:function(){var I=this._button;return I?I:this._button=this.createButton(this.vr.gv)},createButton:function(H){function A(M,T){M.textContent=T&&T.isPresenting?" VR ":" VR "}function $($){j.style.display="",j.style.cursor="pointer",j.style.left="calc(50% - 50px)",j.style.width="100px",A(j,$),j.onmouseenter=function(){j.style.opacity="1.0"},j.onmouseleave=function(){j.style.opacity="0.5"},j.onclick=function(){$.isPresenting?$.exitPresent():$.requestPresent([{source:H.getCanvas()}])},H.vr.setDevice($)}function r(){j.style.display="",j.style.cursor="auto",j.style.left="calc(50% - 75px)",j.style.width="150px",A(j,null),j.onmouseenter=null,j.onmouseleave=null,j.onclick=null,H.vr.setDevice(null)}function D(G){G.style.position="absolute",G.style.bottom="20px",G.style.padding="12px 6px",G.style.border="1px solid #fff",G.style.borderRadius="4px",G.style.color="#000",G.style.font="normal 13px sans-serif",G.style.textAlign="center",G.style.opacity="0.5",G.style.outline="none",G.style.zIndex="999"}if("getVRDisplays"in navigator){var j=this._button=i.createElement("button");return j.style.display="none",D(j),U.addEventListener("vrdisplayconnect",function(u){$(u.display)},P),U.addEventListener("vrdisplaydisconnect",function(){r()},P),U.addEventListener("vrdisplaypresentchange",function(I){A(j,I.display),H.vr.onVRDisplayPresentChange()},P),navigator.getVRDisplays().then(function(z){z.length>0?$(z[0]):r()}),j}var s=i.createElement("a");return s.href="https://webvr.info",s.innerHTML=" webvr",s.style.left="calc(50% - 90px)",s.style.width="180px",s.style.textDecoration="none",D(s),s}}),C.defineProperties(mb.prototype,{});var xq=j.graph3d.PostProcessing=function(A){function t(){if(!_){var U=A.getGL();_=new Uq.RenderTarget(A,U),F=new pc.Shader(U,w.vs,w.fs),B=pc.Buffer.createIndexBuffer(U,new Uint16Array([0,2,1,1,2,3])),o=pc.Buffer.createVertexBuffer(U,new Float32Array([0,0,1,0,0,1,1,1]))}}var _,F,B,o,O=this,R={},r=!1;!function(){var G;for(G in xq)R[G]=new xq[G](A)}(),O.getModule=function(L){return L?R[L]:R},O.getModuleList=function(){return C.keys(R)},O.handleDataModleChange=function(g,r){g&&(g.setPostProcessingData(O.serialize()),g.removeSerializeListener(O.onDataModelSerialize,O)),r&&(r.addSerializeListener(O.onDataModelSerialize,O),O.deserialize(r.getPostProcessingData()))},O.onDataModelSerialize=function(b){"serialize"===b.type?A.dm()._postProcessingData=O.serialize():"deserialize"===b.type&&O.deserialize(A.dm().getPostProcessingData())},O.serialize=function(){var p,M,d,q={};for(p in R)M=R[p],q[p]={enable:M.enable},d=M.serializeProperties,d&&d.forEach(function(d){q[p][d]=M[d]});return q},O.deserialize=function(y){if(y){var g,J,F,C;for(g in y){J=R[g],F=y[g],O.enableModule(g,F.enable);for(C in F)"enable"!==C&&(J[C]=F[C])}}else{var g,J;for(g in R)J=R[g],J.enable=!1,J.resetProperties&&J.resetProperties()}},O.enableModule=function(u,q){var S,E,o,m=u.split(",");for(S=0,E=m.length;E>S;S++)o=m[S].trim(),R[o]&&(R[o].enable=q);r=!1;for(o in R)if(R[o].enable){r=!0;break}r&&t()};var w={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};O._42=function(h,J,T,$,K){if(r&&!K){_.setSize(h,J,T),is(h,_.frame),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT),A.setViewport(h,0,0,J,T),$();var H,I=_;for(H in R)I=R[H]._42(h,I)||I;return is(h,null),A.setViewport(h,0,0,J,T),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT),F.bind(),h.activeTexture(h.TEXTURE0+0),h.bindTexture(h.TEXTURE_2D,I.texture),F.uniforms.image=0,B.upload(),o.upload(),F.attributes.pos.pointer(o),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),h.bindTexture(h.TEXTURE_2D,null),h.useProgram(A._prg),!0}}},zg=j.graph3d.PostProcessing.Bloom=function(f){function I(){y=!0,v=[f.getWidth(),f.getHeight()];var q,U=f.getGL(),h=Math.round(v[0]/2),p=Math.round(v[1]/2);for(l=new Uq.RenderTarget(f,U,h,p),q=0;N>q;q++)i.push(new Uq.RenderTarget(f,U,h,p)),M.push(new Uq.RenderTarget(f,U,h,p)),h=Math.round(h/2),p=Math.round(p/2);r=new pc.Shader(U,zg.highPassShader.vs,zg.highPassShader.fs);for(var q=0;N>q;q++)j[q]=new pc.Shader(U,zg.blurShader.vs,zg.blurShader.fs.replace(/DEFINE_VALUE/g,$[q]));m=new pc.Shader(U,zg.compositeShader.vs,zg.compositeShader.fs.replace(/NUM_MIPS/g,N)),L=new pc.Shader(U,zg.finalShader.vs,zg.finalShader.fs),Z=pc.Buffer.createIndexBuffer(U,new Uint16Array([0,2,1,1,2,3])),d=pc.Buffer.createVertexBuffer(U,new Float32Array([0,0,1,0,0,1,1,1]))}var O,o,T,Z,d,k=this,U=!1,y=!1;this.serializeProperties="strength,threshold,radius".split(","),this.resetProperties=function(){O=1.5,o=.55,T=.4},C.defineProperties(k,{enable:{get:function(){return U},set:function(k){!!U!=!!k&&(U=k,k&&!y&&I())}},strength:{get:function(){return O},set:function(C){O=C}},threshold:{get:function(){return o},set:function(S){o=S}},radius:{get:function(){return T},set:function(g){T=g}}}),this.resetProperties();var l,r,m,L,v=[256,256],i=[],M=[],N=5,$=[3,5,7,9,11],j=[];k._42=function(S,a){function B(r,a,W,n){is(S,a.frame),f.setViewport(S,0,0,a.width,a.height),n?n(S):S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT),_!==r&&r.bind();var K=0;for(var A in W){var G=W[A];G instanceof WebGLTexture&&(S.activeTexture(S.TEXTURE0+K),S.bindTexture(S.TEXTURE_2D,G),G=K,K++),r.uniforms[A]=G}for(_!==r&&(Z.upload(),d.upload(),r.attributes.pos.pointer(d),_=r),S.drawElements(S.TRIANGLES,6,S.UNSIGNED_SHORT,0);K--;)S.activeTexture(S.TEXTURE0+K),S.bindTexture(S.TEXTURE_2D,null)}if(U){var _;B(r,l,{smoothWidth:.01,luminosityThreshold:o,tDiffuse:a.texture});var Y,D=l,$=Math.round(v[0]/2),z=Math.round(v[1]/2);for(Y=0;N>Y;Y++)B(j[Y],i[Y],{colorTexture:D.texture,direction:[1,0],texSize:[$,z]}),B(j[Y],M[Y],{colorTexture:i[Y].texture,direction:[0,1],texSize:[$,z]}),$=Math.round($/2),z=Math.round(z/2),D=M[Y];return B(m,i[0],{blurTexture1:M[0].texture,blurTexture2:M[1].texture,blurTexture3:M[2].texture,blurTexture4:M[3].texture,blurTexture5:M[4].texture,bloomStrength:O,bloomRadius:T,bloomTintColor:[1,1,1]}),B(L,a,{image:i[0].texture},function(X){X.enable(X.BLEND),X.blendEquation(X.FUNC_ADD),X.blendFunc(X.SRC_ALPHA,X.ONE)}),S.blendEquationSeparate(S.FUNC_ADD,S.FUNC_ADD),S.blendFuncSeparate(S.SRC_ALPHA,S.ONE_MINUS_SRC_ALPHA,S.ONE,S.ONE_MINUS_SRC_ALPHA),a}}};zg.highPassShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D tDiffuse;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4(0.0, 0.0, 0.0, 0.0);","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},zg.blurShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D colorTexture;","uniform vec2 texSize;","uniform vec2 direction;","#define KERNEL_RADIUS DEFINE_VALUE","#define SIGMA DEFINE_VALUE","float gaussianPdf(in float x, in float sigma) {","return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;","}","void main() {","vec2 invSize = 1.0 / texSize;","float fSigma = float(SIGMA);","float weightSum = gaussianPdf(0.0, fSigma);","vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;","for( int i = 1; i < KERNEL_RADIUS; i ++ ) {","float x = float(i);","float w = gaussianPdf(x, fSigma);","vec2 uvOffset = direction * invSize * x;","vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;","vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;","diffuseSum += (sample1 + sample2) * w;","weightSum += 2.0 * w;","}","gl_FragColor = vec4(diffuseSum/weightSum, 1.0);","}"].join("\n")},zg.compositeShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D blurTexture1;","uniform sampler2D blurTexture2;","uniform sampler2D blurTexture3;","uniform sampler2D blurTexture4;","uniform sampler2D blurTexture5;","uniform sampler2D dirtTexture;","uniform float bloomStrength;","uniform float bloomRadius;","uniform vec3 bloomTintColor;","float lerpBloomFactor(const in float factor) {","float mirrorFactor = 1.2 - factor;","return mix(factor, mirrorFactor, bloomRadius);","}","void main() {","gl_FragColor = bloomStrength * ( lerpBloomFactor(1.0) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture1, vUv) + ","lerpBloomFactor(0.8) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture2, vUv) + ","lerpBloomFactor(0.6) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture3, vUv) + ","lerpBloomFactor(0.4) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture4, vUv) + ","lerpBloomFactor(0.2) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture5, vUv) );","}"].join("\n")},zg.finalShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};
var gn=j.graph3d.PostProcessing.Fxaa=function(a){function j(){d=!0;var X=a.getGL();o=new pc.Shader(X,gn.ShaderSource.vs,gn.ShaderSource.fs),t=pc.Buffer.createIndexBuffer(X,new Uint16Array([0,2,1,1,2,3])),E=pc.Buffer.createVertexBuffer(X,new Float32Array([0,0,1,0,0,1,1,1])),U=new Uq.RenderTarget(a,X)}var t,E,o,U,u=this,p=!1,d=!1;C.defineProperties(u,{enable:{get:function(){return p},set:function(F){!!p!=!!F&&(p=F,F&&!d&&j())}}}),u._42=function(Y,P){function f(m,T,H,c){is(Y,T.frame),a.setViewport(Y,0,0,T.width,T.height),c?c(Y):Y.clear(Y.COLOR_BUFFER_BIT|Y.DEPTH_BUFFER_BIT),m.bind();var P=0;for(var g in H){var G=H[g];G instanceof WebGLTexture&&(Y.activeTexture(Y.TEXTURE0+P),Y.bindTexture(Y.TEXTURE_2D,G),G=P,P++),m.uniforms[g]=G}for(t.upload(),E.upload(),m.attributes.pos.pointer(E),Y.drawElements(Y.TRIANGLES,6,Y.UNSIGNED_SHORT,0);P--;)Y.activeTexture(Y.TEXTURE0+P),Y.bindTexture(Y.TEXTURE_2D,null)}if(p){var b=P.width,x=P.height;return U.setSize(Y,b,x),f(o,U,{tDiffuse:P.texture,resolution:[1/b,1/x]}),U}}};gn.ShaderSource={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},Of(h,{accordionViewExpandIcon:$j(qd),accordionViewCollapseIcon:$j(qd,!0),accordionViewLabelColor:gp,accordionViewLabelFont:be,accordionViewTitleBackground:ub,accordionViewSelectBackground:wi,accordionViewSelectWidth:3,accordionViewSeparatorColor:H,splitViewDividerSize:1,splitViewDividerBackground:ub,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:Em,rect:[2,2,12,12],background:qd}]},propertyViewLabelColor:Cc,propertyViewLabelSelectColor:gp,propertyViewLabelFont:be,propertyViewExpandIcon:$j(ji),propertyViewCollapseIcon:$j(ji,!0),propertyViewBackground:Dn,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:oj,propertyViewColumnLineColor:oj,propertyViewSelectBackground:wi,listViewLabelColor:Cc,listViewLabelSelectColor:gp,listViewLabelFont:be,listViewRowLineVisible:!1,listViewRowLineColor:oj,listViewSelectBackground:wi,treeViewLabelColor:Cc,treeViewLabelSelectColor:gp,treeViewLabelFont:be,treeViewExpandIcon:$j(xf),treeViewCollapseIcon:$j(xf,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:oj,treeViewSelectBackground:wi,treeViewDoubleClickToToggle:!0,tableViewLabelColor:Cc,tableViewLabelSelectColor:gp,tableViewLabelFont:be,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:oj,tableViewColumnLineColor:oj,tableViewSelectBackground:wi,treeTableViewLabelColor:Cc,treeTableViewLabelSelectColor:gp,treeTableViewLabelFont:be,treeTableViewExpandIcon:$j(xf),treeTableViewCollapseIcon:$j(xf,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:oj,treeTableViewColumnLineColor:oj,treeTableViewSelectBackground:wi,tableHeaderLabelColor:Cc,tableHeaderLabelFont:be,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:kn,tableHeaderBackground:Dn,tableHeaderMoveBackground:Xb,tableHeaderInsertColor:wi,tableHeaderSortDescIcon:ac(ji,!0),tableHeaderSortAscIcon:ac(ji),tabViewTabGap:1,tabViewLabelColor:gp,tabViewLabelFont:be,tabViewTabBackground:ub,tabViewSelectWidth:3,tabViewSelectBackground:wi,tabViewMoveBackground:Xb,tabViewInsertColor:wi,toolbarLabelColor:Cc,toolbarLabelSelectColor:gp,toolbarLabelFont:be,toolbarBackground:Dn,toolbarSelectBackground:wi,toolbarItemGap:8,toolbarSeparatorColor:mh},!0);
var Yl={translateX:1,sortColumn:1},Vm={sortable:1,sortOrder:1,sortFunc:1},os={focusData:1},We={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Me={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},um=function(v,V){V.add(v),v.hasChildren()&&v.eachChild(function(n){um(n,V)})},Tf=function(i,_,f,c,q,X,g,A,l,B,t){var D,p=f.getValueType(B),n=f.getAlign(B);if(f.getEnumValues(B)){var y=f.toEnumLabel(_,B),x=Qk||0,N=0,G=X,Y=h.getTextSize(c,y).width;return D=qp(f.toEnumIcon(_,B)),D&&(N=X+Qk/2,"center"===n?N+=(A-(x+Y))/2:"right"===n&&(N=N+A-(x+Y)),ll(i,D,N,g+l/2,B,t),G=N+Qk/2),y!=I&&(D?zj(i,y,c,q,G,g,A-(G-X),l):zj(i,y,c,q,X,g,A,l,n)),void 0}return _=f.formatValue(_),_!=I?p===sq?(Yg(i,X,g,A,l,_),void 0):p===jc||!p&&Ro(_)?(D=qp(_?Vk:Dj),ll(i,D,X+A/2,g+l/2,B,t),void 0):(zj(i,_,c,q,X,g,A,l,n),void 0):void 0},Cm=function(C,U){var I=U.view,r=eq(C),k=U.column||U.property;I.getDataModel().beginTransaction(),U.editor=C,C.info=U,I.setCurrentEditor(C),I.getView().insertBefore(r,I._79O),Hr(C,U.editorRect),C.setFocus?C.setFocus():Nm(C),C.commitValue=function(f,l){C._17Q&&(C=C._17Q),l||I.setValue(U.data,k,C.getValue?C.getValue():C.value),C.close&&C.close(),Wb(r)},k.onEditorCreated&&k.onEditorCreated(U)},Eq=function(C,D,Q,y,e){var _=Gb(C,Q),b=D.value,J=D.view,z=e.getValueType(D.data);return _.onblur=_.onchange=function(){J.endEditing()},"input"===C?(b=e.formatValue(b),b!=I&&(_.value=b),_.onkeydown=function(w){Rr(w)?J.endEditing():Cj(w)&&J.endEditing(!0)},(z===yd||z===Bo)&&_.addEventListener(Cb,h.numberListener,P)):C===yg&&y.forEach(function(V){var t=i.createElement("option");t.innerHTML=e.toEnumLabel(V),t.value=V,e.isEnumEqual(b,V)&&(t.selected=!0),jr(_,t)}),Cm(_,D),_},an=j.widget={},Vd=function(d,$,e){ab(t+".widget."+d,$,e)};Of(Tm,{ms_value:function(z){z.getValue=function(W){var P=this.getItemById(W),d=P.element;return _e(d)?d:d?d.getValue?d.getValue():d.value:P.selected},z.setValue=function(H,I){var r=this.getItemById(H);if(r){var k=r.element;k&&!_e(k)?k.setValue?k.setValue(I):k.value=I:Ro(I)?(r.selected=I,this.iv()):(r.element=I,this.iv())}},z.v=function(G,F){var U=this;if(2===arguments.length)U.setValue(G,F);else{if(!Lg(G))return U.getValue(G);for(var b in G)U.setValue(b,G[b])}return U}},_46o:function(F){F._icon=I,F._accessType=I,F._valueType=I,F._editable=!1,F._batchEditable=!0,F._align=Mn,F._nullable=!0,F._emptiable=!1,F.setParent=Gg,F.formatValue=function(V){var v=this,Y=v._valueType;return v.getEnumValues()?v.toEnumLabel(V):Y===jc?!!V:V!=I&&Y===yd?A(V):V},F.setEnum=function(t,A,v,J,d,V,u){var F=this;t&&!Ck(t)&&t.values&&(J=t.editable,v=t.icons,A=t.labels,d=t.strict,V=t.maxHeight,u=t.dropDownWidth,t=t.values),Am(t)&&(t=t._as),Am(A)&&(A=A._as),Am(v)&&(v=v._as),F._enumValues=t,F._enumLabels=A,F._enumIcons=v,F._enumEditable=J,F._enumStrict=d==I?!0:d,F._enumMaxHeight=V,F._enumDropDownWidth=u,t&&t.length&&df(t[0])&&(F._valueType=Bo),F.fp("enum",!1,!0)},F.getEnumDropDownWidth=function(){return this._enumDropDownWidth},F.getEnumMaxHeight=function(){return this._enumMaxHeight},F.isEnumEditable=function(){return this._enumEditable},F.getEnumValues=function(){return this._enumValues},F.getEnumLabels=function(){return this._enumLabels},F.getEnumIcons=function(){return this._enumIcons},F.isEnumStrict=function(){return this._enumStrict},F.isEnumEqual=function(J,I){return this._enumStrict?J===I:J==I},F.toEnumLabel=function(h,c){var K=this,P=K.getEnumValues(c),A=K.getEnumLabels(c);if(P&&A)for(var v=0;v<P.length;v++)if(K.isEnumEqual(h,P[v]))return A[v];return h},F.toEnumIcon=function(N,$){var U=this,n=U.getEnumValues($),O=U.getEnumIcons($);if(n&&O)for(var B=0;B<n.length;B++)if(U.isEnumEqual(N,n[B]))return O[B];return H}},_45o:function(Y){Y._87o=function(M,a,q,U,l,W){if(M){var v=this,X=v._90I,G=cf(1);v._columnLineVisible&&(l-=1),v._rowLineVisible&&(W-=1),0>=l||0>=W||(v._90I||(X=v._90I={}),X[a]||(X[a]=new fb),Hr(G,v.tx()+q,v.ty()+U,l,W),jr(G,M),v._view.insertBefore(G,v._79O),M.onParentAdded&&M.onParentAdded(G),X[a].add(G))}},Y._76o=function(){var R=this,v=R._90I;if(v){for(var a in v)v[a].each(function(T){Wb(T)});delete R._90I}},Y._77o=function(J){var v=this;if(v._90I){var G=v._90I[J];G&&(G.each(function(R){Wb(R)}),delete v._90I[J])}}},_47o:function(V){V.getValue=function(V,$){return $.getValue?$.getValue(V,$,this):nd(V,$.getAccessType(),$.getName())},V.setValue=function(L,d,z){if(d.isEmptiable(L)||""!==z||(z=H),d.isNullable(L)||z!=I){var s=this,J=d.getName(L),l=d.getAccessType(L),c=d.getValueType(L);c===yd&&_e(z)?z=G(z):c===Bo&&_e(z)?z=parseFloat(z):c===jc&&_e(z)&&(z="true"===z),s._batchEditable&&d._batchEditable&&s.isSelected(L)?s.sm().each(function(x){d.setValue?d.setValue(x,d,z,s):jk(x,l,J,z)}):d.setValue?d.setValue(L,d,z,s):jk(L,l,J,z)}},V.setCurrentEditor=function(K){this.endEditing(),this._currentEditor=K,this.redraw()},V.isEditing=function(x,R){var j=this,p=j._currentEditor;if(!p)return!1;if(R){var D=p.info;return D?(D.column||D.property)===R&&D.data===x:!1}return!0},V.endEditing=function(f){var S=this,B=S._currentEditor;B&&(delete S._currentEditor,B.commitValue&&B.commitValue(B.info,f),S.redraw(),S.getDataModel().endTransaction())},V.beginEditing=function(e){this.endEditing();var J=this,V=e.column||e.property;if(V.beginEditing)V.beginEditing(e);else{var d=e.data,r=e.value,x=J.getSelectBackground(d),f=V.getEnumValues(d),u=V.getSlider(d),o=V.getColorPicker(d);if(u){var q=Re(an.Slider,u);return q.setValue(r),q.getView().onblur=function(){J.endEditing()},q.isInstant()&&(q.onValueChanged=function(){J.setValue(d,V,q.getValue())}),Cm(q,e),void 0}if(o||V.getValueType(d)===sq){var S=Re(an.ColorPicker,o);return S.setValue(r),S.onClosed=function(){J.endEditing()},S.isInstant()&&(S.onValueChanged=function(I,q){J.setValue(d,V,q)}),Cm(S,e),S.open(),void 0}if(f){if(an.ComboBox){var N=new an.ComboBox;N.setValue(r),N.setValues(f),N.setLabels(V.getEnumLabels(d)),N.setIcons(V.getEnumIcons(d)),N.setEditable(V.isEnumEditable(d)),N.setStrict(V.isEnumStrict(d)),N.setMaxHeight(V.getEnumMaxHeight(d)),N.setDropDownWidth(V.getEnumDropDownWidth(d)),N.onClosed=function(){J.endEditing()},Cm(N,e),N.open()}else Eq(yg,e,x,f,V);return}var A=V.getValueType(d);if(A===jc||Ro(r))return J.setValue(d,V,!r),void 0;if(V.getItemEditor(d)){var _=Vf(V.getItemEditor(d)),W=new _(d,V,J,e),B=W.getView();return B._17Q=W,W.setValue(r),zq(B),Cm(B,e),W.editBeginning&&W.editBeginning(),void 0}Eq("input",e,x,I,V)}}},_44o:function(L){L.init=function(i){var N=this,I=N.th=new Gj(i),_=N._view=Di(1,N);N.tv=N._tableView=i,jr(_,I.getView()),jr(_,i.getView()),I.mp(function(X){X.property===lh&&N.iv()}),N.iv()},L.getTableView=function(){return this.tv},L.getTableHeader=function(){return this.th},L.getDataModel=function(){return this.tv.dm()},L.getColumnModel=function(){return this.tv.getColumnModel()},L.setColumns=function(x){this.tv.setColumns(x)},L.addColumns=function(B){this.tv.addColumns(B)},L.endEditing=function(){this.tv.endEditing()},L.validateImpl=function(){var u=this,f=u.th,l=Gc(f),L={x:0,y:0,width:u.getWidth(),height:l};Hr(f,L),L.y=l,L.height=o(0,u.getHeight()-l),Hr(u.tv,L)}},ms_vs:function(H){H._41o=function(){return this._29I.height<this._59I},H._43o=function(){var d=this;d._41o()&&(d._58I||(e(function(){d._94O()},Pi),d.iv()),d._58I=new Date)},H._94O=function(){var h=this;if(h._58I){var t=new Date;t.getTime()-h._58I.getTime()>=Pi?(delete h._58I,h.iv()):e(function(){h._94O()},Pi)}},H._93I=function(){var l=this,q=l._27I;if(l._58I||!l._autoHideScrollBar){q||jr(l._79O,q=l._27I=cf());var M=l._29I,F=M.height,p=l._59I,w=l.getScrollBarSize(),X=M.width-w-2,v=F*(-l.ty()/p),x=F*(F/p),L=q.style;p>F?(Sj>x&&(v=v+x/2-Sj/2,0>v&&(v=0),v+Sj>F&&(v=F-Sj),x=Sj),L.visibility=Qn,L.background=l.getScrollBarColor(),L.borderRadius=w/2+pj,Hr(q,X,v,w,x)):L.visibility=tk}else q&&(q.style.visibility=tk)}},ms_hs:function(V){V._40o=function(){return this._29I.width<this._91I},V._42o=function(){var z=this;z._40o()&&(z._95O||(e(function(){z._94I()},Pi),z.iv()),z._95O=new Date)},V._94I=function(){var q=this;if(q._95O){var m=new Date;m.getTime()-q._95O.getTime()>=Pi?(delete q._95O,q.iv()):e(function(){q._94I()},Pi)}},V._92I=function(){var W=this,h=W._28I;if(W._95O||!W._autoHideScrollBar){h||jr(W._79O,h=W._28I=cf());var d=W._29I,F=d.width,G=W._91I,C=W.getScrollBarSize(),Q=d.height-C-2,g=F*(-W.tx()/G),y=F*(F/G),c=h.style;G>F?(Sj>y&&(g=g+y/2-Sj/2,0>g&&(g=0),g+Sj>F&&(g=F-Sj),y=Sj),c.visibility=Qn,c.background=W.getScrollBarColor(),c.borderRadius=C/2+pj,Hr(h,g,Q,y,C)):c.visibility=tk}else h&&(h.style.visibility=tk)}}}),Jp(Vk,go(16,16,[{type:nn,rect:[1,1,14,14],background:wi},{type:ci,rect:[1,1,14,14],width:1,color:sg},{type:Rc,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),Jp(Dj,go(16,16,{type:ci,rect:[1,1,14,14],width:1,color:sg})),Jp(Dm,go(16,16,[{type:Go,rect:[2,2,12,12],borderWidth:1,borderColor:sg,background:"#FFF"},{type:Go,rect:[4,4,8,8],background:wi}])),Jp(Si,go(16,16,{type:Go,rect:[2,2,12,12],borderWidth:1,borderColor:sg})),Tm._15Q=function(_){_._29I=jq,_._59I=0,_._91I=0,_._5o=function(s){var Z=this;Z._30I=new fb,Z._rows=new fb,Z._rowMap={},Z._31I=0,Z._14I=0,Z._view=Di(1,Z),Z._canvas=Ue(Z._view),jr(Z._view,Z._79O=cf()),Z.dm(s?s:new pd)},_.getCheckIcon=function(C){var f=this.sm(),Y=f.co(C);return f.sg()?qp(Y?Dm:Si):qp(Y?Vk:Dj)},_.checkData=function(A){var e=this.sm(),y=e.co(A);e.sg()&&y||(this._32o=1,y?e.rs(A):e.as(A),delete this._32o)},_.getDataAt=function(S){S.target&&(S=this.lp(S));var s=$(S.y/this._rowHeight),f=this._rows;return 0>s||s>=f.size()?I:f.get(s)},_.onDataDoubleClicked=function(){},_.onDataClicked=function(){},_.adjustTranslateX=function(){return 0},_.adjustTranslateY=function(S){var a=this.getHeight()-this._59I;return a>S&&(S=a),S>0?0:A(S)},_.onPropertyChanged=function(z){var t=this,S=z.property;We[S]?t.ivm():os[S]||t.redraw(),S===dh?t._42o():S===ul&&t._43o()},_.getLabel=function(X){return X.toLabel()},_.getLabelFont=function(){return this._labelFont},_.getLabelColor=function(Y){var I=this;if(I.isCheckMode()){if(I._focusData===Y)return I._labelSelectColor}else if(I.isSelected(Y))return I._labelSelectColor;return I._labelColor},_.getStartRowIndex=function(){return this._31I},_.getEndRowIndex=function(){return this._14I},_.getRowDatas=function(){return this._rows},_.getRowIndex=function(M){return this._rowMap[M._id]},_.getRowSize=function(){return this._rows.size()},_.getViewRect=function(){return oc(this._29I)},_.isVisible=function(y){return this._visibleFunc?this._visibleFunc(y):!0},_.getCurrentSortFunc=function(){return this._sortFunc},_.setDataModel=function(Y){var G=this,I=G._dataModel,$=G._selectionModel;I!==Y&&(I&&(I.umm(G.handleDataModelChange,G),I.umd(G.handleDataPropertyChange,G),I.umh(G.handleHierarchyChange,G),$||I.sm().ums(G.handleSelectionChange,G)),G._dataModel=Y,Y.mm(G.handleDataModelChange,G),Y.md(G.handleDataPropertyChange,G),Y.mh(G.handleHierarchyChange,G),$?$._21I(Y):Y.sm().ms(G.handleSelectionChange,G),G.fp("dataModel",I,Y))},_.validateModel=function(){var W=this;W._rows.clear(),W._rowMap={},W.buildChildren(W._dataModel._roots);var c=W._rows=W._rows.toList(W.isVisible,W),K=0,E=W.getCurrentSortFunc(),O=c.size();for(E&&c.sort(E);O>K;K++)W._rowMap[c.get(K)._id]=K},_.buildChildren=function(O){var X=this;O.each(function(H){X._rows.add(H),X.buildChildren(H._children)})},_.handleDataModelChange=function(){this.ivm()},_.handleDataPropertyChange=function(J){"parent"===J.property?this.ivm():this.invalidateData(J.data)},_.handleHierarchyChange=function(){this.ivm()},_.handleSelectionChange=function(B){B.datas.each(this.invalidateData,this),this.onSelectionChanged(B)},_.onSelectionChanged=function(k){var P=this,a=P.sm();!P.isAutoMakeVisible()||1!==a.size()||"set"!==k.kind&&"append"!==k.kind||P._32o||P.makeVisible(a.ld())},_.handleBackgroundClick=function(k){gc(k)&&!this.isCheckMode()&&this.sm().cs()},_.makeVisible=function(Y){Y&&(this._23I=Y,this.iv())},_.scrollToIndex=function(Z){var z=this,N=z._29I,D=N.height,U=z._rowHeight,u=U*Z;Z>=0&&Z<z._rows.size()&&D>0&&(u+U>N.y+D?z.ty(-u+D-U):u<N.y&&z.ty(-u))},_.autoScroll=function(q,j){var y=this,M=y._rowHeight,X=M,e=M/4,z=y._29I,k=y.lp(q),E={x:y.tx(),y:y.ty()};return M>0&&z&&(k.x-z.x<X?y.translate(e,0):z.x+z.width-k.x<X&&y.translate(-e,0),k.y-z.y<X?y.translate(0,e):z.y+z.height-k.y<X&&y.translate(0,-e)),E.x=y.tx()-E.x,E.y=y.ty()-E.y,j&&(j.x+=E.x,j.y+=E.y),E},_.getTopRowOrderSelection=function(){var m=this.sm().getTopSelection(),s={},h=new fb;return m.each(function(f){s[f._id]=f}),this._rows.each(function(R){s[R._id]&&h.add(R)}),h},_.getRowOrderSelection=function(){var v=new fb;return this._rows.each(function(X){this.isSelected(X)&&v.add(X)},this),v},_.ivm=function(){this.invalidateModel()},_.invalidateModel=function(){var p=this;p._96I||(p._96I=1,p._32I=1,delete p._24I),p.iv()},_.redraw=function(){var i=this;i._32I||(i._32I=1,delete i._24I,i.iv())},_.invalidateData=function(g){var f=this;k?f.redraw():f._32I||(f._24I||(f._24I={}),f._24I[g._id]=g,f.iv())},_.getFocusData=function(){return this._focusData},_.setFocusDataById=function(L){this.setFocusData(this.dm().getDataById(L))},_.setFocusData=function(a){var j=this,K=j._focusData;K!==a&&(j._focusData=a,j.fp("focusData",K,a),K&&j.invalidateData(K),a&&(j.invalidateData(a),j.isAutoMakeVisible()&&j.makeVisible(a)))},_.drawRowBackground=function(T,M,u,O,J,z,d){var c=this,D=c.isCheckMode();(M===c._focusData&&D||u&&!D)&&Yg(T,O,J,z,d,c.getSelectBackground(M))},_.drawData=function(e,C,f){var A=this,P=A._rowHeight,D=P*f,X=A._29I,E=X.x,J=X.width;e.save(),e.beginPath(),e.rect(E,D,J,P),e.clip(),A._87o(A.drawRow(e,C,A.isSelected(C),E,D,J,P),f,E,D,J,P),e.restore(),A._rowLineVisible&&Yg(e,E,D+P-1,J,1,A._rowLineColor)},_._12I=function(G){var p=this,g=p._31I,i=p._29I,E=i.x,Z=i.y,q=i.width,J=i.height;for(G.beginPath(),G.rect(E,Z,q,J),G.clip(),G.clearRect(E,Z,q,J),p._76o(),p._93db(G);g<p._14I;g++)p.drawData(G,p._rows.get(g),g);p._92db(G)},_._13I=function(s){for(var c,i=this,h=i._rowHeight,V=i._29I,r=V.x,X=V.width,Y=i._31I,b=i._30I;Y<i._14I;Y++)c=i._rows.get(Y),i._24I[c._id]&&b.add({data:c,index:Y});b.isEmpty()||(s.beginPath(),b.each(function(i){s.rect(r,i.index*h,X,h)}),s.clip(),b.each(function(o){s.clearRect(r,o.index*h,X,h)}),b.each(function(L){i._77o(L.index)}),i._93db(s),b.each(function(g){i.drawData(s,g.data,g.index)}),i._92db(s),b.clear())},_.preValidateModel=function(){this.endEditing&&this.endEditing()},_.validateImpl=function(){var z=this,f=z._canvas,K=z.getWidth(),k=z.getHeight(),x=z._rowHeight,G=z._32I;(K!==f.clientWidth||k!==f.clientHeight)&&(op(f,K,k),G=1);var n=T&&!F;z._96I&&!n&&(z.preValidateModel(),z.validateModel());var m=z._29I,e={x:-z.tx(),y:-z.ty(),width:K,height:k},U=z._rows.size(),_=Pg(f),X=z._23I;G||ol(e,m)||(G=1),z._29I=e,z._59I=U*x+z.getScrollBarSize(),z._31I=$(e.y/x),z._14I=c((e.y+e.height)/x),z._31I<0&&(z._31I=0),z._14I>U&&(z._14I=U),z._99I&&G&&z._99I(),np(_,z.tx(),z.ty(),1),G?z._12I(_):z._24I&&z._13I(_),z._93I(),z._92I(),_.restore(),z._32I=z._24I=z._96I=I,X&&(z.scrollToIndex(z.getRowIndex(X)),delete z._23I),z.tx(z.tx()),z.ty(z.ty())}},Tm._48o=function(p){p._rootVisible=!0,p._rootData=I,p._35o=function(){this._expandMap={},this._levelMap={}},p.validateModel=function(){var _=this,e=_._rootData;_._rows.clear(),_._levelMap={},_._rowMap={},_._currentLevel=0,e?_._rootVisible?_.isVisible(e)&&_.buildData(e):_.buildChildren(e):_.buildChildren(),delete _._currentLevel},p.buildData=function(b){var Q=this,o=b._id,D=Q._rows;Q._rowMap[o]=D.size(),D.add(b),Q._levelMap[o]=Q._currentLevel,Q.isExpanded(b)&&(Q._currentLevel++,Q.buildChildren(b),Q._currentLevel--)},p.buildChildren=function(k){var Y=this,X=k?k._children:Y._dataModel._roots,p=Y.getCurrentSortFunc();p&&Y.isChildrenSortable(k)?X.toList(Y.isVisible,Y).sort(p).each(Y.buildData,Y):X.each(function(I){Y.isVisible(I)&&Y.buildData(I)})},p.getLevel=function(m){return this._levelMap[m._id]},p.getToggleIcon=function(L){var B=this,H=B._loader,D=B._collapseIcon;return H&&!H.isLoaded(L)?D:L.hasChildren()?B.isExpanded(L)?B._expandIcon:D:I},p.isCheckMode=function(){return this._checkMode!=I},p.isChildrenSortable=function(){return!0},p.handleDataModelChange=function(D){var h=this;D.kind===Rf?delete h._expandMap[D.data._id]:D.kind===Zd&&(h._expandMap={}),h.ivm()},p.toggle=function(U){var E=this;E.isExpanded(U)?E.collapse(U):E.expand(U)},p.isExpanded=function(M){return 1===this._expandMap[M._id]},p.expand=function(U){var t=this,y=t._loader;t.isExpanded(U)||(y&&!y.isLoaded(U)&&y.load(U),t._expandMap[U._id]=1,t.ivm(),t.onExpanded(U))},p.onExpanded=function(){},p.collapse=function(N){var s=this;s.isExpanded(N)&&(delete s._expandMap[N._id],s.ivm(),s.onCollapsed(N))},p.onCollapsed=function(){},p.expandAll=function(Y){if(Y)this.expand(Y),Y.eachChild(function(b){this.expandAll(b)},this);else{var G=this;G._dataModel.each(function(H){H.hasChildren()&&(G._expandMap[H._id]=1)}),G.ivm()}},p.collapseAll=function(){this._expandMap={},this.ivm()},p.makeVisible=function(F){if(F){var g=this;if(!g._rootData||F.isDescendantOf(g._rootData)){for(var G=F._parent;G;)g.expand(G),G=G._parent;g._23I=F,g.iv()}}},p.checkData=function(b){var e,M=this,z=M._checkMode,t=M.sm(),w=t.co(b);if(!t.sg()||!w){if(M._32o=1,z===Ci)w?t.rs(b):t.as(b);else if(z===ff)e=new fb(b),e.addAll(b._children);else if("descendant"===z)e=new fb,um(b,e);else if("all"===z&&(e=new fb,um(b,e),!w))for(var h=b._parent;h;)e.add(h),h=h._parent;e&&(w?t.rs(e):t.as(e)),delete M._32o}},p._97I=function(n,L,M,S,t,h,A){var O=this,s=O._indent,I=O._levelMap[L._id],Q=O.getIconWidth(L),d=qp(O.getToggleIcon(L));d?(S+=s*I,ll(n,d,S+s/2,t+A/2,L,O),S+=s):S+=s*(I+1),O._checkMode&&(ll(n,O.getCheckIcon(L),S+s/2,t+A/2,L,O),S+=s),O.drawIcon(n,L,S,t,Q,A),O.drawLabel(n,L,S+Q,t,A)}},Tm._14Q=function(w){w.getIcon=function(r){return r.getIcon()},w.getIconWidth=function(X){return this.getIcon(X)?this._indent:0},w.drawIcon=function(d,e,V,x,E,R){if(E){var f=this,X=f.getBodyColor(e),r=qp(f.getIcon(e),X);r&&(R-=f.isRowLineVisible()?1:0,mg(d,r,Jc,V,x,E,R,e,f,X),Wr(d,f.getBorderColor(e),V,x,E,R))}},w.drawLabel=function(r,q,G,z,$){var R=this;zj(r,R.getLabel(q),R.getLabelFont(q),R.getLabelColor(q),G,z,0,$)}},Tm._50o=function(r){r._98I=function(){var A=this,K=A._39o=new pd;A._60I=new fb,K.mm(A._17o,A),K.md(A._18o,A),K.mh(A._19o,A)},r.setColumns=function(Q){this._39o.clear(),this.addColumns(Q)},r.addColumns=function(B){var L=this._39o;B.forEach(function(I){if(!(I instanceof af)){var y=Vf(I.className);I=Re(y?y:af,I)}L.add(I)})},r.onColumnClicked=function(){},r.onCheckColumnClicked=function(){},r._3Q=function(o){for(var X,F=0,$=this._60I,A=$.size();A>F;F++)if(X=$.get(F),X.column===o)return X;return I},r.getColumnAt=function(n){var O=this._4Q(n);return O?O.column:I},r._4Q=function(t){for(var k=this,B=t.target?k.lp(t).x:t.x,n=k._60I,D=0;D<n.size();D++){var u=n.get(D),l=u.startX;if(B>=l&&B<l+u.column.getWidth())return u}return I},r.getToolTip=function(R){var q=this,b=q.getDataAt(R),Q=q.getColumnAt(R);return b&&Q?Q.getToolTip(b,q):I},r.adjustTranslateX=function($){var G=this.getWidth()-this._91I;return G>$&&($=G),$>0?0:A($)},r._99I=function(){var A=this,y=A._29I,R=A._60I;R.clear(),A._91I=0,A._39o._roots.each(function(k){if(k.isVisible()){var P=A._91I+k.getWidth();A._91I<=y.x+y.width&&P>=y.x&&R.add({column:k,startX:A._91I}),A._91I=P}}),A._91I+=A.getScrollBarSize()},r.drawData=function(z,L,x){var b=this,v=b._rowHeight,t=v*x,h=b.isSelected(L),Z=b._29I,_=Z.x,U=Z.width;b.drawRowBackground(z,L,h,_,t,U,v),b._60I.each(function(o){var O=o.column,c=o.startX,Y=O.getWidth();Y>0&&!b.isEditing(L,O)&&(z.save(),z.beginPath(),z.rect(c,t,Y,v),z.clip(),b._87o(b.drawCell(z,L,h,O,c,t,Y,v),x,c,t,Y,v),b._columnLineVisible&&Yg(z,c+Y-1,t,1,v,b._columnLineColor),z.restore())}),b._rowLineVisible&&Yg(z,_,t+v-1,U,1,b._rowLineColor)},r.drawCell=function(b,W,h,J,I,G,C,c){var m=this;if(J.drawCell)return J.drawCell(b,W,h,J,I,G,C,c,m);var g=m.getValue(W,J);Tf(b,g,J,m.getLabelFont(W,J,g),m.getLabelColor(W,J,g),I,G,C,c,W,m)},r.getColumnModel=function(){return this._39o},r._17o=function(){this.redraw()},r._18o=function(Y){var $=this;Y.data===$._sortColumn&&Vm[Y.property]?$.ivm():($._42o(),$.redraw())},r._19o=function(){this.redraw()},r.getCurrentSortFunc=function(){var l=this,D=l._sortColumn;if(D&&D.isSortable()){var k=D.getSortFunc(),F=Gh===D.getSortOrder()?1:-1;return k||(k=xl),function(j,E){return k.call(l,l.getValue(j,D),l.getValue(E,D),j,E)*F}}return l._sortFunc},r.isCellEditable=function(c,p,G){return p.isEditable()&&this.isEditable()?p.isCellEditable?p.isCellEditable(c,p,G,this):!0:!1},r._37O=function(C,E){if(gc(E))for(var n=this,R=n.lp(E),k=n._60I,A=n._rowHeight,Q=n._29I,r=Q.x,d=Q.y,p=Q.width,Z=Q.height,U=0;U<k.size();U++){var K=k.get(U),v=K.startX,y=K.column,V=y.getWidth();if(y!==n._31o&&y!==n._4o&&R.x>=v&&R.x<v+V&&n.isCellEditable(C,y,E)){var G={x:v,y:n.getRowIndex(C)*A,width:V,height:A},b={x:G.x+n.tx(),y:G.y+n.ty(),width:G.width,height:G.height},m=0,a=0;return G.x<r?m=G.x-r:G.x+G.width>r+p&&(m=G.x+G.width-r-p),m&&(n.tx(n.tx()-m),b.x-=m),G.y<d?a=G.y-d:G.y+A>d+Z&&(a=G.y+A-d-Z),a&&(n.ty(n.ty()-a),b.y-=a),n.beginEditing({data:C,column:y,value:n.getValue(C,y),event:E,rect:G,editorRect:b,view:n}),void 0}}}},an.BaseItemEditor=function(y,V,i,C){this._data=y,this._column=V,this._master=i,this._editInfo=C},Vd("BaseItemEditor",C,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var $p=j.Tab=function(){zp($p,this)};yp("Tab",Uk,{ms_ac:["view","closable","disabled"],_icon:I,_closable:!1,_disabled:!1,setParent:Gg});var af=j.Column=function(){zp(af,this)};yp("Column",Uk,{_46o:1,ms_ac:["accessType","valueType",Qn,hm,hh,cq,"align",sq,"sortOrder",qe,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:Gh,_sortFunc:I,_sortable:!0,_clickable:!0,setWidth:function(k){16>k&&(k=16);var j=this._width;this._width=k,this.fp(cq,j,k)},getToolTip:function(L,x){return this.formatValue(x.getValue(L,this))}});var Fp=j.Property=function(){zp(Fp,this)};yp("Property",Uk,{_46o:1,ms_ac:["accessType","valueType",hm,hh,"categoryName",sq,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:I,getToolTip:function(u,l,x){var K=this;return l?K.formatValue(x.getValue(u,K)):x.getPropertyName(K)}}),an.AccordionView=function(){var C=this;C._20o={},C._21o=new fb,C._10o=I,C._9o=I,C._11o=I,C._view=Di(0,C),C.iv()},Vd("AccordionView",C,{ms_v:1,ms_fire:1,ms_ac:[Sl,on,"titleHeight",Kp,Wo,"titleBackground","selectWidth",lp,"orientation","separatorColor"],_expandIcon:h.accordionViewExpandIcon,_collapseIcon:h.accordionViewCollapseIcon,_titleHeight:Zf,_labelColor:h.accordionViewLabelColor,_labelFont:h.accordionViewLabelFont,_titleBackground:h.accordionViewTitleBackground,_selectBackground:h.accordionViewSelectBackground,_selectWidth:h.accordionViewSelectWidth,_orientation:"v",_separatorColor:h.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(Z,J,d,V){var y=this,R=cf();if(y._20o[Z])throw Z+" already exists";R.onmousedown=Oi,R.style.cursor=Yb,R.addEventListener(hd?km:gk,function(s){Oi(s)},P),R.addEventListener(hd?Fq:$f,function(q){Oi(q),gc(q)&&(y._10o===Z?y.collapse():y.expand(Z))},P),jr(y._view,R),y._20o[Z]={content:J,div:R,canvas:Ue(R),icon:V},y._21o.add(Z),d&&y.expand(Z),y.iv()},remove:function(I){var i=this,g=i._20o[I];g&&(Wb(g.div),delete i._20o[I],i._21o.remove(I),i.iv())},clear:function(){var A=this;A._21o.toArray().forEach(A.remove,A),A._20o={},A._21o.clear(),A.iv()},isExpanded:function(Q){return this._10o===Q},expand:function(E){var k=this;k._20o[E]&&k._10o!==E&&(k._10o=E,k.onExpanded(E),k.iv())},onExpanded:function(){},collapse:function(){var S=this;S._10o&&(S.onCollapsed(S._10o),delete S._10o,S.iv())},onCollapsed:function(){},initCanvas:function(d,T,r){op(d,T,r);var n=Pg(d);return np(n,0,0,1),n.clearRect(0,0,T,r),n},drawTitle:function(Z,p,$,q,H){var P=this,s=qp(H.icon),V=P.isExpanded(p),n=P._titleHeight,a=P._titleBackground,B=P._selectWidth,E=P._separatorColor,l=qp(V?P._expandIcon:P._collapseIcon),X=B+4;Yg(Z,0,0,$,q,a),V&&B&&Yg(Z,0,0,B,q,P._selectBackground),(V||P._21o.get(P._21o.size()-1)!==p)&&Yg(Z,0,q-1,$,1,E?E:$i(a)),s&&(ll(Z,s,X+uf(s)/2,n/2),X+=uf(s)+2),zj(Z,p,P.getLabelFont(p),P.getLabelColor(p),X,0,0,n),l&&ll(Z,l,$-uf(l)/2-4,n/2)},validateImpl:function(){var F=this,P=F._view,g=0,V=0,p=F.getWidth(),E=F.getHeight(),W=F._titleHeight,G=F._21o.size()*W,J=F._11o,$=F._9o;delete F._11o,delete F._9o,F._21o.each(function(U){var Y,R,a=F._20o[U],N=a.content,K=F._10o===U;pg(F)?(Hr(a.div,g,0,W,E),Y=F.initCanvas(a.canvas,W,E),Kh(Y,0,E),Bh(Y,-S),F.drawTitle(Y,U,E,W,a),Y.restore(),K?(R=o(0,p-G),N&&(F._11o=N,F._9o=eq(N),Hr(N,g+W,0,R,E)),g+=W+R):g+=W):(Hr(a.div,0,V,p,W),Y=F.initCanvas(a.canvas,p,W),F.drawTitle(Y,U,p,W,a),Y.restore(),K?(R=o(0,E-G),N&&(F._11o=N,F._9o=eq(N),Hr(N,0,V+W,p,R)),V+=W+R):V+=W)});var N=F._9o;J&&J!==F._11o&&J.endEditing&&J.endEditing(),N&&N!==$&&jr(P,N),$&&$!==N&&Wb($)}}),an.SplitView=function(f,H,h,w){var F=this,M=F._dividerDiv=cf(),Y=F._60O=Ue(),P=F._61O=Ue(),Z=Y.style,s=P.style;F._view=Di(1,F),jr(F._view,M),Z.msTouchAction=Sm,Z.pointerEvents=Sm,Z.cursor=Yb,s.msTouchAction=Sm,s.pointerEvents=Sm,s.cursor=Yb,f&&F.setLeftView(f),H&&F.setRightView(H),h&&F.setOrientation(h),w!=I&&F.setPosition(w),F.setStatus(Qg),new bk(F)},Vd("SplitView",C,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:h.splitViewDividerSize,_dividerBackground:h.splitViewDividerBackground,_dragOpacity:h.splitViewDragOpacity,_toggleIcon:h.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(J,c){var k=this,s=k._position;isNaN(J)||(c||(k._82O=0>J?-1:J>1?1:0),k._position=J,k.fp(Sf,s,J))},getLeftView:function(){return this._leftView},setLeftView:function(S){var y=this,K=y._leftView,M=y._view;if(y._leftView!==S){if(K&&K!==y._rightView){var Z=eq(K);Z.parentNode===M&&Wb(Z)}if(y._leftView=S,S){var v=eq(S);v.parentNode!==M&&M.insertBefore(v,y._dividerDiv)}y.fp("leftView",K,S)}},getRightView:function(){return this._rightView},setRightView:function(E){var K=this,W=K._rightView,T=K._view;if(K._rightView!==E){if(W&&W!==K._leftView){var J=eq(W);J.parentNode===T&&Wb(J)}if(K._rightView=E,E){var N=eq(E);N.parentNode!==T&&T.insertBefore(N,K._dividerDiv)}K.fp("rightView",W,E)}},validateImpl:function(){var d=this,I=d._draggable,n=d._position,H=d.getWidth(),P=d.getHeight(),b=d._dividerSize,Y=d._dividerBackground,F=hd?18:8,K=d._dividerDiv,w=d._82O,c=d._60O,G=d._61O,D=d._toggleIcon,q=d._status,j=K.style,h=null,C=hd?20:4,m=D.comps[0];b>=F||0===b?d._coverDiv&&(Wb(d._coverDiv),delete d._coverDiv):d._coverDiv||(d._coverDiv=cf(),E&&(d._coverDiv.style.background=Vl),jr(K,d._coverDiv)),d._togglable?c.parentNode||(jr(K,c),jr(K,G)):(Wb(c),Wb(G));var R=d._coverDiv,V=d._leftView,z=d._rightView;if(pg(d)){if(b>H&&(b=H),q===Qg)if(1===w)var v=N(n,H),i=o(0,H-b-v);else-1===w?(i=N(-n,H),v=o(0,H-b-i)):(v=A((H-b)*n),i=o(0,H-b-v));else"cl"===q?(v=0,i=o(0,H-b)):"cr"===q&&(i=0,v=o(0,H-b));V&&Hr(V,0,0,v,P),z&&Hr(z,v+b,0,i,P),Hr(K,v,0,b,P),d._22o=v,R&&(Hr(R,b/2-F/2,0,F,P),R.style.cursor=I?rm:""),K.style.cursor=I?rm:"";var X=K.clientHeight/2,O=K.clientWidth;op(c,O,O),Hr(c,0,X-O-C,O,O),h=Pg(c),np(h,0,0,1),m.rotation=-S,_i(h,D,0,0,O,O),h.restore(),op(G,O,O),Hr(G,0,X+C,O,O),h=Pg(G),np(h,0,0,1),m.rotation=S,_i(h,D,0,0,O,O),h.restore()}else{if(b>P&&(b=P),q===Qg)if(1===w)var M=N(n,P),k=o(0,P-b-M);else-1===w?(k=N(-n,P),M=o(0,P-b-k)):(M=A((P-b)*n),k=o(0,P-b-M));else"cl"===q?(M=0,k=o(0,P-b)):"cr"===q&&(k=0,M=o(0,P-b));V&&Hr(V,0,0,H,M),z&&Hr(z,0,M+b,H,k),Hr(K,0,M,H,b),d._22o=M,R&&(Hr(R,0,b/2-F/2,H,F),R.style.cursor=I?Kl:""),j.cursor=I?Kl:"";var T=K.clientWidth/2,O=K.clientHeight;op(c,O,O),Hr(c,T-O-C,0,O,O),h=Pg(c),np(h,0,0,1),m.rotation=0,_i(h,D,0,0,O,O),h.restore(),op(G,O,O),Hr(G,T+C,0,O,O),h=Pg(G),np(h,0,0,1),m.rotation=g,_i(h,D,0,0,O,O),h.restore()}j.background=Y}});var bk=function(W){this.sv=W,this.addListeners()};ab(bk,C,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(A){var S=this,$=S.sv,d=$._dividerDiv,k=$._60O,x=$._61O,V=$._status,J=A.target;if(J===k)V===Qg?$.setStatus("cl"):"cr"===V&&$.setStatus(Qg);else if(J===x)V===Qg?$.setStatus("cr"):"cl"===V&&$.setStatus(Qg);else if(Pe(A)&&(J===d||J===$._coverDiv)&&(Oi(A),$.isDraggable())){$.getLeftView(),$.getRightView();var u=S.maskDiv=cf();if(u.style.left=0,u.style.top=0,u.style.width=$.getWidth()+"px",u.style.height=$.getHeight()+"px",$.getView().appendChild(u),!$.isContinuousLayout()){var v=S.resizeDiv=cf();v.style.left=d.style.left,v.style.top=d.style.top,v.style.width=d.style.width,v.style.height=d.style.height,v.style.opacity=$.getDragOpacity(),v.style.background=$.getDividerBackground(),jr(S.getView(),v)}S._lastAbsPosition=$._22o,S._86o=pg($)?fm(A).x:fm(A).y,Ti(S,A)}},handleWindowTouchMove:function(K){Pe(K)&&this.update(K,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(Z){var O=this;O.update(Z,!0),O.sv.setStatus(Qg),O.maskDiv&&Wb(O.maskDiv),O.resizeDiv&&Wb(O.resizeDiv),O.maskDiv=O.resizeDiv=I},handle_mousedown:function(I){gc(I)&&this.handle_touchstart(I)},handleWindowMouseMove:function(y){this.handleWindowTouchMove(y)},handleWindowMouseUp:function(W){this.handleWindowTouchEnd(W)},update:function($,q){var a=this,D=a.sv,I=pg(D)?D.getWidth():D.getHeight(),s=D._dividerSize,j=a._lastAbsPosition-a._86o;pg(D)?(j+=fm($).x,j>I-s&&(j=I-s),0>j&&(j=0),a.resizeDiv&&(a.resizeDiv.style.left=j+pj)):(j+=fm($).y,j>I-s&&(j=I-s),0>j&&(j=0),a.resizeDiv&&(a.resizeDiv.style.top=j+pj)),q&&I!==s&&(1===D._82O?D.setPosition(j,1):-1===D._82O?D.setPosition(j-I+s,1):D.setPosition(j/(I-s),1))}}),an.TabView=function(){var V=this,W=V._view=Di(1,V),r=V._91O=cf(1),D=V._tabModel=new pd,S=D.sm(),Y=V.invalidate;V._7o=new fb,V._canvas=Ue(r),jr(W,r),jr(W,V._92O=cf(1)),S.setSelectionMode(Oc),S.ms(V.handleSelectionChange,V),D.mm(Y,V),D.md(Y,V),D.mh(Y,V),V._interactor=new mm(V),V.iv()},Vd("TabView",C,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Kp,Wo,"tabBackground","selectWidth",lp,"moveBackground","insertColor"],_tabPosition:yo,_tabHeight:Zf,_tabGap:h.tabViewTabGap,_labelColor:h.tabViewLabelColor,_labelFont:h.tabViewLabelFont,_tabBackground:h.tabViewTabBackground,_selectWidth:h.tabViewSelectWidth,_selectBackground:h.tabViewSelectBackground,_moveBackground:h.tabViewMoveBackground,_insertColor:h.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(p,C,t){var G,W=this._tabModel;return p instanceof $p?(G=p,C&&G.setView(C)):(G=new $p,G.setName(p),G.setView(C)),W.add(G),t&&W.sm().ss(G),G},getLabel:function(k){return k.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(m){this._23o=m,this.iv()},get:function(c){var $=this,A=$._tabModel;if(df(c))return A._roots.get(c);if(_e(c)){var _;return A.each(function(k){c===$.getLabel(k)&&(_=k)}),_}return c instanceof $p?c:I},select:function(n){this._tabModel.sm().ss(this.get(n))},remove:function(R){var x=this;if(R=x.get(R)){var V=x._tabModel,O=V._roots.indexOf(R);x._tabModel.remove(R),x.selectByIndex(--O)}},getCurrentTab:function(){return this._8o},hideTabView:function(O,E){E.parentNode===this._92O&&(Fb(E)?(E.style.display=ls,E._tab_=O):Wb(E),Kg())},showTabView:function(s,n){Fb(n)&&(n.style.display="block",n._tab_=s),n.parentNode!==this._92O&&(jr(this._92O,n),Kg())},_24o:function(){var E,c=this,G=c._8o,H=c._9o,i=c._tabModel.sm().ld();i&&(E=eq(i.getView())),E!==H&&(H&&(G.getView()&&G.getView().endEditing&&G.getView().endEditing(),c.hideTabView(G,H)),E&&c.showTabView(i,E)),c._8o=i,c._9o=E,G!==i&&c.onTabChanged(G,i)
},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(V,q){this.selectByIndex(--q)},selectByIndex:function(u){var y=this,j=y._tabModel,W=j.size();if(W&&!j.sm().ld()){u==I&&(u=0),u>=W&&(u=W-1),0>u&&(u=0);for(var O=u;O>=0;O--){var Z=y.get(O);if(!Z.isDisabled())return y.select(Z),Z}for(O=u+1;W>O;O++)if(Z=y.get(O),!Z.isDisabled())return y.select(Z),Z}},getTabWidth:function(E){var k=4,N=qp(E.getIcon());N&&(k+=uf(N,E)+4);var F=this.getLabel(E);return F&&(k+=es(this.getLabelFont(E),F).width+4),E.isClosable()&&(k+=10),k},drawTab:function(u,C,M,e,B,l,J){var F,j=this,N=j._tabPosition,G=M+4,$=j._selectWidth,Y=qp(C.getIcon()),A=C.isDisabled(),o=j.getLabelColor(C),k=j.getLabelFont(C),b=j.getLabel(C),z=j._selectBackground,f=N===Mn+"-vertical",t=N===rj+"-vertical";(f||t)&&(G=e+4),A&&(u.globalAlpha=qf),Yg(u,M,e,B,l,J),C===j._8o&&$&&(N===yo?Yg(u,M,e+l-$,B,$,z):N===Mn?Yg(u,M+B-$,e,$,l,z):N===rj?Yg(u,M,e,$,l,z):f?Yg(u,M+B-$,e,$,l,z):t?Yg(u,M,e,$,l,z):Yg(u,M,e,B,$,z));var W=B/2;if(f&&(Kh(u,W,e+l/2),Bh(u,g),Kh(u,-W,-e-l/2)),Y){var s=Xd(Y,C),Q=uf(Y,C);if(f||t){var i=M+B/2,q=G+s/2;Kh(u,i,q),Bh(u,S),Kh(u,-i,-q),ll(u,Y,M+B/2,G+s/2,C,j),Kh(u,i,q),Bh(u,-S),Kh(u,-i,-q),G+=s+4}else ll(u,Y,G+Q/2,e+l/2,C,j),G+=Q+4}return f||t?(Kh(u,B/2,G+B/2),Bh(u,S),Kh(u,-B/2,-G-B/2),zj(u,b,k,o,M,G,l,B),Kh(u,B/2,G+B/2),Bh(u,-S),Kh(u,-B/2,-G-B/2)):zj(u,b,k,o,G,e,B,l),f&&(Kh(u,W,e+l/2),Bh(u,-g),Kh(u,-W,-e-l/2)),C.isClosable()&&(F=t?{x:M+B-12,y:e+l-12,width:12,height:12}:{x:M+B-12,y:e+2,width:12,height:12},this.drawCloseIcon(C,u,o,F)),A&&(u.globalAlpha=1),F},drawCloseIcon:function(W,D,L,S){var f=S.x,G=S.y;D.strokeStyle=L,D.lineWidth=1,D.beginPath(),D.moveTo(f+2,G+8),D.lineTo(f+8,G+2),D.moveTo(f+8,G+8),D.lineTo(f+2,G+2),D.stroke()},getTabAt:function(F){var Z=this._interactor._8Q(F);return Z?Z.tab:null},validateImpl:function(){var M=this;M._24o();var y,W=M._canvas,j=M._tabPosition,D=M._91O,k=M._92O,n=M._tabModel,B=M.getWidth(),w=M.getHeight(),K=M._tabHeight,i=M._7o,q=M._tabGap,X=j===yo,I=j===Mn,h=j===rj,A=j===Mn+"-vertical",H=j===rj+"-vertical",E=M._23o,L=0;if((I||h)&&n._roots.each(function(J){L=o(M.getTabWidth(J),L)}),X?(Hr(D,0,0,B,K),y={x:0,y:K,width:B,height:o(0,w-K)}):I?(Hr(D,0,0,L,w),y={x:L,y:0,width:o(0,B-L),height:w}):h?(Hr(D,B-L,0,L,w),y={x:0,y:0,width:o(0,B-L),height:w}):A?(Hr(D,0,0,K,w),y={x:K,y:0,width:o(0,B-K),height:w}):H?(Hr(D,B-K,0,K,w),y={x:0,y:0,width:o(0,B-K),height:w}):(Hr(D,0,w-K,B,K),y={x:0,y:0,width:B,height:o(0,w-K)}),Hr(k,y),A||H){M._9o&&(y.x=0,Hr(M._8o.getView(),y)),op(W,K,w);var m=Pg(W),e=0;if(np(m,0,M.ty(),1),m.clearRect(0,0,K,w),i.clear(),n._roots.each(function(h){var o,C=M.getTabWidth(h);E&&E.tab===h||(o=M.drawTab(m,h,0,e,K,C,M._tabBackground)),i.add({_75o:o,tab:h,startY:e,endY:e+C,height:C}),e+=C+q}),M._23Q=o(0,e-q),E){var z=E.position;M.drawTab(m,E.tab,0,E.startY,K,E.height,M._moveBackground),Yg(m,0,z,K,1,M._insertColor)}if(m.restore(),M._selectionChanged){M._selectionChanged=!1;for(var c=M.ty(),d=0;d<i.size();d++){var C=i.get(d);if(C.tab===M._8o){if(C.endY+c<0){M.ty(-C.startY);break}if(C.startY+c>w){M.ty(w-C.endY);break}}}}M.ty(M.ty())}else if(I||h){M._9o&&(y.x=0,Hr(M._8o.getView(),y)),op(W,L,w);var m=Pg(W),e=0;if(np(m,0,M.ty(),1),m.clearRect(0,0,L,w),i.clear(),n._roots.each(function(p){var d;E&&E.tab===p||(d=M.drawTab(m,p,0,e,L,K,M._tabBackground)),i.add({_75o:d,tab:p,startY:e,endY:e+K,height:K}),e+=K+q}),M._23Q=o(0,e-q),E){var z=E.position;M.drawTab(m,E.tab,0,E.startY,L,E.height,M._moveBackground),Yg(m,0,z,L,1,M._insertColor)}if(m.restore(),M._selectionChanged){M._selectionChanged=!1;for(var c=M.ty(),d=0;d<i.size();d++){var C=i.get(d);if(C.tab===M._8o){if(C.endY+c<0){M.ty(-C.startY);break}if(C.startY+c>w){M.ty(w-C.endY);break}}}}M.ty(M.ty())}else{M._9o&&(y.y=0,Hr(M._8o.getView(),y)),op(W,B,K);var m=Pg(W),x=0;if(np(m,M.tx(),0,1),m.clearRect(0,0,B,K),i.clear(),n._roots.each(function(z){var U,L=M.getTabWidth(z);E&&E.tab===z||(U=M.drawTab(m,z,x,0,L,K,M._tabBackground)),i.add({_75o:U,tab:z,startX:x,endX:x+L,width:L}),x+=L+q}),M._64I=o(0,x-q),E){var z=E.position;M.drawTab(m,E.tab,E.startX,0,E.width,K,M._moveBackground),Zb(m,M._insertColor,z,0,K)}if(m.restore(),M._selectionChanged){M._selectionChanged=!1;for(var s=M.tx(),d=0;d<i.size();d++){var C=i.get(d);if(C.tab===M._8o){if(C.endX+s<0){M.tx(-C.startX);break}if(C.startX+s>B){M.tx(B-C.endX);break}}}}M.tx(M.tx())}for(var g=[],G=k.children,d=0;d<G.length;d++){var N=G[d],l=N._tab_;l&&!n.contains(l)&&g.push(N)}g.forEach(function(v){k.removeChild(v)})}});var mm=function(c){this.tv=c,this.addListeners()};ab(mm,C,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(j){this.handleScroll(j,10*(j.wheelDelta/40))},handle_DOMMouseScroll:function(y){this.handleScroll(y,10*-y.detail)},handleScroll:function(O,g){Oi(O);var W=this.tv,H=W._tabPosition;!W._40o()||H!==yo&&H!==Fl||W.tx(this.tv.tx()+g),!W._41o()||H!==Mn&&H!==rj&&H!==Mn+"-vertical"&&H!==rj+"-vertical"||W.ty(this.tv.ty()+g)},_8Q:function(L){var c,n,F=this.tv,t=F._tabPosition,X=F._7o;if(t===yo||t===Fl){var W=F.lp(L).x;for(c=0;c<X.size();c++)if(n=X.get(c),n.startX<=W&&W<=n.endX)return n}else if(t===Mn||t===rj||t===Mn+"-vertical"||t===rj+"-vertical"){var K=F.lp(L).y;for(c=0;c<X.size();c++)if(n=X.get(c),n.startY<=K&&K<=n.endY)return n}return I},isClickable:function(X){var z=this.tv,B=z._tabPosition,O=this._73o=this._8Q(X);return!z._40o()||B!==yo&&B!==Fl?!z._41o()||B!==Mn&&B!==rj&&B!==Mn+"-vertical"&&B!==rj+"-vertical"?O&&(!O.tab.isDisabled()||z.isMovable()):!0:!0},handle_mousemove:function(X){var f=this;Rm?f._74o=f._8Q(X):f.getView().style.cursor=f.isClickable(X)?Yb:""},handle_mousedown:function(d){this.handle_mousemove(d),this.handle_touchstart(d)},handle_touchstart:function(h){var Y=this,O=Y.tv,i=O._tabPosition;Oi(h),gc(h)&&Y.isClickable(h)&&(i===yo||i===Fl?(Y.x=fm(h).x,Y.lp=O.lp(h),Y.tx=O.tx()):(Y.y=fm(h).y,Y.lp=O.lp(h),Y.ty=O.ty()),Ti(Y,h))},handleWindowMouseMove:function(s){this.handleWindowTouchMove(s)},handleWindowTouchMove:function(b){var w,F=this,f=F.tv,i=f._tabPosition,I=F._73o;if(i===yo||i===Fl){if(w=fm(b).x-F.x,!F._25o&&!F.moving&&J(w)>2&&(f._40o()&&!aq(b)?F._25o=1:I&&f.isMovable()&&(F.moving=1)),F._25o)f.tx(F.tx+w);else if(F.moving){var O=F.lp.x+w,s=f._tabGap/2;f._7o.each(function(R){var D=R.endX,A=O-R.startX<D-O;O>=R.startX&&D>=O&&f._7Q({tab:I.tab,startX:I.startX+w,width:I.width,front:A,insertTab:R.tab,position:A?o(0,R.startX-s):N(f._64I,D+s)})})}}else if(w=fm(b).y-F.y,!F._25o&&!F.moving&&J(w)>2&&(f._41o()&&!aq(b)?F._25o=1:I&&f.isMovable()&&(F.moving=1)),F._25o)f.ty(F.ty+w);else if(F.moving){var d=F.lp.y+w,s=f._tabGap/2;f._7o.each(function(L){var C=L.endY,O=d-L.startY<C-d;d>=L.startY&&C>=d&&f._7Q({tab:I.tab,startY:I.startY+w,height:I.height,front:O,insertTab:L.tab,position:O?o(0,L.startY-s):N(f._23Q,C+s)})})}},handleWindowMouseUp:function(A){this.handleWindowTouchEnd(A)},handleWindowTouchEnd:function(){var k=this,E=k.tv,W=E._tabPosition,j=E.getTabModel(),d=j._roots,m=k._73o;if(k.moving){var g=E._23o;if(g&&g.insertTab!==g.tab){var s=g.tab,n=d.remove(s),o=d.indexOf(g.insertTab);o>=0&&(g.front||o++,o<=d.size()&&(d.add(s,o),j._38I(s,n,o)))}E._7Q(I),delete k.moving}else if(!k._25o&&m){s=m.tab;var X=k._74o;if(!X||X.tab===s)if(!s.isDisabled()&&ps(m._75o,k.lp)){var h=function(){var r=d.indexOf(s);j.remove(s),E.onTabClosed(s,r)};E.onTabClosing(s,h)&&h()}else s.isDisabled()||E._8o===s||j.sm().ss(s)}k._25o=k._73o=k._74o=W===yo||W===Fl?k.x=k.lp=k.tx=I:k.y=k.lp=k.ty=I}}),an.PropertyView=function(y){var p=this;p._view=Di(1,p),p._canvas=Ue(p._view),jr(p._view,p._79O=cf()),p._rows=new fb,p._28o=new fb,p._26o={},p._26Q={};var x=p._propertyModel=new pd,J=p.ivm;x.mm(J,p),x.md(J,p),x.mh(J,p),p.dm(y?y:new pd),new kp(p)},Vd("PropertyView",C,{ms_ac:[Kp,Ek,Wo,hm,hh,"categorizable",te,qe,Dr,Sl,on,Ji,Er,Qo,"selectRowIndex",lp,"background",Ud,Tl,nj,lf,Zj],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:jq,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:Qk,_background:h.propertyViewBackground,_expandIcon:h.propertyViewExpandIcon,_collapseIcon:h.propertyViewCollapseIcon,_scrollBarColor:jj,_scrollBarSize:Gl,_autoHideScrollBar:Ec,_selectBackground:h.propertyViewSelectBackground,_rowHeight:br,_rowLineVisible:h.propertyViewRowLineVisible,_rowLineColor:h.propertyViewRowLineColor,_10I:.5,_columnLineVisible:h.propertyViewColumnLineVisible,_columnLineColor:h.propertyViewColumnLineColor,_labelColor:h.propertyViewLabelColor,_labelSelectColor:h.propertyViewLabelSelectColor,_labelFont:h.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(K){0>K&&(K=0),K>1&&(K=1);var P=this,q=P._10I;P._10I=K,P.fp("columnPosition",q,K)},getPropertyName:function(T){return T.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(Z,J,b){return b===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(r,F){return F===this._selectRowIndex?this._labelSelectColor:r.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(o){var m=this.getHeight()-this._59I;return m>o&&(o=m),o>0?0:A(o)},isExpanded:function(Q){if(!Q)return!0;var y=this._26o[Q];return y?y.isExpanded:!(this._26Q[Q]===!1)},toggle:function(w){var h=this;h.isExpanded(w)?h.collapse(w):h.expand(w)},expandAll:function(){this.validate();for(var q in this._26o)this.expand(q)},expand:function(E){if(E&&E!==ls){var d=this,H=d._26o[E];H&&!H.isExpanded&&(H.isExpanded=!0,d.onExpanded(E),d.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var o in this._26o)this.collapse(o)},collapse:function(Y){if(Y&&Y!==ls){var B=this,C=B._26o[Y];C&&C.isExpanded&&(C.isExpanded=!1,B.onCollapsed(Y),B.ivm())}},onCollapsed:function(){},getCategoryName:function(T){if(!this.isCategorizable())return ls;var X=T.getCategoryName();return X?X:ls},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(_){var $=this,r=$._dataModel;r!==_&&(r&&(r.umd($.handlePropertyChange,$),$._selectionModel||r.sm().ums($.handleSelectionChange,$)),$._dataModel=_,_.md($.handlePropertyChange,$),$._selectionModel?$._selectionModel._21I(_):_.sm().ms($.handleSelectionChange,$),$.fp(ik,r,_))},isVisible:function(e){return this._visibleFunc?this._visibleFunc(e):!0},onPropertyChanged:function(p){var t=this,P=p.property;Me[P]?t.ivm():t.iv(),P===ul&&t._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Qi},handlePropertyChange:function(g){this._27o===g.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var E=this;E._96I||(E.setSelectRowIndex(-1),E._96I=1,E.iv())},redraw:function(){this.iv()},validateModel:function(){var A=this,G=A._rows,y=A._28o,W={},O=new fb,I=A._27o;A.updateCurrentData(),I!==A._27o&&A.endEditing(),G.clear(),y.clear(),A.getRawProperties().each(function(_){if(A.isVisible(_)){O.add(_);var i=A.getCategoryName(_);W[i]||(y.add(i,i===ls?0:H),W[i]={isExpanded:A.isExpanded(i),properties:new fb})}}),A._sortFunc&&O.sort(A._sortFunc);for(var x in A._26o)A._26Q[x]=A.isExpanded(x);A._26o=W,y.each(function(n){n!==ls&&G.add(n);var o=W[n];o.isExpanded&&O.each(function(M){A.getCategoryName(M)===n&&(o.properties.add(M),G.add({property:M,data:A._27o}))},A)})},validateImpl:function(){var d=this;d._76o(),d._96I&&(d.validateModel(),delete d._96I);var l=d._canvas,M=d.getWidth(),s=d.getHeight(),g=-d.ty(),U=d._rowHeight,f=d._indent,x=M-f,X=d._rows,Y=X.size(),r=d._9I=f+x*d._10I,N=d._59I=Y*U;op(l,M,s),d._29I={x:0,y:g,width:M,height:s},d._31I=$(g/U),d._14I=c((g+s)/U),d._31I<0&&(d._31I=0),d._14I>Y&&(d._14I=Y);var D,Z=Pg(l),v=d._background;np(Z,0,-g,1),Z.beginPath(),Z.rect(0,g,M,s),Z.clip(),Z.clearRect(0,g,M,s),d._93db(Z),v&&Yg(Z,0,0,f,N,v);for(var W=d._31I;W<d._14I;W++){var J=X.get(W),g=U*W;if(_e(J))v&&Yg(Z,f,g,x,U,v),D=qp(d.isExpanded(J)?d._expandIcon:d._collapseIcon),D&&mg(Z,D,Jc,0,g,f,U),Z.save(),Z.beginPath(),Z.rect(f,g,x,U),Z.clip(),d.drawCategoryName(Z,J,W,f,g,x,U),Z.restore();else{var u=J.property,O=J.data,D=qp(u.getIcon()),i=d._selectRowIndex===W?d.getSelectBackground():I;if(D&&mg(Z,D,Jc,0,g,f,U),i&&Yg(Z,f,g,x,U,i),Z.save(),Z.beginPath(),Z.rect(f,g,r-f,U),Z.clip(),d.drawPropertyName(Z,u,W,f,g,r-f,U),Z.restore(),!d.isEditing(O,u)){var G=r+1,m=M-r-1;Z.save(),Z.beginPath(),Z.rect(G,g,m,U),Z.clip(),d._87o(d.drawPropertyValue(Z,u,d.getValue(O,u),W,G,g,m,U,O),W,G,g,m,U),Z.restore()}}d._rowLineVisible&&Yg(Z,f,g+U-1,x,1,d._rowLineColor)}d._columnLineVisible&&(Yg(Z,r,0,1,N,d._columnLineColor),Yg(Z,M-1,0,1,N)),d._92db(Z),d._93I(),Z.restore(),d.ty(d.ty())},drawCategoryName:function(M,_,e,K,y,R,b){zj(M,_,this.getCategoryFont(_),this.getCategoryColor(_),K,y,R,b)},drawPropertyName:function(S,E,w,_,R,A,J){return E.drawPropertyName?(E.drawPropertyName(S,E,w,_,R,A,J,this),void 0):(zj(S,this.getPropertyName(E),this.getPropertyFont(E,w),this.getPropertyColor(E,w),_,R,A,J),void 0)},drawPropertyValue:function(R,Z,t,T,J,j,A,o,u){return Z.drawPropertyValue?Z.drawPropertyValue(R,Z,t,T,J,j,A,o,u,this):(Tf(R,t,Z,this.getLabelFont(Z,t,T),this.getLabelColor(Z,t,T),J,j,A,o,u,this),void 0)},isPropertyEditable:function(v){return v.isEditable()&&this.isEditable()},setProperties:function(K){this._propertyModel.clear(),this.addProperties(K)},addProperties:function(e){if(e){var B=this._propertyModel;e.forEach(function(t){if(!(t instanceof Fp)){var Y=Vf(t.className);t=Re(Y?Y:Fp,t)}B.add(t)})}},getRowIndexAt:function(H){var N=this,U=$(N.lp(H).y/N._rowHeight);return U>=0&&U<N._rows.size()?U:-1},getPropertyAt:function(i){var q=this,f=q.getRowIndexAt(i);return f>=0?q._rows.get(f).property:I},getToolTip:function(W){var u=this,s=u.getPropertyAt(W),K=u._27o;return s&&K?s.getToolTip(K,u._9I<u.lp(W).x,u):I}});var kp=function(U){this.pv=U,this.addListeners()};ab(kp,C,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(l){this.getView().style.cursor=l},clear:function(){var J=this;J._62O=J.cp=J.ty=J.p=I,J.setCursor(Ci)},handle_mousedown:function(T){this.handle_touchstart(T)},handle_touchstart:function(s){var k=this,b=k.pv;Oi(s),b.setFocus(s)&&(gc(s)?(k.cp=fm(s),k.ty=b.ty(),k.p=b.getColumnPosition(),k.handle_touchmove(s)):b.setSelectRowIndex(b.getRowIndexAt(s)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(b){this.handle_touchend(b)},handle_touchend:function(R){var l=this;if(l.cp&&!l._62O){var J=l.pv,g=J.lp(R),w=g.x,U=g.y,C=J._indent,r=J.getRowIndexAt(R),m=J._9I;if(r>=0){var k=J._rowHeight,L=k*r,j=J._rows.get(r),s=j.property;if(_e(j))qp(J.isExpanded(j)?J._expandIcon:J._collapseIcon)&&w>=0&&C>=w&&U>=L&&L+k>=U?J.toggle(j):Ih(R)&&J.toggle(j);else if(w>m&&J.isPropertyEditable(s,R)){var b={x:m+1,y:L,width:J.getWidth()-m-1,height:k},G={x:b.x+J.tx(),y:b.y+J.ty(),width:b.width,height:b.height},c=0,E=J._29I;b.y<E.y?c=b.y-E.y:b.y+k>E.y+E.height&&(c=b.y+k-E.y-E.height),c&&(J.ty(J.ty()-c),G.y-=c),J.beginEditing({data:j.data,property:s,value:J.getValue(j.data,s),event:R,rect:b,editorRect:G,view:J})}}J.setSelectRowIndex(r)}l.clear()},handleWindowMouseMove:function(I){this.handleWindowTouchMove(I)},handleWindowTouchMove:function(o){var n=this,J=n.pv,m=n.ty,c=n.cp,B=fm(o),p=n._62O;if("p"===p)J.setTranslateY(m+B.y-c.y);else if("c"===p){var E=J.getWidth()-J._indent;if(E>16){var P=n.p-(c.x-B.x)/E,q=16/E;q>P&&(P=q),P>1-q&&(P=1-q),J.setColumnPosition(P)}}else"s"===p&&J.setTranslateY(m+(c.y-B.y)*J._59I/J._29I.height)},handle_mousemove:function(l){this.handle_touchmove(l)},handle_touchmove:function(u){if(!Rm&&gc(u)){var Y=this,e=Y.pv,A=J(e.lp(u).x-e._9I)<=(hd?8:3);Y.cp?Y._62O||(A?(Y._62O="c",Ti(Y)):J(fm(u).y-Y.cp.y)>=2&&(Y._62O=Y.isV(u)?"s":"p",Ti(Y))):(A?Y.setCursor(rm):Y.setCursor(Ci),Y.isV(u)&&e._43o())}},isV:function(K){var o=this.pv,k=o._29I;return o._41o()&&k.x+k.width-o.lp(K).x<kr},handle_mousewheel:function(C){this.handleScroll(C,C.wheelDelta/40)},handle_DOMMouseScroll:function(U){2===U.axis&&this.handleScroll(U,-U.detail)},handleScroll:function(J,i){var L=this.pv;Oi(J),L.endEditing(),L.translate(0,i*L.getRowHeight())},handle_keydown:function(q){var P=this.pv,y=P._rows.size(),$=P._selectRowIndex+(Nl(q)?-1:1);(Nl(q)||Ik(q))&&(0>$&&($=0),$>=y&&($=y-1),P.setSelectRowIndex($))}}),an.ListView=function(A){this._5o(A),new bl(this)},Vd("ListView",C,{ms_ac:[Kp,Ek,Wo,Ud,te,Tl,nj,qe,Dr,Ji,Er,Qo,Wc,lp],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:Qk,_rowHeight:br,_rowLineVisible:h.listViewRowLineVisible,_rowLineColor:h.listViewRowLineColor,_scrollBarColor:jj,_scrollBarSize:Gl,_autoMakeVisible:pq,_autoHideScrollBar:Ec,_selectBackground:h.listViewSelectBackground,_labelColor:h.listViewLabelColor,_labelSelectColor:h.listViewLabelSelectColor,_labelFont:h.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(L){var q=this,T=q._checkMode;q._checkMode=L,q.fp(Oj,T,L)},drawRow:function(F,w,h,N,D,f,I){var q=this,V=0,e=q._indent,C=q.getIconWidth(w);q.drawRowBackground(F,w,h,N,D,f,I),q._checkMode&&(ll(F,qp(q.getCheckIcon(w)),V+e/2,D+I/2,w,q),V+=e),q.drawIcon(F,w,V,D,C,I),q.drawLabel(F,w,V+C,D,I)}});var bl=function(o){this.list=o,this._lastSelectDataTime=Xi(),this.addListeners()};ab(bl,C,{ms_listener:1,getView:function(){return this.list._view},clear:function(J){var h=this,s=h.list;J&&"d"===h._62O&&!h.dragCancel&&s.handleDragAndDrop(J,"end"),s.draggingData&&(s.draggingData=null,s.redraw()),h.dragCancel=h._62O=h._isV=h._isH=h.cp=h.tx=h.ty=I},handle_mousedown:function(z){this.handle_touchstart(z)},handle_touchstart:function(Q){var p=this,X=p.list;if(Oi(Q),X.setFocus(Q)){var $=X.getDataAt(Q);p.cp=fm(Q),p.tx=X.tx(),p.ty=X.ty(),gc(Q)?$&&X.handleDragAndDrop&&!p.isV(Q)&&!p.isH(Q)&&(X.draggingData=$,X.redraw(),X.handleDragAndDrop(Q,"prepare")):($&&p._33o(Q,$),p.clear(Q))}},handleWindowMouseUp:function(g){this.clear(g)},handleWindowTouchEnd:function(s){this.clear(s)},handle_mouseup:function(Z){this.handle_touchend(Z)},handle_touchend:function(Y){var E=this,N=E.list;if(!E._isV&&!E._isH&&E.cp&&!E._62O){var i=N.getDataAt(Y);i?(N.isCheckMode()?E._34o(Y,i):E._33o(Y,i),Ih(Y)?N.onDataDoubleClicked(i,Y):N.onDataClicked(i,Y)):N.handleBackgroundClick(Y)}E.clear(Y)},handleWindowMouseMove:function(U){this.handleWindowTouchMove(U)},handleWindowTouchMove:function(v){var Q=this,L=Q.list,G=Q._62O,U=Q.tx,l=Q.ty,s=Q.cp,q=fm(v),u=L._29I;"p"===G?L.setTranslate(U+q.x-s.x,l+q.y-s.y):"v"===G?L.ty(l+(s.y-q.y)*L._59I/u.height):"h"===G?L.tx(U+(s.x-q.x)*L._91I/u.width):"d"===G&&(Q.dragCancel||L.handleDragAndDrop(v,"between"))},handle_mousemove:function(G){this.handle_touchmove(G)},handle_touchmove:function(B){if(!Rm&&gc(B)){var P=this,D=P.list;if(P._isV=P.isV(B),P._isH=P.isH(B),P.cp){if(!P._62O){if(em(fm(B),P.cp)<2)return;P._isV?P._62O="v":P._isH?P._62O="h":D.draggingData&&!this.dragCancel?(P._62O="d",D.handleDragAndDrop(B,"begin")):P._62O="p",P._62O&&"d"!==P._62O&&D.draggingData&&(D.draggingData=null,D.redraw()),Ti(P)}}else P._isV&&D._43o(),P._isH&&D._42o()}},isV:function(y){var u=this.list,H=u._29I;return u._41o()&&H.x+H.width-u.lp(y).x<kr},isH:function(e){var C=this.list,p=C._29I;return C._40o()&&p.y+p.height-C.lp(e).y<kr},handle_mousewheel:function(K){this.handleScroll(K,K.wheelDelta/40,K.wheelDelta!==K.wheelDeltaX)},handle_DOMMouseScroll:function(h){this.handleScroll(h,-h.detail,1)},handleScroll:function(M,Z,O){var m=this.list;Oi(M),m.endEditing&&m.endEditing(),O&&m._41o()?m.translate(0,Z*m.getRowHeight()):m._40o()&&m.translate(10*Z,0)},handle_keydown:function(x){if(!h.isInput(x.target)){var y,O=this.list,j=O.sm(),s=O._rows,T=s.size();if(Ic(x))O.selectAll();else if(Ce(x))O.handleDelete&&O.handleDelete(x);else if(Cj(x))"d"!==this._62O||this.dragCancel||(O.handleDragAndDrop(x,"cancel"),this.dragCancel=!0);else if(ib(x))O.isCheckMode()&&(y=O.getFocusData(),y&&O.checkData(y));else if(Nl(x)||Ik(x)){var F=O.isCheckMode();if(y=F?O.getFocusData():j.ld()){var R=O.getRowIndex(y);R>=0&&(Nl(x)?0!==R&&(y=s.get(R-1),F?O.setFocusData(y):j.ss(y)):R!==T-1&&(y=s.get(R+1),F?O.setFocusData(y):j.ss(y)))}else T>0&&(y=s.get(0),F?O.setFocusData(y):j.ss(y))}}},_34o:function(m,f){var w=this.list,y=w.lp(m).x;return y>=0&&y<=w._indent?(w.checkData(f),void 0):(w.setFocusData(f),void 0)},_33o:function(T,v){var t=this.list,f=t.sm(),r=f.ld();if(aq(T))t.isSelected(v)?f.rs(v):f.as(v);else if(Ah(T))if(r)for(var M=t.getRowIndex(r),G=t.getRowIndex(v);M!==G;)M+=G>M?1:-1,f.as(t._rows.get(M));else f.ss(v);else if(gc(T)){var l=Xi();if(f.contains(v)){var q=l-this._lastSelectDataTime;t.handleDataDoubleSelect&&q>500&&1500>q&&t.handleDataDoubleSelect(T,v)}f.ss(v),this._lastSelectDataTime=l}else f.contains(v)||f.ss(v)}}),an.TreeView=function(o){var B=this;B._35o(),B._5o(o),new Tc(B)},Vd("TreeView",C,{ms_ac:[Kp,Ek,Wo,"rootVisible",Oj,"rootData",qe,Dr,Ji,Er,Qo,te,Ud,Tl,nj,Sl,on,Wc,lp,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:I,_indent:Qk,_rowHeight:br,_rowLineVisible:h.treeViewRowLineVisible,_rowLineColor:h.treeViewRowLineColor,_scrollBarColor:jj,_scrollBarSize:Gl,_autoHideScrollBar:Ec,_expandIcon:h.treeViewExpandIcon,_collapseIcon:h.treeViewCollapseIcon,_autoMakeVisible:pq,_selectBackground:h.treeViewSelectBackground,_labelColor:h.treeViewLabelColor,_labelSelectColor:h.treeViewLabelSelectColor,_labelFont:h.treeViewLabelFont,_doubleClickToToggle:h.treeViewDoubleClickToToggle,drawRow:function(f,g,c,u,l,F,x){var X=this;X.drawRowBackground(f,g,c,u,l,F,x),X._97I(f,g,c,0,l,F,x)},isOnToggleIcon:function(s){var w=this.getDataAt(s);if(w){var p=this.getIndent(),V=this.lp(s).x;if(qp(this.getToggleIcon(w))){var B=p*this.getLevel(w);if(V>=B&&B+p>=V)return!0}}return!1}});var Tc=function(m){zp(Tc,this,[m])};ab(Tc,bl,{toggle:function(Q,M,Y,o){var a=this.list,P=a.lp(Q).x;if(qp(a.getToggleIcon(M))){var C=Y*o;if(P>=C&&C+Y>=P)return a.toggle(M),!0}return a.isDoubleClickToToggle()&&Ih(Q)?(a.toggle(M),!0):!1},_34o:function(Q,U){var D=this.list,C=D.lp(Q).x,i=D._levelMap[U._id],v=D._indent,c=v*(i+1);return C>=c&&c+v>=C?(D.checkData(U),void 0):(this.toggle(Q,U,v,i)||D.setFocusData(U),void 0)},_33o:function(E,H){var R=this,D=R.list;R.toggle(E,H,D._indent,D.getLevel(H))||Tc.superClass._33o.call(R,E,H)},handle_keydown:function(k){if(Od(k)||Id(k)){var v=this.list,X=v._rows,t=v.isCheckMode(),q=v.sm(),M=t?v.getFocusData():q.ld();M?M.hasChildren()&&(Od(k)?v.collapse(M):v.expand(M)):X.size()>0&&(M=X.get(0),t?v.setFocusData(M):q.ss(M))}else Tc.superClass.handle_keydown.call(this,k)}});var Bq=an.TableView=function(e){this._98I(),this._5o(e),new Bj(this)};Vd("TableView",C,{ms_ac:[Kp,Ek,Wo,"sortMode",hm,hh,Ud,Tl,nj,lf,Zj,"sortColumn",qe,Dr,Ji,Er,Qo,Wc,lp],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:Ri,_editable:!0,_batchEditable:!1,_rowHeight:br,_rowLineVisible:h.tableViewRowLineVisible,_rowLineColor:h.tableViewRowLineColor,_columnLineVisible:h.tableViewColumnLineVisible,_columnLineColor:h.tableViewColumnLineColor,_scrollBarColor:jj,_scrollBarSize:Gl,_autoHideScrollBar:Ec,_autoMakeVisible:pq,_selectBackground:h.tableViewSelectBackground,_labelColor:h.tableViewLabelColor,_labelSelectColor:h.tableViewLabelSelectColor,_labelFont:h.tableViewLabelFont,getCheckColumn:function(){var B=this;if(!B._31o){var u=B._31o=new af;u.setEditable(!0),u.setWidth(40),u.getValue=B.getCheckColumValue,u.drawCell=B.drawCheckColumnCell}return B._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(t){var v=this,u=v._39o,l=v.getCheckColumn();t!==v.isCheckMode()&&(t?u.add(l,0):u.remove(l),v.fp(Oj,!t,t))},getCheckColumValue:function(Q,s,p){return p.isSelected(Q)},drawCheckColumnCell:function(R,G,u,S,K,t,y,B,v){ll(R,v.getCheckIcon(G),K+y/2,t+B/2,G,v)}});var Bj=function(k){zp(Bj,this,[k])};ab(Bj,bl,{_34o:function(b,t){var A=this.list,Q=A._31o;if(A.isCellEditable(t,Q,b)){var f=A._3Q(Q),v=A.lp(b).x;if(f&&v>=f.startX&&v<f.startX+Q.getWidth())return A.checkData(t),void 0}A._37O(t,b),A.setFocusData(t)},_33o:function(_,O){this.list._37O(O,_),Bj.superClass._33o.apply(this,arguments)}});var Fo=an.TreeTableView=function(C){var O=this,r=O._4o=new af;O._35o(),O._98I(),O._5o(C),r.setDisplayName("Name"),r.setEditable(!0),r.setWidth(180),r.drawCell=Wn,r.getValue=Nb,O._39o.add(r),new si(O)},Wn=function(x,r,m,n,e,s,C,Q,y){y._97I(x,r,m,e,s,C,Q)},Nb=function(s,k,q){return q.getLabel(s)};Vd("TreeTableView",C,{ms_ac:[Kp,Ek,Wo,"sortMode",hm,hh,te,Oj,"rootData","rootVisible",qe,Dr,"sortColumn",Sl,on,Ji,Er,Qo,Wc,nj,Ud,Tl,lf,Zj,lp,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:Ri,_checkMode:I,_editable:!0,_batchEditable:!1,_indent:Qk,_rowHeight:br,_rowLineVisible:h.treeTableViewRowLineVisible,_rowLineColor:h.treeTableViewRowLineColor,_columnLineVisible:h.treeTableViewColumnLineVisible,_columnLineColor:h.treeTableViewColumnLineColor,_expandIcon:h.treeTableViewExpandIcon,_collapseIcon:h.treeTableViewCollapseIcon,_scrollBarColor:jj,_scrollBarSize:Gl,_autoHideScrollBar:Ec,_autoMakeVisible:pq,_selectBackground:h.treeTableViewSelectBackground,_labelColor:h.treeTableViewLabelColor,_labelSelectColor:h.treeTableViewLabelSelectColor,_labelFont:h.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var si=function(v){zp(si,this,[v])};ab(si,bl,{_34o:function(R,E){var H=this.list,p=H._4o,W=H._3Q(p),K=H.lp(R).x;if(W){var x=H._indent,J=W.startX+x*H.getLevel(E);if(qp(H.getToggleIcon(E))&&K>=J&&J+x>=K)return H.toggle(E),void 0;if(H.isCellEditable(E,p)&&(J+=x,K>=J&&J+x>=K))return H.checkData(E),void 0}H._37O(E,R),H.setFocusData(E)},_33o:function(b,x){var D=this.list,G=D.lp(b).x;if(qp(D.getToggleIcon(x))){var O=D._3Q(D._4o);if(O){var L=D._indent,m=O.startX+L*D.getLevel(x);if(G>=m&&m+L>=G)return D.toggle(x),void 0}}D._37O(x,b),si.superClass._33o.apply(this,arguments)}});var Gj=an.TableHeader=function(N){var a=this,X=a._view=Di(1,a),Z=a._39o=N.getColumnModel(),m=a.iv;a.tv=a._tableView=N,a._60I=new fb,a._canvas=Ue(X),X.style.background=h.tableHeaderBackground||"",X.style.height=yb+pj,Z.mm(m,a),Z.md(m,a),Z.mh(m,a),N.mp(function(k){Yl[k.property]&&a.iv()},a),new ni(a),a.iv()};Vd("TableHeader",C,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Kp,Wo,te,"moveBackground","insertColor",lf,Zj,"resizable","movable"],_checkIcon:Dj,_movable:!0,_resizable:!0,_labelColor:h.tableHeaderLabelColor,_labelFont:h.tableHeaderLabelFont,_columnLineColor:h.tableHeaderColumnLineColor,_columnLineVisible:h.tableHeaderColumnLineVisible,_sortDescIcon:h.tableHeaderSortDescIcon,_sortAscIcon:h.tableHeaderSortAscIcon,_moveBackground:h.tableHeaderMoveBackground,_insertColor:h.tableHeaderInsertColor,_indent:Qk,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(e){return e.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(Z){return Z.getColor()||this._labelColor},getLabelAlign:function(l){return l._align},onPropertyChanged:function(){this.iv()},_5Q:function($){this._61I=$,this.iv()},getLogicalPoint:function(N){return ro(N,this._canvas,this.tv.tx())},validateImpl:function(){var o=this,f=o._canvas,C=o.getWidth(),E=o.getHeight(),O=o.tv,B=o._60I,T=o._61I,h=-O.tx(),p=0;(C!==f.clientWidth||E!==f.clientHeight)&&op(f,C,E),B.clear(),o._39o._roots.each(function(R){if(R.isVisible()){var T=p+R.getWidth();h+C>=p&&T>=h&&B.add({column:R,startX:p}),p=T}});var D=Pg(f);if(np(D,-h,0,1),D.beginPath(),D.rect(h,0,C,E),D.clip(),D.clearRect(h,0,C,E),B.each(function(P){var j=P.column,G=P.startX,i=j.getWidth();i>0&&(D.save(),D.beginPath(),D.rect(G,0,i,E),D.clip(),T&&T.column===j||o.drawColumn(D,j,G,0,i,E),o._columnLineVisible&&Yg(D,G+i-1,0,1,E,o._columnLineColor),D.restore())}),T){var J=T.column,p=T.startX,d=T.position,i=J.getWidth();D.save(),D.beginPath(),D.rect(p,0,i,E),D.clip(),D.fillStyle=o._moveBackground,D.fill(),o.drawColumn(D,J,p,0,i,E),D.restore(),Zb(D,o._insertColor,d,0,E)}D.restore()},_6Q:function(h){var e=this.tv;return e._31o===h&&e.sm().getSelectionMode()===Kq},drawColumn:function(o,y,d,W,S,c){var l=this,i=l.tv,h=qp(y.getIcon()),f=l.getLabelAlign(y);if(l._6Q(y)){var P=qp(l._checkIcon);ll(o,P,d+S/2,W+c/2,y,l)}else{var J=l.getLabel(y),r=l.getLabelFont(y),Y=l.getLabelColor(y),H=es(r,J).width,k=h?l._indent:0;f===Mn?(h&&mg(o,h,Jc,d,W,k,c),zj(o,J,r,Y,d+k,W,S,c,Mn)):f===rj?(h&&mg(o,h,Jc,d+S-H-k,W,k,c),zj(o,J,r,Y,d,W,S,c,rj)):(h&&mg(o,h,Jc,d+(S-H-k)/2,W,k,c),zj(o,J,r,Y,d+(S-H+k)/2,W,0,c,Mn))}if(y.isSortable()&&i.getSortColumn()===y&&(h=qp(y.getSortOrder()===Gh?l._sortAscIcon:l._sortDescIcon))){var U=uf(h,y)/2+2;ll(o,h,f===rj?d+U:d+S-U,W+c/2,y,i)}}});var ni=function(q){var d=this;d.th=q,d.tv=q._tableView,d.addListeners()};ab(ni,C,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(q){this.getView().style.cursor=q},handle_mousemove:function(Z){if(!Rm){var n=this;delete n._29o,n.setCursor(Ci);for(var l=n.th,V=l._60I,E=l.lp(Z).x,L=V.size()-1;L>=0;L--){var X=V.get(L),i=X.column,I=X.startX+i.getWidth();if(l.isResizable()&&J(I-E)<=(hd?10:3))return n._29o=X,n.setCursor(rm),void 0;E>X.startX&&I>E&&(n._29o=X),(i.isClickable()||i.isSortable()||l.isMovable()||n.tv.getCheckColumn&&i===n.tv.getCheckColumn())&&E>X.startX&&I>E&&n.setCursor(Yb)}}},handle_mousedown:function(M){this.handle_touchstart(M)},handle_touchstart:function(W){var R=this;Oi(W),R.tv.endEditing(),R.handle_mousemove(W),R._29o&&(R.x=fm(W).x,R.lx=R.th.lp(W).x,R.w=R._29o.column.getWidth(),Ti(R,W))},handleWindowMouseMove:function(A){this.handleWindowTouchMove(A)},handleWindowTouchMove:function(v){var m=this,e=m.th,O=m.getView().style.cursor,f=m._29o,$=fm(v).x-m.x;if(m.resizing||m.moving||(O===rm?m.resizing=1:e.isMovable()&&O===Yb&&J($)>2&&(m.moving=1)),m.resizing)f.column.setWidth(m.w+$);else if(m.moving){var y=m.lx+$;e._60I.each(function(i){var w=i.startX,D=w+i.column.getWidth();if(y>=w&&D>=y){var K={column:f.column,startX:f.startX+$,front:D-y>y-w,insertColumn:i.column};K.position=K.front?w:D,e._5Q(K)}})}},_16Q:function(j,E){var Y=this,c=Y.tv,k=Y.th,A=k._checkIcon;if(k._6Q(j)){var H=qp(A),u=Y.lx,w=j.getWidth(),z=uf(H,j);if(u>=E+w/2-z&&E+w/2+z>=u){k.setCheckIcon(A===Vk?Dj:Vk);var V=c.sm(),$=c._rows;return A===Vk?V.rs($):V.ss($),c.onCheckColumnClicked(j),!0}}return!1},handleWindowMouseUp:function(Z){this.handleWindowTouchEnd(Z)},handleWindowTouchEnd:function(q){var y=this,h=y.tv,b=y.th,m=y._29o;if(y.moving){var R=b._61I;if(R&&R.insertColumn!==R.column){var d=R.column,W=h.getColumnModel()._roots,s=W.remove(d),u=W.indexOf(R.insertColumn);u>=0&&(R.front||u++,u<=W.size()&&(W.add(d,u),h.getColumnModel()._38I(d,s,u)))}b._5Q(I),delete y.moving}else if(!y.resizing&&m){d=m.column;var U=b.lp(q).x,G=m.startX,Y=!0;if(b.onColumnClicked){var V=b.onColumnClicked(d,q,G);V===!1&&(Y=!1)}if(Y&&U>=G&&U<=G+d.getWidth()&&!y._16Q(d,G)){if(d.isSortable()){var Q=h.getSortMode(),e=d.getSortOrder();Q===Ri?h.getSortColumn()===d?(e===zb&&h.setSortColumn(I),d.setSortOrder(e===Gh?zb:Gh)):h.setSortColumn(d):"bistate"===Q&&(h.getSortColumn()===d?d.setSortOrder(e===Gh?zb:Gh):h.setSortColumn(d))}h.onColumnClicked(d,q,G)}}y._29o=y.resizing=y.x=y.lx=y.w=I}}),an.TablePane=function(T){this.init(new Bq(T))},Vd("TablePane",C,{ms_v:1,_44o:1}),an.TreeTablePane=function(w){this.init(new Fo(w))},Vd("TreeTablePane",C,{ms_v:1,_44o:1}),an.Toolbar=function(e){var H=this,Q=H._view=Di(1,H),O=Q.style;O.background=h.toolbarBackground||"",O.height=Zf+pj,H._canvas=Ue(Q),H._30o=new fb,H._90I=new fb,H.setItems(e||[]),Q.handleGroupSelectedChanged=function(j){if(j.isSelected()){var A=j.getGroupId();null!=A&&H._items.forEach(function(Y){var z=Y.element;
z&&z!==j&&z.setSelected&&z.getGroupId&&z.getGroupId()===A&&z.setSelected(!1)})}},new Ok(H)},Vd("Toolbar",C,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[Uj,Kp,Wo,Ek,lp,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:h.toolbarLabelColor,_labelSelectColor:h.toolbarLabelSelectColor,_labelFont:h.toolbarLabelFont,_selectBackground:h.toolbarSelectBackground,_itemGap:h.toolbarItemGap,_separatorColor:h.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function($){var o=this.getItemInfoAt($);return o?o.item.toolTip:I},getLabelColor:function(_){return _&&_.selected&&_.type!==Vk&&_.type!==tg?this._labelSelectColor:this._labelColor},onPropertyChanged:function(z){this.iv(),z.property===Uj&&this._items.forEach(function(L){Bp(L)})},redraw:function(){this.iv()},addItem:function(O,i){var n=this._items;i==I?n.push(O):n.splice(i,0,O),this.fp(Uj,I,n)},removeItem:function(i){if(i)for(var y=this._items,m=0;m<y.length;m++)i===y[m]&&(y.splice(m,1),this.fp(Uj,I,y))},removeItemById:function(L){if(L!=I)for(var P=this._items,a=0;a<P.length;a++)if(L===P[a].id){var U=P.splice(a,1)[0];return this.fp(Uj,I,P),U}},getItemById:function(z){if(z!=I)for(var U=this._items,v=0;v<U.length;v++){var o=U[v];if(z===o.id)return o}},setItemVisible:function(b,O){var _=this.getItemById(b);_&&(_.visible=O)},getItemInfos:function(){return this._30o},getItemInfoAt:function(U){var _=this,X=0,h=_._30o,B=_.lp(U),D=B.x,L=B.y;if(L>=0&&L<=_.getHeight())for(;X<h.size();X++){var i=h.get(X);if(i.startX<=D&&D<=i.endX)return i}return I},drawItem:function(Q,x,z,d,L){if(x.visible===!1)return 0;if(gj(x.visible)&&!x.visible())return 0;var B=this,n=x.disabled;n&&(Q.globalAlpha=qf);var E=B.drawItemImpl(Q,x,z,d,L),f=B._itemGap;return n&&(Q.globalAlpha=1),this._currentItem!==x||"separator"===x||x.separator===!0||x.unfocusable||Wr(Q,B._separatorColor,z-f/2,0,E+f,d),E},drawItemImpl:function(s,W,Y,Z,z){var S=this,l=S._view,A=S._itemGap,h=Z/2,q=W.type,O=W.element,T=W.label;_e(O)&&(T=O,O=I);var V,U=S.getLabelFont(W),p=S.getLabelColor(W),y=W.selected,m=qp(W.icon),L=uf(m,W),R=0,G=L+(T?es(U,T).width:0);if("separator"===W||W.separator===!0)return Zb(s,S._separatorColor,Y,Z/4,h),1;if(O){m&&ll(s,m,Y+L/2,h,W,S),zj(s,T,U,p,Y+L,0,0,Z);var Q=eq(O);z||S._90I.add(Q),Q.parentNode!==l&&jr(l,Q),O.iv&&O.iv(),O.validate&&O.validate();var b=Q.getBoundingClientRect(),o=b.width,F=Q.style;return zq(Q),F.left=S.tx()+Y+G+pj,F.top=(Z-b.height)/2+pj,G+o}return q===tg?V=qp(y?Dm:Si):q===Vk&&(V=qp(y?Vk:Dj)),V?(R=uf(V,W),ll(s,V,Y+R/2,h,W,S),Y+=R,G+=R):y&&Yg(s,Y-A/2,0,G+A,Z,S.getSelectBackground(W)),m&&ll(s,m,Y+L/2,h,W,S),zj(s,T,U,p,Y+L,0,0,Z),G},validateImpl:function(){var k=this,Z=k._canvas,U=k.getWidth(),j=k.getHeight(),c=k._30o,Q=k._items;op(Z,U,j);var O=Pg(Z),T=k._itemGap,f=T/2;np(O,k.tx(),0,1),O.clearRect(0,0,U,j);var $=k._90I;k._90I=new fb,c.clear(),Q.forEach(function(C){var d=k.drawItem(O,C,f,j);c.add({item:C,startX:f,endX:f+d,width:d}),d&&(f+=d+T)}),$.each(function(v){k._90I.contains(v)||Wb(v)});var r=k._64I;k._64I=o(0,f),O.restore(),k._stickToRight?(k._65O=0,O=Pg(Z),f=U-k._64I+T,np(O,0,0,1),O.clearRect(0,0,U,j),c.clear(),Q.forEach(function(g){var z=k.drawItem(O,g,f,j,!0);c.add({item:g,startX:f,endX:f+z,width:z}),z&&(f+=z+T)}),O.restore()):k.tx(k.tx()),r!==k._64I&&k.onSumWidthChanged(r,k._64I)},onSumWidthChanged:function(){},handleClick:function(P,A){var f=this,X=P.type,C=P.action,x=P.groupId,i=P.selected;P.disabled||(x!=I?i||(P.selected=!0,this._items.forEach(function(A){A.groupId===x&&P!==A&&(A.selected=!1)}),C&&P.action(P,f,A)):X===Vk||"toggle"===X?(P.selected=!i,C&&P.action(P,f,A)):C&&P.action(P,f,A)),Kg(),f.iv()}});var Ok=function(c){this.tb=c,this.addListeners()};ab(Ok,C,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(O){this.handleScroll(O,10*(O.wheelDelta/40))},handle_DOMMouseScroll:function(t){this.handleScroll(t,10*-t.detail)},handleScroll:function(y,M){Oi(y);var c=this.tb;c.isScrollable()&&!c._stickToRight&&(c.tx(c.tx()+M),$n())},handle_mousemove:function(u){var Q=this;Rm||Q.setItem(u)},handle_mouseout:function(c){var T=this;c.target===T.getView()?T.tb.setCurrentItem(I):T.handle_mousemove(c)},handle_mousedown:function(z){this.handle_mousemove(z),this.handle_touchstart(z)},handle_touchstart:function(O){var X=this,Y=X.tb,h=O.target;gc(O)&&(h===X.getView()||h===Y._canvas)&&(Oi(O),Y.setFocus(O)&&(this.setItem(O,!0),(Y.isScrollable()||X.info&&!X.info.item.disabled)&&(X.x=fm(O).x,X.tx=Y.tx(),Ti(X,O))))},handleWindowMouseMove:function(j){this.handleWindowTouchMove(j)},handleWindowTouchMove:function($){var L=this,c=L.tb;if(!c._stickToRight){var d=fm($).x-L.x;!L._25o&&J(d)>2&&c.isScrollable()&&(L._25o=1),L._25o&&c.tx(L.tx+d)}},handleWindowMouseUp:function(b){this.handleWindowTouchEnd(b)},handleWindowTouchEnd:function(W){var R=this,D=R.tb,o=R.info,J=R.tb.getItemInfoAt(W);if(!R._25o&&o){var H=o.item;J&&J.item===H&&D.handleClick(H,W)}R._25o=R.x=R.tx=I,R.setItem()},setItem:function(s,w){var e=this,K=e.tb,P=e.info=s?K.getItemInfoAt(s):I,v=P?P.item:I;K.setCurrentItem(v),w&&v&&gj(v.onDown)&&v.onDown(s)}}),an.BorderPane=function(){this._view=Di(1,this),this.iv()},Vd("BorderPane",C,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(z,E){this._12o("leftView",z),E!=I&&this.setLeftWidth(E)},getRightView:function(){return this._rightView},setRightView:function(R,s){this._12o("rightView",R),s!=I&&this.setRightWidth(s)},getTopView:function(){return this._topView},setTopView:function(S,R){this._12o("topView",S),R!=I&&this.setTopHeight(R)},getBottomView:function(){return this._bottomView},setBottomView:function(m,E){this._12o("bottomView",m),E!=I&&this.setBottomHeight(E)},getCenterView:function(){return this._centerView},setCenterView:function(j){this._12o("centerView",j)},_12o:function(R,x){var S=this,O="_"+R,b=S._view,a=S[O];a!==x&&(a&&(a.getView?Wb(a.getView()):Wb(a)),S[O]=x,x&&(x.getView?jr(b,x.getView(),1):jr(b,x,1)),S.fp(R,a,x))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var r=this,G=r._topView,e=r._bottomView,V=r._leftView,f=r._rightView,U=r._centerView,g=r.getWidth(),H=r.getHeight(),u=0,L=0,h=g,T=H,A=0,c=0,y=0,O=0;G&&(A=r._topHeight==I?Gc(G):r._topHeight,L=A),e&&(c=r._bottomHeight==I?Gc(e):r._bottomHeight,T=H-c),V&&(y=r._leftWidth==I?cn(V):r._leftWidth,u=y),f&&(O=r._rightWidth==I?cn(f):r._rightWidth,h=g-O);var B=o(0,h-u),m=o(0,T-L);G&&Hr(G,0,0,g,A),e&&Hr(e,0,T,g,c),V&&Hr(V,0,L,y,m),f&&Hr(f,h,L,O,m),U&&Hr(U,u,L,B,m)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);